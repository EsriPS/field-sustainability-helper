"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[8526],{45028:function(e,t,n){n.d(t,{C:function(){return C},b:function(){return S}});var r,i,a,o,s,l,u,c,d=n(30168),h=n(33280),f=n(94951),p=n(48655),v=n(16574),g=n(137),m=n(21002),y=n(15226),_=n(10763),b=n(116),x=n(98634),w=n(64201);function S(e){var t=new w.kG,n=1===e.output;return t.include(f.w,{linearDepth:n}),t.include(p.c,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),n&&(t.include(v.F,e),t.vertex.uniforms.add("cameraNearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add((0,x.H)(r||(r=(0,d.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      ","\n      gl_Position = ","\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",n?(0,x.H)(i||(i=(0,d.Z)(["transformPositionWithDepth(proj, view, vpos, cameraNearFar, linearDepth);"]))):(0,x.H)(a||(a=(0,d.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(h.p2,e),t.fragment.include(b.Y),e.multipassTerrainEnabled&&(t.fragment.include(m.S),t.include(y.l,e)),t.fragment.uniforms.add("eColor","vec4"),4===e.output&&t.include(g.bA),t.fragment.code.add((0,x.H)(o||(o=(0,d.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 color = ","\n\n    if (color.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n  }\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.attributeColor?"vColor * eColor;":"eColor;",x.H.float(_.bf),7===e.output?(0,x.H)(s||(s=(0,d.Z)(["gl_FragColor = vec4(color.a);"]))):"",0===e.output?(0,x.H)(l||(l=(0,d.Z)(["gl_FragColor = highlightSlice(color, vpos); ",""])),e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",4===e.output?(0,x.H)(u||(u=(0,d.Z)(["outputHighlight();"]))):"",1===e.output?(0,x.H)(c||(c=(0,d.Z)(["outputDepth(linearDepth);"]))):"")),t}var C=Object.freeze({__proto__:null,build:S})},18442:function(e,t,n){n.d(t,{H:function(){return W},a:function(){return F},b:function(){return j},c:function(){return U}});var r,i,a,o,s,l,u,c,d,h,f,p,v,g,m,y,_,b,x,w=n(30168),S=n(88396),C=n(6394),P=n(67077),T=n(33280),D=n(28156),O=n(81879),E=n(50913),R=n(137),k=n(18607),Z=n(10763),A=n(116),M=n(78980),z=n(62993),H=n(98634),L=n(64201);function F(e){var t=new L.kG,n=e.signedDistanceFieldEnabled;if(t.include(D.H),t.include(O.R,e),t.include(T.p2,e),6===e.output)return t.include(E.R,e),t;t.include(z.c),t.fragment.include(M.n),t.fragment.include(A.Y),t.include(k.kl,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),n&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add("uv0","vec2"),t.attributes.add("color","vec4"),t.attributes.add("size","vec2"),t.attributes.add("auxpos2","vec4"),t.vertex.code.add((0,H.H)(r||(r=(0,w.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.screenSizePerspectiveEnabled?(0,H.H)(i||(i=(0,w.Z)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,H.H)(a||(a=(0,w.Z)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var S=(0,H.H)(o||(o=(0,w.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),C=e.pixelSnappingEnabled?n?(0,H.H)(s||(s=(0,w.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,H.H)(l||(l=(0,w.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,H.H)(u||(u=(0,w.Z)(["posProj += quadOffset;"])));t.vertex.code.add((0,H.H)(c||(c=(0,w.Z)(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",S,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",H.H.float(Z.bf),n?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(H.H.float(Z.bf),";"):"",C,e.debugDrawBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,H.H)(d||(d=(0,w.Z)(["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),n&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var P=e.debugDrawBorder?(0,H.H)(h||(h=(0,w.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),H.H.float(Z.F)):H.H.float(Z.F),F=(0,H.H)(f||(f=(0,w.Z)(["\n    ","\n\n    ","\n\n    ","\n  "])),e.debugDrawBorder?(0,H.H)(p||(p=(0,w.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",n?(0,H.H)(v||(v=(0,w.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = 128.0;\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),P,H.H.float(Z.bf),P):(0,H.H)(g||(g=(0,w.Z)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),P),e.debugDrawBorder?(0,H.H)(m||(m=(0,w.Z)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):"");return 7===e.output&&t.fragment.code.add((0,H.H)(y||(y=(0,w.Z)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),F)),0===e.output&&t.fragment.code.add((0,H.H)(_||(_=(0,w.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),F,e.FrontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":"")),4===e.output&&(t.include(R.bA),t.fragment.code.add((0,H.H)(b||(b=(0,w.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),F,e.binaryHighlightOcclusionEnabled?(0,H.H)(x||(x=(0,w.Z)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function j(e,t,n){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",P.Z),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*n,2*t.screenOffset[1]*n),e.setUniform2fv("anchorPos",U(t))}function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:V;return e.textureIsSignedDistanceField?I(e.anchorPos,e.distanceFieldBoundingBox,t):(0,S.c)(t,e.anchorPos),t}function I(e,t,n){n[0]=e[0]*(t[2]-t[0])+t[0],n[1]=e[1]*(t[3]-t[1])+t[1]}var V=(0,C.a)(),W=Object.freeze({__proto__:null,build:F,bindHUDMaterialUniforms:j,calculateAnchorPosForRendering:U})},99337:function(e,t,n){n.d(t,{N:function(){return P},b:function(){return C}});var r,i,a,o,s,l,u,c,d,h,f,p=n(30168),v=n(1413),g=n(33280),m=n(94951),y=n(48655),_=n(137),b=n(37248),x=n(10763),w=n(98634),S=n(64201);function C(e){var t=new S.kG;return t.include(m.w,{linearDepth:!1}),t.include(y.c,e),t.include(b.q,(0,v.Z)((0,v.Z)({},e),{},{stippleRequiresStretchMeasure:!1})),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3")),t.attributes.add("position","vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add((0,w.H)(r||(r=(0,p.Z)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);"])))),e.stippleEnabled&&(t.vertex.code.add((0,w.H)(i||(i=(0,p.Z)(["vec4 vpos2 = transformPosition(proj, view, auxpos1);\nfloat lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);"])))),e.draped||t.vertex.code.add((0,w.H)(a||(a=(0,p.Z)(["vec3 segmentCenter = (position + auxpos1) * 0.5;\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),t.vertex.code.add((0,w.H)(o||(o=(0,p.Z)(["float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);"])))),e.draped?t.vertex.code.add((0,w.H)(s||(s=(0,p.Z)(["float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);\nfloat segmentLengthPseudoScreen = lineSegmentPixelSize;"])))):t.vertex.code.add((0,w.H)(l||(l=(0,p.Z)(["float segmentLengthRender = length(position - auxpos1);\nfloat startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),t.vertex.code.add((0,w.H)(u||(u=(0,p.Z)(["vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);\nvStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);\nvStippleDistance *= gl_Position.w;"]))))),t.vertex.code.add((0,w.H)(c||(c=(0,p.Z)(["}"])))),4===e.output&&t.include(_.bA),t.include(g.p2,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add((0,w.H)(d||(d=(0,p.Z)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",w.H.float(x.bf),0===e.output?(0,w.H)(h||(h=(0,p.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",4===e.output?(0,w.H)(f||(f=(0,p.Z)(["outputHighlight();"]))):"")),t}var P=Object.freeze({__proto__:null,build:C})},98186:function(e,t,n){n.d(t,{N:function(){return te},R:function(){return re},b:function(){return ne}});var r,i,a,o,s,l,u,c,d,h,f,p,v,g,m,y,_,b,x,w,S,C,P,T,D,O,E,R,k,Z,A,M,z,H,L,F,j,U,I,V=n(30168),W=n(1413),N=n(33280),G=n(48353),B=n(16574),q=n(21002),J=n(37248),$=n(15226),Y=n(85586),X=n(10763),K=n(116),Q=n(98634),ee=n(64201),te=1;function ne(e){var t=new ee.kG,n=e.stippleEnabled&&e.roundCaps,ne=e.falloffEnabled||n,re=e.innerColorEnabled,ie=e.stippleEnabled&&e.stippleScaleWithLineWidth||e.roundCaps,ae=e.stippleEnabled&&e.stippleScaleWithLineWidth;return t.extensions.add("GL_OES_standard_derivatives"),t.include(Y.e),t.include(G.U,e),t.include(J.q,(0,W.Z)((0,W.Z)({},e),{},{stippleRequiresStretchMeasure:n})),1===e.output&&t.include(B.F,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraNearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2"),t.attributes.add("position","vec3"),t.attributes.add("subdivisionFactor","float"),t.attributes.add("uv0","vec2"),t.attributes.add("auxpos1","vec3"),t.attributes.add("auxpos2","vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),ie&&t.varyings.add("vLineWidth","float"),ae&&t.varyings.add("vLineSizeInv","float"),re&&t.varyings.add("vLineDistance","float"),ne&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),e.roundCaps&&t.varyings.add("vCapPosition","vec2"),n&&t.varyings.add("vStipplePatternStretch","float"),t.vertex.code.add((0,Q.H)(r||(r=(0,V.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),t.vertex.code.add((0,Q.H)(i||(i=(0,V.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= screenSize / posNdc.w;\nreturn posNdc;\n}"])))),t.vertex.code.add((0,Q.H)(a||(a=(0,V.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = cameraNearFar[0] * 0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z > -cameraNearFar[0]) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z < -cameraNearFar[0]) {\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z < -cameraNearFar[0]) {\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z > -cameraNearFar[0]) {\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z > -cameraNearFar[0]) {\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = (-pos.z - cameraNearFar[0]) / (cameraNearFar[1] - cameraNearFar[0]);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n"])),e.multipassTerrainEnabled?"depth = pos.z;":"")),t.vertex.code.add((0,Q.H)(o||(o=(0,V.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n    vpos = position;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n\n      float lineSize = getSize();\n      float lineWidth = lineSize * pixelRatio;\n\n      ","\n      ","\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "])),ie?(0,Q.H)(s||(s=(0,V.Z)(["vLineWidth = lineWidth;"]))):"",ae?(0,Q.H)(l||(l=(0,V.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),e.stippleEnabled&&t.vertex.code.add((0,Q.H)(u||(u=(0,V.Z)(["float isEndVertex = float(!isStartVertex);\nvec4 segmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), isEndVertex);\nvec2 segmentOrigin = segmentInfo.xy;\nvec2 segment = segmentInfo.zw;"])))),t.vertex.code.add((0,Q.H)(c||(c=(0,V.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?t.vertex.code.add((0,Q.H)(d||(d=(0,V.Z)(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen < 0.001) {\n          startDir = right;\n        }\n        else{\n          startDir = left;\n        }\n        startDir = normalize(startDir);\n        startDir = PERPENDICULAR(startDir);\n\n        if (rightLen < 0.001) {\n          endDir = left;\n        }\n        else{\n          endDir = right;\n        }\n        endDir = normalize(endDir);\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,Q.H)(h||(h=(0,V.Z)(["min(1.0, subdivisionFactor * ",")"])),Q.H.float((te+2)/(te+1))):(0,Q.H)(f||(f=(0,V.Z)(["subdivisionFactor"]))))):t.vertex.code.add((0,Q.H)(p||(p=(0,V.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = normalize(joinDisplacementDir);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"])))),t.vertex.code.add((0,Q.H)(v||(v=(0,V.Z)(["displacementLen = lineWidth;\n}\n} else {\nif (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = isStartVertex ? right : left;\n}\njoinDisplacementDir = normalize(joinDisplacementDir);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\ndisplacementLen = lineWidth;\ncapDisplacementDir = isStartVertex ? -right : left;\ncapDisplacementDir *= subdivisionFactor;\n}"])))),t.vertex.code.add((0,Q.H)(g||(g=(0,V.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n    ","\n\n    ","\n    ","\n\n    ","\n\n    pos.xy += dpos;\n  "])),ne||re?(0,Q.H)(m||(m=(0,V.Z)(["float lineDistNorm = sign(uv0.y) * pos.w;"]))):"",re?(0,Q.H)(y||(y=(0,V.Z)(["vLineDistance = lineWidth * lineDistNorm;"]))):"",ne?(0,Q.H)(_||(_=(0,V.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"",e.roundCaps?(0,Q.H)(b||(b=(0,V.Z)(["vCapPosition = isJoin ? vec2(0.0) : dpos;"]))):"")),e.stippleEnabled&&(e.draped||t.vertex.code.add((0,Q.H)(x||(x=(0,V.Z)(["vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),t.vertex.code.add((0,Q.H)(w||(w=(0,V.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));"])))),e.draped?t.vertex.code.add((0,Q.H)(S||(S=(0,V.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):t.vertex.code.add((0,Q.H)(C||(C=(0,V.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),t.vertex.code.add((0,Q.H)(P||(P=(0,V.Z)(["\n      float patternLength = "," stipplePatternPixelSize;\n\n      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader\n      // The 0.5 factor on the screen length is to correct for pixel ratio (it is calculated at double resolution)\n      ","\n\n      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\n\n      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)\n      if (segmentLengthScreenDouble >= 0.001) {\n        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the\n        // original vertex positions, and slightly outside of that range at the displaced positions\n        vec2 stippleDisplacement = pos.xy - segmentOrigin;\n        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\n\n        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)\n        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n      }\n\n      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance\n      vStippleDistanceLimits *= pos.w;\n      vStippleDistance *= pos.w;\n    "])),e.stippleScaleWithLineWidth?"lineSize * ":"",n?(0,Q.H)(T||(T=(0,V.Z)(["\n            vec3 stippleSegmentInfo = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\n            vStippleDistanceLimits = stippleSegmentInfo.xy;\n            vStipplePatternStretch = stippleSegmentInfo.z;"]))):(0,Q.H)(D||(D=(0,V.Z)(["\n            vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);"])))))),t.vertex.code.add((0,Q.H)(O||(O=(0,V.Z)(["pos.xy = pos.xy / screenSize * pos.w;\nvColor = getColor();\nvColor.a *= coverage;\ngl_Position = pos;\n}\n}"])))),e.multipassTerrainEnabled&&(t.fragment.include(q.S),t.include($.l,e)),t.include(N.p2,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(K.Y),t.fragment.code.add((0,Q.H)(E||(E=(0,V.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.roundCaps&&t.fragment.code.add((0,Q.H)(R||(R=(0,V.Z)(["\n    float fragmentRadius = length(vCapPosition);\n    float fragmentSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n    float capCoverage = clamp(0.5 - fragmentSDF, 0.0, 1.0);\n    if (capCoverage < ",") {\n      discard;\n    }\n  "])),Q.H.float(X.bf))),n?t.fragment.code.add((0,Q.H)(k||(k=(0,V.Z)(["\n      vec2 stipplePosition = vec2(\n        max(1.0 - getStippleSDF() * 2.0 * vStipplePatternStretch, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n    "])),Q.H.float(X.bf))):t.fragment.code.add((0,Q.H)(Z||(Z=(0,V.Z)(["float stippleAlpha = getStippleAlpha();"])))),t.fragment.code.add((0,Q.H)(A||(A=(0,V.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\nvec4 color = intrinsicColor * vColor;"])))),t.fragment.uniforms.add("pixelRatio","float"),e.innerColorEnabled&&t.fragment.code.add((0,Q.H)(M||(M=(0,V.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"])))),t.fragment.code.add((0,Q.H)(z||(z=(0,V.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&t.fragment.code.add((0,Q.H)(H||(H=(0,V.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))),t.fragment.code.add((0,Q.H)(L||(L=(0,V.Z)(["\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),Q.H.float(X.bf),7===e.output?(0,Q.H)(F||(F=(0,V.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",0===e.output?(0,Q.H)(j||(j=(0,V.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",0===e.output&&e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",4===e.output?(0,Q.H)(U||(U=(0,V.Z)(["gl_FragColor = vec4(1.0);"]))):"",1===e.output?(0,Q.H)(I||(I=(0,V.Z)(["outputDepth(linearDepth);"]))):"")),t}var re=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:te,build:ne})},61863:function(e,t,n){n.d(t,{T:function(){return u},b:function(){return l}});var r,i=n(30168),a=n(74321),o=n(98634),s=n(64201);function l(){var e=new s.kG;return e.include(a.k),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("color","vec4"),e.fragment.code.add((0,o.H)(r||(r=(0,i.Z)(["void main() {\nvec4 texColor = texture2D(tex, uv);\ngl_FragColor = texColor * color;\n}"])))),e}var u=Object.freeze({__proto__:null,build:l})},49810:function(e,t,n){n.d(t,{W:function(){return E},b:function(){return O}});var r,i,a,o,s,l,u,c,d,h,f=n(30168),p=n(22357),v=n(33280),g=n(94951),m=n(137),y=n(21002),_=n(15226),b=n(8555),x=n(23235),w=n(90782),S=n(79246),C=n(10763),P=n(116),T=n(98634),D=n(64201);function O(e){var t=new D.kG;return t.include(g.w,{linearDepth:!1}),t.attributes.add("position","vec3"),t.attributes.add("uv0","vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),0!==e.output&&7!==e.output||(t.include(b.n,e),t.include(p.q,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add((0,T.H)(r||(r=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),T.H.float(C.bf),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",0===e.output?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(y.S),t.include(_.l,e)),7===e.output&&(t.include(v.p2,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add((0,T.H)(i||(i=(0,f.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),0===e.output&&(t.include(S.M,e),t.include(v.p2,e),e.receiveShadows&&t.include(x.hX,e),t.include(w.B,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(P.Y),t.fragment.code.add((0,T.H)(a||(a=(0,f.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - camPos);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?(0,T.H)(o||(o=(0,f.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.OITEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),2===e.output&&(t.include(b.n,e),t.include(S.M,e),t.include(v.p2,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add((0,T.H)(s||(s=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),T.H.float(C.bf))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add((0,T.H)(l||(l=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))))),5===e.output&&(t.varyings.add("vpos","vec3"),t.vertex.code.add((0,T.H)(u||(u=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),T.H.float(C.bf))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add((0,T.H)(c||(c=(0,f.Z)(["void main() {\ngl_FragColor = waterColor;\n}"]))))),4===e.output&&(t.include(m.bA),t.varyings.add("vpos","vec3"),t.vertex.code.add((0,T.H)(d||(d=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),T.H.float(C.bf))),t.include(v.p2,e),t.fragment.code.add((0,T.H)(h||(h=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))),t}var E=Object.freeze({__proto__:null,build:O})},82218:function(e,t,n){n.d(t,{a:function(){return x},c:function(){return b},g:function(){return Z},h:function(){return P},u:function(){return S}});var r=n(37762),i=n(43144),a=n(15671),o=(n(93169),n(32718)),s=n(16889),l=n(21530),u=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(85981),p=n(55652),v=n(40885),g=n(40927),m=n(11185),y=o.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),_=(0,i.Z)((function e(){(0,a.Z)(this,e),this.plane=(0,p.Ue)(),this.origin=(0,h.c)(),this.basis1=(0,h.c)(),this.basis2=(0,h.c)()}));function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U;return{plane:(0,p.Ue)(e.plane),origin:(0,h.a)(e.origin),basis1:(0,h.a)(e.basis1),basis2:(0,h.a)(e.basis2)}}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b();return w(e.origin,e.basis1,e.basis2,t)}function w(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:b();return(0,d.g)(r.origin,e),(0,d.g)(r.basis1,t),(0,d.g)(r.basis2,n),S(r),F(r,"fromValues()"),r}function S(e){(0,p.my)(e.basis2,e.basis1,e.origin,e.plane)}function C(e,t,n){e!==n&&x(e,n);var r=(0,d.a)(m.WM.get(),M(e),t);return(0,d.b)(n.origin,n.origin,r),n.plane[3]-=t,n}function P(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b(),n=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,d.s)(t.origin,e[0]+n,e[1]+r,0),(0,d.s)(t.basis1,n,0,0),(0,d.s)(t.basis2,0,r,0),(0,p.al)(0,0,1,0,t.plane),t}function T(e,t,n){return!!(0,p.BR)(e.plane,t,n)&&z(e,n)}function D(e,t,n){var i=I.get();j(e,t,i,I.get());var a,o=Number.POSITIVE_INFINITY,l=(0,r.Z)(G);try{for(l.s();!(a=l.n()).done;){var u=L(e,a.value,V.get()),c=m.WM.get();if((0,p.rx)(i,u,c)){var h=(0,d.r)(m.WM.get(),t.origin,c),f=Math.abs((0,s.ZF)((0,d.d)(t.direction,h)));f<o&&(o=f,(0,d.g)(n,c))}}}catch(v){l.e(v)}finally{l.f()}return o===Number.POSITIVE_INFINITY?O(e,t,n):n}function O(e,t,n){if(T(e,t,n))return n;var i=I.get(),a=I.get();j(e,t,i,a);var o,s=Number.POSITIVE_INFINITY,l=(0,r.Z)(G);try{for(l.s();!(o=l.n()).done;){var u=L(e,o.value,V.get()),c=m.WM.get();if((0,p.dZ)(i,u,c)){var h=(0,v.Jk)(t,c);if(!(0,p.Ac)(a,c))continue;h<s&&(s=h,(0,d.g)(n,c))}}}catch(f){l.e(f)}finally{l.f()}return k(e,t.origin)<s&&E(e,t.origin,n),n}function E(e,t,n){var r=(0,p.nF)(e.plane,t,m.WM.get()),i=(0,f.ct)(H(e,e.basis1),r,-1,1,m.WM.get()),a=(0,f.ct)(H(e,e.basis2),r,-1,1,m.WM.get());return(0,d.f)(n,(0,d.b)(m.WM.get(),i,a),e.origin),n}function R(e,t,n){var r=e.origin,i=e.basis1,a=e.basis2,o=(0,d.f)(m.WM.get(),t,r),s=(0,g.SR)(i,o),l=(0,g.SR)(a,o),u=(0,g.SR)(M(e),o);return(0,d.s)(n,s,l,u)}function k(e,t){var n=R(e,t,m.WM.get()),r=e.basis1,i=e.basis2,a=(0,d.l)(r),o=(0,d.l)(i),s=Math.max(Math.abs(n[0])-a,0),l=Math.max(Math.abs(n[1])-o,0),u=n[2];return s*s+l*l+u*u}function Z(e,t){return Math.sqrt(k(e,t))}function A(e,t){var n=-e.plane[3];return(0,g.SR)(M(e),t)-n}function M(e){return(0,p.mJ)(e.plane)}function z(e,t){var n=(0,d.f)(m.WM.get(),t,e.origin),r=(0,d.p)(e.basis1),i=(0,d.p)(e.basis2),a=(0,d.d)(e.basis1,n),o=(0,d.d)(e.basis2,n);return-a-r<0&&a-r<0&&-o-i<0&&o-i<0}function H(e,t){var n=V.get();return(0,d.g)(n.origin,e.origin),(0,d.g)(n.vector,t),n}function L(e,t,n){var r=e.basis1,i=e.basis2,a=e.origin,o=(0,d.a)(m.WM.get(),r,t.origin[0]),s=(0,d.a)(m.WM.get(),i,t.origin[1]);(0,d.b)(n.origin,o,s),(0,d.b)(n.origin,n.origin,a);var l=(0,d.a)(m.WM.get(),r,t.direction[0]),u=(0,d.a)(m.WM.get(),i,t.direction[1]);return(0,d.a)(n.vector,(0,d.b)(l,l,u),2),n}function F(e,t){Math.abs((0,d.d)(e.basis1,e.basis2)/((0,d.l)(e.basis1)*(0,d.l)(e.basis2)))>1e-6&&y.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,d.d)(e.basis1,M(e)))>1e-6&&y.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,d.d)(M(e),e.origin)-e.plane[3])>1e-6&&y.warn(t,"Plane offset is not consistent with plane origin")}function j(e,t,n,r){var i=M(e);(0,p.my)(i,t.direction,t.origin,n),(0,p.my)((0,p.mJ)(n),i,t.origin,r)}var U={plane:(0,p.Ue)(),origin:(0,h.f)(0,0,0),basis1:(0,h.f)(1,0,0),basis2:(0,h.f)(0,1,0)},I=new l.x(p.Ue),V=new l.x(f.Ue),W=(0,h.c)(),N=new l.x((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),G=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],B=(0,c.c)(),q=(0,c.c)();Object.freeze({__proto__:null,BoundedPlaneClass:_,create:b,wrap:function(e,t,n){var r=N.get();return r.origin=e,r.basis1=t,r.basis2=n,r.plane=(0,p.re)(0,0,0,0),S(r),r},copy:x,copyWithoutVerify:function(e,t){(0,d.g)(t.origin,e.origin),(0,d.g)(t.basis1,e.basis1),(0,d.g)(t.basis2,e.basis2),(0,p.JG)(e.plane,t.plane)},fromValues:w,updateUnboundedPlane:S,elevate:C,setExtent:function(e,t,n){return P(t,n),C(n,A(e,e.origin),n),n},fromAABoundingRect:P,intersectRay:T,intersectRayClosestSilhouette:function(e,t,n){if(T(e,t,n))return n;var r=D(e,t,m.WM.get());return(0,d.b)(n,t.origin,(0,d.a)(m.WM.get(),t.direction,(0,d.i)(t.origin,r)/(0,d.l)(t.direction))),n},closestPointOnSilhouette:D,closestPoint:O,projectPoint:E,projectPointLocal:R,distance2:k,distance:Z,distanceToSilhouette:function(e,t){var n,i=Number.NEGATIVE_INFINITY,a=(0,r.Z)(G);try{for(a.s();!(n=a.n()).done;){var o=L(e,n.value,V.get()),s=(0,f.Jk)(o,t);s>i&&(i=s)}}catch(l){a.e(l)}finally{a.f()}return Math.sqrt(i)},extrusionContainsPoint:function(e,t){return(0,p.Ac)(e.plane,t)&&z(e,t)},axisAt:function(e,t,n,r){return function(e,t,n){switch(t){case 0:(0,d.g)(n,e.basis1),(0,d.n)(n,n);break;case 1:(0,d.g)(n,e.basis2),(0,d.n)(n,n);break;case 2:(0,d.g)(n,M(e))}return n}(e,n,r)},altitudeAt:A,setAltitudeAt:function(e,t,n,r){var i=A(e,t),a=(0,d.a)(W,M(e),n-i);return(0,d.b)(r,t,a),r},equals:function(e,t){return(0,d.k)(e.basis1,t.basis1)&&(0,d.k)(e.basis2,t.basis2)&&(0,d.k)(e.origin,t.origin)},transform:function(e,t,n){return e!==n&&x(e,n),(0,u.b)(B,t),(0,u.t)(B,B),(0,d.m)(n.basis1,e.basis1,B),(0,d.m)(n.basis2,e.basis2,B),(0,d.m)((0,p.mJ)(n.plane),(0,p.mJ)(e.plane),B),(0,d.m)(n.origin,e.origin,t),(0,p.T5)(n.plane,n.origin,n.plane),n},rotate:function(e,t,n,r){return e!==r&&x(e,r),(0,u.e)(q,(0,u.i)(q),t,n),(0,d.m)(r.basis1,e.basis1,q),(0,d.m)(r.basis2,e.basis2,q),S(r),r},normal:M,UP:U})},79347:function(e,t,n){n.d(t,{e:function(){return s}});var r,i,a,o={exports:{}};r=o,i=function(){function e(e,n,i){i=i||2;var a,o,s,u,c,d,h,f=n&&n.length,p=f?n[0]*i:e.length,v=t(e,0,p,i,!0),g=[];if(!v||v.next===v.prev)return g;if(f&&(v=l(e,n,v,i)),e.length>80*i){a=s=e[0],o=u=e[1];for(var m=i;m<p;m+=i)(c=e[m])<a&&(a=c),(d=e[m+1])<o&&(o=d),c>s&&(s=c),d>u&&(u=d);h=0!==(h=Math.max(s-a,u-o))?1/h:0}return r(v,g,i,a,o,h),g}function t(e,t,n,r,i){var a,o;if(i===O(e,t,n,r)>0)for(a=t;a<n;a+=r)o=P(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=P(a,e[a],e[a+1],o);if(o&&_(o,o.next)){var s=o.next;T(o),o=s}return o}function n(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!_(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{var i=r.prev;if(T(r),(r=t=i)===r.next)break;n=!0}}while(n||r!==t);return t}function r(e,t,l,u,c,d,h){if(e){!h&&d&&f(e,u,c,d);for(var p,v,g=e;e.prev!==e.next;)if(p=e.prev,v=e.next,d?a(e,u,c,d):i(e))t.push(p.i/l),t.push(e.i/l),t.push(v.i/l),T(e),e=v.next,g=v.next;else if((e=v)===g){h?1===h?r(e=o(n(e),t,l),t,l,u,c,d,2):2===h&&s(e,t,l,u,c,d):r(n(e),t,l,u,c,d,1);break}}}function i(e){var t=e.prev,n=e,r=e.next;if(y(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(g(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,n,r){var i=e.prev,a=e,o=e.next;if(y(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,d=p(s,l,t,n,r),h=p(u,c,t,n,r),f=e.prevZ,v=e.nextZ;f&&f.z>=d&&v&&v.z<=h;){if(f!==e.prev&&f!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&g(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function o(e,t,r){var i=e;do{var a=i.prev,o=i.next.next;!_(a,o)&&b(a,i,i.next,o)&&S(a,o)&&S(o,a)&&(t.push(a.i/r),t.push(i.i/r),t.push(o.i/r),T(i),T(i.next),i=e=o),i=i.next}while(i!==e);return n(i)}function s(e,t,i,a,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&m(l,u)){var c=C(l,u);return l=n(l,l.next),c=n(c,c.next),r(l,t,i,a,o,s),void r(c,t,i,a,o,s)}u=u.next}l=l.next}while(l!==e)}function l(e,r,i,a){var o,s,l,c=[];for(o=0,s=r.length;o<s;o++)(l=t(e,r[o]*a,o<s-1?r[o+1]*a:e.length,a,!1))===l.next&&(l.steiner=!0),c.push(v(l));for(c.sort(u),o=0;o<c.length;o++)i=n(i=d(c[o],i),i.next);return i}function u(e,t){return e.x-t.x}function c(e){if(e.next.prev===e)return e;for(var t=e;;){var n=t.next;if(n.prev===t||n===t||n===e)break;t=n}return t}function d(e,t){var r=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var l,u=n,c=n.x,d=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&g(a<d?i:o,a,c,d,a<d?o:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),S(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&h(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(e,t);if(!r)return t;var i=C(r,e),a=n(r,r.next),o=c(i);return n(o,o.next),a=c(a),c(t===r?a:t)}function h(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function f(e,t,n,r){var i=e;do{if(null===i.z&&(i.z=p(i.x,i.y,t,n,r)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,f(e,t,n,r);i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}function p(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function g(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(S(e,t)&&S(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||_(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,r){var i=w(y(e,t,n)),a=w(y(e,t,r)),o=w(y(n,r,e)),s=w(y(n,r,t));return i!==a&&o!==s||!(0!==i||!x(e,n,t))||!(0!==a||!x(e,r,t))||!(0!==o||!x(n,e,r))||!(0!==s||!x(n,t,r))}function x(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function w(e){return e>0?1:e<0?-1:0}function S(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function C(e,t){var n=new D(e.i,e.x,e.y),r=new D(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function P(e,t,n,r){var i=new D(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function T(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function D(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}return e.deviation=function(e,t,n,r){var i=t&&t.length,a=i?t[0]*n:e.length,o=Math.abs(O(e,0,a,n));if(i)for(var s=0,l=t.length;s<l;s++){var u=t[s]*n,c=s<l-1?t[s+1]*n:e.length;o-=Math.abs(O(e,u,c,n))}var d=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,f=r[s+1]*n,p=r[s+2]*n;d+=Math.abs((e[h]-e[p])*(e[f+1]-e[h+1])-(e[h]-e[f])*(e[p+1]-e[h+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n},e},void 0!==(a=i())&&(r.exports=a);var s=o.exports},46228:function(e,t,n){n.d(t,{I:function(){return i},v:function(){return a}});var r=n(16889);function i(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,r.uZ)(e,0,l),a=0;a<4;a++)t[n+a]=Math.floor(256*u(i*o[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0,r=0;r<4;r++)n+=e[t+r]*s[r];return n}var o=[1,256,65536,16777216],s=[1/256,1/65536,1/16777216,1/4294967296],l=a(new Uint8ClampedArray([255,255,255,255]));function u(e){return e-Math.floor(e)}},70444:function(e,t,n){n.d(t,{Ue:function(){return o},iL:function(){return s},S$:function(){return u},Ws:function(){return l}});var r=n(21530),i=n(11186),a=n(40885);n(11185);function o(e){return e?{ray:(0,a.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,a.Ue)(),c0:0,c1:Number.MAX_VALUE}}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return(0,a.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){return c(e,e.c0,t)}function u(e,t){return c(e,e.c1,t)}function c(e,t,n){return(0,i.b)(n,e.ray.origin,(0,i.a)(n,e.ray.direction,t))}new r.x((function(){return{c0:0,c1:0,ray:null}}))},95773:function(e,t,n){n.d(t,{JG:function(){return f},Ue:function(){return h},q_:function(){return p},zq:function(){return m},hr:function(){return g}});var r=n(21530),i=n(14226),a=n(11186),o=n(71353),s=n(90045),l=n(67077),u=n(70444),c=n(55652),d=n(11185);function h(e){return e?[(0,c.Ue)(e[0]),(0,c.Ue)(e[1]),(0,c.Ue)(e[2]),(0,c.Ue)(e[3]),(0,c.Ue)(e[4]),(0,c.Ue)(e[5])]:[(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)(),(0,c.Ue)()]}function f(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h(),n=0;n<6;n++)(0,c.JG)(e[n],t[n])}function p(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_,o=(0,i.m)(d.MP.get(),t,e);(0,i.b)(o,o);for(var l=0;l<8;++l){var u=(0,s.t)(d.o6.get(),y[l],o);(0,a.s)(r[l],u[0]/u[3],u[1]/u[3],u[2]/u[3])}v(n,r)}function v(e,t){(0,c.zk)(t[4],t[0],t[3],e[0]),(0,c.zk)(t[1],t[5],t[6],e[1]),(0,c.zk)(t[4],t[5],t[1],e[2]),(0,c.zk)(t[3],t[2],t[6],e[3]),(0,c.zk)(t[0],t[1],t[2],e[4]),(0,c.zk)(t[5],t[4],t[7],e[5])}function g(e,t){for(var n=0;n<6;n++){var r=e[n];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function m(e,t){for(var n=0;n<6;n++){var r=e[n];if(!(0,c.Er)(r,t))return!1}return!0}var y=[(0,l.f)(-1,-1,-1,1),(0,l.f)(1,-1,-1,1),(0,l.f)(1,1,-1,1),(0,l.f)(-1,1,-1,1),(0,l.f)(-1,-1,1,1),(0,l.f)(1,-1,1,1),(0,l.f)(1,1,1,1),(0,l.f)(-1,1,1,1)],_=(new r.x(u.Ue),[(0,o.c)(),(0,o.c)(),(0,o.c)(),(0,o.c)(),(0,o.c)(),(0,o.c)(),(0,o.c)(),(0,o.c)()])},35888:function(e,t,n){n.d(t,{d:function(){return i}});var r=n(16889);function i(e,t,n){var i,u=e.byteLength/(4*t),c=new Uint32Array(e,0,u*t),d=new Uint32Array(u),h=null!=(i=null==n?void 0:n.minReduction)?i:0,f=(null==n?void 0:n.originalIndices)||null,p=f?f.length:0,v=(null==n?void 0:n.componentOffsets)||null,g=0;if(v)for(var m=0;m<v.length-1;m++){var y=v[m+1]-v[m];y>g&&(g=y)}else g=u;var _=Math.floor(1.1*g)+1;(null==l||l.length<2*_)&&(l=new Uint32Array((0,r.Sf)(2*_)));for(var b=0;b<2*_;b++)l[b]=0;for(var x=0,w=!!v&&!!f,S=w?p:u,C=w?new Uint32Array(p):null,P=1.96,T=0!==h?Math.ceil(4*P*P/(h*h)*h*(1-h)):S,D=1,O=v?v[1]:S,E=0;E<S;E++){if(E===T){var R=1-x/E;if(R+P*Math.sqrt(R*(1-R)/E)<h)return null;T*=2}if(E===O){for(var k=0;k<2*_;k++)l[k]=0;if(f)for(var Z=v[D-1];Z<v[D];Z++)C[Z]=d[f[Z]];O=v[++D]}for(var A=w?f[E]:E,M=A*t,z=s(c,M,t),H=z%_,L=x;0!==l[2*H+1];){if(l[2*H]===z){var F=l[2*H+1]-1;if(a(c,M,F*t,t)){L=d[F];break}}++H>=_&&(H-=_)}L===x&&(l[2*H]=z,l[2*H+1]=A+1,x++),d[A]=L}if(0!==h&&1-x/u<h)return null;if(w){for(var j=v[D-1];j<C.length;j++)C[j]=d[f[j]];d=C}var U=new Uint32Array(t*x);x=0;for(var I=0;I<S;I++)d[I]===x&&(o(c,(w?f[I]:I)*t,U,x*t,t),x++);if(f&&!w){for(var V=new Uint32Array(p),W=0;W<V.length;W++)V[W]=d[f[W]];d=V}return{buffer:U.buffer,indices:d,uniqueCount:x}}function a(e,t,n,r){for(var i=0;i<r;i++)if(e[t+i]!==e[n+i])return!1;return!0}function o(e,t,n,r,i){for(var a=0;a<i;a++)n[r+a]=e[t+a]}function s(e,t,n){for(var r=0,i=0;i<n;i++)r=(r=e[t+i]+r|0)+(r<<11)+(r>>>2)|0;return r>>>0}var l=null},91320:function(e,t,n){n.d(t,{M:function(){return l},b:function(){return s}});var r=n(37762),i=n(79347),a=n(69662),o=n(35888);function s(e){var t,n=l(e.rings,e.hasZ,1),a=[],s=0,u=0,c=(0,r.Z)(n.polygons);try{var d=function(){var e=t.value,r=e.count,o=e.index,l=new Float64Array(n.position.buffer,3*o*n.position.BYTES_PER_ELEMENT,3*r),c=e.holeIndices.map((function(e){return e-o})),d=new Uint32Array((0,i.e)(l,c,3));a.push({position:l,faces:d}),s+=l.length,u+=d.length};for(c.s();!(t=c.n()).done;)d()}catch(p){c.e(p)}finally{c.f()}var h=function(e,t,n){if(1===e.length)return e[0];var i,a=new Float64Array(t),o=new Uint32Array(n),s=0,l=0,u=0,c=(0,r.Z)(e);try{for(c.s();!(i=c.n()).done;){for(var d=i.value,h=0;h<d.position.length;h++)a[s++]=d.position[h];for(var f=0;f<d.faces.length;f++)o[l++]=d.faces[f]+u;u=s/3}}catch(p){c.e(p)}finally{c.f()}return{position:a,faces:o}}(a,s,u),f=(0,o.d)(h.position.buffer,6,{originalIndices:h.faces});return h.position=new Float64Array(f.buffer),h.faces=f.indices,h}function l(e,t,n){for(var r=e.length,i=new Array(r),a=new Array(r),o=new Array(r),s=0,l=0,d=0,h=0,f=0;f<r;++f)h+=e[f].length;for(var p=new Float64Array(3*h),v=0,g=r-1;g>=0;g--){var m=e[g],y=1===n&&c(m);if(y&&1!==r)i[s++]=m;else{for(var _=m.length,b=0;b<s;++b)_+=i[b].length;var x={index:v,pathLengths:new Array(s+1),count:_,holeIndices:new Array(s)};x.pathLengths[0]=m.length,m.length>0&&(o[d++]={index:v,count:m.length}),v=y?u(m,m.length-1,-1,p,v,m.length,t):u(m,0,1,p,v,m.length,t);for(var w=0;w<s;++w){var S=i[w];x.holeIndices[w]=v,x.pathLengths[w+1]=S.length,S.length>0&&(o[d++]={index:v,count:S.length}),v=u(S,0,1,p,v,S.length,t)}s=0,x.count>0&&(a[l++]=x)}}for(var C=0;C<s;++C){var P=i[C];P.length>0&&(o[d++]={index:v,count:P.length}),v=u(P,0,1,p,v,P.length,t)}return l<r&&(a.length=l),d<r&&(o.length=d),{position:p,polygons:a,outlines:o}}function u(e,t,n,r,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];r[i++]=l[0],r[i++]=l[1],r[i++]=o?l[2]:0,t+=n}return i/3}function c(e){return!(0,a.bu)(e,!1,!1)}},81020:function(e,t,n){function r(e){return"point"===e.type}n.d(t,{f:function(){return r}})},37818:function(e,t,n){n.d(t,{WG:function(){return m},kB:function(){return f},mW:function(){return h},Ou:function(){return c}});var r=n(37762),i=n(52639),a=(n(93169),n(84652)),o=n(92026),s=n(18722),l=n(77981),u=n(65618);function c(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if(function(e){return"declaredClass"in e}(e))return e;var n=new i.Z({layer:t,sourceLayer:t});return n.visible=e.visible,n.symbol=(0,a.d9)(e.symbol),n.attributes=(0,a.d9)(e.attributes),n.geometry=f(e.geometry),n}function f(e){return(0,o.Wi)(e)?null:c(e)?e:(0,l.im)(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var n=e.rings,r=e.hasZ,i=e.hasM;return{rings:p(n),hasZ:r,hasM:i,spatialReference:t};case"polyline":var a=e.paths,o=e.hasZ,s=e.hasM;return{paths:p(a),hasZ:o,hasM:s,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:t};case"multipoint":var l=e.points,u=e.hasZ,c=e.hasM;return{points:g(l)?v(l):l,hasZ:u,hasM:c,spatialReference:t};default:return}}(e))}function p(e){return function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(0!==i.length)return g(i)}}catch(a){n.e(a)}finally{n.f()}return!1}(e)?e.map((function(e){return v(e)})):e}function v(e){return e.map((function(e){return(0,s.qo)(e)}))}function g(e){return e.length&&((0,s.xZ)(e[0])||(0,s.fS)(e[0]))}function m(e,t){if(!e)return null;var n;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?((n=t).x=e.x,n.y=e.y,n.spatialReference=e.spatialReference,e.hasZ?(n.z=e.z,n.hasZ=e.hasZ):(n.z=null,n.hasZ=!1),e.hasM?(n.m=e.m,n.hasM=!0):(n.m=null,n.hasM=!1)):(n=(0,u.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(n.m=e.m,n.hasM=!0)),n}},78935:function(e,t,n){n.d(t,{o:function(){return l}});var r=n(15671),i=n(43144),a=n(92026),o=n(88152),s=n(8821),l=function(){function e(){(0,r.Z)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return(0,i.Z)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=(0,o.Z7)(e)}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var n=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?n:e+n}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,n=this.featureExpressionInfoContext;return null!=n&&(t+=(0,s.ht)(n)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=(0,o.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,a.Pt)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,n){if((0,a.Wi)(e))this._featureExpressionInfoContext=null;else{var r=e&&e.arcade;r&&(0,a.pC)(t)&&(0,a.pC)(n)?(this._featureExpressionInfoContext=(0,s.d9)(e),(0,s.aO)(this._featureExpressionInfoContext,(0,s.Tz)(r.modules,t,n))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var n=new e;return(0,a.pC)(t)&&n.setFromElevationInfo(t),n}}]),e}()},61310:function(e,t,n){n.d(t,{ZF:function(){return i},rD:function(){return a},a1:function(){return o}});var r=n(67077),i=1.2,a=r.Z,o=r.O},69691:function(e,t,n){n.d(t,{Lm:function(){return w},lO:function(){return x},bD:function(){return b},rR:function(){return p},GC:function(){return m},w7:function(){return g},qZ:function(){return v},Xf:function(){return y},B5:function(){return _}});var r=n(43144),i=n(15671),a=n(41644),o=n(92026),s=n(14226),l=n(81949),u=n(71353),c=n(60176),d=n(81020),h=n(96387),f=n(77648);function p(e,t,n,r,i,a,o,s,l,u,d){var h,f,p=S[d.mode],v=0;if((0,c.CM)(e,t,n,r,l.spatialReference,i,s))return p.requiresAlignment(d)?(v=p.applyElevationAlignmentBuffer(r,i,a,o,s,l,u,d),h=a,f=o):(h=r,f=i),(0,c.CM)(h,l.spatialReference,f,a,u.spatialReference,o,s)?v:void 0}function v(e,t,n,r,i){var s=((0,d.f)(e)?e.z:(0,f.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(n.mode){case"on-the-ground":var l=(0,o.Pt)((0,f.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=0,i.sampledElevation=l,void(i.z=l);case"relative-to-ground":var u=(0,o.Pt)((0,f.KO)(t,e,"ground"),0),c=n.geometryZWithOffset(s,r);return i.verticalDistanceToGround=c,i.sampledElevation=u,void(i.z=c+u);case"relative-to-scene":var h=(0,o.Pt)((0,f.KO)(t,e,"scene"),0),p=n.geometryZWithOffset(s,r);return i.verticalDistanceToGround=p,i.sampledElevation=h,void(i.z=p+h);case"absolute-height":var v=n.geometryZWithOffset(s,r),g=(0,o.Pt)((0,f.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=v-g,i.sampledElevation=g,void(i.z=v);default:return(0,a.Bg)(n.mode),void(i.z=0)}}function g(e,t,n,r){return v(e,t,n,r,P),P.z}function m(e,t,n){return null==t||null==n?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===n?e.staysOnTheGround:t===n||"on-the-ground"!==t&&"on-the-ground"!==n?x.UPDATE:e.onTheGroundChanged}function y(e){return"relative-to-ground"===e||"relative-to-scene"===e}function _(e){return"absolute-height"!==e}function b(e,t,n,r,i){v(t,n,i,r,P),(0,h.CV)(e,P.verticalDistanceToGround);var a=P.sampledElevation,o=(0,s.c)(C,e.transformation);return T[0]=t.x,T[1]=t.y,T[2]=P.z,(0,c.Bm)(t.spatialReference,T,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),a}var x,w=(0,r.Z)((function e(){(0,i.Z)(this,e),this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}));!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(x||(x={}));var S={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,o,s){var l=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext;t*=3,r*=3;for(var c=0;c<i;++c){var d=e[t+0],h=e[t+1],f=e[t+2];n[r+0]=d,n[r+1]=h,n[r+2]=null==u?f+l:l,t+=3,r+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,n=e.featureExpressionInfoContext;return 0!==t||null!=n}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a){var s=0,l=a.spatialReference;t*=3,r*=3;for(var u=0;u<i;++u){var c=e[t+0],d=e[t+1],h=e[t+2],f=(0,o.Pt)(a.getElevation(c,d,h,l,"ground"),0);s+=f,n[r+0]=c,n[r+1]=d,n[r+2]=f,t+=3,r+=3}return s/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,s,l){var u=0,c=l.calculateOffsetRenderUnits(s),d=l.featureExpressionInfoContext,h=a.spatialReference;t*=3,r*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],g=e[t+2],m=(0,o.Pt)(a.getElevation(p,v,g,h,"ground"),0);u+=m,n[r+0]=p,n[r+1]=v,n[r+2]=null==d?g+m+c:m+c,t+=3,r+=3}return u/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,n,r,i,a,s,l){var u=0,c=l.calculateOffsetRenderUnits(s),d=l.featureExpressionInfoContext,h=a.spatialReference;t*=3,r*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],g=e[t+2],m=(0,o.Pt)(a.getElevation(p,v,g,h,"scene"),0);u+=m,n[r+0]=p,n[r+1]=v,n[r+2]=null==d?g+m+c:m+c,t+=3,r+=3}return u/i},requiresAlignment:function(){return!0}}},C=(0,l.c)(),P=new w,T=(0,u.c)()},8821:function(e,t,n){n.d(t,{d9:function(){return u},kr:function(){return c},Tz:function(){return h},ht:function(){return p},WI:function(){return v},aO:function(){return f},O$:function(){return g}});var r=n(15861),i=n(87757),a=n(32718),o=n(37818),s=n(819),l=a.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function u(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e,t,n){return d.apply(this,arguments)}function d(){return d=(0,r.Z)(i.mark((function e(t,n,r){var a,o,l,u,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(a=t&&t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(o=y(a))){e.next=6;break}return e.abrupt("return",{cachedResult:o});case 6:return e.next=8,(0,s.LC)();case 8:return l=e.sent,u=l.arcadeUtils,c=u.createSyntaxTree(a),e.abrupt("return",u.dependsOnView(c)?(null!=r&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:u.createFunction(c),context:u.createExecContext(null,{sr:n}),modules:l}});case 12:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function h(e,t,n){return e.arcadeUtils.createFeature(t.attributes,t.geometry,n)}function f(e,t){if(null!=e&&!m(e)){if(!t||!e.arcade)return void l.errorOncePerTick("Arcade support required but not provided");var n=t;n._geometry&&(n._geometry=(0,o.kB)(n._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(m(e))return e.cachedResult;var t=e.arcade,n=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof n&&(e.cachedResult=0,n=0),n}return 0}function v(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e&&e.featureExpressionInfo,r=n&&n.expression;return t||"0"===r||(n=null),n}var g={cachedResult:0};function m(e){return null!=e.cachedResult}function y(e){return"0"===e?0:null}},96387:function(e,t,n){n.d(t,{zE:function(){return y},_Z:function(){return D},bD:function(){return C},Si:function(){return O},Go:function(){return x},ZL:function(){return T},Uu:function(){return S},yY:function(){return E},CV:function(){return w},bh:function(){return P}});var r=n(37762),i=n(92026),a=n(14226),o=n(81949),s=n(6394),l=n(71353),u=n(90045),c=n(67077),d=n(60176),h=n(41414),f=n(65156),p=n(4954),v=n(69662),g=n(65618),m=n(37818);function y(e,t){if("point"===e.type)return b(e,t,!1);if((0,m.Ou)(e))switch(e.type){case"extent":return b(e.center,t,!1);case"polygon":return b(e.centroid,t,!1);case"polyline":return b(_(e),t,!0);case"mesh":return b(e.origin,t,!1)}else switch(e.type){case"extent":return b(function(e){var t=isFinite(e.zmin);return(0,g.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return b(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var n=(0,p.a)(e.rings,e.hasZ);return(0,g.Tx)(n[0],n[1],n[2],e.spatialReference)}(e),t,!0);case"polyline":return b(_(e),t,!0)}}function _(e){var t=e.paths[0];if(!t||0===t.length)return null;var n=(0,v.n8)(t,(0,v.ok)(t)/2);return(0,g.Tx)(n[0],n[1],n[2],e.spatialReference)}function b(e,t,n){var r=n?e:(0,m.WG)(e);return t&&e?(0,d.nF)(e,r,t)?r:null:r}function x(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,f.Ue)());var i=e,a=.5*i.width*(n-1),o=.5*i.height*(n-1);return i.width<1e-7*i.height?a+=o/20:i.height<1e-7*i.width&&(o+=a/20),(0,u.s)(t,i.xmin-a-r,i.ymin-o-r,i.xmax+a+r,i.ymax+o+r),t}return null}function w(e,t){for(var n=0;n<e.geometries.length;++n){var r=e.geometries[n].getMutableAttribute("auxpos1");r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[n]))}}function S(e,t){var n=(0,c.b)(c.O);return(0,i.pC)(e)&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),(0,i.pC)(t)?n[3]=t:(0,i.pC)(e)&&e.length>3&&(n[3]=e[3]),n}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.O,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Array(3);if((0,i.Wi)(t)||(0,i.Wi)(n))a[0]=1,a[1]=1,a[2]=1;else{for(var o,s=0,u=2;u>=0;u--){var c=e[u],d=void 0,h=null!=c,f=0===u&&!o&&!h,p=n[u];"symbol-value"===c||f?d=0!==p?t[u]/p:1:h&&"proportional"!==c&&isFinite(c)&&(d=0!==p?c/p:1),null!=d&&(a[u]=d,o=d,s=Math.max(s,Math.abs(d)))}for(var v=2;v>=0;v--)null==a[v]?a[v]=o:0===a[v]&&(a[v]=.001*s)}for(var g=2;g>=0;g--)a[g]/=r;return(0,l.d)(a)}function P(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),T(e)?null:"Symbol sizes may not be negative values"}function T(e){if(Array.isArray(e)){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){if(!T(t.value))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}return null==e||e>=0}function D(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.c)(),i=e||0,s=t||0,l=n||0;return 0!==i&&(0,a.r)(r,r,-i/180*Math.PI),0!==s&&(0,a.d)(r,r,s/180*Math.PI),0!==l&&(0,a.j)(r,r,l/180*Math.PI),r}function O(e,t){return null!=t.minDemResolution?t.minDemResolution:(0,h.wp)(e)?t.minDemResolutionForPoints:.01*(0,h.aO)(e)}var E={"bottom-left":(0,s.f)(0,0),bottom:(0,s.f)(.5,0),"bottom-right":(0,s.f)(1,0),left:(0,s.f)(0,.5),center:(0,s.f)(.5,.5),right:(0,s.f)(1,.5),"top-left":(0,s.f)(0,1),top:(0,s.f)(.5,1),"top-right":(0,s.f)(1,1)}},75558:function(e,t,n){n.d(t,{YU:function(){return m},VP:function(){return y},rm:function(){return b},u9:function(){return P}});var r=n(37762),i=(n(93169),n(16889)),a=n(92026),o=n(18722),s=n(88396),l=n(11186),u=n(71353),c=n(60176),d=n(92183),h=n(91320),f=n(61310),p=n(69691),v=n(16181),g=n(74894);function m(e){var t=[],n=[];!function(e,t,n){for(var r=e.attributeData.position,i=e.removeDuplicateStartEnd,a=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&1===i,s=r.length/3-(a?1:0),l=new Uint32Array(2*(s-1)),u=a?(0,o.tP)(r,0,r.length-3):r,c=0,d=0;d<s-1;d++)l[c++]=d,l[c++]=d+1;t.push(["position",{size:3,data:u,exclusive:a}]),n.push(["position",l])}(e,n,t);var r=n[0][1].data,u=t[0][1].length,h=new Uint16Array(u);return function(e,t,n){var r=e.attributeData.mapPosition;(0,a.Wi)(r)||(n.push(["mapPos",n[0][1]]),t.push(["mapPos",{size:3,data:r}]))}(e,n,t),function(e,t,n,r){if((0,a.pC)(e.attributeData.colorFeature))return;var i=e.attributeData.color;t.push(["color",{size:4,data:(0,a.Pt)(i,f.a1)}]),n.push(["color",r])}(e,n,t,h),function(e,t,n,r){if((0,a.pC)(e.attributeData.sizeFeature))return;var i=e.attributeData.size;t.push(["size",{size:1,data:[(0,a.Pt)(i,1)]}]),n.push(["size",r])}(e,n,t,h),function(e,t,n,r){var i=e.attributeData.colorFeature;(0,a.Wi)(i)||(t.push(["colorFeatureAttribute",{size:1,data:new Float32Array([i])}]),n.push(["color",r]))}(e,n,t,h),function(e,t,n,r){var i=e.attributeData.sizeFeature;(0,a.Wi)(i)||(t.push(["sizeFeatureAttribute",{size:1,data:new Float32Array([i])}]),n.push(["sizeFeatureAttribute",r]))}(e,n,t,h),function(e,t,n,r){var i=e.attributeData.opacityFeature;(0,a.Wi)(i)||(t.push(["opacityFeatureAttribute",{size:1,data:new Float32Array([i])}]),n.push(["opacityFeatureAttribute",r]))}(e,n,t,h),function(e,t,n,r){if("round"!==e.join)return;var o=r.length/3,s=new Float32Array(o),u=w,c=S;(0,l.s)(u,0,0,0);for(var d=(0,a.Pt)(e.uniformSize,1),h=-1;h<o;++h){var f=h<0?o+h:h,p=(h+1)%o;if((0,l.s)(c,r[3*p+0]-r[3*f+0],r[3*p+1]-r[3*f+1],r[3*p+2]-r[3*f+2]),(0,l.n)(c,c),h>=0){var v=(Math.PI-(0,i.ZF)((0,l.d)(u,c)))*C*1*x(d);s[h]=Math.max(Math.floor(v),0)}(0,l.a)(u,c,-1)}t.push(["subdivisions",{size:1,data:s}]),n.push(["subdivisions",n[0][1]])}(e,n,t,r),function(e,t,n,r){if((0,a.Wi)(e.overlayInfo)||1!==e.overlayInfo.renderCoordsHelper.viewingMode||!e.overlayInfo.spatialReference.isGeographic)return;for(var i=new Float64Array(r.length),o=(0,d.Iu)(e.overlayInfo.spatialReference),u=0;u<i.length;u+=3)(0,c.gH)(r,u,i,u,o);var h=r.length/3,f=new Float32Array(h+1),p=w,v=S,g=0,m=0;(0,l.s)(p,i[m++],i[m++],i[m++]),f[0]=0;for(var y=1;y<h+1;++y){var _;y===h&&(m=0),(0,l.s)(v,i[m++],i[m++],i[m++]),g+=(0,s.d)(p,v),f[y]=g,p=(_=[v,p])[0],v=_[1]}t.push(["distanceToStart",{size:1,data:f}]),n.push(["distanceToStart",n[0][1]])}(e,n,t,r),new g.Z(n,t,2)}function y(e,t,n,r){var i="polygon"===e.type?1:0,a="polygon"===e.type?e.rings:e.paths,o=(0,h.M)(a,e.hasZ,i),s=o.position,l=o.outlines,u=new Float64Array(s.length),c=(0,p.rR)(s,e.spatialReference,0,u,0,s,0,s.length/3,t,n,r),d=null!=c;return{lines:d?_(l,s,u):[],projectionSuccess:d,sampledElevation:c}}function _(e,t,n){var i,a=new Array,o=(0,r.Z)(e);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.index,u=s.count;if(!(u<=1)){var c=3*l,d=c+3*u;a.push({position:t.subarray(c,d),mapPosition:n?n.subarray(c,d):void 0})}}}catch(h){o.e(h)}finally{o.f()}return a}function b(e,t){for(var n="polygon"===e.type?1:0,r="polygon"===e.type?e.rings:e.paths,i=(0,h.M)(r,!1,n),a=i.position,o=i.outlines,s=(0,c.CM)(a,e.spatialReference,0,a,t,0,a.length/3),l=2;l<a.length;l+=3)a[l]=v.Rn;return{lines:s?_(o,a):[],projectionSuccess:s}}function x(e){return 1.863798+-2.0062872/Math.pow(1+e/18.2313,.8856294)}var w=(0,u.c)(),S=(0,u.c)(),C=4/Math.PI;function P(e){switch(e){case"butt":return 0;case"square":return 1;case"round":return 2;default:return null}}},36759:function(e,t,n){n.d(t,{km:function(){return p},dO:function(){return v},VP:function(){return m},S_:function(){return g}});var r=n(92026),i=n(81949),a=n(71353),o=n(60176),s=n(41414),l=n(69662),u=n(65618),c=n(69691),d=n(96387),h=n(59887),f=(0,a.c)();function p(e,t,n,a,l,u,d,p){var v=n?n.length:0,g=e.clippingExtent;if((0,o.KC)(t,f,e.elevationProvider.spatialReference),(0,r.pC)(g)&&!(0,s.BD)(g,f))return null;var m=e.renderCoordsHelper.spatialReference;(0,o.KC)(t,f,m);for(var y=e.localOriginFactory.getOrigin(f),_=new h.T({castShadow:!1,metadata:{layerUid:u,graphicUid:d,usesVerticalDistanceToGround:!0}}),b=0;b<v;b++){var x=i.I;_.addGeometry(n[b],a[b],x,y,p)}return{object:_,sampledElevation:(0,c.bD)(_,t,e.elevationProvider,e.renderCoordsHelper,l)}}function v(e,t,n){var r=e.elevationContext,i=n.spatialReference;(0,o.KC)(t,f,i),r.centerPointInElevationSR=(0,u.Tx)(f[0],f[1],t.hasZ?f[2]:0,i)}function g(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,d.zE)(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var n=(0,l.n8)(t,(0,l.ok)(t)/2);return(0,u.Tx)(n[0],n[1],n[2],e.spatialReference);case"mesh":return e.origin}return null}function m(e,t,n,r,i){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=(0,c.rR)(a,t,0,o,0,a,0,a.length/3,n,r,i),l=null!=s;return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:l,sampledElevation:s}}},55360:function(e,t,n){n.d(t,{y:function(){return a},qG:function(){return l},lQ:function(){return s},yL:function(){return o},aT:function(){return c},Z$:function(){return i},Gh:function(){return u}});n(93169);var r=n(46228);function i(e,t,n){switch(e){case"circle":default:return a(t,n);case"square":return o(t,n);case"cross":return l(t,n);case"x":return u(t,n);case"kite":return s(t,n);case"triangle":return c(t,n)}}function a(e,t){for(var n=e,i=new Uint8Array(4*n*n),a=n/2-.5,o=t/2,s=0;s<n;s++)for(var l=0;l<n;l++){var u=l+n*s,c=l-a,d=s-a,h=Math.sqrt(c*c+d*d)-o;h=h/e+.5,(0,r.I)(h,i,4*u)}return i}function o(e,t){return d(e,t,!1)}function s(e,t){return d(e,t,!0)}function l(e,t){return h(e,t,!1)}function u(e,t){return h(e,t,!0)}function c(e,t){for(var n=new Uint8Array(4*e*e),i=-.5,a=Math.sqrt(1.25),o=(e-t)/2,s=0;s<e;s++)for(var l=0;l<e;l++){var u=s*e+l,c=(l-o)/t,d=(s-o+.75)/t,h=-(1*c+i*d)/a,f=(1*(c-1)+i*-d)/a,p=-d,v=Math.max(h,f,p);(0,r.I)(v*t/e+.5,n,4*u)}return n}function d(e,t,n){n&&(t/=Math.SQRT2);for(var i=new Uint8Array(4*e*e),a=0;a<e;a++)for(var o=0;o<e;o++){var s=o-.5*e+.25,l=.5*e-a-.75,u=a*e+o;if(n){var c=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=c}var d=Math.max(Math.abs(s),Math.abs(l))-.5*t;d=d/e+.5,(0,r.I)(d,i,4*u)}return i}function h(e,t,n){n&&(t*=Math.SQRT2);for(var i=.5*t,a=new Uint8Array(4*e*e),o=0;o<e;o++)for(var s=0;s<e;s++){var l=s-.5*e,u=.5*e-o-1,c=o*e+s;if(n){var d=(l+u)/Math.SQRT2;u=(u-l)/Math.SQRT2,l=d}var h=void 0;h=(h=(l=Math.abs(l))>(u=Math.abs(u))?l>i?Math.sqrt((l-i)*(l-i)+u*u):u:u>i?Math.sqrt(l*l+(u-i)*(u-i)):l)/e+.5,(0,r.I)(h,a,4*c)}return a}},77648:function(e,t,n){n.d(t,{sb:function(){return s},KO:function(){return u},Fb:function(){return l}});var r=n(43144),i=n(15671),a=n(92026),o=n(81020),s=(0,r.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.array=t,this.spatialReference=n,this.offset=r}));function l(e){return"array"in e}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,o.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,n);if(l(t)){var r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,(0,a.Pt)(t.spatialReference,e.spatialReference),n)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,n)}},50256:function(e,t,n){function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.stride;return e.fieldNames.filter((function(t){var n=e.fields.get(t).optional;return!(n&&n.glPadding)})).map((function(r){var a=e.fields.get(r),o=a.constructor.ElementCount,s=i(a.constructor.ElementType),l=a.offset,u=!(!a.optional||!a.optional.glNormalized);return{name:r,stride:n,count:o,type:s,offset:l,normalized:u,divisor:t}}))}function i(e){var t=a[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}n.d(t,{K:function(){return r}});var a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}},94463:function(e,t,n){n.d(t,{Z:function(){return h}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=n(27366),l=n(85015),u=n(49861),c=(n(63780),n(93169),n(25243),n(69912)),d=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_OPTIMIZATIONS=!1,e.TESTS_DISABLE_FAST_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e}return(0,r.Z)(n)}(l.Z);(0,s._)([(0,u.Cb)()],d.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"SCENEVIEW_LOCKING_LOG",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LABELS_SHOW_BORDER",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"SHOW_POI",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);var h=new(d=(0,s._)([(0,c.j)("esri.views.3d.support.DebugFlags")],d))},16181:function(e,t,n){n.d(t,{Rn:function(){return Tt}});var r=n(15861),i=n(29439),a=n(37762),o=n(15671),s=n(43144),l=n(60136),u=n(29388),c=n(87757),d=n(27366),h=n(85015),f=n(91505),p=n(100),v=n(32718),g=n(77427),m=n(92026),y=n(27546),_=n(92377),b=n(8537),x=n(49861),w=(n(63780),n(93169),n(25243),n(69912)),S=n(14226),C=n(6394),P=n(71353),T=n(81949),D=n(94463),O=n(16889),E=n(65156),R=n(71624),k=function(){function e(t,n){(0,o.Z)(this,e),this.index=t,this.renderTargets=n,this.extent=(0,E.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,R.al)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries={extents:[(0,E.Ue)(),(0,E.Ue)(),(0,E.Ue)()],numViews:0},this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(n.renderTargets.length).fill(!1)}return(0,s.Z)(e,[{key:"getValidTarget",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}},{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(0):2===e?this.renderTargets.getTarget(2):this.renderTargets.getTarget(4);return t?t.getTexture():null}},{key:"getNormalTexture",value:function(e){var t=1===e?this.renderTargets.getTarget(3):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var n,r=this.computeRenderTargetValidityBitfield(),i=this.needsColorWithoutRasterImage,o=(0,a.Z)(this.renderTargets.renderTargets);try{for(o.s();!(n=o.n()).done;){var s=n.value;1===s.type&&!1===i?this.validTargets[s.type]=!1:this.validTargets[s.type]=e.drawTarget(this,s,t)}}catch(l){o.e(l)}finally{o.f()}return r^this.computeRenderTargetValidityBitfield()?0:1}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[0]|+e[1]<<1|+e[2]<<2|+e[3]<<3|+e[4]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this.extent[0]-t<=e.min){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,E.cv)(this.extent,e.range,0,n)}if(this.extent[2]+t>=e.max){var r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,E.cv)(this.extent,-e.range,0,r)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,(0,E.JG)(this.canvasGeometries.extents[0],this.extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){e.setViewport(0===this.index?0:this.resolution,0,this.resolution,this.resolution)}}]),e}();var Z=n(15245),A=n(44070),M=n(53634),z=(n(37825),n(8548),n(3667),n(51378)),H=n(45412),L=function(){function e(t,n){(0,o.Z)(this,e),this.size=(0,Z.c)(),this._fbo=null,this._fbo=new M.Z(t,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:n,maxAnisotropy:8,width:0,height:0})}return(0,s.Z)(e,[{key:"dispose",value:function(){this._fbo=(0,m.O3)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null==(e=this._fbo)||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}]),e}(),F=function(){function e(t){(0,o.Z)(this,e);var n=function(e,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{type:n,fbo:new L(t,r),renderPass:e,valid:!1,lastUsed:1/0}};this.renderTargets=[n(0,0),n(0,1),n(5,2,!1),n(3,3),n(0,4)]}return(0,s.Z)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=(0,a.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(n){t.e(n)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=(0,a.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(n){t.e(n)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,n){if(e)t.lastUsed=n;else if(n-t.lastUsed>j)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),j=1e3,U=function(){function e(){(0,o.Z)(this,e),this._outer=new Map}return(0,s.Z)(e,[{key:"clear",value:function(){this._outer.clear()}},{key:"empty",get:function(){return 0===this._outer.size}},{key:"get",value:function(e,t){var n;return null==(n=this._outer.get(e))?void 0:n.get(t)}},{key:"set",value:function(e,t,n){var r=this._outer.get(e);r?r.set(t,n):this._outer.set(e,new Map([[t,n]]))}},{key:"delete",value:function(e,t){var n=this._outer.get(e);n&&(n.delete(t),0===n.size&&this._outer.delete(e))}},{key:"forEach",value:function(e){this._outer.forEach((function(t,n){return e(t,n)}))}}]),e}(),I=(0,s.Z)((function e(t){(0,o.Z)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0})),V=function(){function e(t){(0,o.Z)(this,e),this._context=t,this._perConstructorInstances=new U,this._frameCounter=0,this._keepAliveFrameCount=W}return(0,s.Z)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"dispose",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.dispose()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e,t){var n=this,r=t.key,i=this._perConstructorInstances.get(e,r);if((0,m.Wi)(i)){var a=new e(this._context,t,(function(){return n.release(a)}));i=new I(a),this._perConstructorInstances.set(e,r,i)}return++i.refCount,i.technique}},{key:"releaseAndAcquire",value:function(e,t,n){if((0,m.pC)(n)){if(t.key===n.key)return n;n.release()}return this.acquire(e,t)}},{key:"release",value:function(e){if(!(0,m.Wi)(e)&&!this._perConstructorInstances.empty){var t=this._perConstructorInstances.get(e.constructor,e.key);(0,m.Wi)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==W&&this._perConstructorInstances.forEach((function(t,n){t.forEach((function(t,r){0===t.refCount&&t.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(t.technique.dispose(),e._perConstructorInstances.delete(n,r))}))}))}},{key:"reloadAll",value:function(){var e=(0,r.Z)(c.mark((function e(){var t,n=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,i){var a=function(){var e=(0,r.Z)(c.mark((function e(t,r){var i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.shader,e.t0=i,!e.t0){e.next=6;break}return e.next=5,i.reload();case 5:t.forEach((function(e){e.technique.reload(n._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();t.push(a(e,i))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),W=-1,N=function(e){var t=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments))._isDisposed=!1,e}return(0,s.Z)(n,[{key:"dispose",value:function(){var e,t=(0,a.Z)(null!=(n=this._managedDisposables)?n:[]);try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=this[r];this[r]=null,i&&"function"==typeof i.dispose&&i.dispose()}}catch(o){t.e(o)}finally{t.f()}this._isDisposed=!0}},{key:"isDisposed",get:function(){return this._isDisposed}}]),n}(e);return t};N(function(){return(0,s.Z)((function e(){(0,o.Z)(this,e)}))}());var G=n(30425),B=n(97731),q=v.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository"),J=function(){function e(t){(0,o.Z)(this,e),this._glMaterial=t,this.refCnt=0,this._glMaterial=t}return(0,s.Z)(e,[{key:"incRefCnt",value:function(){++this.refCnt}},{key:"decRefCnt",value:function(){--this.refCnt,(0,B.hu)(this.refCnt>=0)}},{key:"getRefCnt",value:function(){return this.refCnt}},{key:"glMaterial",get:function(){return this._glMaterial}}]),e}(),$=function(){function e(t,n,r,i){(0,o.Z)(this,e),this._textureRepository=t,this._techniqueRepository=n,this.materialChanged=r,this.requestRender=i,this._id2glMaterialRef=new U}return(0,s.Z)(e,[{key:"dispose",value:function(){this._textureRepository.dispose()}},{key:"acquire",value:function(e,t){this._ownMaterial(e);var n=this._id2glMaterialRef.get(t,e.id);if((0,m.Wi)(n)){var r=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});n=new J(r),this._id2glMaterialRef.set(t,e.id,n)}return n.incRefCnt(),n.glMaterial}},{key:"release",value:function(e,t){var n=this._id2glMaterialRef.get(t,e.id);(0,m.pC)(n)&&(n.decRefCnt(),0===n.getRefCnt()&&((0,m.O3)(n.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}},{key:"_ownMaterial",value:function(e){(0,m.pC)(e.repository)&&e.repository!==this&&q.error("Material is already owned by a different material repository"),e.repository=this}}]),e}(),Y=n(32534),X=n(19962),K=n(13679),Q=function(){function e(t){(0,o.Z)(this,e),this.rctx=t,this.camera=null,this.lastFrameCamera=new G.Z,this.pass=0,this.slot=2,this.highlightDepthTexture=null,this.renderOccludedMask=ee,this.hasOccludees=!1}return(0,s.Z)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=ee}},{key:"isHighlightPass",get:function(){return 5===this.pass}}]),e}(),ee=13,te=function(){function e(){(0,o.Z)(this,e),this.adds=new y.Z,this.removes=new y.Z,this.updates=new y.Z({allocator:function(e){return e||new ne},deallocator:function(e){return e.renderGeometry=null,e}})}return(0,s.Z)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}]),e}(),ne=(0,s.Z)((function e(){(0,o.Z)(this,e)})),re=(0,s.Z)((function e(){(0,o.Z)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array}));function ie(e){return e.data.indexCount>=1}var ae=n(50256),oe=n(94425),se=n(47475),le=(0,s.Z)((function e(t){(0,o.Z)(this,e),this.first=t.from,this.count=t.to-t.from})),ue=(0,s.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,o.Z)(this,e),this.from=t,this.to=n})),ce=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a,s,l){var u;return(0,o.Z)(this,n),(u=t.call(this,r,i)).id=e,u.isVisible=a,u.hasHighlights=s,u.hasOccludees=l,u}return(0,s.Z)(n)}(ue);function de(e){return Array.from(e.values()).sort(he)}function he(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function fe(e,t){if(0!==e.length){var n=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(n,t)){var r=t.from-n.first+t.to-t.from;n.count=r}else e.push(new le(t))}else e.push(new le(t))}var pe=function(){function e(t,n){(0,o.Z)(this,e),this._pool=t,this._size=0,this._buffer=t.newBuffer(ve(n))}return(0,s.Z)(e,[{key:"dispose",value:function(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}},{key:"release",value:function(){this.erase(0,this._size),this.dispose()}},{key:"vao",get:function(){return this._buffer.vao}},{key:"array",get:function(){return this._buffer.array}},{key:"size",get:function(){return this._size}},{key:"grow",value:function(e){this._resize(this._size+e,!0).dispose()}},{key:"alloc",value:function(e){return this._resize(e,!1)}},{key:"_resize",value:function(e,t){var n,r=this,i=function(e,t,n){return t<=n?e>=n?e:ve(Math.max(2*e,n)):e<=2*n?e:ve(n)}(this._buffer.length,this._size,e);if(this._buffer.length!==i){var a=this._pool.newBuffer(i);t&&(a.array.set(this._buffer.array.subarray(0,Math.min(this._size,i))),a.vao.vertexBuffers.geometry.setSubData(a.array,0,0,a.array.byteLength)),n=this._buffer,this._buffer=a}var o=this._size;return this._size=e,n?{dispose:function(){n.array.fill(0,0,o),r._pool.deleteBuffer(n)},copy:function(e,t,i){return r._buffer.array.set(n.array.subarray(t,i),e)},hasNewBuffer:!0}:{dispose:function(){},copy:function(e,t,n){e!==t&&r._buffer.array.copyWithin(e,t,n)},hasNewBuffer:!1}}},{key:"erase",value:function(e,t){this._buffer.array.fill(0,e,t)}}]),e}();function ve(e){return 65536*Math.ceil(e/65536)}var ge=n(18759),me=n(95439),ye=function(){function e(t,n,r,i){(0,o.Z)(this,e),this.vao=new H.Z(t,n,{geometry:r},{geometry:A.Z.createVertex(t,35044)}),this.array=new Float32Array(i),this.vao.vertexBuffers.geometry.setData(this.array)}return(0,s.Z)(e,[{key:"dispose",value:function(){this.vao.dispose(!0)}},{key:"length",get:function(){return this.array.length}}]),e}(),_e=ge.an+1,be=function(){function e(t,n,r){(0,o.Z)(this,e),this._rctx=t,this._locations=n,this._layout=r,this._cache=t.newCache("MergedRenderer pool ".concat((0,me.D)()),xe)}return(0,s.Z)(e,[{key:"dispose",value:function(){this._cache.destroy()}},{key:"newBuffer",value:function(e){var t=e.toString(),n=this._cache.pop(t);if((0,m.pC)(n)){var r=n.pop();return n.length>0&&this._cache.put(t,n,r.array.byteLength*n.length,_e),r}return new ye(this._rctx,this._locations,this._layout,e)}},{key:"deleteBuffer",value:function(e){var t=e.array.byteLength,n=e.array.length.toString(),r=this._cache.pop(n);return(0,m.pC)(r)?(r.push(e),this._cache.put(n,r,t*r.length,-1)):this._cache.put(n,[e],t,-1),null}}]),e}();function xe(e,t){if(0!==t){var n=e.pop(),r=e.length*n.array.byteLength;return n.dispose(),r}e.forEach((function(e){return e.dispose()}))}var we=n(32683),Se=function(){function e(t,n,r){(0,o.Z)(this,e),this._rctx=t,this._materialRepository=n,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new y.Z,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new oe.p(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new be(t,r.vertexAttributeLocations,(0,ae.K)(this._bufferWriter.vertexBufferLayout))}return(0,s.Z)(e,[{key:"dispose",value:function(){this._glMaterials.destroy(),this._dataByOrigin.forEach((function(e){return e.buffer.dispose()})),this._dataByOrigin.clear(),this._bufferPool.dispose()}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof se.H}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"modify",value:function(e){this.updateGeometries(e.updates),this.addAndRemoveGeometries(e.adds,e.removes),this.updateRenderCommands()}},{key:"addAndRemoveGeometries",value:function(e,t){var n=this,r=this._bufferWriter,i=r.vertexBufferLayout.stride/4,o=this._dataByOrigin,s=function(e,t){var n,r=new Map,i=(0,a.Z)(e);try{for(i.s();!(n=i.n()).done;){Pe(r,n.value,!0)}}catch(l){i.e(l)}finally{i.f()}var o,s=(0,a.Z)(t);try{for(s.s();!(o=s.n()).done;){Pe(r,o.value,!1)}}catch(l){s.e(l)}finally{s.f()}return r}(e,t);s.forEach((function(e,t){s.delete(t);var a=e.toAdd.reduce((function(e,t){return e+r.elementCount(t.data)}),0),l=o.get(t);if(null==l)(0,B.hu)(0===e.toRemove.length),l=new Ee(e.origin,new pe(n._bufferPool,a*i)),o.set(t,l);else if(0===e.toAdd.length&&l.instances.size===e.toRemove.length)return l.buffer.dispose(),void o.delete(t);var u=0;l.instances.forEach((function(e){return u+=e.to-e.from}));var c=e.toRemove.reduce((function(e,t){return e+r.elementCount(t.data)}),0),d=l.buffer.size,h=(u+a-c)*i,f=ke;if(h<d/2?n.removeAndRebuild(l,e.toRemove,i,h,f):e.toRemove.length>0&&n.remove(l,e.toRemove,i,f),e.toAdd.length>0){var p=Ze;(0,B.u_)(p,-e.origin[0],-e.origin[1],-e.origin[2]),n.add(l,e.toAdd,i,p,f)}var v=l.buffer.vao.vertexBuffers.geometry;Oe(f),f.forAll((function(e){var t=e.from,n=e.to;if(t<n){var r=l.buffer.array,i=4*t,a=4*n;v.setSubData(r,i,i,a)}})),f.clear(),l.drawCommandsDirty=!0}))}},{key:"updateGeometries",value:function(e){var t,n=this._bufferWriter,r=n.vertexBufferLayout.stride/4,i=(0,a.Z)(e);try{for(i.s();!(t=i.n()).done;){var o=t.value,s=o.renderGeometry,l=this._dataByOrigin.get(s.origin.id),u=l&&l.instances.get(s.id);if(!u)return;var c=o.updateType;if(1&c&&(u.isVisible=s.instanceParameters.visible),9&c){var d=s.instanceParameters.visible;u.hasHighlights=!!s.instanceParameters.highlights&&d}if(16&c&&(u.hasOccludees=!!s.instanceParameters.occludees),6&c){var h=l.buffer,f=h.array,p=h.vao;(0,we.bZ)(s,Ae,Me),n.write({transformation:Ae,invTranspTransformation:Me},s.data,n.vertexBufferLayout.createView(f.buffer),u.from),(0,B.hu)(u.from+n.elementCount(s.data)===u.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(f,u.from*r*4,u.from*r*4,u.to*r*4)}l.drawCommandsDirty=!0}}catch(v){i.e(v)}finally{i.f()}}},{key:"updateRenderCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,(0,g.oE)(t.instances,(function(n){return n.isVisible?(n.hasHighlights&&(e._hasHighlights=!0,t.hasHighlights=!0),n.hasOccludees&&(e._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees}))}));this._dataByOrigin.forEach((function(t){t.drawCommandsDirty&&(function(t){if(t.drawCommandsDefault=null,t.drawCommandsHighlight=null,t.drawCommandsOccludees=null,t.drawCommandsShadowHighlightRest=null,0!==t.instances.size)if(Te(t)){var n=de(t.instances);t.drawCommandsDefault=[],t.drawCommandsHighlight=[],t.drawCommandsOccludees=[],t.drawCommandsShadowHighlightRest=[];var r,i=(0,a.Z)(n);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.isVisible&&(o.hasOccludees?fe(t.drawCommandsOccludees,o):fe(t.drawCommandsDefault,o),o.hasHighlights?fe(t.drawCommandsHighlight,o):fe(t.drawCommandsShadowHighlightRest,o))}}catch(u){i.e(u)}finally{i.f()}}else{var s=e._bufferWriter.vertexBufferLayout.stride,l=4*t.buffer.size/s;t.drawCommandsDefault=[{first:0,count:l}]}}(t),t.drawCommandsDirty=!1)}))}},{key:"updateLogic",value:function(e){return this._material.update(e)}},{key:"render",value:function(e,t,n){var r=this;if(null!=e&&!this._material.requiresSlot(e,t))return!1;var i=5===t||7===t;if(i&&!this._hasHighlights)return!1;var a=6===t,o=!(i||a);if(this._dataByOrigin.forEach((function(e){if(!i||e.hasHighlights){var t=(i?e.drawCommandsHighlight:a&&Te(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,n=o&&e.drawCommandsOccludees||null;((0,m.pC)(t)||(0,m.pC)(n))&&r._renderCommandData.push(new Re(e.origin,e.buffer,t,n))}})),0===this._renderCommandData.length)return!1;var s=this._rctx,l=this._glMaterials.load(s,t);if((0,m.Wi)(l))return this._renderCommandData.clear(),!1;var u=l.beginSlot(n);return u.bindPipelineState(s,e,!1),s.useProgram(u.program),l.bind(n,u),this._renderCommandData.forAll((function(t){var i=t.origin,a=t.buffer,o=t.renderCommands,l=t.occludeeCommands;n.origin=i,u.bindDraw(n),u.ensureAttributeLocations(a.vao),s.bindVAO(a.vao);var c=u.primitiveType;(0,m.pC)(o)&&r.renderCommands(s,c,o),(0,m.pC)(l)&&(u.bindPipelineState(s,e,!0),r.renderCommands(s,c,l),u.bindPipelineState(s,e,!1))})),this._renderCommandData.clear(),!0}},{key:"renderCommands",value:function(e,t,n){for(var r=0;r<n.length;r++)e.drawArrays(t,n[r].first,n[r].count)}},{key:"removeAndRebuild",value:function(e,t,n,r,i){var o,s=(0,a.Z)(t);try{for(s.s();!(o=s.n()).done;){var l=o.value;e.instances.delete(l.id)}}catch(y){s.e(y)}finally{s.f()}var u=de(e.instances);e.instances.clear();var c,d=e.buffer.size,h=e.buffer.alloc(r),f=0,p=(0,a.Z)(u);try{for(p.s();!(c=p.n()).done;){var v=c.value,g=v.from*n,m=v.to*n;h.copy(f,g,m),v.from=f/n,f+=m-g,v.to=f/n,e.instances.set(v.id,v)}}catch(y){p.e(y)}finally{p.f()}i.push(new ue(0,h.hasNewBuffer?e.buffer.array.length:d)),h.dispose(),e.buffer.erase(f,i.back().to),e.holes.clear()}},{key:"remove",value:function(e,t,n,r){var i,o=(0,a.Z)(t);try{for(o.s();!(i=o.n()).done;){var s=i.value.id,l=e.instances.get(s),u=l.from*n,c=l.to*n;e.buffer.erase(u,c),e.holes.push(new ue(l.from,l.to)),e.instances.delete(s),r.push(new ue(u,c))}}catch(d){o.e(d)}finally{o.f()}Oe(e.holes)}},{key:"add",value:function(e,t,n,r,i){var o,s=this._bufferWriter,l=s.vertexBufferLayout.createView(e.buffer.array.buffer),u=(0,a.Z)(t);try{for(u.s();!(o=u.n()).done;){var c=o.value,d=(0,m.pC)(c.transformation)?(0,S.m)(Ae,r,c.transformation):r;(0,S.b)(Me,d);var h=(0,S.t)(Me,Me),f=s.elementCount(c.data),p=f*n,v=De(e.holes,f);(0,m.Wi)(v)&&(v=e.buffer.size/n,e.buffer.grow(p),l=s.vertexBufferLayout.createView(e.buffer.array.buffer)),s.write({transformation:d,invTranspTransformation:h},c.data,l,v);var g=c.instanceParameters.visible,y=!!c.instanceParameters.highlights&&g,_=!!c.instanceParameters.occludees,b=new ce(c.id,v,v+f,g,y,_);(0,B.hu)(null==e.instances.get(c.id)),e.instances.set(c.id,b),i.push(new ue(b.from*n,b.to*n))}}catch(x){u.e(x)}finally{u.f()}}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials}}}]),e}(),Ce=(0,s.Z)((function e(t){(0,o.Z)(this,e),this.origin=t,this.toAdd=new Array,this.toRemove=new Array}));function Pe(e,t,n){var r=t.origin;if(!(0,m.Wi)(r)){var i=e.get(r.id);null==i&&(i=new Ce(r.vec3),e.set(r.id,i)),n?i.toAdd.push(t):i.toRemove.push(t)}}function Te(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function De(e,t){var n;if(!e.some((function(e){return!(e.to-e.from<t)&&(n=e,!0)})))return null;var r=n.from;return n.from+=t,n.from>=n.to&&e.removeUnordered(n),r}function Oe(e){var t=new Map;e.forAll((function(e){return t.set(e.from,e)}));for(var n=!0;n;)n=!1,e.forEach((function(r){var i=t.get(r.to);i&&(r.to=i.to,t.delete(i.from),e.removeUnordered(i),n=!0)}))}var Ee=(0,s.Z)((function e(t,n){(0,o.Z)(this,e),this.origin=t,this.buffer=n,this.instances=new Map,this.holes=new y.Z({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1})),Re=(0,s.Z)((function e(t,n,r,i){(0,o.Z)(this,e),this.origin=t,this.buffer=n,this.renderCommands=r,this.occludeeCommands=i})),ke=new y.Z({deallocator:null}),Ze=(0,T.c)(),Ae=(0,T.c)(),Me=(0,T.c)(),ze=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments))._pending=new He,e._changes=new te,e._materialRenderers=new Map,e._sortedMaterialRenderers=new y.Z,e._hasHighlights=!1,e._hasWater=!1,e}return(0,s.Z)(n,[{key:"dispose",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return(0,g.oE)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=function(e){var t=new Map,n=function(e){var n=t.get(e);return n||(n=new re,t.set(e,n)),n};return e.adds.forAll((function(e){ie(e)&&n(e.material).adds.push(e)})),e.removes.forAll((function(e){ie(e)&&n(e.material).removes.push(e)})),e.updates.forAll((function(e){ie(e.renderGeometry)&&n(e.renderGeometry.material).updates.push(e)})),t}(this._changes),n=!1,r=!1,i=!1;return t.forEach((function(t,a){var o=e._materialRenderers.get(a);if(!o&&t.adds.length>0&&(o=new Se(e.rctx,e.materialRepository,a),e._materialRenderers.set(a,o),n=!0,r=!0,i=!0),o){var s=r||o.hasHighlights,l=i||o.hasWater;o.modify(t),r=r||s!==o.hasHighlights,i=i||l!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(a),o.dispose(),n=!0)}})),this._changes.clear(),n&&this.updateSortedMaterialRenderers(),r&&(this._hasHighlights=(0,g.oE)(this._materialRenderers,(function(e){return e.hasHighlights}))),i&&(this._hasWater=(0,g.oE)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"add",value:function(e){if(0!==e.length){var t,n=this._pending.empty,r=(0,a.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._pending.adds.add(i)}}catch(o){r.e(o)}finally{r.f()}n&&this.notifyChange("updating")}}},{key:"remove",value:function(e){var t,n=this._pending.empty,r=(0,a.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._pending.adds.has(i)?(this._pending.removed.add(i),this._pending.adds.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i)}}catch(o){r.e(o)}finally{r.f()}n&&!this._pending.empty&&this.notifyChange("updating")}},{key:"modify",value:function(e,t){var n,r=0===this._changes.updates.length,i=(0,a.Z)(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=this._changes.updates.pushNew();s.renderGeometry=o,s.updateType=t}}catch(l){i.e(l)}finally{i.f()}r&&this._changes.updates.length>0&&this.notifyChange("updating")}},{key:"updateLogic",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(n){var r=n.materialRenderer;return t=r.updateLogic(e)||t})),t}},{key:"render",value:function(e,t){for(var n=0;n<this._sortedMaterialRenderers.length;n++){var r=this._sortedMaterialRenderers.data[n];r.material.shouldRender(e)&&r.materialRenderer.render(t.slot,e.pass,t)}}},{key:"updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(n,r){r.insertOrder=t++,e._sortedMaterialRenderers.push({material:r,materialRenderer:n})})),this._sortedMaterialRenderers.sort((function(e,t){var n=t.material.renderPriority-e.material.renderPriority;return 0!==n?n:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),n}(h.Z);(0,d._)([(0,x.Cb)()],ze.prototype,"rctx",void 0),(0,d._)([(0,x.Cb)()],ze.prototype,"materialRepository",void 0),(0,d._)([(0,x.Cb)()],ze.prototype,"updating",null),ze=(0,d._)([(0,w.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],ze);var He=function(){function e(){(0,o.Z)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return(0,s.Z)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}(),Le=n(61863),Fe=n(82144),je=n(31132),Ue=n(33559),Ie=n(7566),Ve=n(27627),We=n(36207),Ne=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get().build();return new Ve.$(e.rctx,t,Ie.i)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?(0,We.sm)({blending:(0,We.wK)(770,1,771,771),colorWrite:We.BK}):(0,We.sm)({colorWrite:We.BK})}}]),n}(je.A);Ne.shader=new Fe.J(Le.T,(function(){return n.e(7026).then(n.bind(n,77026))}));var Ge=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).hasAlpha=!1,e}return(0,s.Z)(n)}(Ue.m);(0,d._)([(0,Ue.o)()],Ge.prototype,"hasAlpha",void 0);var Be=(0,s.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.c)();(0,o.Z)(this,e),this.intensity=t})),qe=(0,s.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.c)(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,P.f)(.57735,.57735,.57735);(0,o.Z)(this,e),this.intensity=t,this.direction=n})),Je=(0,s.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.c)(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,P.f)(.57735,.57735,.57735),r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(0,o.Z)(this,e),this.intensity=t,this.direction=n,this.castShadows=r})),$e=(0,s.Z)((function e(){(0,o.Z)(this,e),this.r=[0],this.g=[0],this.b=[0]})),Ye=n(11186);function Xe(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t[r];return n}function Ke(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]*t;return n}function Qe(e,t,n){(n=n||e).length=e.length;for(var r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}function et(e){return(e+1)*(e+1)}function tt(e,t,n){var r=e[0],i=e[1],a=e[2],o=n||[];return o.length=et(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*a,o[3]=.4886025119*i),t>=2&&(o[4]=1.09254843059*r*i,o[5]=1.09254843059*i*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*r*a,o[8]=.54627421529*(r*r-i*i)),o}function nt(e,t){var n=et(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=n;for(var i=0;i<n;i++)r.r[i]=r.g[i]=r.b[i]=0;return r}function rt(e,t){var n,r=function(e){return(0,O.uZ)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length),i=(0,a.Z)(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;(0,Ye.o)(ct,o.direction),tt(ct,r,lt),Xe(lt,dt),Ke(lt,o.intensity[0],ut),Qe(t.r,ut),Ke(lt,o.intensity[1],ut),Qe(t.g,ut),Ke(lt,o.intensity[2],ut),Qe(t.b,ut)}}catch(s){i.e(s)}finally{i.f()}return t}function it(e,t){tt(ct,0,lt);var n,r=(0,a.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;t.r[0]+=lt[0]*dt[0]*i.intensity[0]*4*Math.PI,t.g[0]+=lt[0]*dt[0]*i.intensity[1]*4*Math.PI,t.b[0]+=lt[0]*dt[0]*i.intensity[2]*4*Math.PI}}catch(o){r.e(o)}finally{r.f()}return t}var at=[],ot=[],st=[],lt=[0],ut=[0],ct=(0,P.c)(),dt=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],ht=function(){function e(){(0,o.Z)(this,e),this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:(0,P.c)(),ambient:{color:(0,P.c)(),intensity:1},diffuse:{color:(0,P.c)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new $e,this._mainLight={intensity:(0,P.c)(),direction:(0,P.f)(1,0,0),castShadows:!1}}return(0,s.Z)(e,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"setLightDirectionUniform",value:function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}},{key:"setUniforms",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",n),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("ambientBoostFactor",this._ambientBoost);var r=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",r.r[0],r.r[1],r.r[2],r.r[3]),e.setUniform4f("lightingAmbientSH_G",r.g[0],r.g[1],r.g[2],r.g[3]),e.setUniform4f("lightingAmbientSH_B",r.b[0],r.b[1],r.b[2],r.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",r.r[0],r.g[0],r.b[0]),e.setUniform4f("lightingAmbientSH_R1",r.r[1],r.r[2],r.r[3],r.r[4]),e.setUniform4f("lightingAmbientSH_G1",r.g[1],r.g[2],r.g[3],r.g[4]),e.setUniform4f("lightingAmbientSH_B1",r.b[1],r.b[2],r.b[3],r.b[4]),e.setUniform4f("lightingAmbientSH_R2",r.r[5],r.r[6],r.r[7],r.r[8]),e.setUniform4f("lightingAmbientSH_G2",r.g[5],r.g[6],r.g[7],r.g[8]),e.setUniform4f("lightingAmbientSH_B2",r.b[5],r.b[6],r.b[7],r.b[8]))}},{key:"set",value:function(e){(function(e,t,n,r){nt(t,r),(0,Ye.s)(n.intensity,0,0,0);var i=!1,o=at,s=ot,l=st;o.length=0,s.length=0,l.length=0;var u,c=(0,a.Z)(e);try{for(c.s();!(u=c.n()).done;){var d=u.value;d instanceof Je&&!i?((0,Ye.g)(n.direction,d.direction),n.intensity[0]=d.intensity[0],n.intensity[1]=d.intensity[1],n.intensity[2]=d.intensity[2],n.castShadows=d.castShadows,i=!0):d instanceof Je||d instanceof qe?o.push(d):d instanceof Be?s.push(d):d instanceof $e&&l.push(d)}}catch(v){c.e(v)}finally{c.f()}rt(o,r),it(s,r);var h,f=(0,a.Z)(l);try{for(f.s();!(h=f.n()).done;){var p=h.value;Qe(r.r,p.r),Qe(r.g,p.g),Qe(r.b,p.b)}}catch(v){f.e(v)}finally{f.f()}})(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,Ye.g)(this._oldSunlight.direction,this._mainLight.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,Ye.a)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),(0,Ye.g)(ft,this._oldSunlight.diffuse.color),(0,Ye.a)(ft,ft,this._ambientBoost*this.globalFactor),(0,Ye.b)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,ft)}},{key:"old",get:function(){return this._oldSunlight}}]),e}(),ft=(0,P.c)(),pt=n(93433),vt=n(46228),gt=function(){function e(t){(0,o.Z)(this,e),this._rctx=t,this.cache=new Map}return(0,s.Z)(e,[{key:"dispose",value:function(){this.cache.forEach((function(e){return e.texture=(0,m.O3)(e.texture)})),this.cache.clear()}},{key:"acquire",value:function(e){var t=this;if((0,m.Wi)(e))return null;var n=this.patternId(e),r=this.cache.get(n);if(r)return r.refCount++,r.bind;var i=e.pixelRatio,o=function(e,t){var n,r=e.map((function(e){return Math.round(e*t)})),i=1/t,o=Math.floor(r.reduce((function(e,t){return e+t}))),s=r.reduce((function(e,t){return Math.max(e,t)})),l=(Math.floor(.5*(s-1))+.5)*i,u=[],c=1,d=(0,a.Z)(r);try{for(d.s();!(n=d.n()).done;){for(var h=n.value,f=0;f<h;f++){var p=c*(Math.min(f,h-1-f)+.5)*i/l*.5+.5;u.push(p)}c=-c}}catch(S){d.e(S)}finally{d.f()}var v,g=Math.round(r[0]/2),m=[].concat((0,pt.Z)(u.slice(g)),(0,pt.Z)(u.slice(0,g))),y=o+2,_=new Uint8Array(4*y),b=4,x=(0,a.Z)(m);try{for(x.s();!(v=x.n()).done;){var w=v.value;(0,vt.I)(w,_,b),b+=4}}catch(S){x.e(S)}finally{x.f()}return _.copyWithin(0,b-4,b),_.copyWithin(b,4,8),{encodedData:_,sdfNormalizer:l,paddedPixels:y,pixels:o}}(e.pattern,i),s=o.encodedData,l=o.sdfNormalizer,u=o.pixels,c=o.paddedPixels,d=u/i,h={refCount:1,texture:null,bind:function(e){return(0,m.Wi)(h.texture)&&(h.texture=new z.Z(t._rctx,{width:c,height:1,internalFormat:6408,pixelFormat:6408,dataType:5121,wrapMode:33071},s)),e.bindTexture(h.texture,"stipplePatternTexture"),{pixelSize:d,sdfNormalizer:l,pixels:u}}};return this.cache.set(n,h),h.bind}},{key:"release",value:function(e){if(!(0,m.Wi)(e)){var t=this.patternId(e),n=this.cache.get(t);n&&(n.refCount--,0===n.refCount&&((0,m.pC)(n.texture)&&n.texture.dispose(),this.cache.delete(t)))}}},{key:"swap",value:function(e,t){var n=this.acquire(t);return this.release(e),n}},{key:"patternId",value:function(e){return"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)}}]),e}();var mt=n(99912),yt=n(3384),_t=v.Z.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),bt=function(e){(0,l.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e))._overlays=null,r._overlayRenderTarget=null,r._hasHighlights=!1,r._rendersOccluded=!1,r._hasWater=!1,r._lighting=new ht,r._handles=new p.Z,r._frameTask=mt.sq,r._layerRenderers=new Map,r._sortedLayerRenderersDirty=!1,r._sortedLayerRenderers=new y.Z,r._geometries=new Map,r.worldToPCSRatio=1,r.events=new f.Z,r.longitudeCyclical=null,r}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext,this._renderContext=new Q(this._rctx);var n=t.waterTextureRepository;this._stippleTextureRepository=new gt(t.renderingContext),this._shaderTechniqueRepository=new V({rctx:this._rctx,viewingMode:2,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:n}),this._handles.add([(0,b.S1)(n,"loadingState",(function(){return e.events.emit("content-changed")})),(0,b.S1)(this,"spatialReference",(function(t){return e._localOrigins=new X.C1(t)}))]),this._materialRepository=new $(t.textureRepository,this._shaderTechniqueRepository,(function(t){(t.renderOccluded&Dt)>0!==e._rendersOccluded&&e.updateRendersOccluded(),e.events.emit("content-changed"),e.notifyChange("updating")}),(function(){return e.events.emit("content-changed")})),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new Be((0,P.f)(1,1,1))]),this._bindParameters={slot:20,highlightDepthTexture:(0,Y.hf)(this._rctx),camera:St,inverseViewport:(0,C.a)(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:T.I,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:3,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null},this._frameTask=this.view.resourceController.scheduler.registerTask(mt.T8.STAGE,this),this._handles.add(this._frameTask)}},{key:"dispose",value:function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.dispose()})),this._layerRenderers.clear(),this._debugTextureTechnique=(0,m.RY)(this._debugTextureTechnique),this._debugPatternTexture=(0,m.O3)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=(0,m.O3)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,m.O3)(this._shaderTechniqueRepository),this._temporaryFBO=(0,m.O3)(this._temporaryFBO),this._quadVAO=(0,m.O3)(this._quadVAO),this.disposeOverlays()}},{key:"updating",get:function(){return this._sortedLayerRenderersDirty||this._frameTask.updating||(0,g.oE)(this._layerRenderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return(0,m.pC)(this._overlays)&&(0,m.pC)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return(0,m.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if((0,m.pC)(this._overlayRenderTarget)){var n,r=(0,a.Z)(this._overlayRenderTarget.renderTargets);try{for(r.s();!(n=r.n()).done;){var i=n.value,o=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(o,i,e)||t}}catch(s){r.e(s)}finally{r.f()}}return t}},{key:"overlays",get:function(){return(0,m.Pt)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){(0,m.pC)(this._overlays)&&this._overlays.forEach((function(t){t.hasTargetWithoutRasterImage=(0,_.f)(e,(function(e){return 1===e.drapeTargetType}))}))}},{key:"ensureDrapeSources",value:function(e){(0,m.pC)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=(0,g.oE)(e,(function(e,t){return 1===t.drapeSourceType})),t.hasDrapedRasterSource=(0,g.oE)(e,(function(e,t){return 0===t.drapeSourceType}))}))}},{key:"ensureOverlays",value:function(e,t){(0,m.Wi)(this._overlays)&&(this._overlayRenderTarget=new F(this._rctx),this._overlays=[new k(0,this._overlayRenderTarget),new k(1,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){this._overlays=null,this._overlayRenderTarget=(0,m.O3)(this._overlayRenderTarget),this.events.emit("textures-disposed")}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}},{key:"_processLayers",value:function(e,t){var n,r=!1,o=(0,a.Z)(this._layerRenderers);try{for(o.s();!(n=o.n()).done;){var s=(0,i.Z)(n.value,2),l=s[0],u=s[1];if(e.done)break;(l.destroyed||t(l))&&(u.commitChanges()&&(r=!0,e.madeProgress()),u.isEmpty&&(r=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(l),this._handles.remove(l)))}}catch(c){o.e(c)}finally{o.f()}this.updateSortedLayerRenderers(),r&&((0,m.pC)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())}},{key:"processSyncLayers",value:function(){this._processLayers(mt.G5,(function(e){return 1===e.updatePolicy}))}},{key:"addGeometries",value:function(e,t,n){var r,i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;(0,m.Wi)(o.origin)&&(o.origin=this._localOrigins.getOrigin(o.boundingSphere)),this._geometries.set(o.id,o)}}catch(s){i.e(s)}finally{i.f()}this.ensureLayerRenderer(t).add(e),2===n&&this.notifyGraphicGeometryChanged(e,t)}},{key:"removeGeometries",value:function(e,t,n){var r,i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;this._geometries.delete((0,m.Wg)(o.id))}}catch(l){i.e(l)}finally{i.f()}var s=this._layerRenderers.get(t);s&&(s.remove(e),2===n&&this.notifyGraphicGeometryChanged(e,t))}},{key:"updateGeometries",value:function(e,t,n){var r=this._layerRenderers.get(t);if(r)switch(r.modify(e,n),n){case 4:case 2:return this.notifyGraphicGeometryChanged(e,t);case 1:return this.notifyGraphicVisibilityChanged(e,t)}else _t.warn("Attempted to update geometry for nonexistent layer")}},{key:"notifyGraphicGeometryChanged",value:function(e,t){if(!(0,m.Wi)(t.notifyGraphicGeometryChanged)){var n,r,i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var o=r.value.graphicUid;(0,m.pC)(o)&&o!==n&&(t.notifyGraphicGeometryChanged(o),n=o)}}catch(s){i.e(s)}finally{i.f()}}}},{key:"notifyGraphicVisibilityChanged",value:function(e,t){if(!(0,m.Wi)(t.notifyGraphicVisibilityChanged)){var n,r,i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var o=r.value.graphicUid;(0,m.pC)(o)&&o!==n&&(t.notifyGraphicVisibilityChanged(o),n=o)}}catch(s){i.e(s)}finally{i.f()}}}},{key:"updateHighlights",value:function(e,t){var n=this._layerRenderers.get(t);n?n.modify(e,8):_t.warn("Attempted to update highlights for nonexistent layer")}},{key:"isEmpty",value:function(){return 0===this._geometries.size&&!D.Z.OVERLAY_DRAW_DEBUG_TEXTURE}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateLogic",value:function(e){var t=!1;return this._layerRenderers.forEach((function(n){return t=n.updateLogic(e)||t})),t}},{key:"updateLayerOrder",value:function(){this._sortedLayerRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,n){var r=this,i=e.canvasGeometries;if(0===i.numViews)return!1;this._screenToWorldRatio=n*e.mapUnitsPerPixel;var a=t.renderPass;if(this.isEmpty()||5===a&&!this.hasHighlights||3===a&&!this.hasWater||!e.hasSomeSizedView())return!1;var o=t.fbo;if(!o.isValid())return!1;var s=2*e.resolution,l=e.resolution;o.resize(s,l);var u=this._rctx;St.pixelRatio=e.pixelRatio*n,this._renderContext.pass=a,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=3===a?21:20,e.applyViewport(this._rctx),o.bind(u),0===e.index&&(u.setClearColor(0,0,0,0),u.clearSafe(16384));var c=1===t.type?2:4===t.type?1:0;if(1===c&&(this._renderContext.renderOccludedMask=Dt),D.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==c)for(var d=0;d<i.numViews;d++)this.setViewParameters(i.extents[d],e,St),this.drawDebugTexture(e.resolution,wt[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((function(t){var n=t.layerView,d=t.renderer;if(2!==c||!(0,m.pC)(n)||0!==n.drapeSourceType){var h=(0,m.pC)(n)&&(0,m.pC)(n.fullOpacity)&&n.fullOpacity<1&&0===a;h&&(r.bindTemporaryFramebuffer(r._rctx,s,l),u.clearSafe(16384));for(var f=0;f<i.numViews;f++)r.setViewParameters(i.extents[f],e,St),d.render(r._renderContext,r._bindParameters);h&&(0,m.pC)(r._temporaryFBO)&&(o.bind(u),r.view._stage.renderView.compositingHelper.composite(r._temporaryFBO.getTexture(),2,(0,m.Wg)((0,m.Wg)(n).fullOpacity),3,e.index))}})),u.bindFramebuffer(null),o.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,n){(0,m.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new L(e,!1)),this._temporaryFBO.resize(t,n),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=(0,r.Z)(c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.reloadAll();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"intersect",value:function(e,t,n,r){var i=this,a=0;this._geometries.forEach((function(o){if(!r||r(o)){i._intersectRenderGeometry(o,n,t,0,e,a);var s=i.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&i._intersectRenderGeometry(o,n,t,s.range,e,a),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&i._intersectRenderGeometry(o,n,t,-s.range,e,a)),a++}}))}},{key:"_intersectRenderGeometry",value:function(e,t,n,r,i,a){if(e.instanceParameters.visible){var o=0;(0,m.pC)(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),Ct[0]=n[0]-r,Ct[1]=n[1]-o,Ct[2]=1,Pt[0]=n[0]-r,Pt[1]=n[1]-o,Pt[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),i,Ct,Pt,(function(n,r,o){!function(e,t,n,r,i,a,o){var s={layerUid:a,graphicUid:o,triangleNr:t},l=function(t){t.set(3,s,e.dist,e.normal,e.transformation,n,r)};if((null==i.results.min.drapedLayerOrder||n>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&l(i.results.min),0!==i.options.store&&(null==i.results.max.drapedLayerOrder||n<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&l(i.results.max),2===i.options.store){var u=(0,K.LP)(i.ray);l(u),i.results.all.push(u)}}(t,o,e.material.renderPriority,a,i,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,t)}}},{key:"ensureLayerRenderer",value:function(e){var t=this,n=this._layerRenderers.get(e);return n||(n=new ze({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,n),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(function(){return t.events.emit("content-changed")})),e),this._handles.add((0,b.S1)(n,"updating",(function(){return t.notifyChange("updating")})),e)),n}},{key:"updateSortedLayerRenderers",value:function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=new Set(this._layerRenderers.values());this.view.allLayerViews.forEach((function(n){var r=n,i=e._layerRenderers.get(r);i&&(e._sortedLayerRenderers.push(new xt(r,i)),t.delete(i))})),t.forEach((function(t){return e._sortedLayerRenderers.push(new xt(null,t))}))}}},{key:"setViewParameters",value:function(e,t,n){n.viewport[0]=n.viewport[1]=0,n.viewport[2]=n.viewport[3]=t.resolution,(0,S.o)(n.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],n.near,n.far),(0,S.i)(n.viewMatrix),(0,S.a)(n.viewMatrix,n.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=n,this._bindParameters.camera=n,this._bindParameters.inverseViewport[0]=1/n.fullViewport[2],this._bindParameters.inverseViewport[1]=1/n.fullViewport[3]}},{key:"updateHasWater",value:function(){var e=(0,g.oE)(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"updateHasHighlights",value:function(){var e=(0,g.oE)(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}},{key:"updateRendersOccluded",value:function(){var e=(0,g.oE)(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}},{key:"drawDebugTexture",value:function(e,t){var n=this._rctx;this.ensureDebugPatternResources(e,e);var r=this._debugTextureTechnique.program;n.useProgram(r),this._debugTextureTechnique.bindPipelineState(n),r.setUniform4f("color",t[0],t[1],t[2],1),r.bindTexture(this._debugPatternTexture,"tex"),n.bindVAO(this._quadVAO),n.drawArrays(5,0,(0,yt._V)(this._quadVAO,"geometry"))}},{key:"ensureDebugPatternResources",value:function(e,t){if(!this._debugPatternTexture){for(var n=new Uint8Array(e*t*4),r=0,i=0;i<t;i++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(i/10);o<2||s<2||10*o>e-20||10*s>t-20?(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=255):(n[r++]=255,n[r++]=255,n[r++]=255,n[r++]=1&o&&1&s?1&a^1&i?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new z.Z(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:t},n);var l=new Ge;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Ne,l),this._quadVAO=(0,Y.ow)(this._rctx)}}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]),n}(N(h.Z));(0,d._)([(0,x.Cb)()],bt.prototype,"_frameTask",void 0),(0,d._)([(0,x.Cb)()],bt.prototype,"_sortedLayerRenderersDirty",void 0),(0,d._)([function(e,t){var n,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(n=null==(r=e._managedDisposables)?void 0:r.slice())?n:[]),e._managedDisposables.unshift(t)}],bt.prototype,"_shaderTechniqueRepository",void 0),(0,d._)([function(e,t){var n,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(n=null==(r=e._managedDisposables)?void 0:r.slice())?n:[]),e._managedDisposables.unshift(t)}],bt.prototype,"_stippleTextureRepository",void 0),(0,d._)([(0,x.Cb)({constructOnly:!0})],bt.prototype,"view",void 0),(0,d._)([(0,x.Cb)()],bt.prototype,"worldToPCSRatio",void 0),(0,d._)([(0,x.Cb)()],bt.prototype,"spatialReference",void 0),(0,d._)([(0,x.Cb)({type:Boolean,readOnly:!0})],bt.prototype,"updating",null),bt=(0,d._)([(0,w.j)("esri.views.3d.terrain.OverlayRenderer")],bt);var xt=(0,s.Z)((function e(t,n){(0,o.Z)(this,e),this.layerView=t,this.renderer=n})),wt=[[1,.5,.5],[.5,.5,1]];var St=new G.Z;St.near=1,St.far=1e4,St.relativeElevation=null;var Ct=(0,P.c)(),Pt=(0,P.c)(),Tt=-2,Dt=4},74321:function(e,t,n){n.d(t,{k:function(){return o}});var r,i=n(30168),a=n(98634);function o(e){e.attributes.add("position","vec2"),e.varyings.add("uv","vec2"),e.vertex.code.add((0,a.H)(r||(r=(0,i.Z)(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      uv = position * 0.5 + vec2(0.5);\n    }\n  "]))))}},48353:function(e,t,n){n.d(t,{U:function(){return d}});var r,i,a,o,s,l,u=n(30168),c=n(98634);function d(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add("sizeFeatureAttribute","float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add((0,c.H)(r||(r=(0,u.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add("size","float"),e.vertex.code.add((0,c.H)(i||(i=(0,u.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add("opacityFeatureAttribute","float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add((0,c.H)(a||(a=(0,u.Z)(["uniform float vvOpacityValues[vvOpacityNumber];\nuniform float vvOpacityOpacities[vvOpacityNumber];\nfloat interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):e.vertex.code.add((0,c.H)(o||(o=(0,u.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.attributes.add("colorFeatureAttribute","float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add((0,c.H)(s||(s=(0,u.Z)(["uniform float vvColorValues[vvColorNumber];\nuniform vec4 vvColorColors[vvColorNumber];\nvec4 interpolateColor( float value ) {\nif (value <= vvColorValues[0]) {\nreturn vvColorColors[0];\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn mix(vvColorColors[i-1], vvColorColors[i], f);\n}\n}\nreturn vvColorColors[vvColorNumber - 1];\n}\nvec4 getColor(){\nreturn applyOpacity(interpolateColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add("color","vec4"),e.vertex.code.add((0,c.H)(l||(l=(0,u.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},28156:function(e,t,n){n.d(t,{H:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){var t=(0,o.H)(r||(r=(0,a.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),n=(0,o.H)(i||(i=(0,a.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(n),e.fragment.code.add(t),e.fragment.code.add(n)}},81879:function(e,t,n){n.d(t,{R:function(){return f},H:function(){return p}});var r,i,a,o,s,l,u,c=n(30168),d=n(62993),h=n(98634);function f(e,t){var n=e;n.include(d.c),n.attributes.add("position","vec3"),n.attributes.add("normal","vec3"),n.attributes.add("auxpos1","vec4"),n.vertex.uniforms.add("proj","mat4"),n.vertex.uniforms.add("view","mat4"),n.vertex.uniforms.add("viewNormal","mat4"),n.vertex.uniforms.add("viewport","vec4"),n.vertex.uniforms.add("camPos","vec3"),n.vertex.uniforms.add("polygonOffset","float"),n.vertex.uniforms.add("cameraGroundRelative","float"),n.vertex.uniforms.add("pixelRatio","float"),n.vertex.uniforms.add("perDistancePixelRatio","float"),n.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&n.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&n.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),n.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),n.vertex.constants.add("smallOffsetAngle","float",.984807753012208),n.vertex.code.add((0,h.H)(r||(r=(0,c.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),n.vertex.code.add((0,h.H)(i||(i=(0,c.Z)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped||n.vertex.code.add((0,h.H)(a||(a=(0,c.Z)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"])))),n.vertex.code.add((0,h.H)(o||(o=(0,c.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||1===t.screenCenterOffsetUnitsEnabled)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?(0,h.H)(s||(s=(0,c.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",1!==t.screenCenterOffsetUnitsEnabled?(0,h.H)(l||(l=(0,c.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",1===t.screenCenterOffsetUnitsEnabled?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",1===t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),n.vertex.code.add((0,h.H)(u||(u=(0,c.Z)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (uRenderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}function p(e,t){e.setUniform1f("uRenderTransparentlyOccludedHUD",0===t.renderTransparentlyOccludedHUD?1:1===t.renderTransparentlyOccludedHUD?0:.75)}},50913:function(e,t,n){n.d(t,{R:function(){return h}});var r,i,a,o,s=n(30168),l=n(21002),u=n(43565),c=n(78980),d=n(98634);function h(e,t){t.multipassGeometryEnabled&&e.vertex.include(u.S),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add((0,d.H)(r||(r=(0,s.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassGeometryEnabled?(0,d.H)(i||(i=(0,s.Z)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassTerrainEnabled?"depth = projectAux.posView.z;":"")),t.multipassTerrainEnabled&&e.fragment.include(l.S),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("cameraNearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(c.n),e.fragment.code.add((0,d.H)(a||(a=(0,s.Z)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.multipassTerrainEnabled?(0,d.H)(o||(o=(0,s.Z)(["\n\n          vec2 uv = gl_FragCoord.xy * inverseViewport;\n\n          //Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), cameraNearFar);\n\n          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          //Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"]))):""))}},7683:function(e,t,n){n.d(t,{E:function(){return l},K:function(){return s}});var r,i,a=n(30168),o=n(98634);function s(e){e.fragment.code.add((0,o.H)(r||(r=(0,a.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,o.H)(i||(i=(0,a.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},37248:function(e,t,n){n.d(t,{q:function(){return D}});var r,i,a,o,s,l,u,c,d,h,f,p,v,g,m,y,_,b,x,w,S,C=n(30168),P=n(78980),T=n(98634);function D(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){var n=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(P.n),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("camPos","vec3"),e.vertex.code.add((0,T.H)(r||(r=(0,C.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - camPos);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),e.vertex.code.add((0,T.H)(i||(i=(0,C.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),O)),e.vertex.code.add((0,T.H)(a||(a=(0,C.Z)(["\n  "," computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {\n  "])),t.stippleRequiresStretchMeasure?(0,T.H)(o||(o=(0,C.Z)(["vec3"]))):(0,T.H)(s||(s=(0,C.Z)(["vec2"]))))),n&&e.vertex.code.add((0,T.H)(l||(l=(0,C.Z)(["\n      if (segmentLengthPseudoScreen >= patternLength) {\n\n        // Round the screen length to get an integer number of pattern repetitions (minimum 1).\n        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\n        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));\n        float segmentLengthScreenRounded = flooredRepetitions * patternLength;\n\n        ","\n      }\n    "])),t.stippleRequiresStretchMeasure?(0,T.H)(u||(u=(0,C.Z)(["return vec3(0.0, segmentLengthScreenRounded, repetitions / flooredRepetitions);"]))):(0,T.H)(c||(c=(0,C.Z)(["return vec2(0.0, segmentLengthScreenRounded);"]))))),e.vertex.code.add((0,T.H)(d||(d=(0,C.Z)(["\n      ",";\n    }\n  "])),t.stippleRequiresStretchMeasure?(0,T.H)(h||(h=(0,C.Z)(["return vec3(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen, 1.0)"]))):(0,T.H)(f||(f=(0,C.Z)(["return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen)"]))))),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add((0,T.H)(p||(p=(0,C.Z)(["float padTexture(float u) {\nreturn (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);\n}"])))),e.fragment.code.add((0,T.H)(v||(v=(0,C.Z)(["\n    float getStippleSDF(out bool isClamped) {\n      ","\n\n      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;\n      ","\n      u = padTexture(fract(u));\n\n      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));\n      return (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\n    }\n\n    float getStippleSDF() {\n      bool ignored;\n      return getStippleSDF(ignored);\n    }\n\n    float getStippleAlpha() {\n      bool isClamped;\n      float stippleSDF = getStippleSDF(isClamped);\n\n      float antiAliasedResult = ","\n\n      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n    }\n  "])),t.stippleRequiresClamp?(0,T.H)(g||(g=(0,C.Z)(["\n          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\n          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\n          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;"]))):(0,T.H)(m||(m=(0,C.Z)(["\n          float stippleDistanceClamped = vStippleDistance;\n          isClamped = false;"]))),t.stippleScaleWithLineWidth?(0,T.H)(y||(y=(0,C.Z)(["u *= vLineSizeInv;"]))):"",t.stippleScaleWithLineWidth?(0,T.H)(_||(_=(0,C.Z)(["clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);"]))):(0,T.H)(b||(b=(0,C.Z)(["clamp(stippleSDF + 0.5, 0.0, 1.0);"]))))),t.stippleOffColorEnabled?e.fragment.code.add((0,T.H)(x||(x=(0,C.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"])))):e.fragment.code.add((0,T.H)(w||(w=(0,C.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,T.H)(S||(S=(0,C.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}var O=T.H.float(.4)},43565:function(e,t,n){n.d(t,{l:function(){return l},S:function(){return s}});var r,i=n(30168),a=n(21002),o=n(98634);function s(e){e.include(a.S),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("cameraNearFar","vec2"),e.code.add((0,o.H)(r||(r=(0,i.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, cameraNearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}function l(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},8555:function(e,t,n){n.d(t,{n:function(){return u}});var r,i,a,o,s=n(30168),l=n(98634);function u(e,t){1===t.viewingMode?e.vertex.code.add((0,l.H)(r||(r=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,l.H)(i||(i=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),1===t.viewingMode?e.vertex.code.add((0,l.H)(a||(a=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,l.H)(o||(o=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},70755:function(e,t,n){n.d(t,{P:function(){return u},O:function(){return c}});var r,i,a=n(30168),o=n(21002),s=n(98634);function l(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMat","mat4"),e.fragment.uniforms.add("rpProjectionMat","mat4"),e.fragment.code.add((0,s.H)(r||(r=(0,a.Z)(["vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n{\nvec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\nvec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\nreprojectedCoord.xy /= reprojectedCoord.w;\nreturn reprojectedCoord.xy * 0.5 + 0.5;\n}"]))))}function u(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("ssrViewMat","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(o.S),e.include(l),e.fragment.code.add((0,s.H)(i||(i=(0,a.Z)(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}function c(e,t){t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("ssrViewMat",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),function(e,t){e.bindTexture(t.lastFrameColorTexture,"lastFrameColorMap"),e.setUniformMatrix4fv("reprojectionMat",t.reprojectionMatrix),e.setUniformMatrix4fv("rpProjectionMat",t.camera.projectionMatrix)}(e,t))}},90782:function(e,t,n){n.d(t,{B:function(){return p}});var r,i=n(30168),a=n(7683),o=n(98634);function s(e){e.fragment.code.add((0,o.H)(r||(r=(0,i.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var l,u,c,d,h=n(2116),f=n(70755);function p(e,t){e.include(h.T,t),e.include(s),e.include(a.E),t.ssrEnabled&&e.include(f.P,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.775).add("waterSeeColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]),e.fragment.code.add((0,o.H)(l||(l=(0,i.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),e.fragment.code.add((0,o.H)(u||(u=(0,i.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {\nfloat reflectionHit = 0.;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}"])))),t.ssrEnabled?e.fragment.code.add((0,o.H)(c||(c=(0,i.Z)(["vec4 viewPosition = vec4(positionView.xyz, 1.0);\nvec3 viewDir = normalize(viewPosition.xyz);\nvec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = ssrViewMat *vec4(localUp, 0.0);\nfloat correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);\nvec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));\nvec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\nreflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;\n}\nfloat seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);\nreturn tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);\n}"])))):e.fragment.code.add((0,o.H)(d||(d=(0,i.Z)(["return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);\n}"]))))}},79246:function(e,t,n){n.d(t,{M:function(){return s},b:function(){return l}});var r,i=n(30168),a=n(7683),o=n(98634);function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(a.K),e.fragment.code.add((0,o.H)(r||(r=(0,i.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}function l(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},30425:function(e,t,n){n.d(t,{Z:function(){return w}});var r=n(15671),i=n(43144),a=n(32718),o=n(16889),s=n(92026),l=n(17842),u=n(14226),c=n(81949),d=n(88396),h=n(6394),f=n(11186),p=n(71353),v=n(90045),g=n(67077),m=n(95773),y=n(40885),_=n(40927),b=n(97731),x=a.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera"),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,r.Z)(this,e),this._viewUp=(0,p.c)(),this._viewForward=(0,p.c)(),this._viewRight=(0,p.c)(),this._ray=(0,y.Ue)(),this._viewport=(0,g.f)(0,0,1,1),this._padding=(0,g.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,h.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,c.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,c.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,c.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,c.c)(),this._frustumDirty=!0,this._frustum=(0,m.Ue)(),this._fullViewport=(0,g.c)(),this.pixelRatio=1,this.relativeElevation=0,(0,s.pC)(t)&&(0,f.g)(this._ray.origin,t),this._center=(0,s.pC)(n)?(0,p.a)(n):(0,p.c)(),this._up=(0,s.pC)(i)?(0,p.a)(i):(0,p.f)(0,0,1)}return(0,i.Z)(e,[{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)}},{key:"ray",get:function(){return(0,f.f)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){(0,u.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(e){this.width=e-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(e){this.height=e-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding[0]===e[0]&&this._padding[1]===e[1]&&this._padding[2]===e[2]&&this._padding[3]===e[3]||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),(0,v.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&((0,u.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){var e=this.width,t=this.height,n=this.near*Math.tan(this.fovY/2),r=n*this.aspect;(0,u.h)(this._projectionMatrix,-r*(1+2*this._padding[3]/e),r*(1+2*this._padding[1]/e),-n*(1+2*this._padding[2]/t),n*(1+2*this._padding[0]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){(0,u.c)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return(0,b.tM)(this._fov,this.width,this.height)},set:function(e){this._fov=(0,b.Kj)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return(0,b.RQ)(this._fov,this.width,this.height)},set:function(e){this._fov=(0,b.zF)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return(0,f.i)(this._center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,u.b)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,u.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){(0,f.g)(this._ray.origin,e.eye),(0,f.g)(this._center,e.center),(0,f.g)(this._up,e.up),(0,v.c)(this._viewport,e.viewport),(0,v.c)(this._padding,e.padding),(0,d.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,u.c)(this._viewMatrix,e.viewMatrix),(0,f.g)(this._viewRight,e.viewRight),(0,f.g)(this._viewUp,e.viewUp),(0,f.g)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:((0,u.c)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,m.JG)(e.frustum,this._frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,u.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new e).copyFrom(this)}},{key:"equals",value:function(e){return(0,f.k)(this.eye,e.eye)&&(0,f.k)(this._center,e.center)&&(0,f.k)(this._up,e.up)&&(0,v.g)(this._viewport,e.viewport)&&(0,v.g)(this._padding,e.padding)&&(0,d.e)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;(0,f.v)(P,e.eye,e.center),(0,f.v)(T,this.eye,this._center);var n=(0,f.d)(P,T),r=(0,f.w)(P),i=(0,f.w)(T);return n*n>=(1-1e-10)*r*i&&(0,f.x)(e.eye,this.eye)<Math.max(r,i)*t*t&&(0,v.i)(e.padding,this._padding)<.5&&(0,v.i)(e.viewport,this._viewport)<.5}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(e))}},{key:"viewDirectionDistance",value:function(e){return Math.abs((0,_.SR)(this.viewForward,(0,f.f)(P,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.s1)();return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*n,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,n=this.padding;e.setViewport(t[0]-n[3],t[1]-n[2],t[2]+n[1]+n[3],t[3]+n[0]+n[2])}},{key:"applyProjection",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==S&&(0,f.g)(S,e),S[3]=1,n&&(t[2]=-S[2]),(0,v.t)(S,S,this.projectionMatrix),(0,f.a)(S,S,1/Math.abs(S[3]));var r=this.fullViewport;return t[0]=(0,o.t7)(0,r[0]+r[2],.5+.5*S[0]),t[1]=(0,o.t7)(0,r[1]+r[3],.5+.5*S[1]),n||(t[2]=.5*(S[2]+1)),t}},{key:"projectToScreen",value:function(e,t){this.projectToRenderScreen(e,D),this.renderToScreen(D,t)}},{key:"projectToRenderScreen",value:function(e,t){if(S[0]=e[0],S[1]=e[1],S[2]=e[2],S[3]=1,(0,v.t)(S,S,this.viewProjectionMatrix),0===S[3])return null;(0,f.a)(S,S,1/Math.abs(S[3]));var n=this.fullViewport;return"x"in t?(t.x=(0,o.t7)(0,n[0]+n[2],.5+.5*S[0]),t.y=(0,o.t7)(0,n[1]+n[3],.5+.5*S[1])):(t[0]=(0,o.t7)(0,n[0]+n[2],.5+.5*S[0]),t[1]=(0,o.t7)(0,n[1]+n[3],.5+.5*S[1]),t.length>2&&(t[2]=.5*(S[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,D),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if((0,u.m)(C,this.projectionMatrix,this.viewMatrix),!(0,u.b)(C,C))return null;var n=this.fullViewport;return S[0]=2*(e[0]-n[0])/n[2]-1,S[1]=2*(e[1]-n[1])/n[3]-1,S[2]=2*e[2]-1,S[3]=1,(0,v.t)(S,S,C),0===S[3]?null:(t[0]=S[0]/S[3],t[1]=S[1]/S[3],t[2]=S[2]/S[3],t)}},{key:"constrainWindowSize",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n,i=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(i-n/2,0),s=Math.max(this.fullHeight-a-r/2,0),l=-Math.min(i-n/2,0),u=-Math.min(this.fullHeight-a-r/2,0);return[o,s,n-l- -Math.min(this.fullWidth-i-n/2,0),r-u- -Math.min(a-r/2,0)]}},{key:"computeUp",value:function(e){1===e?this.computeUpGlobal():this.computeUpLocal()}},{key:"screenToRender",value:function(e,t){var n=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=n,t[1]=r,t}},{key:"renderToScreen",value:function(e,t){var n=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=n,t[1]=r}},{key:"computeUpGlobal",value:function(){(0,f.f)(P,this.center,this.eye);var e=(0,f.l)(this.center);e<1?((0,f.s)(this._up,0,0,1),this._markViewDirty()):Math.abs((0,f.d)(P,this.center))>.9999*(0,f.l)(P)*e||((0,f.c)(this._up,P,this.center),(0,f.c)(this._up,this._up,P),(0,f.n)(this._up,this._up),this._markViewDirty())}},{key:"computeUpLocal",value:function(){(0,f.r)(P,this.eye,this.center),Math.abs(P[2])<=.9999&&((0,f.a)(P,P,P[2]),(0,f.s)(this._up,-P[0],-P[1],1-P[2]),(0,f.n)(this._up,this._up),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,f.k)(e,t)||((0,f.g)(t,e),this._markViewDirty()):x.warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&((0,m.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&((0,u.l)(this._viewMatrix,this.eye,this._center,this._up),(0,f.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,f.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,f.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),e}(),S=(0,g.c)(),C=(0,c.c)(),P=(0,p.c)(),T=(0,p.c)(),D=(0,l.J$)()},94425:function(e,t,n){n.d(t,{p:function(){return o},S:function(){return s}});var r=n(15671),i=n(43144),a=n(92026),o=function(){function e(t,n){(0,r.Z)(this,e),this._material=t,this._repository=n,this._map=new Map}return(0,i.Z)(e,[{key:"destroy",value:function(){var e=this;this._map.forEach((function(t,n){(0,a.pC)(t)&&e._repository.release(e._material,s(n))}))}},{key:"load",value:function(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,s(t)));var n=this._map.get(t);if((0,a.pC)(n)){if(2===n.ensureResources(e))return n;this._repository.requestRender()}return null}}]),e}();function s(e){switch(e){default:case 0:return 0;case 1:return 7;case 4:case 7:case 6:return 3;case 3:return 2;case 2:return 1;case 5:return 4}}},70619:function(e,t,n){n.d(t,{Z:function(){return _}});var r,i=n(11186),a=n(8229),o=n(71353),s=n(55652),l=n(40885);!function(e){e.length=function(e,t){var n=e[t],r=e[t+1],i=e[t+2];return Math.sqrt(n*n+r*r+i*i)},e.normalize=function(e,t){var n=e[t],r=e[t+1],i=e[t+2],a=1/Math.sqrt(n*n+r*r+i*i);e[t]*=a,e[t+1]*=a,e[t+2]*=a},e.scale=function(e,t,n){e[t]*=n,e[t+1]*=n,e[t+2]*=n},e.add=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]+n[r],i[a+1]=e[t+1]+n[r+1],i[a+2]=e[t+2]+n[r+2]},e.subtract=function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]-n[r],i[a+1]=e[t+1]-n[r+1],i[a+2]=e[t+2]-n[r+2]}}(r||(r={}));var u,c,d,h,f=n(74894),p=n(81935),v=n(97731),g=r;!function(e){for(var t=.5,n=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36),s=0;s<6;s++)for(var l=0;l<6;l++)o[6*s+l]=s;for(var u=new Uint16Array(36),c=0;c<6;c++)u[6*c+0]=0,u[6*c+1]=1,u[6*c+2]=2,u[6*c+3]=2,u[6*c+4]=3,u[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(24),s=0;s<8;s++)t[3*s]=n[s][0]*e[0],t[3*s+1]=n[s][1]*e[1],t[3*s+2]=n[s][2]*e[2];return new f.Z([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}],["uv0",{size:2,data:i}]],[["position",a],["normal",o],["uv0",u]])}}(u||(u={})),function(e){var t=.5,n=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(18),o=0;o<6;o++)t[3*o]=n[o][0]*e[0],t[3*o+1]=n[o][1]*e[1],t[3*o+2]=n[o][2]*e[2];return new f.Z([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:r}]],[["position",i],["normal",a]])}}(c||(c={})),function(e){var t=.5,n=(0,a.f)(-t,0,-t),r=(0,a.f)(t,0,-t),o=(0,a.f)(0,0,t),s=(0,a.f)(0,.5,0),l=(0,a.c)(),u=(0,a.c)(),c=(0,a.c)(),d=(0,a.c)(),h=(0,a.c)();(0,i.f)(l,n,s),(0,i.f)(u,n,r),(0,i.c)(c,l,u),(0,i.n)(c,c),(0,i.f)(l,r,s),(0,i.f)(u,r,o),(0,i.c)(d,l,u),(0,i.n)(d,d),(0,i.f)(l,o,s),(0,i.f)(u,o,n),(0,i.c)(h,l,u),(0,i.n)(h,h);var p=[n,r,o,s],v=[0,-1,0,c[0],c[1],c[2],d[0],d[1],d[2],h[0],h[1],h[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],m=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(12),n=0;n<4;n++)t[3*n]=p[n][0]*e[0],t[3*n+1]=p[n][1]*e[1],t[3*n+2]=p[n][2]*e[2];return new f.Z([["position",{size:3,data:t,exclusive:!0}],["normal",{size:3,data:v}]],[["position",new Uint16Array(g)],["normal",new Uint16Array(m)]])}}(d||(d={})),function(e){e.createBoxGeometry=u.createGeometry,e.createDiamondGeometry=c.createGeometry,e.createTetrahedronGeometry=d.createGeometry,e.createSphereGeometry=function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{uv:!0},i=-Math.PI,a=2*Math.PI,o=-Math.PI/2,s=Math.PI,l=Math.max(3,Math.floor(t)),u=Math.max(2,Math.floor(n)),c=(l+1)*(u+1),d=new Float32Array(3*c),h=new Float32Array(3*c),p=new Float32Array(2*c),v=[],g=0,m=0;m<=u;m++){for(var y=[],_=m/u,b=o+_*s,x=Math.cos(b),w=0;w<=l;w++){var S=w/l,C=i+S*a,P=Math.cos(C)*x,T=Math.sin(b),D=-Math.sin(C)*x;d[3*g]=P*e,d[3*g+1]=T*e,d[3*g+2]=D*e,h[3*g]=P,h[3*g+1]=T,h[3*g+2]=D,p[2*g]=S,p[2*g+1]=_,y.push(g),++g}v.push(y)}var O=new Uint32Array(2*l*(u-1)*3);g=0;for(var E=0;E<u;E++)for(var R=0;R<l;R++){var k=v[E][R],Z=v[E][R+1],A=v[E+1][R+1],M=v[E+1][R];0===E?(O[g++]=k,O[g++]=A,O[g++]=M):E===u-1?(O[g++]=k,O[g++]=Z,O[g++]=A):(O[g++]=k,O[g++]=Z,O[g++]=A,O[g++]=A,O[g++]=M,O[g++]=k)}var z=[["position",O],["normal",O]],H=[["position",{size:3,data:d,exclusive:!0}],["normal",{size:3,data:h,exclusive:!0}]];return r.uv&&(H.push(["uv0",{size:2,data:p,exclusive:!0}]),z.push(["uv0",O])),r.offset&&(z[0][0]="offset",H[0][0]="offset",z.push(["position",new Uint32Array(O.length)]),H.push(["position",{size:3,data:Float64Array.from(r.offset),exclusive:!0}])),new f.Z(H,z)},e.createPolySphereGeometry=function(e,t,n){var r,i,a=e;if(n)r=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var o=a*(1+Math.sqrt(5))/2;r=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var s=0;s<r.length;s+=3)g.scale(r,s,e/g.length(r,s));var l={};function u(t,n){var i;t>n&&(t=(i=[n,t])[0],n=i[1]);var a=t.toString()+"."+n.toString();if(l[a])return l[a];var o=r.length;return r.length+=3,g.add(r,3*t,r,3*n,r,o),g.scale(r,o,e/g.length(r,o)),o/=3,l[a]=o,o}for(var c=0;c<t;c++){for(var d=i.length,h=new Uint32Array(4*d),p=0;p<d;p+=3){var v=i[p],m=i[p+1],y=i[p+2],_=u(v,m),b=u(m,y),x=u(y,v),w=4*p;h[w]=v,h[w+1]=_,h[w+2]=x,h[w+3]=m,h[w+4]=b,h[w+5]=_,h[w+6]=y,h[w+7]=x,h[w+8]=b,h[w+9]=_,h[w+10]=b,h[w+11]=x}i=h,l={}}for(var S=new Float32Array(r),C=0;C<S.length;C+=3)g.normalize(S,C);var P=[["position",i],["normal",i]],T=[["position",{size:3,data:new Float32Array(r),exclusive:!0}],["normal",{size:3,data:S,exclusive:!0}]];return new f.Z(T,P)},e.createPointGeometry=function(e,t,n,r,i,a,o){var s=t?[t[0],t[1],t[2]]:[0,0,0],l=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];var u=n?[255*n[0],255*n[1],255*n[2],n.length>3?255*n[3]:255]:[255,255,255,255],c=null!=r&&2===r.length?r:[1,1],d=[["position",{size:3,data:s,exclusive:!0}],["normal",{size:3,data:l,exclusive:!0}],["uv0",{size:a.length,data:a}],["color",{size:4,data:u,exclusive:!0}],["size",{size:2,data:c}]];if(null!=i){var h=new Float32Array([i[0],i[1],i[2],i[3]]);d.push(["auxpos1",{size:4,data:h}])}if(null!=o){var p=new Float32Array([o[0],o[1],o[2],o[3]]);d.push(["auxpos2",{size:4,data:p}])}return new f.Z(d,null,1)},e.updatePointGeometry=function(e,t,n,r,i,a,o,s){if(null!=e){var l=s.getMutableAttribute("normal").data;l[0]=e[0],l[1]=e[1],l[2]=e[2]}if(null!=t){var u=s.getMutableAttribute("position").data;u[0]=t[0],u[1]=t[1],u[2]=t[2]}if(null!=n){var c=s.getMutableAttribute("color").data;c[0]=n[0],c[1]=n[1],c[2]=n[2],c[3]=n[3]}if(null!=r){var d=s.getMutableAttribute("size").data;d[0]=r[0],d[1]=r[1]}if(null!=i){var h=s.getMutableAttribute("auxpos1").data;h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3]}if(null!=a){var f=s.getMutableAttribute("uv0").data;f[0]=a[0],f[1]=a[1]}if(null!=o){var p=s.getMutableAttribute("auxpos2").data;p[0]=o[0],p[1]=o[1],p[2]=o[2],p[3]=o[3]}},e.createPointArrayGeometry=function(e,t){for(var n=new Float32Array(3*e.length),r=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)n[3*o]=e[o][0],n[3*o+1]=e[o][1],n[3*o+2]=e[o][2],t&&(r[3*o]=t[o][0],r[3*o+1]=t[o][1],r[3*o+2]=t[o][2]),i[o]=o,a[o]=0;return t||(r[0]=0,r[1]=1,r[2]=0),new f.Z([["position",{size:3,data:n,exclusive:!0}],["normal",{size:3,data:r,exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",i],["normal",t?i:a],["uv0",a]],1)},e.createTriangleGeometry=function(){var e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),n=new Uint16Array([0,0,0]);return new f.Z([["position",{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],["normal",{size:3,data:[0,1,0],exclusive:!0}],["uv0",{size:2,data:[0,0],exclusive:!0}]],[["position",e],["normal",t],["uv0",n]])};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function n(e,t,n,r,a){return!(Math.abs((0,i.d)(t,e))>a)&&((0,i.c)(n,e,t),(0,i.n)(n,n),(0,i.c)(r,n,e),(0,i.n)(r,r),!0)}function r(e,t,r,i,a,o,s){return n(e,t,a,o,s)||n(e,r,a,o,s)||n(e,i,a,o,s)}e.createSquareGeometry=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,n=new Array(12),r=0;r<4;r++)for(var i=0;i<3;i++)n[3*r+i]=e[r][i];var a=new Uint32Array([0,1,2,2,3,0]),o=[0,0,1],s=new Uint32Array([0,0,0,0,0,0]);return new f.Z([["position",{size:3,data:n,exclusive:!0}],["normal",{size:3,data:o,exclusive:!0}],["uv0",{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],["color",{size:4,data:[255,255,255,255],exclusive:!0}]],[["position",a],["normal",s],["uv0",a],["color",s]])},e.createConeGeometry=function(e,t,n,r){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=0,l=t,u=e,c=(0,a.f)(0,s,0),d=(0,a.f)(0,s+u,0),h=(0,a.f)(0,-1,0),p=(0,a.f)(0,1,0);r&&(s=u,d=(0,a.f)(0,0,0),c=(0,a.f)(0,s,0),h=(0,a.f)(0,1,0),p=(0,a.f)(0,-1,0));var v=[d,c],g=[h,p],m=n+2,y=Math.sqrt(u*u+l*l);if(r)for(var _=n-1;_>=0;_--){var b=_*(2*Math.PI/n),x=(0,a.f)(Math.cos(b)*l,s,Math.sin(b)*l);v.push(x);var w=(0,a.f)(u*Math.cos(b)/y,-l/y,u*Math.sin(b)/y);g.push(w)}else for(var S=0;S<n;S++){var C=S*(2*Math.PI/n),P=(0,a.f)(Math.cos(C)*l,s,Math.sin(C)*l);v.push(P);var T=(0,a.f)(u*Math.cos(C)/y,l/y,u*Math.sin(C)/y);g.push(T)}var D=new Uint32Array(2*(n+2)*3),O=new Uint32Array(2*(n+2)*3),E=0,R=0;if(i){for(var k=3;k<v.length;k++)D[E++]=1,D[E++]=k-1,D[E++]=k,O[R++]=0,O[R++]=0,O[R++]=0;D[E++]=v.length-1,D[E++]=2,D[E++]=1,O[R++]=0,O[R++]=0,O[R++]=0}if(o){for(var Z=3;Z<v.length;Z++)D[E++]=Z,D[E++]=Z-1,D[E++]=0,O[R++]=Z,O[R++]=Z-1,O[R++]=1;D[E++]=0,D[E++]=2,D[E++]=v.length-1,O[R++]=1,O[R++]=2,O[R++]=g.length-1}for(var A=new Float32Array(3*m),M=0;M<m;M++)A[3*M]=v[M][0],A[3*M+1]=v[M][1],A[3*M+2]=v[M][2];for(var z=new Float32Array(3*m),H=0;H<m;H++)z[3*H]=g[H][0],z[3*H+1]=g[H][1],z[3*H+2]=g[H][2];return new f.Z([["position",{size:3,data:A,exclusive:!0}],["normal",{size:3,data:z,exclusive:!0}]],[["position",D],["normal",O]])},e.createCylinderGeometry=function(e,t,n,r,o,s){var l=r?(0,a.a)(r):(0,a.f)(1,0,0),u=o?(0,a.a)(o):(0,a.f)(0,0,0);s=null==s||s;var c=(0,a.c)();(0,i.n)(c,l);var d=(0,a.c)();(0,i.a)(d,c,Math.abs(e));var h=(0,a.c)();(0,i.a)(h,d,-.5),(0,i.b)(h,h,u);var p=(0,a.f)(0,1,0);Math.abs(1-(0,i.d)(c,p))<.2&&(0,i.s)(p,0,0,1);var v=(0,a.c)();(0,i.c)(v,c,p),(0,i.n)(v,v),(0,i.c)(p,v,c);var g=2*n+(s?2:0),m=n+(s?2:0),y=new Float32Array(3*g),_=new Float32Array(3*m),b=new Float32Array(2*g),x=new Uint32Array(3*n*(s?4:2)),w=new Uint32Array(3*n*(s?4:2));s&&(y[3*(g-2)+0]=h[0],y[3*(g-2)+1]=h[1],y[3*(g-2)+2]=h[2],b[2*(g-2)]=0,b[2*(g-2)+1]=0,y[3*(g-1)+0]=y[3*(g-2)+0]+d[0],y[3*(g-1)+1]=y[3*(g-2)+1]+d[1],y[3*(g-1)+2]=y[3*(g-2)+2]+d[2],b[2*(g-1)]=1,b[2*(g-1)+1]=1,_[3*(m-2)+0]=-c[0],_[3*(m-2)+1]=-c[1],_[3*(m-2)+2]=-c[2],_[3*(m-1)+0]=c[0],_[3*(m-1)+1]=c[1],_[3*(m-1)+2]=c[2]);for(var S=function(e,t,n){x[e]=t,w[e]=n},C=0,P=(0,a.c)(),T=(0,a.c)(),D=0;D<n;D++){var O=D*(2*Math.PI/n);(0,i.a)(P,p,Math.sin(O)),(0,i.a)(T,v,Math.cos(O)),(0,i.b)(P,P,T),_[3*D+0]=P[0],_[3*D+1]=P[1],_[3*D+2]=P[2],(0,i.a)(P,P,t),(0,i.b)(P,P,h),y[3*D+0]=P[0],y[3*D+1]=P[1],y[3*D+2]=P[2],b[2*D+0]=D/n,b[2*D+1]=0,y[3*(D+n)+0]=y[3*D+0]+d[0],y[3*(D+n)+1]=y[3*D+1]+d[1],y[3*(D+n)+2]=y[3*D+2]+d[2],b[2*(D+n)+0]=D/n,b[2*D+1]=1;var E=(D+1)%n;S(C++,D,D),S(C++,D+n,D),S(C++,E,E),S(C++,E,E),S(C++,D+n,D),S(C++,E+n,E)}if(s){for(var R=0;R<n;R++){var k=(R+1)%n;S(C++,g-2,m-2),S(C++,R,m-2),S(C++,k,m-2)}for(var Z=0;Z<n;Z++){var A=(Z+1)%n;S(C++,Z+n,m-1),S(C++,g-1,m-1),S(C++,A+n,m-1)}}return new f.Z([["position",{size:3,data:y,exclusive:!0}],["normal",{size:3,data:_,exclusive:!0}],["uv0",{size:2,data:b,exclusive:!0}]],[["position",x],["normal",w],["uv0",x]])},e.createTubeGeometry=function(t,n,r,i,a){r=r||10,i=null==i||i,(0,v.hu)(t.length>1);for(var o=[],s=[],l=0;l<r;l++){o.push([0,-l-1,-(l+1)%r-1]);var u=l/r*2*Math.PI;s.push([Math.cos(u)*n,Math.sin(u)*n])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,i,a)},e.createPathExtrusionGeometry=function(e,t,n,u,c){var d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,a.f)(0,0,0),h=e.length,p=new Float32Array(t.length*h*3+(6*n.length||0)),v=new Float32Array(t.length*h*3+(n?6:0)),g=(t.length-1)*h*6+3*u.length*2,y=new Uint32Array(g),_=new Uint32Array(g),b=0,x=0,w=0,S=0,C=(0,a.c)(),P=(0,a.c)(),T=(0,a.c)(),D=(0,a.c)(),O=(0,a.c)(),E=(0,a.c)(),R=(0,a.c)(),k=(0,o.c)(),Z=(0,a.c)(),A=(0,a.c)(),M=(0,a.c)(),z=(0,a.c)(),H=(0,a.c)(),L=(0,s.Ue)();(0,i.s)(Z,0,1,0),(0,i.f)(P,t[1],t[0]),(0,i.n)(P,P),c?((0,i.b)(k,t[0],d),(0,i.n)(T,k)):(0,i.s)(T,0,0,1),r(P,T,Z,Z,O,T,m),(0,i.g)(D,T),(0,i.g)(z,O);for(var F=0;F<n.length;F++)(0,i.a)(E,O,n[F][0]),(0,i.a)(k,T,n[F][2]),(0,i.b)(E,E,k),(0,i.b)(E,E,t[0]),p[b++]=E[0],p[b++]=E[1],p[b++]=E[2];v[x++]=-P[0],v[x++]=-P[1],v[x++]=-P[2];for(var j=0;j<u.length;j++)y[w++]=u[j][0]>0?u[j][0]:-u[j][0]-1+n.length,y[w++]=u[j][1]>0?u[j][1]:-u[j][1]-1+n.length,y[w++]=u[j][2]>0?u[j][2]:-u[j][2]-1+n.length,_[S++]=0,_[S++]=0,_[S++]=0;for(var U=n.length,I=n.length-1,V=0;V<t.length;V++){var W=!1;V>0&&((0,i.g)(C,P),V<t.length-1?((0,i.f)(P,t[V+1],t[V]),(0,i.n)(P,P)):W=!0,(0,i.b)(A,C,P),(0,i.n)(A,A),(0,i.b)(M,t[V-1],D),(0,s.Yq)(t[V],A,L),(0,s.BR)(L,(0,l.re)(M,C),k)?((0,i.f)(k,k,t[V]),(0,i.n)(T,k),(0,i.c)(O,A,T),(0,i.n)(O,O)):r(A,D,z,Z,O,T,m),(0,i.g)(D,T),(0,i.g)(z,O)),c&&((0,i.b)(k,t[V],d),(0,i.n)(H,k));for(var N=0;N<h;N++)if((0,i.a)(E,O,e[N][0]),(0,i.a)(k,T,e[N][1]),(0,i.b)(E,E,k),(0,i.n)(R,E),v[x++]=R[0],v[x++]=R[1],v[x++]=R[2],(0,i.b)(E,E,t[V]),p[b++]=E[0],p[b++]=E[1],p[b++]=E[2],!W){var G=(N+1)%h;y[w++]=U+N,y[w++]=U+h+N,y[w++]=U+G,y[w++]=U+G,y[w++]=U+h+N,y[w++]=U+h+G;for(var B=0;B<6;B++)_[S++]=y[w-6+B]-I}U+=h}for(var q=t[t.length-1],J=0;J<n.length;J++)(0,i.a)(E,O,n[J][0]),(0,i.a)(k,T,n[J][1]),(0,i.b)(E,E,k),(0,i.b)(E,E,q),p[b++]=E[0],p[b++]=E[1],p[b++]=E[2];var $=x/3;v[x++]=P[0],v[x++]=P[1],v[x++]=P[2];for(var Y=U-h,X=0;X<u.length;X++)y[w++]=u[X][0]>=0?U+u[X][0]:-u[X][0]-1+Y,y[w++]=u[X][2]>=0?U+u[X][2]:-u[X][2]-1+Y,y[w++]=u[X][1]>=0?U+u[X][1]:-u[X][1]-1+Y,_[S++]=$,_[S++]=$,_[S++]=$;return new f.Z([["position",{size:3,data:p,exclusive:!0}],["normal",{size:3,data:v,exclusive:!0}]],[["position",y],["normal",_]])},e.createPolylineGeometry=function(e,t,n){(0,v.hu)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,v.hu)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),(0,v.hu)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),(0,v.hu)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var r=new Float64Array(3*e.length),i=new Uint32Array(2*(e.length-1)),a=0,o=0,s=0;s<e.length;s++){for(var l=0;l<3;l++)r[a++]=e[s][l];s>0&&(i[o++]=s-1,i[o++]=s)}var u=[],c=[];if(u.push(["position",i]),c.push(["position",{size:3,data:r,exclusive:!0}]),t){for(var d=new Float32Array(3*t.length),h=0,g=0;g<e.length;g++)for(var m=0;m<3;m++)d[h++]=t[g][m];u.push(["normal",i]),c.push(["normal",{size:3,data:d,exclusive:!0}])}return n&&(c.push(["color",{size:4,data:n}]),u.push(["color",(0,p.p)(n.length/4)])),new f.Z(c,u,2)},e.createExtrudedTriangle=function(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=new Array(18),o=[[-t,i,r/2],[n,i,r/2],[0,e+i,r/2],[-t,i,-r/2],[n,i,-r/2],[0,e+i,-r/2]],s=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),l=0;l<6;l++)a[3*l]=o[l][0],a[3*l+1]=o[l][1],a[3*l+2]=o[l][2];return new f.Z([["position",{size:3,data:a,exclusive:!0}]],[["position",s]])},e.transformInPlace=function(e,t){for(var n=e.getMutableAttribute("position").data,r=0;r<n.length;r+=3){var a=n[r],o=n[r+1],s=n[r+2];(0,i.s)(y,a,o,s),(0,i.m)(y,y,t),n[r]=y[0],n[r+1]=y[1],n[r+2]=y[2]}},e.cgToGIS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=e.vertexAttributes,r=n.get("position").data,i=n.get("normal").data;if(i)for(var a=t.getMutableAttribute("normal").data,o=0;o<i.length;o+=3){var s=i[o+1];a[o+1]=-i[o+2],a[o+2]=s}if(r)for(var l=t.getMutableAttribute("position").data,u=0;u<r.length;u+=3){var c=r[u+1];l[u+1]=-r[u+2],l[u+2]=c}return t},e.makeOrthoBasisDirUp=n,e.makeOrthoBasisDirUpFallback=r}(h||(h={}));var m=.99619469809,y=(0,a.c)(),_=h},19962:function(e,t,n){n.d(t,{C1:function(){return m}});var r=n(93433),i=n(15671),a=n(43144),o=n(92026),s=n(95439),l=n(81949),u=n(11186),c=n(71353),d=n(60176),h=n(74894),f=n(71624),p=n(59887),v=n(97882),g=n(58901),m=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:125e4;(0,i.Z)(this,e),this._originSR=t,this._gridSize=n,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+(0,s.D)()}return(0,a.Z)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this._rootOriginId);if(null==t){if((0,o.pC)(y))return this._origins.set(this._rootOriginId,(0,f.al)(y[0],y[1],y[2],this._rootOriginId)),this.getOrigin(e);var n=(0,f.al)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,n),n}var i=this._gridSize,a=Math.round(e[0]/i),s=Math.round(e[1]/i),l=Math.round(e[2]/i),c="".concat(a,"/").concat(s,"/").concat(l),d=this._origins.get(c),h=.5*i;if((0,u.f)(_,e,t.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),_[0]<h&&_[1]<h&&_[2]<h){if(d){var p=Math.max.apply(Math,(0,r.Z)(_));if((0,u.f)(_,e,d.vec3),_[0]=Math.abs(_[0]),_[1]=Math.abs(_[1]),_[2]=Math.abs(_[2]),Math.max.apply(Math,(0,r.Z)(_))<p)return d}return t}return d||(d=(0,f.al)(a*i,s*i,l*i,c),this._origins.set(c,d)),d}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,0,1],n=window.view,r=n._stage,i=t.toString();if(!this._objects.has(i)){this._material=new g.U({width:2,color:t}),r.add(this._material);var a=new v.F({isPickable:!1}),o=new p.T({castShadow:!1});r.add(o),a.add(o),r.add(a),this._objects.set(i,o)}for(var s=this._objects.get(i),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],c=u.length,f=new Array(3*c),m=new Uint16Array(2*(c-1)),y=.5*this._gridSize,_=0;_<c;_++)f[3*_+0]=e[0]+(1&u[_]?y:-y),f[3*_+1]=e[1]+(2&u[_]?y:-y),f[3*_+2]=e[2]+(4&u[_]?y:-y),_>0&&(m[2*_+0]=_-1,m[2*_+1]=_);(0,d.CM)(f,this._originSR,0,f,n.renderSpatialReference,0,c);var b=new h.Z([["position",{size:3,data:f,exclusive:!0}]],[["position",m]],2);r.add(b),s.addGeometry(b,this._material,l.I)}}]),e}(),y=null;var _=(0,c.c)()},13679:function(e,t,n){n.d(t,{Z8:function(){return b},LP:function(){return S}});var r=n(37762),i=n(15671),a=n(43144),o=n(92026),s=n(14226),l=n(81949),u=n(11186),c=n(71353),d=n(90045),h=n(67077),f=n(40885),p=(0,a.Z)((function e(){(0,i.Z)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=2}));n(82218);function v(e){return(0,o.pC)(e)&&(0,o.pC)(e.dist)}(0,c.c)();var g=n(76783),m=n(32683),y=1e-5,_=function(){function e(t){(0,i.Z)(this,e),this.options=new p,this._results=new x,this.transform=new g.yn,this.tolerance=y,this.verticalOffset=null,this._ray=(0,f.Ue)(),this._rayEnd=(0,c.c)(),this._rayBeginTransformed=(0,c.c)(),this._rayEndTransformed=(0,c.c)(),this.viewingMode=null==t?1:t}return(0,a.Z)(e,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}},{key:"reset",value:function(e,t,n){this.resetWithRay((0,f.zk)(e,t,this._ray),n)}},{key:"resetWithRay",value:function(e,t){this.camera=t,e!==this._ray&&(0,f.JG)(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,u.b)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;this.point=n,this.filterPredicate=a,this.tolerance=null==i?y:i;var l=(0,g.W9)(this.verticalOffset);(0,o.pC)(t)&&t.length>0&&function(){var n,i=s?function(t){s(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},a=(0,r.Z)(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,c=u.getSpatialQueryAccelerator&&u.getSpatialQueryAccelerator();(0,o.pC)(c)?((0,o.pC)(l)?c.forEachAlongRayWithVerticalOffset(e._ray.origin,e._ray.direction,i,l):c.forEachAlongRay(e._ray.origin,e._ray.direction,i),e.options.selectionMode&&e.options.hud&&c.forEachDegenerateObject(i)):u.objects.forAll((function(e){return i(e)}))}}catch(d){a.e(d)}finally{a.f()}}(),this.sortResults()}},{key:"intersectObject",value:function(e){var t=this,n=e.geometryRecords;if(n){var i,a=e.transformation,s=(0,g.W9)(this.verticalOffset),c=(0,r.Z)(n);try{var d=function(){var n=i.value,r=n.geometry,c=n.material,d=n.instanceParameters;if((0,m.PD)(d))return"continue";var h=r.id;t.transform.setAndInvalidateLazyTransforms(a,n.getShaderTransformation()),(0,u.m)(t._rayBeginTransformed,t.rayBegin,t.transform.inverse),(0,u.m)(t._rayEndTransformed,t.rayEnd,t.transform.inverse);var f=t.transform.transform;(0,o.pC)(s)&&(s.objectTransform=t.transform),c.intersect(r,d,t.transform.transform,t,t._rayBeginTransformed,t._rayEndTransformed,(function(n,r,i,a,s,u){if(n>=0){if((0,o.pC)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEnd,n))return;if(a){if(null==t._results.hud.dist||n<t._results.hud.dist){var c={object:e,geometryId:h,triangleNr:i,center:u};t._results.hud.set(1,c,n,r,l.I,s)}return}var d=function(t){return t.set(0,{object:e,geometryId:h,triangleNr:i},n,r,f,s)};if((null==t._results.min.drapedLayerOrder||s>=t._results.min.drapedLayerOrder)&&(null==t._results.min.dist||n<t._results.min.dist)&&d(t._results.min),0!==t.options.store&&(null==t._results.max.drapedLayerOrder||s<t._results.max.drapedLayerOrder)&&(null==t._results.max.dist||n>t._results.max.dist)&&d(t._results.max),2===t.options.store){var p=S(t._ray);p.set(0,{object:e,geometryId:h,triangleNr:i},n,r,f),t._results.all.push(p)}}}),n.shaderTransformation)};for(c.s();!(i=c.n()).done;)d()}catch(h){c.e(h)}finally{c.f()}}}},{key:"sortResults",value:function(){this._results.all.sort((function(e,t){return e.dist!==t.dist?(0,o.Pt)(e.dist,0)-(0,o.Pt)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?(0,o.Pt)(e.drapedLayerOrder,Number.MAX_VALUE)-(0,o.Pt)(t.drapedLayerOrder,Number.MAX_VALUE):(0,o.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,o.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)}))}}]),e}();function b(e){return new _(e)}var x=function(){function e(){(0,i.Z)(this,e),this._min=new w((0,f.Ue)()),this._max=new w((0,f.Ue)()),this._hud=new w((0,f.Ue)()),this._ground=new w((0,f.Ue)())}return(0,a.Z)(e,[{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}},{key:"hud",get:function(){return this._hud}},{key:"ground",get:function(){return this._ground}},{key:"init",value:function(e){this._min.init(e),this._max.init(e),this._hud.init(e),this._ground.init(e),this.all=[]}}]),e}(),w=function(){function e(t){(0,i.Z)(this,e),this.intersector=0,this.normal=(0,c.c)(),this.transformation=(0,l.c)(),this._ray=(0,f.Ue)(),this.init(t)}return(0,a.Z)(e,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return(0,o.pC)(this.dist)?((0,u.a)(C,this.ray.direction,this.dist),(0,u.l)(C)):null}},{key:"getIntersectionPoint",value:function(e){return!!v(this)&&((0,u.a)(C,this.ray.direction,this.dist),(0,u.b)(e,this.ray.origin,C),!0)}},{key:"getTransformedNormal",value:function(e){return(0,u.g)(P,this.normal),P[3]=0,(0,d.t)(P,P,this.transformation),(0,u.g)(e,P),(0,u.n)(e,e)}},{key:"init",value:function(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=0,(0,f.JG)(e,this._ray)}},{key:"set",value:function(e,t,n,r,i,a,d){this.intersector=e,this.dist=n,(0,u.g)(this.normal,(0,o.Pt)(r,c.U)),(0,s.c)(this.transformation,(0,o.Pt)(i,l.I)),this.target=t,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=d}},{key:"copy",value:function(e){(0,f.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,u.g)(this.normal,e.normal),(0,s.c)(this.transformation,e.transformation)}}]),e}();function S(e){return new w(e)}var C=(0,c.c)(),P=(0,h.c)()},59887:function(e,t,n){n.d(t,{T:function(){return w}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(92026),u=n(14226),c=n(81949),d=n(11186),h=n(71353),f=n(23470),p=n(80064),v=n(1395),g=n(13005),m=n(95439),y=function(){function e(){(0,i.Z)(this,e),this._disposed=!1}return(0,a.Z)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}},{key:"acquire",value:function(e,t,n,r,i,a){this.id=(0,m.D)(),this.geometry=e,this.material=t,this.transformation=n,this.instanceParameters=r,this.origin=i,this._shaderTransformation=a,this._disposed=!1}},{key:"release",value:function(){this._disposed=!1}},{key:"dispose",value:function(){this._disposed=!0}},{key:"getStaticTransformation",value:function(){return this.transformation}},{key:"getShaderTransformation",value:function(){return(0,l.pC)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}},{key:"computeAttachmentOrigin",value:function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&((0,d.m)(e,e,this.getStaticTransformation()),!0)}}]),e}();y.pool=new g.Z(y);var _=n(47669),b=n(97731),x=n(32683),w=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,n),(e=t.call(this)).type=1,e._geometryRecords=new Array,e._geometries=new Array,e._objectTransformation=(0,c.c)(),e._bvObjectSpace=new C,e._bvWorldSpace=new C,e._bvDirty=!0,e._hasVolatileTransformation=!1,e._visible=!0,e.castShadow=null==r.castShadow||r.castShadow,e.metadata=r.metadata,e.metadata&&e.metadata.isElevationSource&&(e.metadata.lastValidElevationBB=new S),e.transformation=(0,c.c)();var a=r.geometries,o=r.materials,s=r.transformations,l=r.origins;if(Array.isArray(a)){(0,b.hu)(o.length===a.length,"Object3D: materials don't match geometries"),(0,b.hu)(s.length===a.length,"Object3D: transformations don't match geometries"),e._geometryRecords.length=a.length,e._geometries.length=a.length;for(var u=0;u<a.length;u++)e._geometries[u]=a[u],e._geometryRecords[u]=y.pool.acquire(a[u],o[u],(0,c.b)(s[u]),{highlights:null,occludees:null,visible:e._visible},l&&l[u])}return e}return(0,a.Z)(n,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(e){(0,u.c)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}},{key:"dispose",value:function(){this._geometryRecords.length=0,this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){(0,b.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"addGeometry",value:function(e,t,n,r,i){n=n||c.I,this._geometries.push(e);var a=y.pool.acquire(e,t,n,{highlights:null,occludees:null,visible:this._visible},r,i);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||(0,l.pC)(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}},{key:"removeGeometry",value:function(e){var t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=(0,l.pC)(t.shaderTransformation)?this._geometryRecords.some((function(e){return(0,l.pC)(e.shaderTransformation)})):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}},{key:"removeAllGeometries",value:function(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}},{key:"geometryVertexAttrsUpdated",value:function(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}},{key:"isVisible",get:function(){return this._visible}},{key:"setVisible",value:function(e){if(this._visible!==e){this._visible=e;var t,n=(0,r.Z)(this._geometryRecords);try{for(n.s();!(t=n.n()).done;){t.value.instanceParameters.visible=this._visible}}catch(i){n.e(i)}finally{n.f()}this._emit("visibilityChanged",this)}}},{key:"maskOccludee",value:function(){var e,t=new _.O(1),n=(0,r.Z)(this._geometryRecords);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.instanceParameters.occludees=(0,x.lr)(i.instanceParameters.occludees,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,n=(0,r.Z)(this._geometryRecords);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.instanceParameters.occludees=(0,x.U_)(i.instanceParameters.occludees,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new _.O(0),n=(0,r.Z)(this._geometryRecords);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.instanceParameters.highlights=(0,x.lr)(i.instanceParameters.highlights,t)}}catch(a){n.e(a)}finally{n.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,n=(0,r.Z)(this._geometryRecords);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.instanceParameters.highlights=(0,x.U_)(i.instanceParameters.highlights,e)}}catch(a){n.e(a)}finally{n.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return(0,u.m)((0,l.Pt)(t,(0,c.c)()),this.transformation,e.getStaticTransformation())}},{key:"getCombinedShaderTransformation",value:function(e,t){return t=t||(0,c.c)(),(0,u.m)(t,this.transformation,e.getShaderTransformation()),t}},{key:"hasVolativeTransformation",value:function(){return this._hasVolatileTransformation}},{key:"boundingVolumeWorldSpace",get:function(){return this._validateBoundingVolume(),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._validateBoundingVolume(),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],n=this._geometryRecords[e],r=t.boundingInfo;(0,l.pC)(r)&&(this._calculateTransformedBoundingVolume(r,this._bvObjectSpace,n.getShaderTransformation()),this._calculateTransformedBoundingVolume(r,this._bvWorldSpace,this.getCombinedShaderTransformation(n)))}(0,d.e)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,d.e)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);for(var i=(0,h.c)(),a=(0,h.c)(),o=(0,p.u1)(this.transformation),s=0;s<this._geometryRecords.length;++s){var u=this._geometries[s].boundingInfo;if(!(0,l.Wi)(u)){var c=this._geometryRecords[s].getShaderTransformation(),f=(0,p.u1)(c);(0,d.m)(i,u.getCenter(),c);var v=(0,d.i)(i,this._bvObjectSpace.bounds),g=u.getBSRadius()*f;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],v+g),(0,d.m)(a,i,this.transformation);var m=(0,d.i)(a,this._bvWorldSpace.bounds),y=g*o;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],m+y)}}this._bvDirty=!1}}},{key:"_calculateTransformedBoundingVolume",value:function(e,t,n){var r=e.getBBMin(),i=e.getBBMax(),a=(0,h.a)(r),o=(0,h.a)(i);(0,d.m)(a,a,n),(0,d.m)(o,o,n);for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],o[s]),t.max[s]=Math.max(t.max[s],a[s],o[s]);for(var l=0;l<3;++l){(0,d.g)(a,r),(0,d.g)(o,i),a[l]=i[l],o[l]=r[l],(0,d.m)(a,a,n),(0,d.m)(o,o,n);for(var u=0;u<3;++u)t.min[u]=Math.min(t.min[u],a[u],o[u]),t.max[u]=Math.max(t.max[u],a[u],o[u])}}},{key:"_invalidateBoundingVolume",value:function(){this._bvDirty=!0,(0,l.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}},{key:"_emit",value:function(e,t){(0,l.pC)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}}}]),n}(v.c),S=function(){function e(){(0,i.Z)(this,e),this.min=(0,h.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,h.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return(0,a.Z)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),C=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).bounds=(0,f.c)(),e}return(0,a.Z)(n,[{key:"init",value:function(){(0,d.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,d.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,f.a)(this.bounds)}}]),n}(S)},47669:function(e,t,n){n.d(t,{O:function(){return o}});var r=n(43144),i=n(15671),a=n(95439),o=(0,r.Z)((function e(t){(0,i.Z)(this,e),this.channel=t,this.id=(0,a.D)()}))},78329:function(e,t,n){n.d(t,{Z:function(){return v}});var r=n(37762),i=n(15671),a=n(43144),o=n(92026),s=n(13005),l=n(27546),u=n(11186),c=n(71353),d=n(95773),h=n(40885),f=n(23470),p=n(97731),v=function(){function e(t,n){(0,i.Z)(this,e),this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new g,this._objectCount=0,n&&(void 0!==n.maximumObjectsPerNode&&(this._maximumObjectsPerNode=n.maximumObjectsPerNode),void 0!==n.maximumDepth&&(this._maximumDepth=n.maximumDepth))}return(0,a.Z)(e,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}},{key:"destroy",value:function(){this._degenerateObjects.clear(),g.clearPool(),O[0]=null,A.prune(),j.prune()}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;this._objectCount+=t,this._grow(e,t);for(var n=g.acquire(),r=0;r<t;r++){var i=e[r];this._isDegenerate(i)?this._degenerateObjects.add(i):(n.init(this._root),this._add(i,n))}g.release(n)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._objectCount-=e.length;var n,i=g.acquire(),a=(0,r.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,l=(0,o.pC)(t)?t:(0,f.b)(this._objectToBoundingSphere(s),M);C(l[3])?(i.init(this._root),this._remove(s,l,i)):this._degenerateObjects.delete(s)}}catch(u){a.e(u)}finally{a.f()}g.release(i),this._shrink()}},{key:"update",value:function(e,t){if(C(t[3])||!this._isDegenerate(e)){var n=function(e){return O[0]=e,O}(e);this.remove(n,t),this.add(n)}}},{key:"forEachAlongRay",value:function(e,t,n){var r=this,i=(0,h.re)(e,t);this._forEachNode(this._root,(function(e){if(!r._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forAll((function(e){r._intersectsObject(i,e)&&n(e)})),null!==t.residents&&t.residents.forAll((function(e){r._intersectsObject(i,e)&&n(e)})),!0}))}},{key:"forEachAlongRayWithVerticalOffset",value:function(e,t,n,r){var i=this,a=(0,h.re)(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(a,e,r))return!1;var t=e.node;return t.terminals.forAll((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),null!==t.residents&&t.residents.forAll((function(e){i._intersectsObjectWithOffset(a,e,r)&&n(e)})),!0}))}},{key:"forEach",value:function(e){this._forEachNode(this._root,(function(t){var n=t.node;return n.terminals.forAll(e),null!==n.residents&&n.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}},{key:"forEachDegenerateObject",value:function(e){this._degenerateObjects.forEach(e)}},{key:"findClosest",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=1/0,s=1/0,l=null,c=w(e,t),h=function(u){if(--a,i(u)){var c=r._objectToBoundingSphere(u);if((0,d.hr)(n,c)){var h=S(e,t,(0,f.g)(c)),p=h-c[3],v=h+c[3];p<o&&(o=p,s=v,l=u)}}};return this._forEachNodeDepthOrdered(this._root,(function(r){if(a<=0||!(0,d.hr)(n,r.bounds))return!1;if((0,u.a)(R,c,r.halfSize),(0,u.b)(R,R,r.bounds),S(e,t,R)>s)return!1;var i=r.node;return i.terminals.forAll((function(e){return h(e)})),null!==i.residents&&i.residents.forAll((function(e){return h(e)})),!0}),e,t),l}},{key:"forEachInDepthRange",value:function(e,t,n,r,i,a,o){var s=this,l=-1/0,c=1/0,h={setRange:function(e){1===n?(l=Math.max(l,e.near),c=Math.min(c,e.far)):(l=Math.max(l,-e.far),c=Math.min(c,-e.near))}};h.setRange(r);var p=S(t,n,e),v=w(t,n),g=w(t,-n),m=function(e){if(o(e)){var r=s._objectToBoundingSphere(e),u=(0,f.g)(r),v=S(t,n,u)-p,g=v-r[3],m=v+r[3];g>c||m<l||!(0,d.hr)(a,r)||i(e,h)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(!(0,d.hr)(a,e.bounds))return!1;if((0,u.a)(R,v,e.halfSize),(0,u.b)(R,R,e.bounds),S(t,n,R)-p>c)return!1;if((0,u.a)(R,g,e.halfSize),(0,u.b)(R,R,e.bounds),S(t,n,R)-p<l)return!1;var r=e.node;return r.terminals.forAll((function(e){return m(e)})),null!==r.residents&&r.residents.forAll((function(e){return m(e)})),!0}),t,n)}},{key:"forEachNode",value:function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.bounds,t.halfSize)}))}},{key:"_intersectsNode",value:function(e,t){return _(t.bounds,2*-t.halfSize,k),_(t.bounds,2*t.halfSize,Z),(0,p.yK)(e.origin,e.direction,k,Z)}},{key:"_intersectsNodeWithOffset",value:function(e,t,n){return _(t.bounds,2*-t.halfSize,k),_(t.bounds,2*t.halfSize,Z),n.applyToMinMax(k,Z),(0,p.yK)(e.origin,e.direction,k,Z)}},{key:"_intersectsObject",value:function(e,t){var n=this._objectToBoundingSphere(t);return!(n[3]>0)||(0,f.i)(n,e)}},{key:"_intersectsObjectWithOffset",value:function(e,t,n){var r=this._objectToBoundingSphere(t);return!(r[3]>0)||(0,f.i)(n.applyToBoundingSphere(r),e)}},{key:"_forEachNode",value:function(e,t){for(var n=g.acquire().init(e),r=[n];0!==r.length;){if(t(n=r.pop())&&!n.isLeaf())for(var i=0;i<n.node.children.length;i++)n.node.children[i]&&r.push(g.acquire().init(n).advance(i));g.release(n)}}},{key:"_forEachNodeDepthOrdered",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=g.acquire().init(e),a=[i];for(x(n,r,U);0!==a.length;){if(t(i=a.pop())&&!i.isLeaf())for(var o=7;o>=0;--o){var s=U[o];i.node.children[s]&&a.push(g.acquire().init(i).advance(s))}g.release(i)}}},{key:"_remove",value:function(e,t,n){A.clear();var r=n.advanceTo(t,(function(e,t){A.push(e.node),A.push(t)}))?n.node.terminals:n.node.residents;if(r.removeUnordered(e),0===r.length)for(var i=A.length-2;i>=0;i-=2){var a=A.data[i],o=A.data[i+1];if(!this._purge(a,o))break}}},{key:"_nodeIsEmpty",value:function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}},{key:"_purge",value:function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new l.Z({shrink:!0})),!0)}},{key:"_add",value:function(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}},{key:"_split",value:function(e){var t=e.node.residents;e.node.residents=null;for(var n=0;n<t.length;n++){var r=g.acquire().init(e);this._add(t.getItemAt(n),r),g.release(r)}}},{key:"_grow",value:function(e,t){var n=this;if(0!==t&&(b(e,t,(function(e){return n._objectToBoundingSphere(e)}),z),C(z[3])&&!this._fitsInsideTree(z)))if(this._nodeIsEmpty(this._root.node))(0,f.b)(z,this._root.bounds),this._root.halfSize=1.25*z[3];else{var r=this._rootBoundsForRootAsSubNode(z);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(z,r):this._growRootAsSubNode(r),g.release(r)}}},{key:"_rebuildTree",value:function(e,t){var n=this;(0,u.g)(H,t.bounds),H[3]=t.halfSize,b([e,H],2,(function(e){return e}),L);var r=g.acquire().init(this._root);this._root.initFrom(null,L,1.25*L[3]),this._forEachNode(r,(function(e){return n.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&n.add(e.node.residents.data,e.node.residents.length),!0})),g.release(r)}},{key:"_placingRootViolatesMaxDepth",value:function(e){var t=this,n=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E,r=0;return this._forEachNode(this._root,(function(e){return(r=Math.max(r,e.depth))+n<=t._maximumDepth})),r+n>this._maximumDepth}},{key:"_rootBoundsForRootAsSubNode",value:function(e){for(var t=e[3],n=e,r=-1/0,i=this._root.bounds,a=this._root.halfSize,o=0;o<3;o++){var s=i[o]-a-(n[o]-t),l=n[o]+t-(i[o]+a),u=Math.max(0,Math.ceil(s/(2*a))),c=Math.max(0,Math.ceil(l/(2*a)))+1,d=Math.pow(2,Math.ceil(Math.log(u+c)*Math.LOG2E));r=Math.max(r,d),F[o].min=u,F[o].max=c}for(var h=0;h<3;h++){var f=F[h].min,p=F[h].max,v=(r-(f+p))/2;f+=Math.ceil(v),p+=Math.floor(v);var m=i[h]-a-f*a*2;E[h]=m+(p+f)*a}return E[3]=r*a*D,g.acquire().initFrom(null,E,r*a,0)}},{key:"_growRootAsSubNode",value:function(e){var t=this._root.node;(0,u.g)(z,this._root.bounds),z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}},{key:"_shrink",value:function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}},{key:"_findShrinkIndex",value:function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,n=0,r=0;r<t.length&&null==e;)e=t[n=r++];for(;r<t.length;)if(t[r++])return-1;return n}},{key:"_isDegenerate",value:function(e){return!C(this._objectToBoundingSphere(e)[3])}},{key:"_fitsInsideTree",value:function(e){var t=this._root.bounds,n=this._root.halfSize;return e[3]<=n&&e[0]>=t[0]-n&&e[0]<=t[0]+n&&e[1]>=t[1]-n&&e[1]<=t[1]+n&&e[2]>=t[2]-n&&e[2]<=t[2]+n}}]),e}(),g=function(){function e(){(0,i.Z)(this,e),this.bounds=(0,f.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}return(0,a.Z)(e,[{key:"init",value:function(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}},{key:"initFrom",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.depth;return this.node=(0,o.pC)(t)?t:e.createEmptyNode(),(0,o.pC)(n)&&(0,f.b)(n,this.bounds),this.halfSize=r,this.depth=i,this}},{key:"advance",value:function(t){var n=this.node.children[t];n||(n=e.createEmptyNode(),this.node.children[t]=n),this.node=n,this.halfSize/=2,this.depth++;var r=P[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*D,this}},{key:"advanceTo",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!n)return t&&t(this,-1),!1;this.node.residents=null}var r=this._childIndex(e);t&&t(this,r),this.advance(r)}}},{key:"isLeaf",value:function(){return null!=this.node.residents}},{key:"isTerminalFor",value:function(e){return e[3]>this.halfSize/2}},{key:"_childIndex",value:function(e){var t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}}],[{key:"createEmptyNode",value:function(){return{children:[null,null,null,null,null,null,null,null],terminals:new l.Z({shrink:!0}),residents:new l.Z({shrink:!0})}}},{key:"acquire",value:function(){return e._pool.acquire()}},{key:"release",value:function(t){e._pool.release(t)}},{key:"clearPool",value:function(){e._pool.prune()}}]),e}();function m(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function y(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function _(e,t,n){n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t}function b(e,t,n,r){if(1===t){var i=n(e[0]);(0,f.b)(i,r)}else{k[0]=1/0,k[1]=1/0,k[2]=1/0,Z[0]=-1/0,Z[1]=-1/0,Z[2]=-1/0;for(var a=0;a<t;a++){var o=n(e[a]);C(o[3])&&(m(k,o),y(Z,o))}(0,u.e)(r,k,Z,.5),r[3]=Math.max(Z[0]-k[0],Z[1]-k[1],Z[2]-k[2])/2}}function x(e,t,n){if(!j.length)for(var r=0;r<8;++r)j.push({index:0,distance:0});for(var i=0;i<8;++i){var a=P[i];j.data[i].index=i,j.data[i].distance=S(e,t,a)}j.sort((function(e,t){return e.distance-t.distance}));for(var o=0;o<8;++o)n[o]=j.data[o].index}function w(e,t){for(var n=1/0,r=null,i=0;i<8;++i){var a=S(e,t,T[i]);a<n&&(n=a,r=T[i])}return r}function S(e,t,n){return t*(e[0]*n[0]+e[1]*n[1]+e[2]*n[2])}function C(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}g._pool=new s.Z(g);var P=[(0,c.f)(-1,-1,-1),(0,c.f)(1,-1,-1),(0,c.f)(-1,1,-1),(0,c.f)(1,1,-1),(0,c.f)(-1,-1,1),(0,c.f)(1,-1,1),(0,c.f)(-1,1,1),(0,c.f)(1,1,1)],T=[(0,c.f)(-1,-1,-1),(0,c.f)(-1,-1,1),(0,c.f)(-1,1,-1),(0,c.f)(-1,1,1),(0,c.f)(1,-1,-1),(0,c.f)(1,-1,1),(0,c.f)(1,1,-1),(0,c.f)(1,1,1)],D=Math.sqrt(3),O=[null];var E=(0,f.c)(),R=(0,c.c)(),k=(0,c.c)(),Z=(0,c.c)(),A=new l.Z,M=(0,f.c)(),z=(0,f.c)(),H=(0,f.c)(),L=(0,f.c)(),F=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],j=new l.Z,U=[0,0,0,0,0,0,0,0]},39077:function(e,t,n){n.d(t,{z:function(){return v}});var r=n(15671),i=n(43144),a=n(92026),o=n(95439),s=n(14226),l=n(81949),u=n(11186),c=n(67077),d=n(80064),h=n(81935),f=n(47669),p=n(32683),v=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,o.D)(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]&&arguments[7];(0,r.Z)(this,e),this.data=t,this.material=n,this.layerUid=i,this.graphicUid=a,this.id=s,this.boundingInfo=u,this.calculateShaderTransformation=d,this.castShadow=h,this.boundingSphere=(0,c.c)(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=(0,l.c)(),this._shaderTransformationDirty=!0}return(0,i.Z)(e,[{key:"transformation",get:function(){return this._transformation}},{key:"updateTransformation",value:function(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this._shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.u1)(e);(0,a.Wi)(this.boundingInfo)||((0,u.m)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*n)}},{key:"hasShaderTransformation",get:function(){return(0,a.pC)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return(0,a.Wi)(this.calculateShaderTransformation)?(0,a.Pt)(this.transformation,l.I):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,l.c)()),(0,s.c)(this._shaderTransformation,this.calculateShaderTransformation((0,a.Pt)(this.transformation,l.I))),this._shaderTransformationDirty=!1),this._shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&((0,a.pC)(this._transformation)&&(0,u.m)(e,e,this._transformation),!0);var t=this.indices.get("position"),n=this.vertexAttributes.get("position");return!!(0,h.cM)(n,t,e)&&((0,a.pC)(this._transformation)&&(0,u.m)(e,e,this._transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new f.O(0),t=this.instanceParameters;return t.highlights=(0,p.lr)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=(0,p.U_)(t.highlights,e)}}]),e}()},97882:function(e,t,n){n.d(t,{F:function(){return v}});var r=n(37762),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(91505),u=n(100),c=n(92026),d=n(27546),h=n(1395),f=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"],p=n(78329),v=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r,a,o,s,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,i.Z)(this,n),(r=t.call(this)).apiLayerUid=c,r.type=0,r.events=new l.Z,r.isSliceable=!1,r._objects=new d.Z,r._stageHandles=new u.Z,r.apiLayerUid=c,r.isVisible=null==(a=null==e?void 0:e.isVisible)||a,r.isPickable=null==(o=null==e?void 0:e.isPickable)||o,r.updatePolicy=null!=(s=null==e?void 0:e.updatePolicy)?s:0,r}return(0,a.Z)(n,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this.detachStage(),this._stage=null}},{key:"attachStage",value:function(e){var t=this;this.detachStage(),this._stage=e;var n,i=(0,r.Z)(f);try{var a=function(){var r=n.value;t._stageHandles.add(t.events.on(r,(function(t){return e.handleEvent(r,t)})))};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"detachStage",value:function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,c.pC)(this._octree)&&this._octree.add([e])}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,c.pC)(this._octree)&&this._octree.remove([e]))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){t.value.parentLayer=this}}catch(i){n.e(i)}finally{n.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,c.pC)(this._octree)&&this._octree.add(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){n.value.parentLayer=null}}catch(a){i.e(a)}finally{i.f()}this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,c.pC)(this._octree)&&this._octree.remove(t)}}},{key:"sync",value:function(){(0,c.pC)(this._stage)&&1!==this.updatePolicy&&this._stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){(0,c.pC)(this._octree)&&this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return(0,c.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}},{key:"shaderTransformationChanged",value:function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=(0,c.SC)(this._octree)}},{key:"_createOctree",value:function(){this._octree=new p.Z((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)}}]),n}(h.c)},71624:function(e,t,n){n.d(t,{al:function(){return s}});var r=n(43144),i=n(15671),a=n(71353),o=(0,r.Z)((function e(t,n){(0,i.Z)(this,e),this.vec3=t,this.id=n}));function s(e,t,n,r){return new o((0,a.f)(e,t,n),r)}},74818:function(e,t,n){n.d(t,{E:function(){return Z}});var r=n(1413),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(23620),u=n(94425),c=n(56529),d=n(78041),h=n(64226),f=n(22909),p=n(11752),v=n(61120),g=n(27366),m=n(33280),y=n(137),_=n(15226),b=n(41012),x=n(82144),w=n(31132),S=n(33559),C=n(7566),P=n(27627),T=n(50411),D=n(45028),O=n(36207),E=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({output:r.output,OITEnabled:0===r.transparencyPassType,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new P.$(e.rctx,i,C.i)}},{key:"bindPass",value:function(e,t){(0,b.II)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),4===this.configuration.output&&(0,y.wW)(this.program,t),(1===this.configuration.output||t.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,_.p)(this.program,t))}},{key:"bindDraw",value:function(e){(0,b.id)(this.program,e),this.program.rebindTextures(),(0,m.DA)(this.program,this.configuration,e)}},{key:"createPipeline",value:function(e,t){var n=this.configuration,r=3===e,i=2===e;return(0,O.sm)({blending:0!==n.output&&7!==n.output||!n.transparent?null:r?d.wu:(0,d.$L)(e),culling:(0,O.zp)(n.cullFace),depthTest:{func:(0,d.$x)(e)},depthWrite:r||i?n.writeDepth&&O.LZ:null,colorWrite:O.BK,stencilWrite:n.sceneHasOcludees?T.s3:null,stencilTest:n.sceneHasOcludees?t?T.eD:T.RY:null,polygonOffset:r||i?n.polygonOffset&&R:(0,d.je)(n.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this.createPipeline(this.configuration.transparencyPassType,!0),this.createPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,p.Z)((0,v.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(w.A);E.shader=new x.J(D.C,(function(){return n.e(3173).then(n.bind(n,23173))}));var R={factor:1,units:1},k=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.cullFace=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.polygonOffset=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,a.Z)(n)}(S.m);(0,g._)([(0,S.o)({count:8})],k.prototype,"output",void 0),(0,g._)([(0,S.o)({count:3})],k.prototype,"cullFace",void 0),(0,g._)([(0,S.o)()],k.prototype,"slicePlaneEnabled",void 0),(0,g._)([(0,S.o)()],k.prototype,"vertexColors",void 0),(0,g._)([(0,S.o)()],k.prototype,"transparent",void 0),(0,g._)([(0,S.o)()],k.prototype,"polygonOffset",void 0),(0,g._)([(0,S.o)()],k.prototype,"enableOffset",void 0),(0,g._)([(0,S.o)()],k.prototype,"writeDepth",void 0),(0,g._)([(0,S.o)()],k.prototype,"sceneHasOcludees",void 0),(0,g._)([(0,S.o)({count:4})],k.prototype,"transparencyPassType",void 0),(0,g._)([(0,S.o)()],k.prototype,"multipassTerrainEnabled",void 0),(0,g._)([(0,S.o)()],k.prototype,"cullAboveGround",void 0);var Z=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,M)).supportsEdges=!0,r.techniqueConfig=new k,r}return(0,a.Z)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<d.ve,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"intersect",value:function(e,t,n,r,i,a,o){(0,f.Bw)(e,t,r,i,a,void 0,o)}},{key:"requiresSlot",value:function(e,t){return 20===e||(4===(0,u.S)(t)?2===e:e===(this.parameters.transparent?this.parameters.writeDepth?4:7:2))}},{key:"createGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output&&this.parameters.writeLinearDepth?new A(e):null}},{key:"createBufferWriter",value:function(){return new h.G_(h.IM)}}]),n}(c.F),A=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"updateParameters",value:function(e){return this.ensureTechnique(E,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),n}(l.Z),M=(0,r.Z)({color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1},c.z)},9992:function(e,t,n){n.d(t,{A:function(){return Q}});var r=n(1413),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(16889),u=n(92026),c=n(17842),d=n(22753),h=n(11873),f=n(14226),p=n(81949),v=n(88396),g=n(6394),m=n(11186),y=n(71353);function _(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var b=n(65156),x=n(55158),w=n(81935),S=n(94425),C=n(40485),P=n(56529),T=n(65216),D=n(97731),O=n(33236),E=n(22909),R=n(32683),k=n(18442),Z=n(27366),A=n(33280),M=n(49223),z=n(81879),H=n(137),L=n(43565),F=n(15226),j=n(18607),U=n(62993),I=n(41012),V=n(82144),W=n(31132),N=n(33559),G=n(7566),B=n(78041),q=n(27627),J=n(36207),$=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({output:r.output,FrontFacePass:2===r.transparencyPassType,viewingMode:e.viewingMode,occlusionTestEnabled:r.occlusionTestEnabled,signedDistanceFieldEnabled:r.sdf,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:r.debugDrawBorder,binaryHighlightOcclusionEnabled:r.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:r.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:r.screenSizePerspective,verticalOffsetEnabled:r.verticalOffset,pixelSnappingEnabled:r.pixelSnappingEnabled,vvSize:r.vvSize,vvColor:r.vvColor,vvInstancingEnabled:!1,isDraped:r.isDraped,multipassGeometryEnabled:r.multipassGeometryEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new q.$(e.rctx,i,G.i)}},{key:"bindPass",value:function(e,t){(0,I.II)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),(0,M.Mo)(this.program,e,t),(0,U.y)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),(0,I.yJ)(this.program,t),6===this.configuration.output?(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,L.l)(this.program,t),(0,F.p)(this.program,t)):((0,z.H)(this.program,t),(0,k.b)(this.program,e,t.camera.pixelRatio||1),(0,j.kz)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),4===this.configuration.output&&(0,H.wW)(this.program,t)}},{key:"bindDraw",value:function(e){(0,I.id)(this.program,e),(0,I.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,A.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"setPipelineState",value:function(e){var t=this.configuration,n=3===e,r=2===e,i=this.configuration.polygonOffsetEnabled&&Y,a=(n||r)&&4!==t.output?(t.depthEnabled||6===t.output)&&J.LZ:null;return(0,J.sm)({blending:0===t.output||7===t.output||4===t.output?n?X:(0,B.$L)(e):null,depthTest:{func:515},depthWrite:a,colorWrite:J.BK,polygonOffset:i})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return 6===this.configuration.output?0:4}}]),n}(W.A);$.shader=new V.J(k.H,(function(){return n.e(6823).then(n.bind(n,16823))}));var Y={factor:0,units:-4},X=(0,J.if)(1,771),K=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.occlusionTestEnabled=!0,e.sdf=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.screenSizePerspective=!1,e.screenCenterOffsetUnitsEnabled=0,e.debugDrawBorder=!1,e.binaryHighlightOcclusion=!0,e.slicePlaneEnabled=!1,e.polygonOffsetEnabled=!1,e.depthEnabled=!0,e.transparencyPassType=3,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.multipassGeometryEnabled=!1,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,a.Z)(n)}(N.m);(0,Z._)([(0,N.o)({count:8})],K.prototype,"output",void 0),(0,Z._)([(0,N.o)()],K.prototype,"occlusionTestEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"sdf",void 0),(0,Z._)([(0,N.o)()],K.prototype,"vvSize",void 0),(0,Z._)([(0,N.o)()],K.prototype,"vvColor",void 0),(0,Z._)([(0,N.o)()],K.prototype,"verticalOffset",void 0),(0,Z._)([(0,N.o)()],K.prototype,"screenSizePerspective",void 0),(0,Z._)([(0,N.o)({count:2})],K.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"debugDrawBorder",void 0),(0,Z._)([(0,N.o)()],K.prototype,"binaryHighlightOcclusion",void 0),(0,Z._)([(0,N.o)()],K.prototype,"slicePlaneEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"polygonOffsetEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"depthEnabled",void 0),(0,Z._)([(0,N.o)({count:4})],K.prototype,"transparencyPassType",void 0),(0,Z._)([(0,N.o)()],K.prototype,"pixelSnappingEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"isDraped",void 0),(0,Z._)([(0,N.o)()],K.prototype,"multipassGeometryEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"multipassTerrainEnabled",void 0),(0,Z._)([(0,N.o)()],K.prototype,"cullAboveGround",void 0);var Q=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,xe)).techniqueConfig=new K,r}return(0,a.Z)(n,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?1:0,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,0===e&&(this.techniqueConfig.debugDrawBorder=!!this.parameters.debugDrawBorder),4===e&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,n,r,i,a,o,s,l){(0,u.pC)(l)?this.intersectDrapedHudGeometry(e,a,o,s,l):this.intersectHudGeometry(e,t,n,r,o,s)}},{key:"intersectDrapedHudGeometry",value:function(e,t,n,r,i){var a=e.vertexAttributes.get("position"),o=e.vertexAttributes.get("size"),s=this.parameters,l=(0,k.c)(s),c=1,d=1;if((0,u.pC)(r)){var h=r(ge);c=h[0],d=h[5]}c*=e.screenToWorldRatio,d*=e.screenToWorldRatio;for(var f=ye*e.screenToWorldRatio,p=0;p<a.data.length/a.size;p++){var v=p*a.size,g=a.data[v],m=a.data[v+1],y=p*o.size,_=void 0;_e[0]=o.data[y]*c,_e[1]=o.data[y+1]*d,s.textureIsSignedDistanceField&&(_=s.outlineSize*e.screenToWorldRatio/2),re(t,g,m,_e,f,_,s,l)&&n(i.dist,i.normal,-1,!0)}}},{key:"intersectHudGeometry",value:function(e,t,n,r,i,a){if(r.options.selectionMode&&r.options.hud&&!(0,R.PD)(t)){var o=this.parameters,s=1,l=1;if((0,d.f)(de,n),(0,u.pC)(a)){var c=a(ge);s=c[0],l=c[5],function(e){var t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=1/Math.sqrt(t*t+n*n+r*r),d=1/Math.sqrt(i*i+a*a+o*o),h=1/Math.sqrt(s*s+l*l+u*u);e[0]=t*c,e[1]=n*c,e[2]=r*c,e[3]=i*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=l*h,e[8]=u*h}(de)}var h=e.vertexAttributes.get("position"),p=e.vertexAttributes.get("size"),v=e.vertexAttributes.get("normal"),g=e.vertexAttributes.get("auxpos1");(0,D.hu)(h.size>=3);var _=r.point,b=r.camera,x=(0,k.c)(o);s*=b.pixelRatio,l*=b.pixelRatio;for(var w="screen"===this.parameters.centerOffsetUnits,S=0;S<h.data.length/h.size;S++){var C=S*h.size;(0,m.s)(oe,h.data[C],h.data[C+1],h.data[C+2]),(0,m.m)(oe,oe,n);var P=S*p.size;_e[0]=p.data[P]*s,_e[1]=p.data[P+1]*l,(0,m.m)(oe,oe,b.viewMatrix);var O=S*g.size;if((0,m.s)(pe,g.data[O+0],g.data[O+1],g.data[O+2]),!w&&(oe[0]+=pe[0],oe[1]+=pe[1],0!==pe[2])){var E=pe[2];(0,m.n)(pe,oe),(0,m.f)(oe,oe,(0,m.a)(pe,pe,E))}var Z=S*v.size;if((0,m.s)(se,v.data[Z],v.data[Z+1],v.data[Z+2]),this.normalAndViewAngle(se,de,b,ve),this.applyVerticalOffsetTransformationView(oe,ve,b,ie),b.applyProjection(oe,le),le[0]>-1){var A=Math.floor(le[0])+this.parameters.screenOffset[0],M=Math.floor(le[1])+this.parameters.screenOffset[1];w&&(A+=pe[0],0!==pe[1]&&(M+=(0,T.sX)(pe[1],ie.factorAlignment))),(0,T.TU)(_e,ie.factor,_e);var z=me*b.pixelRatio,H=void 0;if(o.textureIsSignedDistanceField&&(H=o.outlineSize*b.pixelRatio/2),re(_,A,M,_e,z,H,o,x)){var L=r.ray;if((0,m.m)(ce,oe,(0,f.b)(fe,b.viewMatrix)),le[0]=_[0],le[1]=_[1],b.unprojectFromRenderScreen(le,oe)){var F=(0,y.c)();(0,m.g)(F,L.direction);var j=1/(0,m.l)(F);(0,m.a)(F,F,j),i((0,m.i)(L.origin,oe)*j,F,-1,!0,1,ce)}}}}}}},{key:"computeAttachmentOrigin",value:function(e,t){var n=e.vertexAttributes;if(!n)return!1;var r=n.get("position"),i=e.indices.get("position");return(0,w.NO)(r,i,t)}},{key:"createBufferWriter",value:function(){return new Se(this)}},{key:"normalAndViewAngle",value:function(e,t,n,r){return _(t)&&(t=(0,d.f)(he,t)),(0,m.t)(r.normal,e,t),(0,m.m)(r.normal,r.normal,n.viewInverseTransposeMatrix),r.cosAngle=(0,m.d)(ue,be),r}},{key:"updateScaleInfo",value:function(e,t,n){var r=this.parameters;r.screenSizePerspective?(0,T.PV)(n,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),r.screenSizePerspectiveAlignment?(0,T.PV)(n,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,n,r,i,a,o){var s=this.normalAndViewAngle(t,n,i,ve);return this.applyVerticalGroundOffsetView(e,s,i,o),this.applyVerticalOffsetTransformationView(o,s,i,a),this.applyPolygonOffsetView(o,s,r[3],i,o),this.applyCenterOffsetView(o,r,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,n,r,i){return this.applyCenterOffsetNDC(e,t,n,r),(0,u.pC)(i)&&(0,m.g)(i,r),this.applyPolygonOffsetNDC(r,t,n,r),r}},{key:"applyPolygonOffsetView",value:function(e,t,n,r,i){var a=r.aboveGround?1:-1,o=Math.sign(n);0===o&&(o=a);var s=a*o;if(this.parameters.shaderPolygonOffset<=0)return(0,m.g)(i,e);var u=(0,l.uZ)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-u*u)/u/r.viewport[2];return(0,m.a)(i,e,s>0?c:1/c),i}},{key:"applyVerticalGroundOffsetView",value:function(e,t,n,r){var i=(0,m.l)(e),a=n.aboveGround?1:-1,o=.5*n.computeRenderPixelSizeAtDist(i),s=(0,m.a)(oe,t.normal,a*o);return(0,m.b)(r,e,s),r}},{key:"applyVerticalOffsetTransformationView",value:function(e,t,n,r){var i=this.parameters;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=(0,m.l)(e);this.updateScaleInfo(r,a,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}var o=(0,m.l)(e),s=i.screenSizePerspectiveAlignment||i.screenSizePerspective,l=(0,E.Hx)(n,o,i.verticalOffset,t.cosAngle,s);return this.updateScaleInfo(r,o,t.cosAngle),(0,m.a)(t.normal,t.normal,l),(0,m.b)(e,e,t.normal)}},{key:"applyCenterOffsetView",value:function(e,t,n){var r="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,m.g)(n,e),r&&(n[0]+=t[0],n[1]+=t[1],t[2]&&((0,m.n)(se,n),(0,m.b)(n,n,(0,m.a)(se,se,t[2])))),n}},{key:"applyCenterOffsetNDC",value:function(e,t,n,r){var i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,m.g)(r,e),i||(r[0]+=t[0]/n.fullWidth*2,r[1]+=t[1]/n.fullHeight*2),r}},{key:"applyPolygonOffsetNDC",value:function(e,t,n,r){var i=this.parameters.shaderPolygonOffset;if(e!==r&&(0,m.g)(r,e),i){var a=n.aboveGround?1:-1,o=a*Math.sign(t[3]);r[2]-=(o||a)*i}return r}},{key:"requiresSlot",value:function(e,t){var n=(0,S.S)(t);if(0===n||7===n){if(20===e)return!0;var r=this.parameters.drawInSecondSlot?17:16;return this.parameters.occlusionTest&&11===e||e===r}return e===(this.parameters.drawInSecondSlot?17:16)||20===e}},{key:"createGLMaterial",value:function(e){return 0===e.output||7===e.output?new te(e):4===e.output?new ee(e):null}},{key:"calculateRelativeScreenBounds",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,b.Ue)();return ne(this.parameters,e,t,n),n[2]=n[0]+e[0],n[3]=n[1]+e[1],n}}]),n}(P.F),ee=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),e.material.parameters))}return(0,a.Z)(n,[{key:"updateParameters",value:function(e){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(e)}},{key:"selectProgram",value:function(e){return this.ensureTechnique($,e)}},{key:"beginSlot",value:function(e){return this.updateParameters(e)}},{key:"bind",value:function(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}]),n}(C.Z),te=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"isOcclusionSlot",value:function(e){return 11===e.slot&&this._material.parameters.occlusionTest&&(0===this._output||7===this._output)}},{key:"selectProgram",value:function(e){return this.ensureTechnique($,e,this.isOcclusionSlot(e)?6:this._output)}},{key:"bind",value:function(e,t){this.isOcclusionSlot(e)||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.parameters,e)}}]),n}(ee);function ne(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ae;return(0,v.c)(r,e.anchorPos),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*n,r[1]+=e.screenOffset[1]*n,r}function re(e,t,n,r,i,a,o,s){var l=t-i-(s[0]>0?r[0]*s[0]:0),u=l+r[0]+2*i,c=n-i-(s[1]>0?r[1]*s[1]:0),d=c+r[1]+2*i;if(o.textureIsSignedDistanceField){var h=o.distanceFieldBoundingBox;l+=r[0]*h[0],c+=r[1]*h[1],u-=r[0]*(1-h[2]),d-=r[1]*(1-h[3]),l-=a,u+=a,c-=a,d+=a}return e[0]>l&&e[0]<u&&e[1]>c&&e[1]<d}var ie={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ae=(0,g.a)(),oe=(0,y.c)(),se=(0,y.c)(),le=(0,c.J$)(),ue=(0,y.c)(),ce=(0,y.c)(),de=(0,h.c)(),he=(0,h.c)(),fe=(0,p.c)(),pe=(0,y.c)(),ve={normal:ue,cosAngle:0},ge=(0,p.c)(),me=1,ye=2,_e=[0,0],be=(0,y.f)(0,0,1),xe=(0,r.Z)({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:(0,g.f)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1},P.z),we=(0,x.U$)().vec3f("position").vec3f("normal").vec2f("uv0").vec4u8("color").vec2f("size").vec4f("auxpos1").vec4f("auxpos2"),Se=function(){function e(t){(0,i.Z)(this,e),this.material=t,this.vertexBufferLayout=we}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get("position").length}},{key:"write",value:function(e,t,n,r){(0,O.ho)(t.indices.get("position"),t.vertexAttributes.get("position").data,e.transformation,n.position,r,6),(0,O.s5)(t.indices.get("normal"),t.vertexAttributes.get("normal").data,e.invTranspTransformation,n.normal,r,6);var i,a,o,s,l=t.vertexAttributes.get("uv0").data;if(null==l||l.length<4){var u=this.material.parameters;i=0,a=0,o=u.texCoordScale[0],s=u.texCoordScale[1]}else i=l[0],a=l[1],o=l[2],s=l[3];o=Math.min(1.99999,o+1),s=Math.min(1.99999,s+1);for(var c=t.indices.get("position").length,d=n.uv0,h=r,f=0;f<c;++f)d.set(h,0,i),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,i),d.set(h,1,s),h+=1,d.set(h,0,i),d.set(h,1,a),h+=1;(0,O.Vs)(t.indices.get("color"),t.vertexAttributes.get("color").data,4,n.color,r,6);for(var p=t.indices.get("size"),v=t.vertexAttributes.get("size").data,g=p.length,m=n.size,y=r,_=0;_<g;++_)for(var b=v[2*p[_]],x=v[2*p[_]+1],w=0;w<6;++w)m.set(y,0,b),m.set(y,1,x),y+=1;t.indices.get("auxpos1")&&t.vertexAttributes.get("auxpos1")&&(0,O.SW)(t.indices.get("auxpos1"),t.vertexAttributes.get("auxpos1").data,n.auxpos1,r,6),t.indices.get("auxpos2")&&t.vertexAttributes.get("auxpos2")&&(0,O.SW)(t.indices.get("auxpos2"),t.vertexAttributes.get("auxpos2").data,n.auxpos2,r,6)}}]),e}()},99196:function(e,t,n){n.d(t,{Y:function(){return V}});var r=n(1413),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(32718),u=n(92026),c=n(17842),d=n(88396),h=n(11186),f=n(71353),p=n(85981),v=n(55652),g=n(25158),m=n(81935),y=n(23620),_=n(56529),b=n(97731),x=n(33236),w=n(64226),S=n(22909),C=n(32683),P=n(11752),T=n(61120),D=n(27366),O=n(33280),E=n(137),R=n(41012),k=n(82144),Z=n(31132),A=n(33559),M=n(7566),z=n(27627),H=n(50411),L=n(99337),F=n(36207),j=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this,e,r,a)).stipplePattern=null,o.stippleTextureBind=null,o.stippleTextureRepository=e.stippleTextureRepository,o}return(0,a.Z)(n,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&4!==this.configuration.output}},{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:r.stipplePreferContinuous});return new z.$(e.rctx,i,M.i)}},{key:"dispose",value:function(){(0,P.Z)((0,T.Z)(n.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if((0,R.II)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){var n=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.stippleEnabled){var r=(0,u.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1},i=r.pixelSize,a=r.sdfNormalizer,o=r.pixels;this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.program.setUniform1f("stipplePatternTextureSize",o),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var s=(0,u.Wg)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}4===this.configuration.output&&(0,E.wW)(this.program,t)}},{key:"bindDraw",value:function(e){(0,R.id)(this.program,e),this.stippleEnabled&&!this.configuration.draped&&(0,R.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,O.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){var e=this.configuration,t=(0,F.wK)(770,1,771,771),n=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,F.sm)({blending:n,depthTest:H.JN,depthWrite:r,colorWrite:F.BK,stencilWrite:e.sceneHasOcludees?H.s3:null,stencilTest:e.sceneHasOcludees?t?H.eD:H.RY:null})};return 0===e.output?(this._occludeePipelineState=n(!0,e.transparent||this.stippleEnabled?t:null,F.LZ),n(!1,e.transparent||this.stippleEnabled?t:null,F.LZ)):n(!1)}},{key:"primitiveType",get:function(){return 1}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,P.Z)((0,T.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(Z.A);j.shader=new k.J(L.N,(function(){return n.e(8569).then(n.bind(n,78569))}));var U=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stipplePreferContinuous=!0,e.sceneHasOcludees=!1,e}return(0,a.Z)(n)}(A.m);(0,D._)([(0,A.o)({count:8})],U.prototype,"output",void 0),(0,D._)([(0,A.o)()],U.prototype,"slicePlaneEnabled",void 0),(0,D._)([(0,A.o)()],U.prototype,"vertexColors",void 0),(0,D._)([(0,A.o)()],U.prototype,"transparent",void 0),(0,D._)([(0,A.o)()],U.prototype,"draped",void 0),(0,D._)([(0,A.o)()],U.prototype,"stippleEnabled",void 0),(0,D._)([(0,A.o)()],U.prototype,"stippleOffColorEnabled",void 0),(0,D._)([(0,A.o)()],U.prototype,"stipplePreferContinuous",void 0),(0,D._)([(0,A.o)()],U.prototype,"sceneHasOcludees",void 0);var I=l.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial"),V=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,G))._techniqueConfig=new U,r}return(0,a.Z)(n,[{key:"getTechniqueConfig",value:function(e,t){this._techniqueConfig.output=e,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=20===t.slot;var n=(0,u.pC)(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=n,this._techniqueConfig.stippleOffColorEnabled=n&&(0,u.pC)(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"intersect",value:function(e,t,n,r,i,a,o,s,l){(0,u.pC)(l)?(0,S.TT)(e,r,l,a,1,o):this.intersectLineGeometry(e,t,n,r,o)}},{key:"intersectLineGeometry",value:function(e,t,n,r,i){if(r.options.selectionMode&&!(0,C.PD)(t))if((0,b.kG)(n)){var a=e.vertexAttributes.get("position").data,o=r.camera,s=ne;(0,d.c)(s,r.point);(0,h.s)(re[0],s[0]-2,s[1]+2,0),(0,h.s)(re[1],s[0]+2,s[1]+2,0),(0,h.s)(re[2],s[0]+2,s[1]-2,0),(0,h.s)(re[3],s[0]-2,s[1]-2,0);for(var l=0;l<4;l++)if(!o.unprojectFromRenderScreen(re[l],ie[l]))return;(0,v.zk)(o.eye,ie[0],ie[1],ae),(0,v.zk)(o.eye,ie[1],ie[2],oe),(0,v.zk)(o.eye,ie[2],ie[3],se),(0,v.zk)(o.eye,ie[3],ie[0],le);for(var u=Number.MAX_VALUE,c=0,f=0;f<a.length-5;f+=3)if(B[0]=a[f]+n[12],B[1]=a[f+1]+n[13],B[2]=a[f+2]+n[14],q[0]=a[f+3]+n[12],q[1]=a[f+4]+n[13],q[2]=a[f+5]+n[14],!((0,v.jH)(ae,B)<0&&(0,v.jH)(ae,q)<0||(0,v.jH)(oe,B)<0&&(0,v.jH)(oe,q)<0||(0,v.jH)(se,B)<0&&(0,v.jH)(se,q)<0||(0,v.jH)(le,B)<0&&(0,v.jH)(le,q)<0)){if(o.projectToRenderScreen(B,Y),o.projectToRenderScreen(q,X),Y[2]<0&&X[2]>0){(0,h.f)(J,B,q);var g=o.frustum,m=-(0,v.jH)(g[4],B)/(0,h.d)(J,(0,v.mJ)(g[4]));(0,h.a)(J,J,m),(0,h.b)(B,B,J),o.projectToRenderScreen(B,Y)}else if(Y[2]>0&&X[2]<0){(0,h.f)(J,q,B);var y=o.frustum,_=-(0,v.jH)(y[4],q)/(0,h.d)(J,(0,v.mJ)(y[4]));(0,h.a)(J,J,_),(0,h.b)(q,q,J),o.projectToRenderScreen(q,X)}else if(Y[2]<0&&X[2]<0)continue;Y[2]=0,X[2]=0;var x=(0,p.Jk)((0,p.zk)(Y,X,ee),s);x<u&&(u=x,(0,h.g)(K,B),(0,h.g)(Q,q),c=f/3)}var w=r.rayBegin,S=r.rayEnd;if(u<4){var P=Number.MAX_VALUE;if((0,p.AR)((0,p.zk)(K,Q,ee),(0,p.zk)(w,S,te),$)){(0,h.f)($,$,w);var T=(0,h.l)($);(0,h.a)($,$,1/T),P=T/(0,h.i)(w,S)}i(P,$,c,!1)}}else I.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var n=e.vertexAttributes;if(!n)return!1;var r=n.get("position");return(0,m.qZ)(r,null,!1,t)}},{key:"requiresSlot",value:function(e){return 2===e||20===e}},{key:"createGLMaterial",value:function(e){return 0===e.output||4===e.output?new W(e):null}},{key:"createBufferWriter",value:function(){var e=this.parameters.vertexColors?w.IM:w.wp;return(0,u.Wi)(this.parameters.stipplePattern)?new w.G_(e):new N(e.clone().vec3f("auxpos1").vec2f("uv0"))}}]),n}(_.F),W=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"updateParameters",value:function(e){return this.ensureTechnique(j,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return 0===this._output&&this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),n}(y.Z),N=function(){function e(t){(0,i.Z)(this,e),this.vertexBufferLayout=t}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,r){(0,x.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r),this.writeAuxpos1(e,t,n,r),this.writeUV0(e,t,n,r)}},{key:"writeAuxpos1",value:function(e,t,n,r){var i=n.getField("auxpos1",g.ct),a=t.indices.get("position"),o=t.vertexAttributes.get("position").data,s=e.transformation,l=i.typedBufferStride,u=i.typedBuffer;r*=l;for(var c=0;c<a.length-1;c+=2)for(var d=0,h=[1,0];d<h.length;d++){var f=3*a[c+h[d]],p=o[f],v=o[f+1],m=o[f+2],y=s[0]*p+s[4]*v+s[8]*m+s[12],_=s[1]*p+s[5]*v+s[9]*m+s[13],b=s[2]*p+s[6]*v+s[10]*m+s[14];u[r]=y,u[r+1]=_,u[r+2]=b,r+=l}}},{key:"writeUV0",value:function(e,t,n,r){var i,a=n.getField("uv0",g.Eu),o=t.indices.get("position"),s=t.vertexAttributes.get("position").data,l=null==(i=t.vertexAttributes.get("distanceToStart"))?void 0:i.data,u=e.transformation,c=a.typedBufferStride,d=a.typedBuffer,f=0;d[r*=c]=0,d[r+1]=f,r+=c;var p=3*o[0],v=(0,h.s)(B,s[p],s[p+1],s[p+2]);u&&(0,h.m)(v,v,u);for(var m=q,y=o.length-1,_=1,b=l?function(e,t,n){return f=l[n]}:function(e,t,n){return f+=(0,h.i)(e,t)},x=1;x<y;x+=2){var w=3*o[x];(0,h.s)(m,s[w],s[w+1],s[w+2]),u&&(0,h.m)(m,m,u),b(v,m,_++);for(var S=0;S<2;++S)d[r]=1-S,d[r+1]=f,r+=c;(0,h.g)(v,m)}var C=3*o[y];(0,h.s)(m,s[C],s[C+1],s[C+2]),u&&(0,h.m)(m,m,u),b(v,m,_),d[r]=1,d[r+1]=f}}]),e}(),G=(0,r.Z)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1},_.z),B=(0,f.c)(),q=(0,f.c)(),J=(0,f.c)(),$=(0,f.c)(),Y=(0,c.J$)(),X=(0,c.J$)(),K=(0,f.c)(),Q=(0,f.c)(),ee=(0,p.Ue)(),te=(0,p.Ue)(),ne=(0,f.c)(),re=[(0,c.J$)(),(0,c.J$)(),(0,c.J$)(),(0,c.J$)()],ie=[(0,f.c)(),(0,f.c)(),(0,f.c)(),(0,f.c)()],ae=(0,v.Ue)(),oe=(0,v.Ue)(),se=(0,v.Ue)(),le=(0,v.Ue)()},58901:function(e,t,n){n.d(t,{U:function(){return B}});var r=n(1413),i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(32718),u=n(16889),c=n(92026),d=n(17842),h=n(88396),f=n(11186),p=n(71353),v=n(85981),g=n(55652),m=n(55158),y=n(81935),_=n(23620),b=n(94425),x=n(56529),w=n(97731),S=n(62930),C=n(32683),P=n(98186),T=n(11752),D=n(61120),O=n(27366),E=n(33280),R=n(137),k=n(15226),Z=n(18607),A=n(41012),M=n(82144),z=n(31132),H=n(33559),L=n(78041),F=n(27627),j=n(50411),U=n(36207),I=new Map([["position",0],["subdivisionFactor",1],["uv0",2],["auxpos1",3],["auxpos2",4],["size",6],["sizeFeatureAttribute",6],["color",5],["colorFeatureAttribute",5],["opacityFeatureAttribute",7]]),V=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this,e,r,a)).stippleTextureRepository=e.stippleTextureRepository,o}return(0,a.Z)(n,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&4!==this.configuration.output}},{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:r.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:r.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:r.stippleScaleWithLineWidth,stipplePreferContinuous:r.stipplePreferContinuous,roundCaps:r.roundCaps,roundJoins:r.roundJoins,vvColor:r.vvColor,vvSize:r.vvSize,vvInstancingEnabled:!0,vvOpacity:r.vvOpacity,falloffEnabled:r.falloffEnabled,innerColorEnabled:r.innerColorEnabled,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new F.$(e.rctx,i,I)}},{key:"dispose",value:function(){(0,T.Z)((0,D.Z)(n.prototype),"dispose",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if((0,A.II)(this.program,t.camera.projectionMatrix),4===this.configuration.output&&(0,R.wW)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,k.p)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),(0,Z.s0)(this.program,e),this.stipplePattern!==e.stipplePattern){var n=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,n),this.stipplePattern=n}if(this.stippleEnabled){var r=(0,c.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1},i=r.pixelSize,a=r.sdfNormalizer,o=r.pixels;if(this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.program.setUniform1f("stipplePatternTextureSize",o),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){var s=(0,c.Wg)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",(0,c.Pt)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}},{key:"bindDraw",value:function(e){(0,A.id)(this.program,e),this.stippleEnabled&&!this.configuration.draped&&(0,A.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,E.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"makePipelineState",value:function(e,t){var n=this.configuration,r=3===e,i=2===e;return(0,U.sm)({blending:0===n.output||7===n.output?r?L.wu:(0,L.$L)(e):null,depthTest:{func:(0,L.$x)(e)},depthWrite:r?!n.transparent&&n.writeDepth&&U.LZ:(0,L.Vc)(e),colorWrite:U.BK,stencilWrite:n.sceneHasOcludees?j.s3:null,stencilTest:n.sceneHasOcludees?t?j.eD:j.RY:null,polygonOffset:r||i?n.polygonOffset&&W:L.E0})}},{key:"initializePipeline",value:function(){var e=this.configuration,t=e.polygonOffset&&W;return e.occluder&&(this._occluderPipelineTransparent=(0,U.sm)({blending:L.wu,polygonOffset:t,depthTest:j.zV,depthWrite:null,colorWrite:U.BK,stencilWrite:null,stencilTest:j.YD}),this._occluderPipelineOpaque=(0,U.sm)({blending:L.wu,polygonOffset:t,depthTest:j.zV,depthWrite:null,colorWrite:U.BK,stencilWrite:j.P7,stencilTest:j.ii}),this._occluderPipelineMaskWrite=(0,U.sm)({blending:null,polygonOffset:t,depthTest:j.JN,depthWrite:null,colorWrite:null,stencilWrite:j.s3,stencilTest:j.eD})),this._occludeePipelineState=this.makePipelineState(this.configuration.transparencyPassType,!0),this.makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return 5}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?10===e?this._occluderPipelineTransparent:9===e?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,T.Z)((0,D.Z)(n.prototype),"getPipelineState",this).call(this,e,t)}}]),n}(z.A);V.shader=new M.J(P.R,(function(){return n.e(6279).then(n.bind(n,56279))}));var W={factor:0,units:-4},N=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.occluder=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.polygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleScaleWithLineWidth=!1,e.stipplePreferContinuous=!0,e.roundCaps=!1,e.roundJoins=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.sceneHasOcludees=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,a.Z)(n)}(H.m);(0,O._)([(0,H.o)({count:8})],N.prototype,"output",void 0),(0,O._)([(0,H.o)()],N.prototype,"occluder",void 0),(0,O._)([(0,H.o)()],N.prototype,"slicePlaneEnabled",void 0),(0,O._)([(0,H.o)()],N.prototype,"transparent",void 0),(0,O._)([(0,H.o)()],N.prototype,"polygonOffset",void 0),(0,O._)([(0,H.o)()],N.prototype,"writeDepth",void 0),(0,O._)([(0,H.o)()],N.prototype,"draped",void 0),(0,O._)([(0,H.o)()],N.prototype,"stippleEnabled",void 0),(0,O._)([(0,H.o)()],N.prototype,"stippleOffColorEnabled",void 0),(0,O._)([(0,H.o)()],N.prototype,"stippleScaleWithLineWidth",void 0),(0,O._)([(0,H.o)()],N.prototype,"stipplePreferContinuous",void 0),(0,O._)([(0,H.o)()],N.prototype,"roundCaps",void 0),(0,O._)([(0,H.o)()],N.prototype,"roundJoins",void 0),(0,O._)([(0,H.o)()],N.prototype,"vvSize",void 0),(0,O._)([(0,H.o)()],N.prototype,"vvColor",void 0),(0,O._)([(0,H.o)()],N.prototype,"vvOpacity",void 0),(0,O._)([(0,H.o)()],N.prototype,"falloffEnabled",void 0),(0,O._)([(0,H.o)()],N.prototype,"innerColorEnabled",void 0),(0,O._)([(0,H.o)()],N.prototype,"sceneHasOcludees",void 0),(0,O._)([(0,H.o)({count:4})],N.prototype,"transparencyPassType",void 0),(0,O._)([(0,H.o)()],N.prototype,"multipassTerrainEnabled",void 0),(0,O._)([(0,H.o)()],N.prototype,"cullAboveGround",void 0);var G=l.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial"),B=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e,J))._vertexAttributeLocations=I,r.techniqueConfig=new N,r.layout=r.createLayout(),r}return(0,a.Z)(n,[{key:"isClosed",value:function(e,t){return K(this.parameters,e,t)}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"getTechniqueConfig",value:function(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=20===t.slot;var n=(0,c.pC)(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=n,this.techniqueConfig.stippleOffColorEnabled=n&&(0,c.pC)(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=n&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=n&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.roundCaps=2===this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&(0,c.pC)(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=8===this.parameters.renderOccluded,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,n,r,i,a,o,s,l){(0,c.pC)(l)?this.intersectDrapedLineGeometry(e,r,l,a,o):this.intersectLineGeometry(e,t,n,r,o)}},{key:"intersectDrapedLineGeometry",value:function(e,t,n,r,i){if(t.options.selectionMode){var a=e.vertexAttributes.get("position").data,o=e.vertexAttributes.get("size"),s=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=e.vertexAttributes.get("sizeFeatureAttribute").data[0];s*=(0,u.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(s*=o.data[0]);for(var c=r[0],d=r[1],h=(s/2+4)*e.screenToWorldRatio,f=Number.MAX_VALUE,p=0,v=0;v<a.length-5;v+=3){var g=a[v],m=a[v+1],y=c-g,_=d-m,b=a[v+3]-g,x=a[v+4]-m,w=(0,u.uZ)((b*y+x*_)/(b*b+x*x),0,1),S=b*w-y,C=x*w-_,P=S*S+C*C;P<f&&(f=P,p=v/3)}f<h*h&&i(n.dist,n.normal,p,!1)}}},{key:"intersectLineGeometry",value:function(e,t,n,r,i){if(r.options.selectionMode&&!(0,C.PD)(t))if((0,w.kG)(n)){var a=e.vertexAttributes,o=a.get("position").data,s=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=a.get("sizeFeatureAttribute").data[0];s*=(0,u.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has("size")&&(s*=a.get("size").data[0]);var c=r.camera,d=re;(0,h.c)(d,r.point);var p=s*c.pixelRatio/2+4*c.pixelRatio;(0,f.s)(fe[0],d[0]-p,d[1]+p,0),(0,f.s)(fe[1],d[0]+p,d[1]+p,0),(0,f.s)(fe[2],d[0]+p,d[1]-p,0),(0,f.s)(fe[3],d[0]-p,d[1]-p,0);for(var m=0;m<4;m++)if(!c.unprojectFromRenderScreen(fe[m],pe[m]))return;(0,g.zk)(c.eye,pe[0],pe[1],ve),(0,g.zk)(c.eye,pe[1],pe[2],ge),(0,g.zk)(c.eye,pe[2],pe[3],me),(0,g.zk)(c.eye,pe[3],pe[0],ye);for(var y=Number.MAX_VALUE,_=0,b=X(this.parameters,a,e.indices)?o.length-2:o.length-5,x=0;x<b;x+=3){Q[0]=o[x]+n[12],Q[1]=o[x+1]+n[13],Q[2]=o[x+2]+n[14];var S=(x+3)%o.length;if(ee[0]=o[S]+n[12],ee[1]=o[S+1]+n[13],ee[2]=o[S+2]+n[14],!((0,g.jH)(ve,Q)<0&&(0,g.jH)(ve,ee)<0||(0,g.jH)(ge,Q)<0&&(0,g.jH)(ge,ee)<0||(0,g.jH)(me,Q)<0&&(0,g.jH)(me,ee)<0||(0,g.jH)(ye,Q)<0&&(0,g.jH)(ye,ee)<0)){if(c.projectToRenderScreen(Q,ie),c.projectToRenderScreen(ee,ae),ie[2]<0&&ae[2]>0){(0,f.f)(te,Q,ee);var P=c.frustum,T=-(0,g.jH)(P[4],Q)/(0,f.d)(te,(0,g.mJ)(P[4]));(0,f.a)(te,te,T),(0,f.b)(Q,Q,te),c.projectToRenderScreen(Q,ie)}else if(ie[2]>0&&ae[2]<0){(0,f.f)(te,ee,Q);var D=c.frustum,O=-(0,g.jH)(D[4],ee)/(0,f.d)(te,(0,g.mJ)(D[4]));(0,f.a)(te,te,O),(0,f.b)(ee,ee,te),c.projectToRenderScreen(ee,ae)}else if(ie[2]<0&&ae[2]<0)continue;ie[2]=0,ae[2]=0;var E=(0,v.Jk)((0,v.zk)(ie,ae,le),d);E<y&&(y=E,(0,f.g)(oe,Q),(0,f.g)(se,ee),_=x/3)}}var R=r.rayBegin,k=r.rayEnd;if(y<p*p){var Z=Number.MAX_VALUE;if((0,v.AR)((0,v.zk)(oe,se,le),(0,v.zk)(R,k,ue),ne)){(0,f.f)(ne,ne,R);var A=(0,f.l)(ne);(0,f.a)(ne,ne,1/A),Z=A/(0,f.i)(R,k)}i(Z,ne,_,!1)}}else G.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var n=e.vertexAttributes;if(!n)return null;var r=e.indices,i=n.get("position");return(0,y.qZ)(i,r?r.get("position"):null,r&&X(this.parameters,n,r),t)}},{key:"createLayout",value:function(){var e=(0,m.U$)().vec3f("position").f32("subdivisionFactor").vec2f("uv0").vec3f("auxpos1").vec3f("auxpos2");return this.parameters.vvSizeEnabled?e.f32("sizeFeatureAttribute"):e.f32("size"),this.parameters.vvColorEnabled?e.f32("colorFeatureAttribute"):e.vec4f("color"),this.parameters.vvOpacityEnabled&&e.f32("opacityFeatureAttribute"),e}},{key:"createBufferWriter",value:function(){return new $(this.layout,this.parameters)}},{key:"requiresSlot",value:function(e,t){if(20===e)return!0;if(8===this.parameters.renderOccluded)return 2===e||9===e||10===e;var n=(0,b.S)(t);return 0===n||7===n?e===(this.parameters.writeDepth?4:7):2===e}},{key:"createGLMaterial",value:function(e){return 0===e.output||7===e.output||4===e.output||1===e.output?new q(e):null}},{key:"validateParameters",value:function(e){"miter"!==e.join&&(e.miterLimit=0),this.requiresTransparent(e)&&(e.transparent=!0)}},{key:"requiresTransparent",value:function(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this.colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this.colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}},{key:"colorRequiresTransparent",value:function(e){return(0,c.pC)(e)&&e[3]<1&&e[3]>0}}]),n}(x.F),q=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"updateParameters",value:function(e){return this.ensureTechnique(V,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return 0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),n}(_.Z),J=(0,r.Z)((0,r.Z)({width:0,color:[1,1,1,1],join:"miter",cap:0,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1},x.z),S.Z.Default),$=function(){function e(t,n){(0,i.Z)(this,e),this.parameters=n,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;var r=n.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=P.N+r}}return(0,a.Z)(e,[{key:"isClosed",value:function(e){return X(this.parameters,e.vertexAttributes,e.indices)}},{key:"numCapSubdivisions",value:function(e){if(this.isClosed(e))return 0;switch(this.parameters.cap){case 1:case 2:return 1;default:return 0}}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=2*this.numCapSubdivisions(e)+2,n=e.indices.get("position").length/2+1,r=this.isClosed(e),i=r?2:2*t,a=r?0:1,o=r?n:n-1;if(e.vertexAttributes.has("subdivisions"))for(var s=e.vertexAttributes.get("subdivisions").data,l=a;l<o;++l)i+=4+2*s[l];else i+=(o-a)*(2*this.numJoinSubdivisions+4);return i+=2}},{key:"write",value:function(e,t,n,r){var i,a=this,o=ce,s=de,l=he,u=t.vertexAttributes.get("position").data,c=t.indices&&t.indices.get("position"),d=null==(i=t.vertexAttributes.get("distanceToStart"))?void 0:i.data,h=this.numCapSubdivisions(t);c&&c.length!==2*(u.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var p=null;t.vertexAttributes.has("subdivisions")&&(p=t.vertexAttributes.get("subdivisions").data);var v=1,g=0;this.parameters.vvSizeEnabled?g=t.vertexAttributes.get("sizeFeatureAttribute").data[0]:t.vertexAttributes.has("size")&&(v=t.vertexAttributes.get("size").data[0]);var m=[1,1,1,1],y=0;this.parameters.vvColorEnabled?y=t.vertexAttributes.get("colorFeatureAttribute").data[0]:t.vertexAttributes.has("color")&&(m=t.vertexAttributes.get("color").data);var _=0;this.parameters.vvOpacityEnabled&&(_=t.vertexAttributes.get("opacityFeatureAttribute").data[0]);var b=u.length/3,x=e.transformation,w=new Float32Array(n.buffer),S=this.vertexBufferLayout.stride/4,C=r*S,P=C,T=0,D=function(e,t,n,r,i,o,s){if(w[C++]=t[0],w[C++]=t[1],w[C++]=t[2],w[C++]=r,w[C++]=s,w[C++]=i,w[C++]=e[0],w[C++]=e[1],w[C++]=e[2],w[C++]=n[0],w[C++]=n[1],w[C++]=n[2],a.parameters.vvSizeEnabled?w[C++]=g:w[C++]=v,a.parameters.vvColorEnabled)w[C++]=y;else{var l=Math.min(4*o,m.length-4);w[C++]=m[l+0],w[C++]=m[l+1],w[C++]=m[l+2],w[C++]=m[l+3]}a.parameters.vvOpacityEnabled&&(w[C++]=_)};C+=S,(0,f.s)(s,u[0],u[1],u[2]),x&&(0,f.m)(s,s,x);var O=this.isClosed(t);if(O){var E=u.length-3;(0,f.s)(o,u[E],u[E+1],u[E+2]),x&&(0,f.m)(o,o,x)}else{(0,f.g)(o,s),(0,f.s)(l,u[3],u[4],u[5]),x&&(0,f.m)(l,l,x);for(var R=0;R<h;++R){var k=1-R/h;D(o,s,l,k,-4,0,T),D(o,s,l,k,4,0,T)}D(o,s,l,0,-4,0,T),D(o,s,l,0,4,0,T),(0,f.g)(o,s),(0,f.g)(s,l)}for(var Z=O?0:1,A=O?b:b-1,M=d?function(e,t,n){return T=d[n]}:function(e,t,n){return T+=(0,f.i)(e,t)},z=Z;z<A;z++){var H=(z+1)%b*3;(0,f.s)(l,u[H+0],u[H+1],u[H+2]),x&&(0,f.m)(l,l,x),M(o,s,z),D(o,s,l,0,-1,z,T),D(o,s,l,0,1,z,T);for(var L=p?p[z]:this.numJoinSubdivisions,F=0;F<L;++F){var j=(F+1)/(L+1);D(o,s,l,j,-1,z,T),D(o,s,l,j,1,z,T)}D(o,s,l,1,-2,z,T),D(o,s,l,1,2,z,T),(0,f.g)(o,s),(0,f.g)(s,l)}if(O)(0,f.s)(l,u[3],u[4],u[5]),x&&(0,f.m)(l,l,x),D(o,s,l,0,-1,Z,T=M(o,s,A)),D(o,s,l,0,1,Z,T);else{D(o,s,l,0,-5,A,T=M(o,s,A)),D(o,s,l,0,5,A,T);for(var U=0;U<h;++U){var I=(U+1)/h;D(o,s,l,I,-5,A,T),D(o,s,l,I,5,A,T)}}Y(w,P+S,w,P,S),C=Y(w,C-S,w,C,S)}}]),e}();function Y(e,t,n,r,i){for(var a=0;a<i;a++)n[r++]=e[t++];return r}function X(e,t,n){return K(e,t.get("position").data,n?n.get("position"):null)}function K(e,t,n){return!!e.isClosed&&(n?n.length>2:t.length>6)}var Q=(0,p.c)(),ee=(0,p.c)(),te=(0,p.c)(),ne=(0,p.c)(),re=(0,p.c)(),ie=(0,d.J$)(),ae=(0,d.J$)(),oe=(0,p.c)(),se=(0,p.c)(),le=(0,v.Ue)(),ue=(0,v.Ue)(),ce=(0,p.c)(),de=(0,p.c)(),he=(0,p.c)(),fe=[(0,d.J$)(),(0,d.J$)(),(0,d.J$)(),(0,d.J$)()],pe=[(0,p.c)(),(0,p.c)(),(0,p.c)(),(0,p.c)()],ve=(0,g.Ue)(),ge=(0,g.Ue)(),me=(0,g.Ue)(),ye=(0,g.Ue)()},62930:function(e,t,n){n.d(t,{Z:function(){return o}});var r,i=n(11873),a=n(8229);!function(e){e.Default={vvSizeEnabled:!1,vvSizeMinSize:(0,a.f)(1,1,1),vvSizeMaxSize:(0,a.f)(100,100,100),vvSizeOffset:(0,a.f)(0,0,0),vvSizeFactor:(0,a.f)(1,1,1),vvSizeValue:(0,a.f)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:(0,i.c)()}}(r||(r={}));var o=r},47475:function(e,t,n){n.d(t,{H:function(){return z}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(92026),l=n(38499),u=function(){function e(){(0,r.Z)(this,e),this.enabled=!0,this._time=0}return(0,i.Z)(e,[{key:"time",get:function(){return(0,l.HA)(this._time)}},{key:"advance",value:function(e){return(0,s.pC)(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}]),e}(),c=n(94425),d=n(56529),h=n(78041),f=n(23620),p=n(27366),v=n(33280),g=n(137),m=n(15226),y=n(23235),_=n(70755),b=n(79246),x=n(41012),w=n(82144),S=n(31132),C=n(33559),P=n(7566),T=n(27627),D=n(49810),O=n(36207),E=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i,a){var o;return(0,r.Z)(this,n),(o=t.call(this,e,i,a))._textureRepository=e.waterTextureRepository,o}return(0,i.Z)(n,[{key:"initializeProgram",value:function(e){var t=n.shader.get(),r=this.configuration,i=t.build({OITEnabled:0===r.transparencyPassType,output:r.output,viewingMode:e.viewingMode,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:r.receiveShadows,pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:r.useSSR,highStepCount:!0,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new T.$(e.rctx,i,P.i)}},{key:"bindPass",value:function(e,t){(0,x.II)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,m.p)(this.program,t)),0===this.configuration.output&&(t.lighting.setUniforms(this.program,!1),(0,_.O)(this.program,t)),0!==this.configuration.output&&2!==this.configuration.output||((0,b.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),4===this.configuration.output&&(0,g.wW)(this.program,t)}},{key:"bindDraw",value:function(e){(0,x.id)(this.program,e),this.program.rebindTextures(),0!==this.configuration.output&&7!==this.configuration.output||(0,x.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),0===this.configuration.output&&(0,y.O2)(this.program,e),0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||(0,v.DA)(this.program,this.configuration,e)}},{key:"setPipelineState",value:function(e){var t=this.configuration,n=3===e,r=2===e;return(0,O.sm)({blending:2!==t.output&&4!==t.output&&t.transparent?n?h.wu:(0,h.$L)(e):null,depthTest:{func:(0,h.$x)(e)},depthWrite:n?t.writeDepth&&O.LZ:(0,h.Vc)(e),colorWrite:O.BK,polygonOffset:n||r?null:(0,h.je)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this.setPipelineState(this.configuration.transparencyPassType)}}]),n}(S.A);E.shader=new w.J(D.W,(function(){return n.e(9106).then(n.bind(n,19106))}));var R=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).output=0,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.useSSR=!1,e.isDraped=!1,e.transparencyPassType=3,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,i.Z)(n)}(C.m);(0,p._)([(0,C.o)({count:8})],R.prototype,"output",void 0),(0,p._)([(0,C.o)()],R.prototype,"receiveShadows",void 0),(0,p._)([(0,C.o)()],R.prototype,"slicePlaneEnabled",void 0),(0,p._)([(0,C.o)()],R.prototype,"transparent",void 0),(0,p._)([(0,C.o)()],R.prototype,"enableOffset",void 0),(0,p._)([(0,C.o)()],R.prototype,"writeDepth",void 0),(0,p._)([(0,C.o)()],R.prototype,"useSSR",void 0),(0,p._)([(0,C.o)()],R.prototype,"isDraped",void 0),(0,p._)([(0,C.o)({count:4})],R.prototype,"transparencyPassType",void 0),(0,p._)([(0,C.o)()],R.prototype,"multipassTerrainEnabled",void 0),(0,p._)([(0,C.o)()],R.prototype,"cullAboveGround",void 0);var k=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"updateParameters",value:function(e){return this.ensureTechnique(E,e)}},{key:"setElapsedTimeUniform",value:function(e){var t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.parameters.animationSpeed)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}},{key:"_updateSSRState",value:function(e){e.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:e.ssrEnabled})}},{key:"ensureResources",value:function(e){var t=this._techniqueRep.constructionContext.waterTextureRepository;return t.ready||t.updating||t.loadTextures(e),t.ready?2:1}},{key:"beginSlot",value:function(e){return 0===this._output&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.parameters,e),2!==this._output&&0!==this._output||this.setElapsedTimeUniform(t.program)}}]),n}(f.Z),Z=n(64226),A=n(22909),M=n(30895),z=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e,M.a))._techniqueConfig=new R,i.animation=new u,i}return(0,i.Z)(n,[{key:"getTechniqueConfig",value:function(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<h.ve,this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig}},{key:"update",value:function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<H;var n=this.animation.advance(e);return this.animation.enabled&&n}},{key:"intersect",value:function(e,t,n,r,i,a,o){(0,A.Bw)(e,t,r,i,a,void 0,o)}},{key:"requiresSlot",value:function(e,t){switch((0,c.S)(t)){case 2:return 21===e;case 0:if(this.parameters.isDraped)return 20===e;break;case 4:return 2===e||20===e}var n=2;return this.parameters.transparent&&(n=this.parameters.writeDepth?4:7),e===n}},{key:"createGLMaterial",value:function(e){if(0===e.output&&this.parameters.isDraped)return e.output=5,new k(e);switch(e.output){case 0:case 2:case 4:case 7:return new k(e)}return null}},{key:"createBufferWriter",value:function(){return new Z.G_(Z.W1)}}]),n}(d.F),H=35e3},64226:function(e,t,n){n.d(t,{G_:function(){return c},IM:function(){return u},wp:function(){return s},W1:function(){return l}});var r=n(15671),i=n(43144),a=n(55158),o=n(33236),s=(0,a.U$)().vec3f("position"),l=(0,a.U$)().vec3f("position").vec2f("uv0"),u=(0,a.U$)().vec3f("position").vec4u8("color"),c=function(){function e(t){(0,r.Z)(this,e),this.vertexBufferLayout=t}return(0,i.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get("position").length}},{key:"write",value:function(e,t,n,r){(0,o.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,n,r)}}]),e}()},30895:function(e,t,n){n.d(t,{a:function(){return o},Z:function(){return s}});var r=n(1413),i=n(6394),a=n(56529),o=(0,r.Z)({waveStrength:.06,waveTextureRepeat:32,waveDirection:(0,i.f)(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1},a.z),s={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}},86700:function(e,t,n){n.d(t,{z5:function(){return s},Dp:function(){return l}});var r=n(93433),i=n(92026),a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:a.dash,"dash-dot":[].concat((0,r.Z)(a.dash),(0,r.Z)(a.dot)),dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[].concat((0,r.Z)(a["long-dash"]),(0,r.Z)(a.dot)),"long-dash-dot-dot":[].concat((0,r.Z)(a["long-dash"]),(0,r.Z)(a.dot),(0,r.Z)(a.dot)),none:null,"short-dash":a["short-dash"],"short-dash-dot":[].concat((0,r.Z)(a["short-dash"]),(0,r.Z)(a["short-dot"])),"short-dash-dot-dot":[].concat((0,r.Z)(a["short-dash"]),(0,r.Z)(a["short-dot"]),(0,r.Z)(a["short-dot"])),"short-dot":a["short-dot"],solid:null};function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return{pattern:[e,e],pixelRatio:t}}function l(e){return(0,i.pC)(e)&&"style"===e.type?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(0,i.Wi)(e)?e:{pattern:e.slice(),pixelRatio:t}}(o[e.style],8):null}}}]);
//# sourceMappingURL=8526.2fcba3b2.chunk.js.map