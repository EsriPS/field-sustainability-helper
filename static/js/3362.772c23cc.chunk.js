"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[3362],{85577:function(e,t,i){i.d(t,{r:function(){return b}});var r=i(93433),n=i(15671),s=i(43144),o=i(60136),a=i(29388),l=(i(59486),i(52639)),c=(i(51508),i(42537)),h=i(17842),p=i(88396),v=i(6394),u=i(71353),y=i(70040),d=i(76014),m=i(38561),f=i(16072),_=i(16851),g=i(75021),x=i(7882),k=i(29909),b=function(e){(0,o.Z)(i,e);var t=(0,a.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this)).graphicsLayer=e,r}return(0,s.Z)(i,[{key:"visualizeIntersectionPoint",value:function(e,t){return this._visualizeSnappingIndicator(new x.Z({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.coordinateHelper.spatialReference}),M)}},{key:"visualizePoint",value:function(e,t){return this._visualizeSnappingIndicator(new x.Z({x:e.point[0],y:e.point[1],spatialReference:t.coordinateHelper.spatialReference}),w)}},{key:"visualizeLine",value:function(e,t){return this._visualizeSnappingIndicator(new k.Z({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),S)}},{key:"visualizeParallelSign",value:function(e,t){return this._visualizeSnappingIndicator(new k.Z({paths:[[e.lineStart,e.lineEnd]],spatialReference:t.coordinateHelper.spatialReference}),C)}},{key:"visualizeRightAngleQuad",value:function(e,t){return this._visualizeSnappingIndicator(new k.Z({paths:[[e.previousVertex,e.centerVertex,e.nextVertex]],spatialReference:t.coordinateHelper.spatialReference}),R(e))}},{key:"_visualizeSnappingIndicator",value:function(e,t){var i=this,r=new l.Z({geometry:e,symbol:t});return this.graphicsLayer.add(r),(0,c.kB)((function(){i.graphicsLayer.remove(r)}))}}]),i}(m.a),G=y.O.main.toArray(),Z=[].concat((0,r.Z)(y.O.main.toRgb()),[100]),M=new f.Z({outline:new _.Z({width:1.5,color:G}),size:15,color:[0,0,0,0]}),w=new f.Z({outline:{width:.5,color:[0,0,0,1]},size:10,color:G}),S=new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,h.Wz)(d.c.lineHintWidthTarget),color:G}]}}}),C=new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:G}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:G}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}}),V=function(e){return new g.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:(0,h.Wz)(d.c.rightAngleHintSize),rotation:e,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:(0,h.Wz)(d.c.rightAngleHintOutlineSize),color:G},{type:"CIMSolidFill",enable:!0,color:Z}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})},I=V(45),O=V(225),R=function(){var e=(0,v.a)(),t=(0,v.a)(),i=(0,u.c)();return function(r){return(0,p.f)(e,r.centerVertex,r.previousVertex),(0,p.f)(t,r.nextVertex,r.previousVertex),(0,p.j)(i,e,t),i[2]<0?I:O}}()},83362:function(e,t,i){i.r(t),i.d(t,{default:function(){return $}});var r=i(15861),n=i(1413),s=i(29439),o=i(37762),a=i(60136),l=i(29388),c=i(43144),h=i(15671),p=i(87757),v=i(27366),u=(i(59486),i(52639)),y=i(40110),d=i(10064),m=i(91505),f=i(100),_=i(32718),g=i(92026),x=i(66978),k=i(8537),b=i(49861),G=(i(63780),i(93169),i(25243),i(69912)),Z=i(69662),M=i(93655),w=i(16072),S=i(85577),C=i(20008),V=i(53503),I=i(83089),O=i(70040),R=i(31235),E=i(87888),z=i(87268),P=i(34019),L=i(29909),H=i(7882),A=(0,c.Z)((function e(t,i,r){(0,h.Z)(this,e),this.graphic=t,this.mover=i,this.selected=r,this.type="reshape-start"})),T=(0,c.Z)((function e(t,i,r){(0,h.Z)(this,e),this.graphic=t,this.mover=i,this.selected=r,this.type="reshape"})),F=(0,c.Z)((function e(t,i,r){(0,h.Z)(this,e),this.graphic=t,this.mover=i,this.selected=r,this.type="reshape-stop"})),U=(0,c.Z)((function e(t,i,r){(0,h.Z)(this,e),this.mover=t,this.dx=i,this.dy=r,this.type="move-start"})),D=(0,c.Z)((function e(t,i,r){(0,h.Z)(this,e),this.mover=t,this.dx=i,this.dy=r,this.type="move"})),W=(0,c.Z)((function e(t,i,r){(0,h.Z)(this,e),this.mover=t,this.dx=i,this.dy=r,this.type="move-stop"})),j=(0,c.Z)((function e(t){(0,h.Z)(this,e),this.added=t,this.type="vertex-select"})),B=(0,c.Z)((function e(t){(0,h.Z)(this,e),this.removed=t,this.type="vertex-deselect"})),N=(0,c.Z)((function e(t,i,r,n){(0,h.Z)(this,e),this.added=t,this.graphic=i,this.oldGraphic=r,this.vertices=n,this.type="vertex-add"})),X=(0,c.Z)((function e(t,i,r,n){(0,h.Z)(this,e),this.removed=t,this.graphic=i,this.oldGraphic=r,this.vertices=n,this.type="vertex-remove"})),K=O.X.reshapeGraphics,Q={vertices:{default:new w.Z({style:"circle",size:K.vertex.size,color:K.vertex.color,outline:{color:K.vertex.outlineColor,width:1}}),hover:new w.Z({style:"circle",size:K.vertex.hoverSize,color:K.vertex.hoverColor,outline:{color:K.vertex.hoverOutlineColor,width:1}}),selected:new w.Z({style:"circle",size:K.selected.size,color:K.selected.color,outline:{color:K.selected.outlineColor,width:1}})},midpoints:{default:new w.Z({style:"circle",size:K.midpoint.size,color:K.midpoint.color,outline:{color:K.midpoint.outlineColor,width:1}}),hover:new w.Z({style:"circle",size:K.midpoint.size,color:K.midpoint.color,outline:{color:K.midpoint.outlineColor,width:1}})}},q="esri.views.draw.support.Reshape",J=_.Z.getLogger(q),Y=function(e){(0,a.Z)(i,e);var t=(0,l.Z)(i);function i(e){var r;return(0,h.Z)(this,i),(r=t.call(this,e))._activeOperationInfo=null,r._editGeometryOperations=null,r._handles=new f.Z,r._graphicAttributes={esriSketchTool:"box"},r._mover=null,r._snappingTask=null,r._stagedVertex=null,r._viewHandles=new f.Z,r.callbacks={onReshapeStart:function(){},onReshape:function(){},onReshapeStop:function(){},onMoveStart:function(){},onMove:function(){},onMoveStop:function(){},onGraphicClick:function(){}},r.enableMidpoints=!0,r.enableMovement=!0,r.enableVertices=!0,r.graphic=null,r.vertexGraphics=new y.Z,r.layer=null,r.midpointGraphics=new y.Z,r.midpointSymbol=new w.Z({style:"circle",size:6,color:[200,200,200],outline:{color:[100,100,100],width:1}}),r.selectedVertices=[],r.snappingManager=null,r.type="reshape",r.view=null,r}return(0,c.Z)(i,[{key:"initialize",value:function(){var e=this;this._setup(),this._handles.add([(0,k.N1)(this,"view.ready",(function(){var t=e.layer,i=e.view;(0,I.p)(i,t),e._viewHandles.add([i.on("key-down",(function(t){return e._keyDownHandler(t)}),R.f.TOOL)])})),(0,k.Wy)(this,"graphic",(function(){return e.refresh()})),(0,k.Wy)(this,"layer",(function(t,i){i&&(e._clearSelection(),e._resetGraphics(i)),e.refresh()})),(0,k.Wy)(this,"enableMidpoints",(function(){e.refresh()}))])}},{key:"destroy",value:function(){var e;this._reset(),null==(e=this._mover)||e.destroy(),this._mover=null,this._handles=(0,g.SC)(this._handles),this._viewHandles=(0,g.SC)(this._viewHandles)}},{key:"state",get:function(){var e=!!this.get("view.ready"),t=!(!this.get("graphic")||!this.get("layer"));return e&&t?"active":e?"ready":"disabled"}},{key:"symbols",set:function(e){var t=e||{},i=t.midpoints,r=void 0===i?Q.midpoints:i,n=t.vertices,s=void 0===n?Q.vertices:n;this._set("symbols",{midpoints:r,vertices:s})}},{key:"isUIGraphic",value:function(e){var t=[];return this.graphic&&t.push(this.graphic),t.concat(this.vertexGraphics.items,this.midpointGraphics.items),t.length&&t.includes(e)}},{key:"refresh",value:function(){this._reset(),this._setup()}},{key:"reset",value:function(){this.graphic=null}},{key:"clearSelection",value:function(){this._clearSelection()}},{key:"removeSelectedVertices",value:function(){this.selectedVertices.length&&this._removeVertices(this.selectedVertices)}},{key:"_setup",value:function(){var e=this.graphic;if(this.layer&&e&&!(0,g.Wi)(e.geometry)){var t=e.geometry;"mesh"!==t.type&&"extent"!==t.type?(this._setupGraphics(),this._setupMover()):this._logGeometryTypeError()}}},{key:"_setUpGeometryHelper",value:function(){var e=this.graphic.geometry;if((0,g.Wi)(e)||"mesh"===e.type||"extent"===e.type)this._logGeometryTypeError();else{var t="multipoint"===e.type?new L.Z({paths:e.points,spatialReference:e.spatialReference}):e;this._editGeometryOperations=z.c.fromGeometry(t,2)}}},{key:"_saveSnappingContextForHandle",value:function(e,t){var i;this._snappingGraphicsLayer=new M.Z({listMode:"hide",internal:!0,title:"Reshape snapping layer"}),this.view.map.layers.add(this._snappingGraphicsLayer),this._snappingContext=new P.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:{mode:"on-the-ground",offset:0},pointer:(null==(i=t.viewEvent)?void 0:i.pointerType)||"mouse",excludeFeature:this.graphic,visualizer:new S.r(this._snappingGraphicsLayer),vertexHandle:this._getVertexFromEditGeometry(e)})}},{key:"_reset",value:function(){this._clearSelection(),this._resetGraphics(),this._resetSnappingStateVars(),this._activeOperationInfo=null,this._mover&&this._mover.destroy(),this._mover=null,this.view.cursor="default"}},{key:"_resetSnappingStateVars",value:function(){(0,g.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,g.pC)(this._snappingGraphicsLayer)&&(this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy()),this._editGeometryOperations=(0,g.SC)(this._editGeometryOperations),this._snappingTask=(0,g.IM)(this._snappingTask),this._snappingTask=null,this._snappingContext=null,this._stagedVertex=null}},{key:"_resetGraphics",value:function(e){this._removeMidpointGraphics(e),this._removeVertexGraphics(e),this._set("selectedVertices",[])}},{key:"_removeMidpointGraphics",value:function(e){var t=e||this.layer;t&&t.removeMany(this.midpointGraphics.items),this.midpointGraphics.items.forEach((function(e){return e.destroy()})),this.midpointGraphics.removeAll()}},{key:"_removeVertexGraphics",value:function(e){var t=e||this.layer;t&&t.removeMany(this.vertexGraphics.items),this.vertexGraphics.items.forEach((function(e){return e.destroy()})),this.vertexGraphics.removeAll()}},{key:"_getCoordinatesForUI",value:function(e){var t=(0,Z.nA)(e.clone());if("polygon"===e.type){var i,r=(0,o.Z)(t);try{for(r.s();!(i=r.n()).done;){var n=i.value,s=n[n.length-1];n[0][0]===s[0]&&n[0][1]===s[1]&&n.length>2&&n.pop()}}catch(a){r.e(a)}finally{r.f()}}return t}},{key:"_setupGraphics",value:function(){var e=this.graphic.geometry;if((0,g.pC)(e)&&("polyline"===e.type||"polygon"===e.type)){var t=this._getCoordinatesForUI(e);this.enableMidpoints&&this._setUpMidpointGraphics(t),this.enableVertices&&this._setUpVertexGraphics(t)}}},{key:"_setUpMidpointGraphics",value:function(e){this._removeMidpointGraphics();var t=this._createMidpointGraphics(e);this.midpointGraphics.addMany(t),this.layer.addMany(t)}},{key:"_setUpVertexGraphics",value:function(e){this._removeVertexGraphics();var t=this._createVertexGraphics(e);this.vertexGraphics.addMany(t),this._storeRelatedVertexIndices(),this.layer.addMany(t)}},{key:"_createVertexGraphics",value:function(e){var t=this._graphicAttributes,i=this.symbols,r=this.view.spatialReference,o=[];return null==e||e.forEach((function(e,a){e.forEach((function(e,l){var c,h=(0,s.Z)(e,2),p=h[0],v=h[1];o.push(new u.Z({geometry:new H.Z({x:p,y:v,spatialReference:r}),symbol:null==i||null==(c=i.vertices)?void 0:c.default,attributes:(0,n.Z)((0,n.Z)({},t),{},{pathIndex:a,pointIndex:l})}))}))})),o}},{key:"_createMidpointGraphics",value:function(e){var t=this,i=this._graphicAttributes,r=this.symbols,o=this.view.spatialReference,a=[];return null==e||e.forEach((function(e,l){e.forEach((function(c,h){var p=(0,s.Z)(c,2),v=p[0],y=p[1],d=e[h+1]?h+1:0;if("polygon"===(0,g.U2)(t.graphic.geometry,"type")||0!==d){var m=(0,s.Z)(e[d],2),f=m[0],_=m[1],x=(0,Z.Gi)([v,y],[f,_]),k=(0,s.Z)(x,2),b=k[0],G=k[1];a.push(new u.Z({geometry:new H.Z({x:b,y:G,spatialReference:o}),symbol:r.midpoints.default,attributes:(0,n.Z)((0,n.Z)({},i),{},{pathIndex:l,pointIndexStart:h,pointIndexEnd:d})}))}}))})),a}},{key:"_storeRelatedVertexIndices",value:function(){var e=this.vertexGraphics.items;if(e)for(var t=e.map((function(e){var t=e.geometry;return{x:t.x,y:t.y}})),i=0;i<t.length;i++){for(var r=[],n=0;n<t.length;n++)if(i!==n){var s=t[i],o=t[n];s.x===o.x&&s.y===o.y&&r.push(n)}e[i].attributes.relatedGraphicIndices=r}}},{key:"_setupMover",value:function(){var e=this,t=this.enableMovement,i=this.graphic,r=this.midpointGraphics,n=this.vertexGraphics,s=this.view,o=(0,g.U2)(i.geometry,"type"),a="point"===o||"multipoint"===o,l=n.concat(r).items;t&&l.push(i),this._mover=new V.default({enableMoveAllGraphics:!1,indicatorsEnabled:a,graphics:l,view:s,callbacks:{onGraphicClick:function(t){return e._onGraphicClickCallback(t)},onGraphicMoveStart:function(t){return e._onGraphicMoveStartCallback(t)},onGraphicMove:function(t){return e._onGraphicMoveCallback(t)},onGraphicMoveStop:function(t){return e._onGraphicMoveStopCallback(t)},onGraphicPointerOver:function(t){return e._onGraphicPointerOverCallback(t)},onGraphicPointerOut:function(t){return e._onGraphicPointerOutCallback(t)}}})}},{key:"_onGraphicClickCallback",value:function(e){e.viewEvent.stopPropagation();var t=e.graphic;if(t===this.graphic)this.clearSelection(),this.emit("graphic-click",e),this.callbacks.onGraphicClick&&this.callbacks.onGraphicClick(e);else if(this._isMidpoint(t)){if(2===e.viewEvent.button)return;var i=this.graphic.clone(),r=this._createVertexFromMidpoint(t);this.refresh(),this._emitVertexAddEvent([t],i,r)}else this._isVertex(t)&&(e.viewEvent.stopPropagation(),2===e.viewEvent.button?this._removeVertices(t):(e.viewEvent.native.shiftKey||this._clearSelection(),this.selectedVertices.includes(t)?this._removeFromSelection(t,!0):this._addToSelection(t)))}},{key:"_setUpOperation",value:function(e){var t=e.graphic,i=e.dx,r=e.dy,n=t===this.graphic;this._resetSnappingStateVars(),this._setUpGeometryHelper(),this._saveSnappingContextForHandle(t,e),this._activeOperationInfo={target:this.graphic,mover:t,operationType:n?"move":"reshape",totalDx:i,totalDy:r}}},{key:"_onGraphicMoveStartCallback",value:function(e){var t=this,i=e.graphic,r=e.dx,n=e.dy;if(i===this.graphic)return this._clearSelection(),this._resetGraphics(),this._setUpOperation(e),this._emitMoveStartEvent(r,n),void("point"===this._editGeometryOperations.data.type&&this._onHandleMove(i,r,n,e,(function(){return t._emitMoveEvent(r,n)})));if(!this.selectedVertices.includes(i)){if(this._clearSelection(),this._isMidpoint(i)){var s=this.graphic.clone(),o=this._createVertexFromMidpoint(i);this._emitVertexAddEvent([i],s,o)}this._addToSelection(i)}this._setUpOperation(e),this._emitReshapeStartEvent(i),this._onHandleMove(i,r,n,e,(function(){return t._emitReshapeEvent(i)}))}},{key:"_onGraphicMoveCallback",value:function(e){var t=this,i=e.graphic,r=e.dx,n=e.dy;this._activeOperationInfo.totalDx+=r,this._activeOperationInfo.totalDy+=n,"move"===this._activeOperationInfo.operationType?"point"===this._editGeometryOperations.data.type?this._onHandleMove(i,r,n,e,(function(){return t._emitMoveEvent(r,n)})):this._emitMoveEvent(r,n):this._onHandleMove(i,r,n,e,(function(){return t._emitReshapeEvent(i)}))}},{key:"_onGraphicMoveStopCallback",value:function(e){var t=this,i=e.graphic,r=e.dx,n=e.dy;this._activeOperationInfo.totalDx+=r,this._activeOperationInfo.totalDy+=n,i===this.graphic?(this._emitMoveStopEvent(),this.refresh()):(this._onHandleMove(i,r,n,e,(function(){return t._emitReshapeStopEvent(i)})),this._resetSnappingStateVars(),this._activeOperationInfo=null,this._isMidpoint(i)&&this.refresh())}},{key:"_updateMidpointGraphicLocations",value:function(e){var t,i=(0,o.Z)(this.midpointGraphics);try{for(i.s();!(t=i.n()).done;){var r=t.value,n=r.attributes,a=n.pathIndex,l=n.pointIndexStart,c=n.pointIndexEnd,h=(0,s.Z)(e[a][l],2),p=h[0],v=h[1],u=(0,s.Z)(e[a][c],2),y=u[0],d=u[1],m=(0,Z.Gi)([p,v],[y,d]),f=(0,s.Z)(m,2),_=f[0],g=f[1];r.geometry=new H.Z({x:_,y:g,spatialReference:this.view.spatialReference})}}catch(x){i.e(x)}finally{i.f()}}},{key:"_getIndicesForVertexGraphic",value:function(e){var t=e.attributes;return[(null==t?void 0:t.pathIndex)||0,(null==t?void 0:t.pointIndex)||0]}},{key:"_getVertexFromEditGeometry",value:function(e){var t=this._getIndicesForVertexGraphic(e),i=(0,s.Z)(t,2),r=i[0],n=i[1];return this._editGeometryOperations.data.components[r].vertices[n]}},{key:"_onHandleMove",value:function(e,t,i,n,s){var o=this;if((0,g.IM)(this._snappingTask),this._snappingContext){var a=e.geometry,l="graphic-move-stop"===n.type;if((0,g.pC)(this.snappingManager)&&this.selectedVertices.length<2&&!l){var c=this.snappingManager;this._stagedVertex=c.update(a,this._snappingContext),this._syncGeometryAfterVertexMove(e,new H.Z(this._stagedVertex),t,i,l),s(),this._snappingTask=(0,x.vr)(function(){var n=(0,r.Z)(p.mark((function r(n){var h;return p.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c.snap(a,o._snappingContext,n);case 2:(h=r.sent).valid&&(o._stagedVertex=h.apply(),o._syncGeometryAfterVertexMove(e,new H.Z(o._stagedVertex),t,i,l),s());case 4:case"end":return r.stop()}}),r)})));return function(e){return n.apply(this,arguments)}}())}else{var h=(0,g.pC)(this._stagedVertex)?new H.Z(this._stagedVertex):a;this._syncGeometryAfterVertexMove(e,h,t,i,l),s()}}}},{key:"_syncGeometryAfterVertexMove",value:function(){var e=(0,r.Z)(p.mark((function e(t,i,r,n){var o,a,l,c,h,v,u,y,d,m,f,_,g,x=arguments;return p.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=x.length>4&&void 0!==x[4]&&x[4],"point"===(a=this._editGeometryOperations.data.geometry).type?t.geometry=i:(l=i.x,c=i.y,h=this._getIndicesForVertexGraphic(t),v=(0,s.Z)(h,2),u=v[0],y=v[1],d=(0,Z.nA)(a),m=d[u].length-1,d[u][y]=[l,c],"polygon"===a.type&&(0===y?d[u][m]=[l,c]:y===m&&(d[u][0]=[l,c])),this._isVertex(t)&&(d=this._moveRelatedCoordinates(d,t,l,c),d=this._moveSelectedHandleCoordinates(d,t,r,n,"polygon"===a.type),this._updateMidpointGraphicLocations(d)),this.graphic.geometry=a.clone(),f=this._getVertexFromEditGeometry(t),_=l-f.pos[0],g=c-f.pos[1],this._editGeometryOperations.moveVertices([f],_,g,0),o&&(this._mover?this._mover.updateGeometry(this._mover.graphics.indexOf(t),i):t.geometry=i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,i,r,n){return e.apply(this,arguments)}}()},{key:"_moveRelatedCoordinates",value:function(e,t,i,r){var n,s=t.attributes.relatedGraphicIndices,a=(0,o.Z)(s);try{for(a.s();!(n=a.n()).done;){var l=n.value,c=this.vertexGraphics.getItemAt(l),h=c.attributes,p=h.pathIndex,v=h.pointIndex;e[p][v]=[i,r],c.geometry=t.geometry}}catch(u){a.e(u)}finally{a.f()}return e}},{key:"_moveSelectedHandleCoordinates",value:function(e,t,i,r,n){var s,a=(0,o.Z)(this.selectedVertices);try{for(a.s();!(s=a.n()).done;){var l=s.value;if(l!==t){var c=l.attributes,h=c.pathIndex,p=c.pointIndex,v=c.relatedGraphicIndices,u=(0,C.e7)(l.geometry,i,r,this.view),y=e[h].length-1;e[h][p]=[u.x,u.y],l.geometry=u,n&&(0===p?e[h][y]=[u.x,u.y]:p===y&&(e[h][0]=[u.x,u.y]));var d,m=(0,o.Z)(v);try{for(m.s();!(d=m.n()).done;){var f=d.value,_=this.vertexGraphics.getItemAt(f),g=_.attributes,x=g.pathIndex,k=g.pointIndex;e[x][k]=[u.x,u.y],_.geometry=u}}catch(b){m.e(b)}finally{m.f()}}}}catch(b){a.e(b)}finally{a.f()}return e}},{key:"_onGraphicPointerOverCallback",value:function(e){var t=e.graphic;this._isVertex(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.hover),this._updateHoverCursor(t)}},{key:"_onGraphicPointerOutCallback",value:function(e){var t=e.graphic;this._isVertex(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.default),this.view.cursor="default"}},{key:"_createVertexFromMidpoint",value:function(e){var t=this._graphicAttributes,i=this.graphic.geometry;if((0,g.Wi)(i)||"polygon"!==i.type&&"polyline"!==i.type)return[];var r=i.clone(),s=[],o=e.attributes,a=o.pathIndex,l=o.pointIndexStart,c=o.pointIndexEnd,h=e.geometry,p=h.x,v=h.y,u=0===c?l+1:c,y=(0,Z.nA)(r);return y[a].splice(u,0,[p,v]),e.attributes=(0,n.Z)((0,n.Z)({},t),{},{pathIndex:a,pointIndex:u,relatedGraphicIndices:[]}),s.push({coordinates:y[a][u],componentIndex:a,vertexIndex:u}),this.graphic.geometry=r,s}},{key:"_addToSelection",value:function(e){e instanceof u.Z&&(e=[e]);var t,i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){t.value.symbol=this.symbols.vertices.selected}}catch(r){i.e(r)}finally{i.f()}this._set("selectedVertices",this.selectedVertices.concat(e)),this._emitSelectEvent(e)}},{key:"_removeFromSelection",value:function(e,t){var i=this.symbols.vertices,r=t?i.hover:i.default;e instanceof u.Z&&(e=[e]);var n,s=(0,o.Z)(e);try{for(s.s();!(n=s.n()).done;){var a=n.value;this.selectedVertices.splice(this.selectedVertices.indexOf(a),1),this._set("selectedVertices",this.selectedVertices),a.set("symbol",r)}}catch(l){s.e(l)}finally{s.f()}this._emitDeselectEvent(e)}},{key:"_clearSelection",value:function(){if(this.selectedVertices.length){var e,t=this.selectedVertices,i=(0,o.Z)(this.selectedVertices);try{for(i.s();!(e=i.n()).done;){e.value.set("symbol",this.symbols.vertices.default)}}catch(r){i.e(r)}finally{i.f()}this._set("selectedVertices",[]),this._emitDeselectEvent(t)}}},{key:"_keyDownHandler",value:function(e){E.j.delete.includes(e.key)&&!e.repeat&&this.selectedVertices.length&&this._removeVertices(this.selectedVertices)}},{key:"_removeVertices",value:function(e){var t=this.graphic.geometry;if(!((0,g.Wi)(t)||"polygon"!==t.type&&"polyline"!==t.type)&&!("polygon"===t.type&&this.vertexGraphics.length<4||this.vertexGraphics.length<3)){e instanceof u.Z&&(e=[e]);var i=this.graphic.clone(),r=t.clone(),n=(0,Z.nA)(r),a=[];e instanceof u.Z&&(e=[e]);var l,c=(0,o.Z)(e);try{for(c.s();!(l=c.n()).done;)for(var h=l.value.geometry,p=h.x,v=h.y,y=0;y<n.length;y++)for(var d=n[y],m=0;m<d.length;m++){var f=(0,s.Z)(d[m],2),_=f[0],x=f[1];p===_&&v===x&&(a.push({coordinates:n[y][m],componentIndex:y,vertexIndex:m}),n[y].splice(Number(m),1))}}catch(M){c.e(M)}finally{c.f()}if("polygon"===r.type)n=n.filter((function(e){if(e.length<2)return!1;var t=(0,s.Z)(e[0],2),i=t[0],r=t[1],n=(0,s.Z)(e[e.length-1],2),o=n[0],a=n[1];return(2!==e.length||i!==o||r!==a)&&(i===o&&r===a||e.push(e[0]),!0)})),r.rings=n;else{var k,b=(0,o.Z)(n);try{for(b.s();!(k=b.n()).done;){var G=k.value;1===G.length&&n.splice(n.indexOf(G),1)}}catch(M){b.e(M)}finally{b.f()}r.paths=n}this.graphic.geometry=r,this.refresh(),this._emitVertexRemoveEvent(e,i,a)}}},{key:"_isVertex",value:function(e){return this.vertexGraphics.includes(e)}},{key:"_isSelected",value:function(e){return this._isVertex(e)&&this.selectedVertices.includes(e)}},{key:"_isMidpoint",value:function(e){return this.midpointGraphics.includes(e)}},{key:"_updateHoverCursor",value:function(e){this.view.cursor=this._isMidpoint(e)?"copy":"move"}},{key:"_emitMoveStartEvent",value:function(e,t){var i=new U(this.graphic,e,t);this.emit("move-start",i),this.callbacks.onMoveStart&&this.callbacks.onMoveStart(i)}},{key:"_emitMoveEvent",value:function(e,t){var i=new D(this.graphic,e,t);this.emit("move",i),this.callbacks.onMove&&this.callbacks.onMove(i)}},{key:"_emitMoveStopEvent",value:function(){var e=this._activeOperationInfo,t=e.totalDx,i=e.totalDy,r=new W(this.graphic,t,i);this.emit("move-stop",r),this.callbacks.onMoveStop&&this.callbacks.onMoveStop(r)}},{key:"_emitReshapeStartEvent",value:function(e){var t=new A(this.graphic,e,this.selectedVertices);this.emit("reshape-start",t),this.callbacks.onReshapeStart&&this.callbacks.onReshapeStart(t)}},{key:"_emitReshapeEvent",value:function(e){var t=new T(this.graphic,e,this.selectedVertices);this.emit("reshape",t),this.callbacks.onReshape&&this.callbacks.onReshape(t)}},{key:"_emitReshapeStopEvent",value:function(e){var t=new F(this.graphic,e,this.selectedVertices);this.emit("reshape-stop",t),this.callbacks.onReshapeStop&&this.callbacks.onReshapeStop(t)}},{key:"_emitSelectEvent",value:function(e){var t=new j(e);this.emit("select",t),this.callbacks.onVertexSelect&&this.callbacks.onVertexSelect(t)}},{key:"_emitDeselectEvent",value:function(e){var t=new B(e);this.emit("deselect",t),this.callbacks.onVertexDeselect&&this.callbacks.onVertexDeselect(t)}},{key:"_emitVertexAddEvent",value:function(e,t,i){var r=new N(e,this.graphic,t,i);this.emit("vertex-add",r),this.callbacks.onVertexAdd&&this.callbacks.onVertexAdd(r)}},{key:"_emitVertexRemoveEvent",value:function(e,t,i){var r=new X(e,this.graphic,t,i);this.emit("vertex-remove",r),this.callbacks.onVertexRemove&&this.callbacks.onVertexRemove(r)}},{key:"_logGeometryTypeError",value:function(){J.error(new d.Z("reshape:invalid-geometry","Reshape operation not supported for the provided graphic. The geometry type is not supported."))}}]),i}(m.Z.EventedAccessor);(0,v._)([(0,b.Cb)()],Y.prototype,"callbacks",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"enableMidpoints",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"enableMovement",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"enableVertices",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"graphic",void 0),(0,v._)([(0,b.Cb)({readOnly:!0})],Y.prototype,"vertexGraphics",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"layer",void 0),(0,v._)([(0,b.Cb)({readOnly:!0})],Y.prototype,"midpointGraphics",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"midpointSymbol",void 0),(0,v._)([(0,b.Cb)({readOnly:!0})],Y.prototype,"selectedVertices",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"snappingManager",void 0),(0,v._)([(0,b.Cb)({readOnly:!0})],Y.prototype,"state",null),(0,v._)([(0,b.Cb)({value:Q})],Y.prototype,"symbols",null),(0,v._)([(0,b.Cb)({readOnly:!0})],Y.prototype,"type",void 0),(0,v._)([(0,b.Cb)()],Y.prototype,"view",void 0);var $=Y=(0,v._)([(0,G.j)(q)],Y)},70040:function(e,t,i){i.d(t,{O:function(){return o},X:function(){return u}});var r=i(43144),n=i(15671),s=i(51995),o={main:new s.Z([255,127,0]),selected:new s.Z([255,255,255]),outline:new s.Z([0,0,0,.5]),selectedOutline:new s.Z([255,255,255]),hoverOutline:new s.Z([255,255,255]),secondary:new s.Z([255,255,255]),secondaryOutline:new s.Z([100,100,100]),transparent:new s.Z([0,0,0,0])};function a(e,t){if(t)for(var i in t)e[i]=t[i]}var l=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.size=8,this.hoverSize=10,this.color=o.main,this.hoverColor=o.main,this.outlineColor=o.outline,this.hoverOutlineColor=o.hoverOutline,a(this,t)})),c=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.color=o.secondary,this.hoverColor=o.main,a(this,t)})),h=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.color=o.transparent,this.hoverColor=o.transparent,this.outlineColor=o.main,this.hoverOutlineColor=o.main,this.stagedColor=o.transparent,this.stagedOutlineColor=o.secondary,a(this,t)})),p=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.vertex=new l,this.midpoint=new l({color:o.secondary,outlineColor:o.secondaryOutline,size:6}),this.selected=new l({color:o.selected,hoverColor:o.selected,hoverOutlineColor:o.hoverOutline}),a(this,t)})),v=(0,r.Z)((function e(t){(0,n.Z)(this,e),this.center=new l({color:o.secondaryOutline}),this.fill=new h,this.line=new c,this.vertex=new l({color:o.selected,outlineColor:o.main,hoverColor:o.selected,hoverOutlineColor:o.secondaryOutline}),a(this,t)})),u=new((0,r.Z)((function e(t){(0,n.Z)(this,e),this.reshapeGraphics=new p,this.transformGraphics=new v,a(this,t)})))}}]);
//# sourceMappingURL=3362.772c23cc.chunk.js.map