"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[3518],{47991:function(e,n,t){t.d(n,{U:function(){return f}});var r=t(15671),i=t(43144),a=t(29439),u=t(37762),s=t(65156),o=t(376),c=t(66504),l=t(77981),d=t(76335),p=t(92975);function f(e){if(!e)return null;var n=null,t=e.spatialReference,r=(0,p.C5)(t);if(!r)return"toJSON"in e?e.toJSON():e;var i,a=(0,p.sS)(t)?102100:4326,s=d.UZ[a].maxX,f=d.UZ[a].minX,v=d.UZ[a].plus180Line,m=d.UZ[a].minus180Line,x="toJSON"in e?e.toJSON():e;if((0,l.wp)(x))i=y(x,s,f);else if((0,l.aW)(x))x.points=x.points.map((function(e){return y(e,s,f)})),i=x;else if((0,l.YX)(x))i=h(x,r);else if((0,l.oU)(x)||(0,l.l9)(x)){var Z=k;(0,o.$P)(Z,x);var _={xmin:Z[0],ymin:Z[1],xmax:Z[2],ymax:Z[3]},S=(0,d.XZ)(_.xmin,f)*(2*s),w=0===S?x:function(e,n){var t,r=(0,d.x3)(e),i=(0,u.Z)(r);try{for(i.s();!(t=i.n()).done;){var a,s=t.value,o=(0,u.Z)(s);try{for(o.s();!(a=o.n()).done;){a.value[0]+=n}}catch(c){o.e(c)}finally{o.f()}}}catch(c){i.e(c)}finally{i.f()}return e}(x,S);_.xmin+=S,_.xmax+=S,(0,c.jQ)(_,v)&&_.xmax!==s||(0,c.jQ)(_,m)&&_.xmin!==f?n=w:i=w}else i=x;return null!==n?(new g).cut(n,s):i}function h(e,n){if(!n)return e;var t=function(e,n){var t,r=[],i=e.ymin,u=e.ymax,s=e.xmax-e.xmin,o=e.xmin,c=e.xmax,l=(0,a.Z)(n.valid,2),d=l[0],p=l[1],f=(t=v(e.xmin,n)).x,h=t.frameId,y=(t=v(e.xmax,n)).x,x=t.frameId,g=f===y&&s>0;if(s>2*p){var k={xmin:o<c?f:y,ymin:i,xmax:p,ymax:u},Z={xmin:d,ymin:i,xmax:o<c?y:f,ymax:u},_={xmin:0,ymin:i,xmax:p,ymax:u},S={xmin:d,ymin:i,xmax:0,ymax:u},w=[],b=[];m(k,_)&&w.push(h),m(k,S)&&b.push(h),m(Z,_)&&w.push(x),m(Z,S)&&b.push(x);for(var C=h+1;C<x;C++)w.push(C),b.push(C);r.push({extent:k,frameIds:[h]},{extent:Z,frameIds:[x]},{extent:_,frameIds:w},{extent:S,frameIds:b})}else f>y||g?r.push({extent:{xmin:f,ymin:i,xmax:p,ymax:u},frameIds:[h]},{extent:{xmin:d,ymin:i,xmax:y,ymax:u},frameIds:[x]}):r.push({extent:{xmin:f,ymin:i,xmax:y,ymax:u},frameIds:[h]});return r}(e,n).map((function(e){return e.extent}));return t.length<2?t[0]||e:t.length>2?(e.xmin=n.valid[0],e.xmax=n.valid[1],e):{rings:t.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function y(e,n,t){if(Array.isArray(e)){var r=e[0];if(r>n){var i=(0,d.XZ)(r,n);e[0]=r+i*(-2*n)}else if(r<t){var a=(0,d.XZ)(r,t);e[0]=r+a*(-2*t)}}else{var u=e.x;if(u>n){var s=(0,d.XZ)(u,n);e.x+=s*(-2*n)}else if(u<t){var o=(0,d.XZ)(u,t);e.x+=o*(-2*t)}}return e}function v(e,n){var t,r=(0,a.Z)(n.valid,2),i=r[0],u=r[1],s=2*u,o=0;return e>u?(e-=(t=Math.ceil(Math.abs(e-u)/s))*s,o=t):e<i&&(e+=(t=Math.ceil(Math.abs(e-i)/s))*s,o=-t),{x:e,frameId:o}}function m(e,n){var t=n.xmin,r=n.ymin,i=n.xmax,a=n.ymax;return x(e,t,r)&&x(e,t,a)&&x(e,i,a)&&x(e,i,r)}function x(e,n,t){return n>=e.xmin&&n<=e.xmax&&t>=e.ymin&&t<=e.ymax}var g=function(){function e(){(0,r.Z)(this,e)}return(0,i.Z)(e,[{key:"cut",value:function(e,n){var t;if(e.rings)this.closed=!0,t=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,t=e.paths,this.minPts=2}for(var r=t.length,i=-2*n,a=0;a<r;a++){var s=t[a];if(s&&s.length>=this.minPts){var o,c=[],l=(0,u.Z)(s);try{for(l.s();!(o=l.n()).done;){var d=o.value;c.push([d[0]+i,d[1]])}}catch(p){l.e(p)}finally{l.f()}t.push(c)}}return this.closed?e.rings=t:e.paths=t,e}}]),e}(),k=(0,s.Ue)()},33518:function(e,n,t){t.r(n),t.d(n,{GraphicsSnappingSource:function(){return M}});var r=t(4942),i=t(29439),a=t(74165),u=t(15861),s=t(37762),o=t(15671),c=t(43144),l=t(60136),d=t(54062),p=t(27366),f=t(85015),h=t(63780),y=t(41691),v=t(92026),m=t(66978),x=t(49861),g=(t(93169),t(25243),t(69912)),k=t(80885),Z=t(79803),_=t(47991),S=t(27823),w=t(83406),b=t(3182),C=t(68928),I=t(14e3),O=t(64674),P=t(69117),M=function(e){(0,l.Z)(t,e);var n=(0,d.Z)(t);function t(e){var r;return(0,o.Z)(this,t),(r=n.call(this,e)).availability=1,r.sources={multipoint:null,point:null,polygon:null,polyline:null},r.loadedWkids=new Set,r.loadedWkts=new Set,r.pendingAdds=[],r}return(0,c.Z)(t,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"layer",get:function(){return this.layerSource.layer}},{key:"destroy",value:function(){var e=this,n=this.pendingAdds;this.pendingAdds.length=0;var t,r=(0,s.Z)(n);try{for(r.s();!(t=r.n()).done;){t.value.task.abort()}}catch(i){r.e(i)}finally{r.f()}this._mapSources((function(n){return e._destroySource(n)}))}},{key:"initialize",value:function(){var e=this;this.handles.add([this.layer.on("graphic-update",(function(n){return e._onGraphicUpdate(n)})),this.updatingHandles.addOnCollectionChange((function(){return e.layer.graphics}),(function(n){return e._onGraphicsChanged(n)}))]),this._addMany(this.layer.graphics.toArray())}},{key:"fetchCandidates",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,t){var r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.WW)(this._mapSources((function(e){return e.queryEngine.executeQueryForSnapping({point:n.coordinateHelper.vectorToPoint(n.point).toJSON(),distance:n.distance,types:n.types,query:(0,v.pC)(n.filter)?n.filter.createQuery().toJSON():{where:"1=1"}},t).then((function(e){return e.candidates}))})));case 2:return r=e.sent,i=r.flat().map((function(e){return(0,P.X)(e,n.coordinateHelper)})),e.abrupt("return",((0,O.lQ)(n.point,i),i));case 5:case"end":return e.stop()}}),e,this)})));return function(n,t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){}},{key:"_onGraphicUpdate",value:function(e){switch(e.property){case"geometry":case"visible":this._remove(e.graphic),this._addMany([e.graphic])}}},{key:"_onGraphicsChanged",value:function(e){var n,t=(0,s.Z)(e.removed);try{for(t.s();!(n=t.n()).done;){var r=n.value;this._remove(r)}}catch(i){t.e(i)}finally{t.f()}this._addMany(e.added)}},{key:"_addMany",value:function(e){var n,t=[],r=new Map,i=(0,s.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;(0,v.Wi)(a.geometry)||(this._needsInitializeProjection(a.geometry.spatialReference)?(t.push(a.geometry.spatialReference),r.set(a.uid,a)):this._add(a))}}catch(u){i.e(u)}finally{i.f()}this._createPendingAdd(t,r)}},{key:"_createPendingAdd",value:function(e,n){var t=this;if(e.length){var r=(0,m.vr)(function(){var r=(0,u.Z)((0,a.Z)().mark((function r(u){var o,c,l,d;return(0,a.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,Z.iQ)(e.map((function(e){return{source:e,dest:t.spatialReference}})),{signal:u});case 2:t._markLoadedSpatialReferences(e),o=(0,s.Z)(n);try{for(o.s();!(c=o.n()).done;)l=(0,i.Z)(c.value,2),d=l[1],t._add(d)}catch(a){o.e(a)}finally{o.f()}case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());this.updatingHandles.addPromise(r.promise);var o={task:r,graphics:n},c=function(){return(0,h.e$)(t.pendingAdds,o)};r.promise.then(c,c),this.pendingAdds.push(o)}}},{key:"_markLoadedSpatialReferences",value:function(e){var n,t=(0,s.Z)(e);try{for(t.s();!(n=t.n()).done;){var r=n.value;null!=r.wkid&&this.loadedWkids.add(r.wkid),null!=r.wkt&&this.loadedWkts.add(r.wkt)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_add",value:function(e){if(!(0,v.Wi)(e.geometry)&&e.visible){var n=e.geometry;if("mesh"!==n.type){"extent"===n.type&&(n=k.Z.fromExtent(n));var t=this._ensureSource(n.type);if(!(0,v.Wi)(t)){var r=this._createOptimizedFeature(e.uid,n);(0,v.pC)(r)&&t.featureStore.add(r)}}}}},{key:"_needsInitializeProjection",value:function(e){return(null==e.wkid||!this.loadedWkids.has(e.wkid))&&(null==e.wkt||!this.loadedWkts.has(e.wkt))&&!(0,Z.Up)(e,this.spatialReference)}},{key:"_createOptimizedFeature",value:function(e,n){var t=(0,Z.iV)((0,_.U)(n),this.spatialReference);return t?new b.u_((0,w.GH)(t,!1,!1),(0,r.Z)({},W,e),null,e):null}},{key:"_ensureSource",value:function(e){var n=this.sources[e];if((0,v.pC)(n))return n;var t=this._createSource(e);return this.sources[e]=t,t}},{key:"_createSource",value:function(e){var n=S.Mk.toJSON(e),t=new C.Z({geometryType:n,hasZ:!1,hasM:!1});return{featureStore:t,queryEngine:new I.Z({featureStore:t,fields:[{name:W,type:"esriFieldTypeOID",alias:W}],geometryType:n,hasM:!1,hasZ:!1,objectIdField:W,spatialReference:this.spatialReference,scheduler:(0,v.pC)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:e}}},{key:"_remove",value:function(e){var n=this;this._mapSources((function(t){return n._removeFromSource(t,e)}));var t,r=(0,s.Z)(this.pendingAdds);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.graphics.delete(e.uid),0===i.graphics.size&&i.task.abort()}}catch(a){r.e(a)}finally{r.f()}}},{key:"_removeFromSource",value:function(e,n){var t=n.uid;e.featureStore.has(t)&&e.featureStore.removeById(n.uid)}},{key:"_destroySource",value:function(e){e.queryEngine.destroy(),this.sources[e.type]=null}},{key:"_mapSources",value:function(e){var n=this.sources,t=n.point,r=n.polygon,i=n.polyline,a=n.multipoint,u=[];return(0,v.pC)(t)&&u.push(e(t)),(0,v.pC)(r)&&u.push(e(r)),(0,v.pC)(i)&&u.push(e(i)),(0,v.pC)(a)&&u.push(e(a)),u}}]),t}((0,y.p)(f.Z));(0,p._)([(0,x.Cb)({constructOnly:!0})],M.prototype,"spatialReference",void 0),(0,p._)([(0,x.Cb)({constructOnly:!0})],M.prototype,"layerSource",void 0),(0,p._)([(0,x.Cb)({constructOnly:!0})],M.prototype,"view",void 0),(0,p._)([(0,x.Cb)({readOnly:!0})],M.prototype,"updating",null),(0,p._)([(0,x.Cb)({readOnly:!0})],M.prototype,"availability",void 0),M=(0,p._)([(0,g.j)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],M);var W="OBJECTID"},69117:function(e,n,t){t.d(n,{X:function(){return f}});var r=t(95905),i=t(1413),a=t(15671),u=t(43144),s=t(60136),o=t(54062),c=t(95122),l=t(75691),d=t(61309),p=function(e){(0,s.Z)(t,e);var n=(0,o.Z)(t);function t(e){return(0,a.Z)(this,t),n.call(this,(0,i.Z)((0,i.Z)({},e),{},{constraint:new c.Hk(e.coordinateHelper,e.targetPoint)}))}return(0,u.Z)(t,[{key:"hints",get:function(){return[new d.n(this.targetPoint)]}}]),t}(l.a);function f(e,n){switch(e.type){case"edge":return new r.L({coordinateHelper:n,edgeStart:n.pointToVector(e.start),edgeEnd:n.pointToVector(e.end),targetPoint:n.pointToVector(e.target),objectId:e.objectId});case"vertex":return new p({coordinateHelper:n,targetPoint:n.pointToVector(e.target),objectId:e.objectId})}}},61309:function(e,n,t){t.d(n,{n:function(){return o}});var r=t(15671),i=t(43144),a=t(60136),u=t(54062),s=t(64674),o=function(e){(0,a.Z)(t,e);var n=(0,u.Z)(t);function t(e){var i;return(0,r.Z)(this,t),(i=n.call(this)).point=e,i}return(0,i.Z)(t,[{key:"equals",value:function(e){return e instanceof t&&(0,s.Xv)(this.point,e.point)}}]),t}(t(55054).r)}}]);
//# sourceMappingURL=3518.2f09a252.chunk.js.map