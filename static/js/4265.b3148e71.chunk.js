"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[4265],{65630:function(e,t,r){r.d(t,{D:function(){return te},b:function(){return ee}});var n,o,a,i,s,l,c,d,u,m,v,p,f,h,g,x,b,C,y,T=r(30168),M=r(50951),w=r(22357),O=r(83734),A=r(71011),S=r(33280),P=r(94951),H=r(81221),E=r(73782),N=r(52276),R=r(53230),D=r(60113),_=r(48655),L=r(28719),Z=r(49223),I=r(6781),B=r(21002),F=r(38171),z=r(30694),G=r(34975),k=r(15226),V=r(96658),q=r(2116),W=r(41481),U=r(23235),j=r(18607),J=r(10763),$=r(14282),K=r(71033),X=r(98634),Q=r(64201),Y=r(4760);function ee(e){var t=new Q.kG,r=t.vertex.code,ee=t.fragment.code;t.include($.a,{name:"Default Material Shader",output:e.output}),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3");var te=e.hasModelTransformation;return te&&t.vertex.uniforms.add("model","mat4"),t.include(N.f),t.varyings.add("vpos","vec3"),t.include(j.kl,e),t.include(H.fQ,e),t.include(Z.LC,e),e.output!==A.H.Color&&e.output!==A.H.Alpha||(t.include(E.O,e),t.include(P.w,{linearDepth:!1,hasModelTransformation:te}),e.normalType===E.h.Attribute&&e.offsetBackfaces&&t.include(O.w),t.include(F.Q,e),t.include(L.B,e),e.instancedColor&&t.attributes.add(Y.T.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(D.D,e),t.include(w.q,e),t.include(R.R,e),t.include(_.c,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r.add((0,X.H)(n||(n=(0,T.Z)(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt = externalColor;\n        ","\n        vcolorExt *= vvColor();\n        vcolorExt *= getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a < ",") {\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos = calculateVPos();\n          localvpos = vpos - view[3].xyz;\n          vpos = subtractOrigin(vpos);\n          ","\n          vpos = addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position = transformPosition(proj, view, "," vpos);\n          ","\n        }\n\n        ","\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),e.instancedColor?"vcolorExt *= instanceColor;":"",X.H.float(J.bf),e.normalType===E.h.Attribute?(0,X.H)(o||(o=(0,T.Z)(["\n          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));"]))):"",e.vertexTangents?"vTangent = dpTransformVertexTangent(tangent);":"",te?"model,":"",e.normalType===E.h.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":"",e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":""))),e.output===A.H.Alpha&&(t.include(S.p2,e),t.include(J.sj,e),e.multipassTerrainEnabled&&(t.fragment.include(B.S),t.include(k.l,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(K.y),ee.add((0,X.H)(a||(a=(0,T.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?(0,X.H)(i||(i=(0,T.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,X.H)(s||(s=(0,T.Z)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?(0,X.H)(l||(l=(0,T.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,X.H)(c||(c=(0,T.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),e.output===A.H.Color&&(t.include(S.p2,e),t.include(G.X,e),t.include(z.K,e),t.include(J.sj,e),e.receiveShadows&&t.include(U.hX,e),e.multipassTerrainEnabled&&(t.fragment.include(B.S),t.include(k.l,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(W.jV,e),t.include(q.T,e),t.fragment.include(K.y),t.include(V.k,e),ee.add((0,X.H)(d||(d=(0,T.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        shadingParams.viewDirection = normalize(vpos - cameraPosition);\n        ","\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.hasColorTexture?(0,X.H)(u||(u=(0,T.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,X.H)(m||(m=(0,T.Z)(["vec4 texColor = vec4(1.0);"]))),e.normalType===E.h.ScreenDerivative?(0,X.H)(v||(v=(0,T.Z)(["\n        vec3 normal = screenDerivativeNormal(localvpos);"]))):(0,X.H)(p||(p=(0,T.Z)(["\n        shadingParams.normalView = vNormalWorld;\n        vec3 normal = shadingNormal(shadingParams);"]))),e.pbrMode===W.f7.Normal?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.viewingMode===M.JY.Global?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?(0,X.H)(f||(f=(0,T.Z)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,X.H)(h||(h=(0,T.Z)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),e.hasNormalTexture?(0,X.H)(g||(g=(0,T.Z)(["\n              mat3 tangentSpace = ","\n              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);"])),e.vertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal = normal;",e.pbrMode===W.f7.Normal||e.pbrMode===W.f7.Schematic?e.viewingMode===M.JY.Global?(0,X.H)(x||(x=(0,T.Z)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):(0,X.H)(b||(b=(0,T.Z)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):(0,X.H)(C||(C=(0,T.Z)([""]))),e.pbrMode===W.f7.Normal||e.pbrMode===W.f7.Schematic?(0,X.H)(y||(y=(0,T.Z)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(I.s,e),t}var te=Object.freeze({__proto__:null,build:ee})},40563:function(e,t,r){r.d(t,{R:function(){return X},b:function(){return K}});var n,o,a,i,s,l,c,d,u,m,v,p,f,h,g,x,b,C,y,T=r(30168),M=r(50951),w=r(22357),O=r(83734),A=r(71011),S=r(33280),P=r(94951),H=r(81221),E=r(73782),N=r(52276),R=r(53230),D=r(60113),_=r(48655),L=r(49223),Z=r(6781),I=r(21002),B=r(30694),F=r(34975),z=r(15226),G=r(2116),k=r(41481),V=r(23235),q=r(18607),W=r(10763),U=r(71033),j=r(98634),J=r(64201),$=r(4760);function K(e){var t=new J.kG,r=t.vertex.code,K=t.fragment.code;return t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("cameraPosition","vec3").add("localOrigin","vec3"),t.include(N.f),t.varyings.add("vpos","vec3"),t.include(q.kl,e),t.include(H.fQ,e),t.include(L.LC,e),e.output!==A.H.Color&&e.output!==A.H.Alpha||(t.include(E.O,e),t.include(P.w,{linearDepth:!1}),e.offsetBackfaces&&t.include(O.w),e.instancedColor&&t.attributes.add($.T.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.include(D.D,e),t.include(w.q,e),t.include(R.R,e),t.include(_.c,e),t.vertex.uniforms.add("externalColor","vec4"),t.varyings.add("vcolorExt","vec4"),r.add((0,j.H)(n||(n=(0,T.Z)(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt = externalColor;\n          ","\n          vcolorExt *= vvColor();\n          vcolorExt *= getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a < ",") {\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos = calculateVPos();\n            localvpos = vpos - view[3].xyz;\n            vpos = subtractOrigin(vpos);\n            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));\n            vpos = addVerticalOffset(vpos, localOrigin);\n            gl_Position = transformPosition(proj, view, vpos);\n            ","\n          }\n          ","\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),e.instancedColor?"vcolorExt *= instanceColor;":"",j.H.float(W.bf),e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":"",e.multipassTerrainEnabled?(0,j.H)(o||(o=(0,T.Z)(["depth = (view * vec4(vpos, 1.0)).z;"]))):""))),e.output===A.H.Alpha&&(t.include(S.p2,e),t.include(W.sj,e),e.multipassTerrainEnabled&&(t.fragment.include(I.S),t.include(z.l,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.fragment.include(U.y),K.add((0,j.H)(a||(a=(0,T.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        ","\n\n        gl_FragColor = vec4(opacity_);\n      }\n    "])),e.multipassTerrainEnabled?(0,j.H)(i||(i=(0,T.Z)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?(0,j.H)(s||(s=(0,T.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,j.H)(l||(l=(0,T.Z)(["vec4 texColor = vec4(1.0);"]))),e.attributeColor?(0,j.H)(c||(c=(0,T.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,j.H)(d||(d=(0,T.Z)(["\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "])))))),e.output===A.H.Color&&(t.include(S.p2,e),t.include(F.X,e),t.include(B.K,e),t.include(W.sj,e),e.receiveShadows&&t.include(V.hX,e),e.multipassTerrainEnabled&&(t.fragment.include(I.S),t.include(z.l,e)),t.fragment.uniforms.add("cameraPosition","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),t.fragment.uniforms.add("view","mat4"),e.hasColorTexture&&t.fragment.uniforms.add("tex","sampler2D"),t.include(k.jV,e),t.include(G.T,e),t.fragment.include(U.y),K.add((0,j.H)(u||(u=(0,T.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        ","\n        vec3 viewDirection = normalize(vpos - cameraPosition);\n        ","\n        float ssao = evaluateAmbientOcclusionInverse();\n        ssao *= getBakedOcclusion();\n\n        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);\n        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ","\n        vec3 matColor = max(ambient, diffuse);\n        ","\n        ","\n        ","\n        ","\n        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?(0,j.H)(m||(m=(0,T.Z)(["terrainDepthTest(gl_FragCoord, depth);"]))):"",e.hasColorTexture?(0,j.H)(v||(v=(0,T.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""):(0,j.H)(p||(p=(0,T.Z)(["vec4 texColor = vec4(1.0);"]))),e.pbrMode===k.f7.Normal?"applyPBRFactors();":"",e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.viewingMode===M.JY.Global?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;",e.attributeColor?(0,j.H)(f||(f=(0,T.Z)(["\n        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):(0,j.H)(h||(h=(0,T.Z)(["\n        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n        "]))),(0,j.H)(g||(g=(0,T.Z)(["\n        vec3 shadedNormal = normalize(vNormalWorld);\n        albedo_ *= 1.2;\n        vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);\n        float transmittance = 1.0 - clamp(dot(viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff = vColor.r;\n        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight += backLightFactor * lightingMainIntensity;"]))),e.pbrMode===k.f7.Normal||e.pbrMode===k.f7.Schematic?e.viewingMode===M.JY.Global?(0,j.H)(x||(x=(0,T.Z)(["vec3 normalGround = normalize(vpos + localOrigin);"]))):(0,j.H)(b||(b=(0,T.Z)(["vec3 normalGround = vec3(0.0, 0.0, 1.0);"]))):(0,j.H)(C||(C=(0,T.Z)([""]))),e.pbrMode===k.f7.Normal||e.pbrMode===k.f7.Schematic?(0,j.H)(y||(y=(0,T.Z)(["\n            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);"]))):"vec3 shadedColor = evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);",e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t.include(Z.s,e),t}var X=Object.freeze({__proto__:null,build:K})},32035:function(e,t,r){r.d(t,{a:function(){return a},b:function(){return l},n:function(){return s},s:function(){return i},t:function(){return o}});var n=r(77873);function o(e,t,r){if(e.count===t.count)for(var o=e.count,a=r[0],i=r[1],s=r[2],l=r[4],c=r[5],d=r[6],u=r[8],m=r[9],v=r[10],p=r[12],f=r[13],h=r[14],g=e.typedBuffer,x=e.typedBufferStride,b=t.typedBuffer,C=t.typedBufferStride,y=0;y<o;y++){var T=y*x,M=y*C,w=b[M],O=b[M+1],A=b[M+2];g[T]=a*w+l*O+u*A+p,g[T+1]=i*w+c*O+m*A+f,g[T+2]=s*w+d*O+v*A+h}else n.c.error("source and destination buffers need to have the same number of elements")}function a(e,t,r){if(e.count===t.count)for(var o=e.count,a=r[0],i=r[1],s=r[2],l=r[3],c=r[4],d=r[5],u=r[6],m=r[7],v=r[8],p=e.typedBuffer,f=e.typedBufferStride,h=t.typedBuffer,g=t.typedBufferStride,x=0;x<o;x++){var b=x*f,C=x*g,y=h[C],T=h[C+1],M=h[C+2];p[b]=a*y+l*T+u*M,p[b+1]=i*y+c*T+m*M,p[b+2]=s*y+d*T+v*M}else n.c.error("source and destination buffers need to have the same number of elements")}function i(e,t,r){for(var n=Math.min(e.count,t.count),o=e.typedBuffer,a=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*a,d=l*s;o[c]=r*i[d],o[c+1]=r*i[d+1],o[c+2]=r*i[d+2]}}function s(e,t){for(var r=Math.min(e.count,t.count),n=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,i=t.typedBufferStride,s=0;s<r;s++){var l=s*o,c=s*i,d=a[c],u=a[c+1],m=a[c+2],v=Math.sqrt(d*d+u*u+m*m);if(v>0){var p=1/v;n[l]=p*d,n[l+1]=p*u,n[l+2]=p*m}}}function l(e,t,r){for(var n=Math.min(e.count,t.count),o=e.typedBuffer,a=e.typedBufferStride,i=t.typedBuffer,s=t.typedBufferStride,l=0;l<n;l++){var c=l*a,d=l*s;o[c]=i[d]>>r,o[c+1]=i[d+1]>>r,o[c+2]=i[d+2]>>r}}Object.freeze({__proto__:null,transformMat4:o,transformMat3:a,scale:i,normalize:s,shiftRight:l})},92770:function(e,t,r){function n(e,t,r){for(var n=e.typedBuffer,o=e.typedBufferStride,a=t.typedBuffer,i=t.typedBufferStride,s=r?r.count:t.count,l=(r&&r.dstIndex?r.dstIndex:0)*o,c=(r&&r.srcIndex?r.srcIndex:0)*i,d=0;d<s;++d)n[l]=a[c],n[l+1]=a[c+1],n[l+2]=a[c+2],l+=o,c+=i}function o(e,t,r,n,o){for(var a,i,s=e.typedBuffer,l=e.typedBufferStride,c=null!=(a=null==o?void 0:o.count)?a:e.count,d=(null!=(i=null==o?void 0:o.dstIndex)?i:0)*l,u=0;u<c;++u)s[d]=t,s[d+1]=r,s[d+2]=n,d+=l}r.d(t,{c:function(){return n},f:function(){return o}});Object.freeze({__proto__:null,copy:n,fill:o})},71277:function(e,t,r){function n(e){return e=e||globalThis.location.hostname,c.some((function(t){var r;return null!=(null==(r=e)?void 0:r.match(t))}))}function o(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(s)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(i)||null!=t.match(l)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}r.d(t,{XO:function(){return n},pJ:function(){return o}});var a=/^devext.arcgis.com$/,i=/^qaext.arcgis.com$/,s=/^[\w-]*\.mapsdevext.arcgis.com$/,l=/^[\w-]*\.mapsqa.arcgis.com$/,c=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,i,/^jsapps.esri.com$/,s,l]},77873:function(e,t,r){r.d(t,{c:function(){return n}});var n=r(32718).Z.getLogger("esri.views.3d.support.buffer.math")},4265:function(e,t,r){r.r(t),r.d(t,{fetch:function(){return re},gltfToEngineResources:function(){return ae},parseUrl:function(){return oe}});var n=r(74165),o=r(37762),a=r(1413),i=r(15861),s=r(71277),l=r(92026),c=r(22753),d=r(11873),u=r(14226),m=r(81949),v=r(11186),p=r(71353),f=r(41414),h=r(25158),g=r(32035),x=r(19093),b=r(17054),C=r(27053),y=r(55798),T=r(32315),M=r(76200),w=r(14921),O=r(10064),A=r(32718),S=r(66978),P=r(49901),H=r(38330),E=r(68401),N=r(74894),R=r(76873),D=r(10052),_=r(8548),L=A.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function Z(e,t){return I.apply(this,arguments)}function I(){return(I=(0,i.Z)((0,n.Z)().mark((function e(t,r){var o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,r);case 2:return o=e.sent,e.t0=o,e.next=6,U(o.textureDefinitions,r);case 6:return e.t1=e.sent,e.abrupt("return",{resource:e.t0,textures:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return F.apply(this,arguments)}function F(){return(F=(0,i.Z)((0,n.Z)().mark((function e(t,r){var o,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=(0,l.pC)(r)&&r.streamDataRequester)){e.next=3;break}return e.abrupt("return",z(t,o,r));case 3:return e.next=5,(0,w.q6)((0,M.default)(t,(0,l.Wg)(r)));case 5:if(!0!==(a=e.sent).ok){e.next=8;break}return e.abrupt("return",a.value.data);case 8:(0,S.r9)(a.error),k(a.error);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,r){return G.apply(this,arguments)}function G(){return(G=(0,i.Z)((0,n.Z)().mark((function e(t,r,o){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.q6)(r.request(t,"json",o));case 2:if(!0!==(a=e.sent).ok){e.next=5;break}return e.abrupt("return",a.value);case 5:(0,S.r9)(a.error),k(a.error.details.url);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){throw new O.Z("","Request for object resource failed: ".concat(e))}function V(e){var t=e.params,r=t.topology,n=!0;switch(t.vertexAttributes||(L.warn("Geometry must specify vertex attributes"),n=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:var o=t.faces;if(o){if(t.vertexAttributes)for(var a in t.vertexAttributes){var i=o[a];i&&i.values?(null!=i.valueType&&"UInt32"!==i.valueType&&(L.warn("Unsupported indexed geometry indices type '".concat(i.valueType,"', only UInt32 is currently supported")),n=!1),null!=i.valuesPerElement&&1!==i.valuesPerElement&&(L.warn("Unsupported indexed geometry values per element '".concat(i.valuesPerElement,"', only 1 is currently supported")),n=!1)):(L.warn("Indexed geometry does not specify face indices for '".concat(a,"' attribute")),n=!1)}}else L.warn("Indexed geometries must specify faces"),n=!1;break;default:L.warn("Unsupported topology '".concat(r,"'")),n=!1}e.params.material||(L.warn("Geometry requires material"),n=!1);var s=e.params.vertexAttributes;for(var l in s)s[l].values||(L.warn("Geometries with externally defined attributes are not yet supported"),n=!1);return n}function q(e,t){var r=[],n=[],o=[],a=[],i=e.resource,s=P.G.parse(i.version||"1.0","wosr");K.validate(s);for(var c=i.model.name,d=i.model.geometries,u=i.materialDefinitions,m=e.textures,v=0,f=new Map,h=0;h<d.length;h++){var g=d[h];if(V(g)){var x=$(g),b=g.params.vertexAttributes,C=[];for(var y in b){var T=b[y],M=T.values;C.push([y,{data:M,size:T.valuesPerElement,exclusive:!0}])}var w=[];if("PerAttributeArray"!==g.params.topology){var O=g.params.faces;for(var A in O)w.push([A,new Uint32Array(O[A].values)])}var S=m&&m[x.texture];if(S&&!f.has(x.texture)){var H=S.image,_=S.params,L=new R.x(H,_);a.push(L),f.set(x.texture,L)}var Z=f.get(x.texture),I=Z?Z.id:void 0,B=o[x.material]?o[x.material][x.texture]:null;if(!B){var F=u[x.material.substring(x.material.lastIndexOf("/")+1)].params;1===F.transparency&&(F.transparency=0);var z=S&&S.alphaChannelUsage,G=F.transparency>0||"transparency"===z||"maskAndTransparency"===z,k=S?J(S.alphaChannelUsage):void 0,q={ambient:(0,p.d)(F.diffuse),diffuse:(0,p.d)(F.diffuse),opacity:1-(F.transparency||0),transparent:G,textureAlphaMode:k,textureAlphaCutoff:.33,textureId:I,initTextureTransparent:!0,doubleSided:!0,cullFace:E.Vr.None,colorMixMode:F.externalColorMixMode||"tint",textureAlphaPremultiplied:!!S&&!!S.params.preMultiplyAlpha};(0,l.pC)(t)&&t.materialParamsMixin&&Object.assign(q,t.materialParamsMixin),B=new D.G(q),o[x.material]||(o[x.material]={}),o[x.material][x.texture]=B}n.push(B);var U=new N.Z(C,w);v+=w.position?w.position.length:0,r.push(U)}}return{name:c,stageResources:{textures:a,materials:n,geometries:r},pivotOffset:i.model.pivotOffset,boundingBox:W(r),numberOfVertices:v,lodThreshold:null}}function W(e){var t=(0,f.cS)();return e.forEach((function(e){var r=e.boundingInfo;(0,l.pC)(r)&&((0,f.pp)(t,r.getBBMin()),(0,f.pp)(t,r.getBBMax()))})),t}function U(e,t){return j.apply(this,arguments)}function j(){return(j=(0,i.Z)((0,n.Z)().mark((function e(t,r){var a,i,s,c,d,u,m,v;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],i=function(e){var n=t[e],o=n.images[0].data;if(!o)return L.warn("Externally referenced texture data is not yet supported"),"continue";var i=n.encoding+";base64,"+o,s="/textureDefinitions/"+e,c="rgba"===n.channels?n.alphaChannelUsage||"transparency":"none",d={noUnpackFlip:!0,wrap:{s:_.e8.REPEAT,t:_.e8.REPEAT},preMultiplyAlpha:J(c)!==E.JJ.Opaque},u=(0,l.pC)(r)&&r.disableTextures?Promise.resolve(null):(0,H.t)(i,r);a.push(u.then((function(e){return{refId:s,image:e,params:d,alphaChannelUsage:c}})))},e.t0=(0,n.Z)().keys(t);case 3:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,"continue"!==i(s)){e.next=8;break}return e.abrupt("continue",3);case 8:e.next=3;break;case 10:return e.next=12,Promise.all(a);case 12:c=e.sent,d={},u=(0,o.Z)(c);try{for(u.s();!(m=u.n()).done;)v=m.value,d[v.refId]=v}catch(p){u.e(p)}finally{u.f()}return e.abrupt("return",d);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){switch(e){case"mask":return E.JJ.Mask;case"maskAndTransparency":return E.JJ.MaskBlend;case"none":return E.JJ.Opaque;default:return E.JJ.Blend}}function $(e){var t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}var K=new P.G(1,2,"wosr"),X=r(4760),Q=r(68845),Y=r(19131),ee=r(69618),te=r(92770);function re(e,t){return ne.apply(this,arguments)}function ne(){return(ne=(0,i.Z)((0,n.Z)().mark((function e(t,r){var o,i,c,d,u,m,v,p,f,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("wosr"!==(o=oe((0,s.pJ)(t))).fileType){e.next=7;break}return e.next=4,r.cache?r.cache.loadWOSR(o.url,r):Z(o.url,r);case 4:return i=e.sent,c=q(i,r),e.abrupt("return",{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:i.remove});case 7:return e.next=9,r.cache?r.cache.loadGLTF(o.url,r,r.usePBR):(0,y.z)(new C.C(r.streamDataRequester),o.url,r,r.usePBR);case 9:if(d=e.sent,u=(0,l.U2)(d.model.meta,"ESRI_proxyEllipsoid"),d.meta.isEsriSymbolResource&&(0,l.pC)(u)&&-1!==d.meta.uri.indexOf("/RealisticTrees/")&&ie(d,u),m=d.meta.isEsriSymbolResource?{usePBR:r.usePBR,isSchematic:!1,treeRendering:d.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:r.usePBR,isSchematic:!1,mrrFactors:[0,1,.5]},v=(0,a.Z)((0,a.Z)({},r.materialParamsMixin),{},{treeRendering:d.customMeta.esriTreeRendering}),null==o.specifiedLodIndex){e.next=18;break}return p=ae(d,m,v,o.specifiedLodIndex),f=p[0].boundingBox,0!==o.specifiedLodIndex&&(f=ae(d,m,v,0)[0].boundingBox),e.abrupt("return",{lods:p,referenceBoundingBox:f,isEsriSymbolResource:d.meta.isEsriSymbolResource,isWosr:!1,remove:d.remove});case 18:return h=ae(d,m,v),e.abrupt("return",{lods:h,referenceBoundingBox:h[0].boundingBox,isEsriSymbolResource:d.meta.isEsriSymbolResource,isWosr:!1,remove:d.remove});case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oe(e){var t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:null!=t[4]?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function ae(e,t,r,n){var o=e.model,i=(0,d.c)(),s=new Array,u=new Map,m=new Map;return o.lods.forEach((function(e,d){if(void 0===n||d===n){var v={name:e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:(0,l.pC)(e.lodThreshold)?e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:(0,f.cS)()};s.push(v),e.parts.forEach((function(e){var n=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),s=o.materials.get(e.material),d=(0,l.pC)(e.attributes.texCoord0),p=(0,l.pC)(e.attributes.normal),C=function(e){switch(e){case"BLEND":return E.JJ.Blend;case"MASK":return E.JJ.Mask;case"OPAQUE":case null:case void 0:return E.JJ.Opaque}}(s.alphaMode);if(!u.has(n)){if(d){if((0,l.pC)(s.textureColor)&&!m.has(s.textureColor)){var y=o.textures.get(s.textureColor),M=(0,a.Z)((0,a.Z)({},y.parameters),{},{preMultiplyAlpha:C!==E.JJ.Opaque});m.set(s.textureColor,new R.x(y.data,M))}if((0,l.pC)(s.textureNormal)&&!m.has(s.textureNormal)){var w=o.textures.get(s.textureNormal);m.set(s.textureNormal,new R.x(w.data,w.parameters))}if((0,l.pC)(s.textureOcclusion)&&!m.has(s.textureOcclusion)){var O=o.textures.get(s.textureOcclusion);m.set(s.textureOcclusion,new R.x(O.data,O.parameters))}if((0,l.pC)(s.textureEmissive)&&!m.has(s.textureEmissive)){var A=o.textures.get(s.textureEmissive);m.set(s.textureEmissive,new R.x(A.data,A.parameters))}if((0,l.pC)(s.textureMetallicRoughness)&&!m.has(s.textureMetallicRoughness)){var S=o.textures.get(s.textureMetallicRoughness);m.set(s.textureMetallicRoughness,new R.x(S.data,S.parameters))}}var P=Math.pow(s.color[0],1/Q.K),H=Math.pow(s.color[1],1/Q.K),L=Math.pow(s.color[2],1/Q.K),Z=Math.pow(s.emissiveFactor[0],1/Q.K),I=Math.pow(s.emissiveFactor[1],1/Q.K),B=Math.pow(s.emissiveFactor[2],1/Q.K),F=(0,l.pC)(s.textureColor)&&d?m.get(s.textureColor):null;u.set(n,new D.G((0,a.Z)((0,a.Z)({},t),{},{transparent:C===E.JJ.Blend,customDepthTest:E.Gv.Lequal,textureAlphaMode:C,textureAlphaCutoff:s.alphaCutoff,diffuse:[P,H,L],ambient:[P,H,L],opacity:s.opacity,doubleSided:s.doubleSided,doubleSidedType:"winding-order",cullFace:s.doubleSided?E.Vr.None:E.Vr.Back,vertexColors:!!e.attributes.color,vertexTangents:!!e.attributes.tangent,normals:p?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,fillLightsEnabled:!0,textureId:(0,l.pC)(F)?F.id:void 0,colorMixMode:s.colorMixMode,normalTextureId:(0,l.pC)(s.textureNormal)&&d?m.get(s.textureNormal).id:void 0,textureAlphaPremultiplied:(0,l.pC)(F)&&!!F.params.preMultiplyAlpha,occlusionTextureId:(0,l.pC)(s.textureOcclusion)&&d?m.get(s.textureOcclusion).id:void 0,emissiveTextureId:(0,l.pC)(s.textureEmissive)&&d?m.get(s.textureEmissive).id:void 0,metallicRoughnessTextureId:(0,l.pC)(s.textureMetallicRoughness)&&d?m.get(s.textureMetallicRoughness).id:void 0,emissiveFactor:[Z,I,B],mrrFactors:[s.metallicFactor,s.roughnessFactor,t.mrrFactors[2]],isSchematic:!1},r)))}var z=function(e,t){switch(t){case _.MX.TRIANGLES:return(0,T.nh)(e);case _.MX.TRIANGLE_STRIP:return(0,T.DA)(e);case _.MX.TRIANGLE_FAN:return(0,T.jX)(e)}}(e.indices||e.attributes.position.count,e.primitiveType),G=e.attributes.position.count,k=(0,b.gS)(h.ct,G);(0,g.t)(k,e.attributes.position,e.transform);var V=[[X.T.POSITION,{data:k.typedBuffer,size:k.elementCount,exclusive:!0}]],q=[[X.T.POSITION,z]];if((0,l.pC)(e.attributes.normal)){var W=(0,b.gS)(h.ct,G);(0,c.a)(i,e.transform),(0,g.a)(W,e.attributes.normal,i),V.push([X.T.NORMAL,{data:W.typedBuffer,size:W.elementCount,exclusive:!0}]),q.push([X.T.NORMAL,z])}if((0,l.pC)(e.attributes.tangent)){var U=(0,b.gS)(h.ek,G);(0,c.a)(i,e.transform),(0,x.t)(U,e.attributes.tangent,i),V.push([X.T.TANGENT,{data:U.typedBuffer,size:U.elementCount,exclusive:!0}]),q.push([X.T.TANGENT,z])}if((0,l.pC)(e.attributes.texCoord0)){var j=(0,b.gS)(h.Eu,G);(0,Y.n)(j,e.attributes.texCoord0),V.push([X.T.UV0,{data:j.typedBuffer,size:j.elementCount,exclusive:!0}]),q.push([X.T.UV0,z])}if((0,l.pC)(e.attributes.color)){var J=(0,b.gS)(h.mc,G);if(4===e.attributes.color.elementCount)e.attributes.color instanceof h.ek?(0,x.s)(J,e.attributes.color,255):e.attributes.color instanceof h.mc?(0,ee.c)(J,e.attributes.color):e.attributes.color instanceof h.v6&&(0,x.s)(J,e.attributes.color,1/256);else{(0,ee.f)(J,255,255,255,255);var $=new h.ne(J.buffer,0,4);e.attributes.color instanceof h.ct?(0,g.s)($,e.attributes.color,255):e.attributes.color instanceof h.ne?(0,te.c)($,e.attributes.color):e.attributes.color instanceof h.mw&&(0,g.s)($,e.attributes.color,1/256)}V.push([X.T.COLOR,{data:J.typedBuffer,size:J.elementCount,exclusive:!0}]),q.push([X.T.COLOR,z])}var K=new N.Z(V,q);v.stageResources.geometries.push(K),v.stageResources.materials.push(u.get(n)),d&&((0,l.pC)(s.textureColor)&&v.stageResources.textures.push(m.get(s.textureColor)),(0,l.pC)(s.textureNormal)&&v.stageResources.textures.push(m.get(s.textureNormal)),(0,l.pC)(s.textureOcclusion)&&v.stageResources.textures.push(m.get(s.textureOcclusion)),(0,l.pC)(s.textureEmissive)&&v.stageResources.textures.push(m.get(s.textureEmissive)),(0,l.pC)(s.textureMetallicRoughness)&&v.stageResources.textures.push(m.get(s.textureMetallicRoughness))),v.numberOfVertices+=G;var re=K.boundingInfo;(0,l.pC)(re)&&((0,f.pp)(v.boundingBox,re.getBBMin()),(0,f.pp)(v.boundingBox,re.getBBMax()))}))}})),s}function ie(e,t){for(var r=0;r<e.model.lods.length;++r){var n=e.model.lods[r];e.customMeta.esriTreeRendering=!0;var a,i=(0,o.Z)(n.parts);try{for(i.s();!(a=i.n()).done;){var s=a.value,c=s.attributes.normal;if((0,l.Wi)(c))return;for(var d=s.attributes.position,f=d.count,g=(0,p.c)(),x=(0,p.c)(),C=(0,p.c)(),y=(0,b.gS)(h.mc,f),T=(0,b.gS)(h.ct,f),M=(0,u.a)((0,m.c)(),s.transform),w=0;w<f;w++){d.getVec(w,x),c.getVec(w,g),(0,v.m)(x,x,s.transform),(0,v.f)(C,x,t.center),(0,v.E)(C,C,t.radius);var O=C[2],A=(0,v.l)(C),S=Math.min(.45+.55*A*A,1);(0,v.E)(C,C,t.radius),(0,v.m)(C,C,M),(0,v.n)(C,C),r+1!==e.model.lods.length&&e.model.lods.length>1&&(0,v.e)(C,C,g,O>-1?.2:Math.min(-4*O-3.8,1)),T.setVec(w,C),y.set(w,0,255*S),y.set(w,1,255*S),y.set(w,2,255*S),y.set(w,3,255)}s.attributes.normal=T,s.attributes.color=y}}catch(P){i.e(P)}finally{i.f()}}}},49420:function(e,t,r){r.d(t,{F5:function(){return s},HB:function(){return l},a9:function(){return n}});var n,o,a=r(16889),i=r(92026);function s(e){switch(e){case"multiply":default:return n.Multiply;case"ignore":return n.Ignore;case"replace":return n.Replace;case"tint":return n.Tint}}function l(e,t,r){if((0,i.Wi)(e)||t===n.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);var o=(0,a.uZ)(Math.round(e[3]*d),0,d),s=0===o||t===n.Tint?0:t===n.Replace?u:m;r[0]=(0,a.uZ)(Math.round(e[0]*c),0,c),r[1]=(0,a.uZ)(Math.round(e[1]*c),0,c),r[2]=(0,a.uZ)(Math.round(e[2]*c),0,c),r[3]=o+s}(o=n||(n={}))[o.Multiply=1]="Multiply",o[o.Ignore=2]="Ignore",o[o.Replace=3]="Replace",o[o.Tint=4]="Tint";var c=255,d=85,u=d,m=2*d},83734:function(e,t,r){r.d(t,{w:function(){return i}});var n,o=r(30168),a=r(98634);function i(e){e.vertex.code.add((0,a.H)(n||(n=(0,o.Z)(["vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\nvec3 camToVert = posWorld - camPosWorld;\nbool isBackface = dot(camToVert, normalWorld) > 0.0;\nif (isBackface) {\nposClip.z += 0.0000003 * posClip.w;\n}\nreturn posClip;\n}"]))))}},81221:function(e,t,r){r.d(t,{d3:function(){return x},fQ:function(){return g}});var n,o,a,i,s,l,c,d=r(30168),u=r(71353),m=r(71011),v=r(27254),p=r(98634),f=r(4760),h=r(43411);function g(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(f.T.MODELORIGINHI,"vec3"),e.attributes.add(f.T.MODELORIGINLO,"vec3"),e.attributes.add(f.T.MODEL,"mat3"),e.attributes.add(f.T.MODELNORMAL,"mat3")),t.instancedDoublePrecision&&(e.vertex.include(v.$,t),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));var r=[(0,p.H)(n||(n=(0,d.Z)(["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"),(0,p.H)(o||(o=(0,d.Z)(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?(0,p.H)(a||(a=(0,d.Z)(["\n          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),(0,p.H)(i||(i=(0,d.Z)(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"),(0,p.H)(s||(s=(0,d.Z)(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"),t.vertexTangents?(0,p.H)(l||(l=(0,d.Z)(["\n    vec4 dpTransformVertexTangent(vec4 _tangent) {\n      ","\n\n    }\n    "])),t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"):(0,p.H)(c||(c=(0,d.Z)([""])))];e.vertex.code.add(r[0]),e.vertex.code.add(r[1]),e.vertex.code.add(r[2]),t.output===m.H.Normal&&e.vertex.code.add(r[3]),e.vertex.code.add(r[4])}function x(e,t){(0,h.po)(t,b,C,3),e.setUniform3fv("viewOriginHi",b),e.setUniform3fv("viewOriginLo",C)}var b=(0,u.c)(),C=(0,u.c)()},73782:function(e,t,r){r.d(t,{O:function(){return m},h:function(){return d}});var n,o=r(30168),a=r(98634);function i(e){var t=(0,a.H)(n||(n=(0,o.Z)(["vec3 decodeNormal(vec2 f) {\nfloat z = 1.0 - abs(f.x) - abs(f.y);\nreturn vec3(f + sign(f) * min(z, 0.0), z);\n}"])));e.fragment.code.add(t),e.vertex.code.add(t)}var s,l,c,d,u=r(4760);function m(e,t){t.normalType===d.Attribute&&(e.attributes.add(u.T.NORMAL,"vec3"),e.vertex.code.add((0,a.H)(s||(s=(0,o.Z)(["vec3 normalModel() {\nreturn normal;\n}"]))))),t.normalType===d.CompressedAttribute&&(e.include(i),e.attributes.add(u.T.NORMALCOMPRESSED,"vec2"),e.vertex.code.add((0,a.H)(l||(l=(0,o.Z)(["vec3 normalModel() {\nreturn decodeNormal(normalCompressed);\n}"]))))),t.normalType===d.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add((0,a.H)(c||(c=(0,o.Z)(["vec3 screenDerivativeNormal(vec3 positionView) {\nreturn normalize(cross(dFdx(positionView), dFdy(positionView)));\n}"])))))}!function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"}(d||(d={}))},52276:function(e,t,r){r.d(t,{f:function(){return s}});var n,o=r(30168),a=r(98634),i=r(4760);function s(e){e.attributes.add(i.T.POSITION,"vec3"),e.vertex.code.add((0,a.H)(n||(n=(0,o.Z)(["vec3 positionModel() { return position; }"]))))}},53230:function(e,t,r){r.d(t,{R:function(){return u}});var n,o=r(30168),a=r(49420),i=r(98634);function s(e){e.vertex.code.add((0,i.H)(n||(n=(0,o.Z)(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha = 0.0;\n\n      const float maxTint = 85.0;\n      const float maxReplace = 170.0;\n      const float scaleAlpha = 3.0;\n\n      if (symbolColor.a > maxReplace) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a > maxTint) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a > 0.0) {\n        colorMixMode = ",";\n        symbolAlpha = scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode = ",";\n        symbolAlpha = 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),i.H.int(a.a9.Multiply),i.H.int(a.a9.Replace),i.H.int(a.a9.Tint),i.H.int(a.a9.Multiply)))}var l,c,d=r(4760);function u(e,t){t.symbolColor?(e.include(s),e.attributes.add(d.T.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float")):e.fragment.uniforms.add("colorMixMode","int"),t.symbolColor?e.vertex.code.add((0,i.H)(l||(l=(0,o.Z)(["int symbolColorMixMode;\nvec4 getSymbolColor() {\nreturn decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n}\nvoid forwardColorMixMode() {\ncolorMixMode = float(symbolColorMixMode) + 0.5;\n}"])))):e.vertex.code.add((0,i.H)(c||(c=(0,o.Z)(["vec4 getSymbolColor() { return vec4(1.0); }\nvoid forwardColorMixMode() {}"]))))}},28719:function(e,t,r){r.d(t,{B:function(){return g},i:function(){return x}});var n,o,a=r(30168),i=r(50951),s=r(73782),l=(r(11873),r(81949),r(71353),r(52276)),c=r(27254),d=r(98634);function u(e,t){e.include(l.f),e.vertex.include(c.$,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),e.vertex.uniforms.add("transformWorldFromModelRS","mat3"),e.vertex.uniforms.add("transformWorldFromModelTH","vec3"),e.vertex.uniforms.add("transformWorldFromModelTL","vec3"),e.vertex.uniforms.add("transformWorldFromViewTH","vec3"),e.vertex.uniforms.add("transformWorldFromViewTL","vec3"),e.vertex.uniforms.add("transformViewFromCameraRelativeRS","mat3"),e.vertex.uniforms.add("transformProjFromView","mat4"),e.vertex.code.add((0,d.H)(n||(n=(0,a.Z)(["vec3 positionWorldCameraRelative() {\nvec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();\nvec3 transform_CameraRelativeFromModel = dpAdd(\ntransformWorldFromModelTL,\ntransformWorldFromModelTH,\n-transformWorldFromViewTL,\n-transformWorldFromViewTH\n);\nreturn transform_CameraRelativeFromModel + rotatedModelPosition;\n}\nvec3 position_view() {\nreturn transformViewFromCameraRelativeRS * positionWorldCameraRelative();\n}\nvoid forwardPosition() {\nvPositionWorldCameraRelative = positionWorldCameraRelative();\nvPosition_view = position_view();\ngl_Position = transformProjFromView * vec4(vPosition_view, 1.0);\n}\nvec3 positionWorld() {\nreturn transformWorldFromViewTL + vPositionWorldCameraRelative;\n}"])))),e.fragment.uniforms.add("transformWorldFromViewTL","vec3"),e.fragment.code.add((0,d.H)(o||(o=(0,a.Z)(["vec3 positionWorld() {\nreturn transformWorldFromViewTL + vPositionWorldCameraRelative;\n}"]))))}var m,v,p,f,h;function g(e,t){t.normalType===s.h.Attribute||t.normalType===s.h.CompressedAttribute?(e.include(s.O,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add("transformNormalGlobalFromModel","mat3"),e.vertex.uniforms.add("transformNormalViewFromGlobal","mat3"),e.vertex.code.add((0,d.H)(m||(m=(0,a.Z)(["void forwardNormal() {\nvNormalWorld = transformNormalGlobalFromModel * normalModel();\nvNormalView = transformNormalViewFromGlobal * vNormalWorld;\n}"]))))):t.normalType===s.h.Ground?(e.include(u,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add((0,d.H)(v||(v=(0,a.Z)(["\n    void forwardNormal() {\n      vNormalWorld = ","\n    }\n    "])),t.viewingMode===i.JY.Global?(0,d.H)(p||(p=(0,a.Z)(["normalize(vPositionWorldCameraRelative);"]))):(0,d.H)(f||(f=(0,a.Z)(["vec3(0.0, 0.0, 1.0);"])))))):e.vertex.code.add((0,d.H)(h||(h=(0,a.Z)(["void forwardNormal() {}"]))))}function x(e,t){e.setUniformMatrix4fv("viewNormal",t)}},6781:function(e,t,r){r.d(t,{s:function(){return S}});var n,o,a,i,s,l,c,d,u,m,v,p,f=r(30168),h=r(71011),g=r(33280),x=r(94951),b=r(73782),C=r(60113),y=r(28719),T=r(16574),M=r(137),w=r(18607),O=r(10763),A=r(98634);function S(e,t){var r=e.vertex.code,S=e.fragment.code,P=t.hasModelTransformation;t.output!==h.H.Depth&&t.output!==h.H.Shadow||(e.include(x.w,{linearDepth:!0,hasModelTransformation:P}),e.include(C.D,t),e.include(w.kl,t),e.include(T.F,t),e.include(g.p2,t),e.vertex.uniforms.add("nearFar","vec2"),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add((0,A.H)(n||(n=(0,f.Z)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPositionWithDepth(proj, view, "," vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])),P?"model,":"")),e.include(O.sj,t),S.add((0,A.H)(o||(o=(0,f.Z)(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),t.hasColorTexture?(0,A.H)(a||(a=(0,f.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):""))),t.output===h.H.Normal&&(e.include(x.w,{linearDepth:!1,hasModelTransformation:P}),e.include(b.O,t),e.include(y.B,t),e.include(C.D,t),e.include(w.kl,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),e.vertex.uniforms.add("viewNormal","mat4"),e.varyings.add("vPositionView","vec3"),r.add((0,A.H)(i||(i=(0,f.Z)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        ","\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, "," vpos);\n        forwardTextureCoordinates();\n      }\n    "])),t.normalType===b.h.Attribute?(0,A.H)(s||(s=(0,f.Z)(["\n        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));"]))):"",P?"model,":"")),e.include(g.p2,t),e.include(O.sj,t),S.add((0,A.H)(l||(l=(0,f.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),t.hasColorTexture?(0,A.H)(c||(c=(0,f.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",t.normalType===b.h.ScreenDerivative?(0,A.H)(d||(d=(0,f.Z)(["\n            vec3 normal = screenDerivativeNormal(vPositionView);"]))):(0,A.H)(u||(u=(0,f.Z)(["\n            vec3 normal = normalize(vNormalWorld);\n            if (gl_FrontFacing == false) normal = -normal;"])))))),t.output===h.H.Highlight&&(e.include(x.w,{linearDepth:!1,hasModelTransformation:P}),e.include(C.D,t),e.include(w.kl,t),t.hasColorTexture&&e.fragment.uniforms.add("tex","sampler2D"),r.add((0,A.H)(m||(m=(0,f.Z)(["\n      void main(void) {\n        vpos = calculateVPos();\n        vpos = subtractOrigin(vpos);\n        vpos = addVerticalOffset(vpos, localOrigin);\n        gl_Position = transformPosition(proj, view, "," vpos);\n        forwardTextureCoordinates();\n      }\n    "])),P?"model,":"")),e.include(g.p2,t),e.include(O.sj,t),e.include(M.bA),S.add((0,A.H)(v||(v=(0,f.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),t.hasColorTexture?(0,A.H)(p||(p=(0,f.Z)(["\n        vec4 texColor = texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"")))}},38171:function(e,t,r){r.d(t,{Q:function(){return v}});var n,o,a,i,s=r(30168),l=r(60113),c=r(27284),d=r(96658),u=r(98634),m=r(4760);function v(e,t){var r=e.fragment;t.vertexTangents?(e.attributes.add(m.T.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===d.q.WindingOrder?r.code.add((0,u.H)(n||(n=(0,s.Z)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;\nvec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"])))):r.code.add((0,u.H)(o||(o=(0,s.Z)(["mat3 computeTangentSpace(vec3 normal) {\nfloat tangentHeadedness = vTangent.w;\nvec3 tangent = normalize(vTangent.xyz);\nvec3 bitangent = cross(normal, tangent) * tangentHeadedness;\nreturn mat3(tangent, bitangent, normal);\n}"]))))):(e.extensions.add("GL_OES_standard_derivatives"),r.code.add((0,u.H)(a||(a=(0,s.Z)(["mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\nvec3 Q1 = dFdx(pos);\nvec3 Q2 = dFdy(pos);\nvec2 stx = dFdx(st);\nvec2 sty = dFdy(st);\nfloat det = stx.t * sty.s - sty.t * stx.s;\nvec3 T = stx.t * Q2 - sty.t * Q1;\nT = T - normal * dot(normal, T);\nT *= inversesqrt(max(dot(T,T), 1.e-10));\nvec3 B = sign(det) * cross(normal, T);\nreturn mat3(T, B, normal);\n}"]))))),t.attributeTextureCoordinates!==l.N.None&&(e.include(c.i,t),r.uniforms.add("normalTexture","sampler2D"),r.uniforms.add("normalTextureSize","vec2"),r.code.add((0,u.H)(i||(i=(0,s.Z)(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv = uv;\n      ","\n      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),t.supportsTextureAtlas?"vtc.size = normalTextureSize;":"")))}},30694:function(e,t,r){r.d(t,{K:function(){return s}});var n,o,a=r(30168),i=r(98634);function s(e,t){var r=e.fragment;t.receiveAmbientOcclusion?(r.uniforms.add("ssaoTex","sampler2D"),r.uniforms.add("viewportPixelSz","vec4"),r.code.add((0,i.H)(n||(n=(0,a.Z)(["float evaluateAmbientOcclusion() {\nreturn 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n}\nfloat evaluateAmbientOcclusionInverse() {\nfloat ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\nreturn viewportPixelSz.z < 0.0 ? 1.0 : ssao;\n}"]))))):r.code.add((0,i.H)(o||(o=(0,a.Z)(["float evaluateAmbientOcclusion() { return 0.0; }\nfloat evaluateAmbientOcclusionInverse() { return 1.0; }"]))))}},34975:function(e,t,r){r.d(t,{X:function(){return A}});var n,o,a,i,s,l,c,d,u,m,v,p,f,h=r(30168),g=r(50951),x=r(60750),b=r(30694),C=r(53685),y=r(2116),T=r(41481),M=r(85586),w=r(23235),O=r(98634);function A(e,t){var r=e.fragment;e.include(C.v),e.include(b.K,t),t.pbrMode!==T.f7.Disabled&&e.include(y.T,t),e.include(x._,t),t.receiveShadows&&e.include(w.hX,t),r.uniforms.add("lightingGlobalFactor","float"),r.uniforms.add("ambientBoostFactor","float"),r.uniforms.add("hasFillLights","bool"),e.include(M.e),r.code.add((0,O.H)(n||(n=(0,h.Z)(["\n    const float GAMMA_SRGB = 2.1;\n    const float INV_GAMMA_SRGB = 0.4761904;\n    ","\n  "])),t.pbrMode===T.f7.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);")),r.code.add((0,O.H)(o||(o=(0,h.Z)(["\n    float additionalDirectedAmbientLight(vec3 vPosWorld) {\n      float vndl = dot(",", lightingMainDirection);\n      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n    }\n  "])),t.viewingMode===g.JY.Global?(0,O.H)(a||(a=(0,h.Z)(["normalize(vPosWorld)"]))):(0,O.H)(i||(i=(0,h.Z)(["vec3(0.0, 0.0, 1.0)"]))))),r.code.add((0,O.H)(s||(s=(0,h.Z)(["vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\nfloat additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);\nreturn (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n}"])))),t.pbrMode===T.f7.Disabled||t.pbrMode===T.f7.WaterOnIntegratedMesh?r.code.add((0,O.H)(l||(l=(0,h.Z)(["vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)\n{\nvec3 mainLighting = evaluateMainLighting(normalWorld, shadow);\nvec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);\nvec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\nvec3 totalLight = mainLighting + ambientLighting + additionalLight;\ntotalLight = min(totalLight, vec3(PI));\nvec3 outColor = vec3((albedoLinear / PI) * totalLight);\nreturn pow(outColor, vec3(INV_GAMMA_SRGB));\n}"])))):t.pbrMode!==T.f7.Normal&&t.pbrMode!==T.f7.Schematic||(r.code.add((0,O.H)(c||(c=(0,h.Z)(["const float fillLightIntensity = 0.25;\nconst float horizonLightDiffusion = 0.4;\nconst float additionalAmbientIrradianceFactor = 0.02;\nvec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)\n{\nvec3 viewDirection = -viewDir;\nvec3 mainLightDirection = lightingMainDirection;\nvec3 h = normalize(viewDirection + mainLightDirection);\nPBRShadingInfo inputs;\ninputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);\ninputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\ninputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);\ninputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);\ninputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);\nvec3 reflectedView = normalize(reflect(viewDirection, normal));\ninputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);\ninputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));\ninputs.ssao = ssao;\ninputs.metalness = mrr[0];\ninputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);"])))),r.code.add((0,O.H)(d||(d=(0,h.Z)(["inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\ninputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));\ninputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);"])))),r.code.add((0,O.H)(u||(u=(0,h.Z)(["vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);\nambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));\ninputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;\nvec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\nvec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;\ninputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\ninputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;"])))),r.code.add((0,O.H)(m||(m=(0,h.Z)(["vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;\nvec3 horizonRingH = normalize(viewDirection + horizonRingDir);\ninputs.NdotH_Horizon = dot(normal, horizonRingH);\nvec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\nvec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\nvec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;\ninputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\ninputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\ninputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);"])))),r.code.add((0,O.H)(v||(v=(0,h.Z)(["\n        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        ","\n        return outColor;\n      }\n    "])),t.pbrMode===T.f7.Schematic?(0,O.H)(p||(p=(0,h.Z)(["vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));"]))):(0,O.H)(f||(f=(0,h.Z)(["vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));"]))))))}},96658:function(e,t,r){r.d(t,{k:function(){return m},q:function(){return s}});var n,o,a,i,s,l,c=r(30168),d=r(41644),u=r(98634);function m(e,t){var r=e.fragment;switch(r.code.add((0,u.H)(n||(n=(0,c.Z)(["struct ShadingNormalParameters {\nvec3 normalView;\nvec3 viewDirection;\n} shadingParams;"])))),t.doubleSidedMode){case s.None:r.code.add((0,u.H)(o||(o=(0,c.Z)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn normalize(params.normalView);\n}"]))));break;case s.View:r.code.add((0,u.H)(a||(a=(0,c.Z)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n}"]))));break;case s.WindingOrder:r.code.add((0,u.H)(i||(i=(0,c.Z)(["vec3 shadingNormal(ShadingNormalParameters params) {\nreturn gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n}"]))));break;default:(0,d.Bg)(t.doubleSidedMode);case s.COUNT:}}(l=s||(s={}))[l.None=0]="None",l[l.View=1]="View",l[l.WindingOrder=2]="WindingOrder",l[l.COUNT=3]="COUNT"},27254:function(e,t,r){r.d(t,{$:function(){return l},I:function(){return c}});var n,o,a=r(30168),i=r(93169),s=r(98634);function l(e,t){var r=e.code;t.doublePrecisionRequiresObfuscation?r.add((0,s.H)(n||(n=(0,a.Z)(["vec3 dpPlusFrc(vec3 a, vec3 b) {\nreturn mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\nreturn mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = dpPlusFrc(hiA, hiB);\nvec3 e = dpMinusFrc(t1, hiA);\nvec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\nreturn t1 + t2;\n}"])))):r.add((0,s.H)(o||(o=(0,a.Z)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 t1 = hiA + hiB;\nvec3 e = t1 - hiA;\nvec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\nreturn t1 + t2;\n}"]))))}function c(e){return!!(0,i.Z)("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}},14282:function(e,t,r){r.d(t,{a:function(){return l}});var n,o=r(30168),a=r(71011),i=r(98634),s=r(37825);function l(e,t){var r=(0,i.H)(n||(n=(0,o.Z)(["\n  /*\n  *  ","\n  *  ","\n  */\n  "])),t.name,t.output===a.H.Color?"RenderOutput: Color":t.output===a.H.Depth?"RenderOutput: Depth":t.output===a.H.Shadow?"RenderOutput: Shadow":t.output===a.H.Normal?"RenderOutput: Normal":t.output===a.H.Highlight?"RenderOutput: Highlight":"");(0,s.CG)()&&(e.fragment.code.add(r),e.vertex.code.add(r))}},71033:function(e,t,r){r.d(t,{y:function(){return l}});var n,o=r(30168),a=r(49420),i=r(116),s=r(98634);function l(e){e.include(i.Y),e.code.add((0,s.H)(n||(n=(0,o.Z)(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed = internalColor * textureColor;\n      vec3 allMixed = internalMixed * externalColor;\n\n      if (mode == ",") {\n        return allMixed;\n      }\n      else if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn = rgb2v(internalMixed);\n        vec3 hsvTint = rgb2hsv(externalColor);\n        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed = internalOpacity * textureOpacity;\n      float allMixed = internalMixed * externalOpacity;\n\n      if (mode == ",") {\n        return internalMixed;\n      }\n      else if (mode == ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),s.H.int(a.a9.Multiply),s.H.int(a.a9.Ignore),s.H.int(a.a9.Replace),s.H.int(a.a9.Ignore),s.H.int(a.a9.Replace)))}},10052:function(e,t,r){r.d(t,{G:function(){return oe},R:function(){return le}});var n=r(1413),o=r(15671),a=r(43144),i=r(11752),s=r(61120),l=r(60136),c=r(54062),d=r(92026),u=r(11873),m=r(11186),v=r(71353),p=r(50951),f=r(55158),h=r(71011),g=r(96658),x=r(10763),b=r(68401),C=r(40485),y=r(56529),T=r(78041),M=r(68198),w=r(93822),O=r(4760),A=r(76783),S=r(33236),P=r(22909),H=r(27366),E=r(32718),N=r(33280),R=r(81221),D=r(73782),_=r(60113),L=r(49223),Z=r(137),I=r(15226),B=r(41481),F=r(23235),z=r(18607),G=r(27254),k=r(41012),V=r(82144),q=r(31132),W=r(33559),U=r(7566),j=r(27627),J=r(50411),$=r(65630),K=r(8548),X=r(36207),Q=E.Z.getLogger("esri.views.3d.webgl-engine.shaders.DefaultTechnique"),Y=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,o.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,o=t.build({oitEnabled:n.transparencyPassType===b.Am.Color,output:n.output,viewingMode:e.viewingMode,receiveShadows:n.receiveShadows,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:n.symbolColors,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,instanced:n.instanced,instancedColor:n.instancedColor,instancedDoublePrecision:n.instancedDoublePrecision,pbrMode:n.usePBR?n.isSchematic?B.f7.Schematic:B.f7.Normal:B.f7.Disabled,hasMetalnessAndRoughnessTexture:n.hasMetalnessAndRoughnessTexture,hasEmissionTexture:n.hasEmissionTexture,hasOcclusionTexture:n.hasOcclusionTexture,hasNormalTexture:n.hasNormalTexture,hasColorTexture:n.hasColorTexture,hasModelTransformation:n.hasModelTransformation,receiveAmbientOcclusion:n.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:n.normalsTypeDerivate?D.h.ScreenDerivative:D.h.Attribute,doubleSidedMode:n.doubleSidedMode,vertexTangents:n.vertexTangents,attributeTextureCoordinates:n.hasMetalnessAndRoughnessTexture||n.hasEmissionTexture||n.hasOcclusionTexture||n.hasNormalTexture||n.hasColorTexture?_.N.Default:_.N.None,textureAlphaPremultiplied:n.textureAlphaPremultiplied,attributeColor:n.vertexColors,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,offsetBackfaces:n.offsetBackfaces,doublePrecisionRequiresObfuscation:(0,G.I)(e.rctx),alphaDiscardMode:n.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new j.$(e.rctx,o,U.i)}},{key:"bindPass",value:function(e,t){var r,n;(0,k.II)(this.program,t.camera.projectionMatrix);var o=this.configuration.output;this.configuration.hasModelTransformation&&((0,d.pC)(e.modelTransformation)?this.program.setUniformMatrix4fv("model",e.modelTransformation):Q.warnOnce("hasModelTransformation true, but no modelTransformation found.")),(this.configuration.output===h.H.Depth||t.multipassTerrainEnabled||o===h.H.Shadow)&&this.program.setUniform2fv("nearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,I.p)(this.program,t)),o===h.H.Alpha&&(this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",P.FZ[e.colorMixMode])),o===h.H.Color?(t.lighting.setUniforms(this.program,!1,t.hasFillLights),this.program.setUniform3fv("ambient",e.ambient),this.program.setUniform3fv("diffuse",e.diffuse),this.program.setUniform4fv("externalColor",e.externalColor),this.program.setUniform1i("colorMixMode",P.FZ[e.colorMixMode]),this.program.setUniform1f("opacity",e.opacity),this.program.setUniform1f("layerOpacity",e.layerOpacity),this.configuration.usePBR&&(0,B.nW)(this.program,e,this.configuration.isSchematic)):o===h.H.Highlight&&(0,Z.wW)(this.program,t),(0,z.uj)(this.program,e),(0,L.Mo)(this.program,e,t),(0,P.bj)(e.screenSizePerspective,this.program,"screenSizePerspectiveAlignment"),e.textureAlphaMode!==b.JJ.Mask&&e.textureAlphaMode!==b.JJ.MaskBlend||this.program.setUniform1f("textureAlphaCutoff",e.textureAlphaCutoff),null==(r=t.shadowMap)||r.bind(this.program),null==(n=t.ssaoHelper)||n.bind(this.program,t.camera)}},{key:"bindDraw",value:function(e){var t=this.configuration.instancedDoublePrecision?(0,v.f)(e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]):e.origin;(0,k.q0)(this.program,t,e.camera.viewMatrix),this.program.rebindTextures(),(this.configuration.output===h.H.Color||this.configuration.output===h.H.Alpha||this.configuration.output===h.H.Depth&&this.configuration.screenSizePerspective||this.configuration.output===h.H.Normal&&this.configuration.screenSizePerspective||this.configuration.output===h.H.Highlight&&this.configuration.screenSizePerspective)&&(0,k.fb)(this.program,t,e.camera.viewInverseTransposeMatrix),this.configuration.output===h.H.Normal&&this.program.setUniformMatrix4fv("viewNormal",e.camera.viewInverseTransposeMatrix),this.configuration.instancedDoublePrecision&&(0,R.d3)(this.program,t),(0,N.Vv)(this.program,this.configuration,e.slicePlane,{origin:t}),this.configuration.output===h.H.Color&&(0,F.vL)(this.program,e,t)}},{key:"_convertDepthTestFunction",value:function(e){return e===b.Gv.Lequal?K.wb.LEQUAL:K.wb.LESS}},{key:"_setPipeline",value:function(e,t){var r=this.configuration,n=e===b.Am.NONE,o=e===b.Am.FrontFace;return(0,X.sm)({blending:r.output!==h.H.Color&&r.output!==h.H.Alpha||!r.transparent?null:n?T.wu:(0,T.j7)(e),culling:ee(r)&&(0,X.zp)(r.cullFace),depthTest:{func:(0,T.Bh)(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:n||o?r.writeDepth&&X.LZ:null,colorWrite:X.BK,stencilWrite:r.sceneHasOcludees?J.s3:null,stencilTest:r.sceneHasOcludees?t?J.eD:J.RY:null,polygonOffset:n||o?null:(0,T.je)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,i.Z)((0,s.Z)(r.prototype),"getPipelineState",this).call(this,e,t)}}]),r}(q.A);function ee(e){return e.cullFace?e.cullFace!==b.Vr.None:!e.slicePlaneEnabled&&!e.transparent&&!e.doubleSidedMode}Y.shader=new V.J($.D,(function(){return r.e(294).then(r.bind(r,40294))}));var te=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments)).output=h.H.Color,e.alphaDiscardMode=b.JJ.Opaque,e.doubleSidedMode=g.q.None,e.isSchematic=!1,e.vertexColors=!1,e.offsetBackfaces=!1,e.symbolColors=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.sliceHighlightDisabled=!1,e.receiveAmbientOcclusion=!1,e.screenSizePerspective=!1,e.textureAlphaPremultiplied=!1,e.hasColorTexture=!1,e.usePBR=!1,e.hasMetalnessAndRoughnessTexture=!1,e.hasEmissionTexture=!1,e.hasOcclusionTexture=!1,e.hasNormalTexture=!1,e.instanced=!1,e.instancedColor=!1,e.instancedDoublePrecision=!1,e.vertexTangents=!1,e.normalsTypeDerivate=!1,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparent=!1,e.enableOffset=!0,e.cullFace=b.Vr.None,e.transparencyPassType=b.Am.NONE,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e.hasModelTransformation=!1,e.customDepthTest=b.Gv.Less,e}return(0,a.Z)(r)}(W.m);(0,H._)([(0,W.o)({count:h.H.COUNT})],te.prototype,"output",void 0),(0,H._)([(0,W.o)({count:b.JJ.COUNT})],te.prototype,"alphaDiscardMode",void 0),(0,H._)([(0,W.o)({count:g.q.COUNT})],te.prototype,"doubleSidedMode",void 0),(0,H._)([(0,W.o)()],te.prototype,"isSchematic",void 0),(0,H._)([(0,W.o)()],te.prototype,"vertexColors",void 0),(0,H._)([(0,W.o)()],te.prototype,"offsetBackfaces",void 0),(0,H._)([(0,W.o)()],te.prototype,"symbolColors",void 0),(0,H._)([(0,W.o)()],te.prototype,"vvSize",void 0),(0,H._)([(0,W.o)()],te.prototype,"vvColor",void 0),(0,H._)([(0,W.o)()],te.prototype,"verticalOffset",void 0),(0,H._)([(0,W.o)()],te.prototype,"receiveShadows",void 0),(0,H._)([(0,W.o)()],te.prototype,"slicePlaneEnabled",void 0),(0,H._)([(0,W.o)()],te.prototype,"sliceHighlightDisabled",void 0),(0,H._)([(0,W.o)()],te.prototype,"receiveAmbientOcclusion",void 0),(0,H._)([(0,W.o)()],te.prototype,"screenSizePerspective",void 0),(0,H._)([(0,W.o)()],te.prototype,"textureAlphaPremultiplied",void 0),(0,H._)([(0,W.o)()],te.prototype,"hasColorTexture",void 0),(0,H._)([(0,W.o)()],te.prototype,"usePBR",void 0),(0,H._)([(0,W.o)()],te.prototype,"hasMetalnessAndRoughnessTexture",void 0),(0,H._)([(0,W.o)()],te.prototype,"hasEmissionTexture",void 0),(0,H._)([(0,W.o)()],te.prototype,"hasOcclusionTexture",void 0),(0,H._)([(0,W.o)()],te.prototype,"hasNormalTexture",void 0),(0,H._)([(0,W.o)()],te.prototype,"instanced",void 0),(0,H._)([(0,W.o)()],te.prototype,"instancedColor",void 0),(0,H._)([(0,W.o)()],te.prototype,"instancedDoublePrecision",void 0),(0,H._)([(0,W.o)()],te.prototype,"vertexTangents",void 0),(0,H._)([(0,W.o)()],te.prototype,"normalsTypeDerivate",void 0),(0,H._)([(0,W.o)()],te.prototype,"writeDepth",void 0),(0,H._)([(0,W.o)()],te.prototype,"sceneHasOcludees",void 0),(0,H._)([(0,W.o)()],te.prototype,"transparent",void 0),(0,H._)([(0,W.o)()],te.prototype,"enableOffset",void 0),(0,H._)([(0,W.o)({count:b.Vr.COUNT})],te.prototype,"cullFace",void 0),(0,H._)([(0,W.o)({count:b.Am.COUNT})],te.prototype,"transparencyPassType",void 0),(0,H._)([(0,W.o)()],te.prototype,"multipassTerrainEnabled",void 0),(0,H._)([(0,W.o)()],te.prototype,"cullAboveGround",void 0),(0,H._)([(0,W.o)()],te.prototype,"hasModelTransformation",void 0),(0,H._)([(0,W.o)({count:b.Gv.COUNT})],te.prototype,"customDepthTest",void 0);var re=r(40563),ne=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,o.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,o=t.build({oitEnabled:n.transparencyPassType===b.Am.Color,output:n.output,viewingMode:e.viewingMode,receiveShadows:n.receiveShadows,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:n.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:n.symbolColors,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!0,instanced:n.instanced,instancedColor:n.instancedColor,instancedDoublePrecision:n.instancedDoublePrecision,pbrMode:n.usePBR?B.f7.Normal:B.f7.Disabled,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:n.hasColorTexture,hasModelTransformation:!1,receiveAmbientOcclusion:n.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:D.h.Attribute,doubleSidedMode:g.q.WindingOrder,vertexTangents:!1,attributeTextureCoordinates:n.hasColorTexture?_.N.Default:_.N.None,textureAlphaPremultiplied:n.textureAlphaPremultiplied,attributeColor:n.vertexColors,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,offsetBackfaces:n.offsetBackfaces,doublePrecisionRequiresObfuscation:(0,G.I)(e.rctx),alphaDiscardMode:n.alphaDiscardMode,supportsTextureAtlas:!1,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new j.$(e.rctx,o,U.i)}}]),r}(Y);ne.shader=new V.J(re.R,(function(){return r.e(8834).then(r.bind(r,88834))}));var oe=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e,ie)).supportsEdges=!0,n.techniqueConfig=new te,n.vertexBufferLayout=function(e){var t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,r=(0,f.U$)().vec3f(O.T.POSITION).vec3f(O.T.NORMAL);return e.vertexTangents&&r.vec4f(O.T.TANGENT),t&&r.vec2f(O.T.UV0),e.vertexColors&&r.vec4u8(O.T.COLOR),e.symbolColors&&r.vec4u8(O.T.SYMBOLCOLOR),r}(n.parameters),n.instanceBufferLayout=e.instanced?le(n.parameters):null,n}return(0,a.Z)(r,[{key:"isVisibleInPass",value:function(e){return e!==M.C.MATERIAL_DEPTH_SHADOWMAP_ALL&&e!==M.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&e!==M.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}},{key:"isVisible",value:function(){var e=this.parameters;if(!(0,i.Z)((0,s.Z)(r.prototype),"isVisible",this).call(this)||0===e.layerOpacity)return!1;var t=e.instanced,n=e.vertexColors,o=e.symbolColors,a=!!t&&t.indexOf("color")>-1,l=e.vvColorEnabled,c="replace"===e.colorMixMode,d=e.opacity>0,u=e.externalColor&&e.externalColor[3]>0;return n&&(a||l||o)?!!c||d:n?c?u:d:a||l||o?!!c||d:c?u:d}},{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.vertexTangents=this.parameters.vertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.verticalOffset=null!==this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=null!==this.parameters.screenSizePerspective,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sliceHighlightDisabled=this.parameters.sliceHighlightDisabled,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.parameters.normals,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,(0,d.pC)(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.cullFace=this.parameters.slicePlaneEnabled?b.Vr.None:this.parameters.cullFace,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig.hasModelTransformation=(0,d.pC)(this.parameters.modelTransformation),e!==h.H.Color&&e!==h.H.Alpha||(this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.symbolColors=this.parameters.symbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=g.q.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?g.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?g.q.WindingOrder:g.q.None,this.techniqueConfig.instancedColor=!!this.parameters.instanced&&this.parameters.instanced.indexOf("color")>-1,this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!t.ssaoEnabled&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.parameters.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.isSchematic=this.parameters.usePBR&&this.parameters.isSchematic,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<T.ve),this.techniqueConfig}},{key:"intersect",value:function(e,t,r,n,o,a,i){if(null!==this.parameters.verticalOffset){var s=n.camera;(0,m.s)(pe,r[12],r[13],r[14]);var l=null;switch(n.viewingMode){case p.JY.Global:l=(0,m.n)(me,pe);break;case p.JY.Local:l=(0,m.g)(me,ue)}var c=0;if(null!==this.parameters.verticalOffset){var d=(0,m.f)(fe,pe,s.eye),u=(0,m.l)(d),v=(0,m.a)(d,d,1/u),f=null;this.parameters.screenSizePerspective&&(f=(0,m.d)(l,v)),c+=(0,P.Hx)(s,u,this.parameters.verticalOffset,f,this.parameters.screenSizePerspective)}(0,m.a)(l,l,c),(0,m.t)(ve,l,n.transform.inverseRotation),o=(0,m.f)(ce,o,ve),a=(0,m.f)(de,a,ve)}(0,P.Bw)(e,t,n,o,a,(0,A.W9)(n.verticalOffset),i)}},{key:"requiresSlot",value:function(e){return e===(this.parameters.transparent?this.parameters.writeDepth?w.r.TRANSPARENT_MATERIAL:w.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:w.r.OPAQUE_MATERIAL)||e===w.r.DRAPED_MATERIAL}},{key:"createGLMaterial",value:function(e){return e.output===h.H.Color||e.output===h.H.Alpha||e.output===h.H.Depth||e.output===h.H.Normal||e.output===h.H.Shadow||e.output===h.H.Highlight?new ae(e):null}},{key:"createBufferWriter",value:function(){return new se(this.vertexBufferLayout,this.instanceBufferLayout)}}]),r}(y.F5),ae=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(e){return(0,o.Z)(this,r),t.call(this,(0,n.Z)((0,n.Z)({},e),e.material.parameters))}return(0,a.Z)(r,[{key:"updateParameters",value:function(e){var t=this._material.parameters;return this.updateTexture(t.textureId),this.ensureTechnique(t.treeRendering?ne:Y,e)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMappingEnabled})}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==h.H.Color&&this._output!==h.H.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.parameters,e),this.bindTextures(t.program)}}]),r}(C.Z),ie=(0,n.Z)({textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:b.Vr.Back,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,fillLightsEnabled:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:(0,u.c)(),modelTransformation:null,transparent:!1,writeDepth:!0,customDepthTest:b.Gv.Less,textureAlphaMode:b.JJ.Blend,textureAlphaCutoff:x.F,textureAlphaPremultiplied:!1,sceneHasOcludees:!1},y.mo),se=function(){function e(t,r){(0,o.Z)(this,e),this.vertexBufferLayout=t,this.instanceBufferLayout=r}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(O.T.POSITION).length}},{key:"write",value:function(e,t,r,n){(0,S.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n)}}]),e}();function le(e){var t=(0,f.U$)();return t=e.instancedDoublePrecision?t.vec3f(O.T.MODELORIGINHI).vec3f(O.T.MODELORIGINLO).mat3f(O.T.MODEL).mat3f(O.T.MODELNORMAL):t.mat4f(O.T.MODEL).mat4f(O.T.MODELNORMAL),e.instanced&&e.instanced.indexOf("color")>-1&&(t=t.vec4f(O.T.INSTANCECOLOR)),e.instanced&&e.instanced.indexOf("featureAttribute")>-1&&(t=t.vec4f(O.T.INSTANCEFEATUREATTRIBUTE)),t}var ce=(0,v.c)(),de=(0,v.c)(),ue=(0,v.f)(0,0,1),me=(0,v.c)(),ve=(0,v.c)(),pe=(0,v.c)(),fe=(0,v.c)()}}]);
//# sourceMappingURL=4265.b3148e71.chunk.js.map