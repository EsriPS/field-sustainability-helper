"use strict";(globalThis.webpackChunkfield_sustainability_helper=globalThis.webpackChunkfield_sustainability_helper||[]).push([[2490],{77566:(e,t,i)=>{i.d(t,{T:()=>U,I:()=>q});var n=i(27366),a=i(52639),r=(i(93169),i(91505)),s=i(41691),o=i(42537),l=i(92026),p=i(49861),h=i(63780),c=(i(25243),i(69912)),d=i(93655),u=(i(59486),i(84652)),m=i(68860),g=i(1587),y=i(2170),v=i(69662),f=i(92975),_=i(22018),x=i(89494),w=i(48976),b=i(98131),C=i(11186),S=i(71353),T=i(14320),M=i(7882);function V(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,l.pC)(i)?[e,t,i]:[e,t]}function E(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,l.pC)(i)?{x:e,y:t,z:i}:{x:e,y:t}}class R{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return(0,l.lV)(e.map((e=>this.mapToLocal(e))))}get doUnnormalization(){return!1}}class O extends R{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super(t),this.defaultZ=i,this.transform=(0,x.c)(),this.transformInv=(0,x.c)(),this.transform=(0,x.a)(e),(0,_.i)(this.transformInv,this.transform)}makeMapPoint(e,t){return V(e,t,this.defaultZ)}mapToLocal(e){return E(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return V(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}class I extends R{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,S.c)(),this.tangentFrameUpWS=(0,S.c)(),this.tangentFrameRightWS=(0,S.c)(),this.tangentFrameForwardWS=(0,S.c)(),this.localFrameRightWS=(0,S.c)(),this.localFrameUpWS=(0,S.c)(),this.worldToLocalTransform=(0,b.a)(),this.localToWorldTransform=(0,b.a)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,T.R.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,T.R.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,T.R.Z,this.tangentFrameForwardWS);const n=(0,S.c)();(0,C.a)(n,this.tangentFrameForwardWS,(0,C.d)(i,this.tangentFrameForwardWS)),(0,C.f)(this.localFrameRightWS,i,n),(0,C.n)(this.localFrameRightWS,this.localFrameRightWS),(0,C.c)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,w.r)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,w.i)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,t){return V(e,t,this.defaultZ)}mapToLocal(e){const t=(0,S.c)();this.view.renderCoordsHelper.toRenderCoords(new M.Z({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,C.q)(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return(0,l.pC)(i)?E(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=(0,S.c)();this.view.renderCoordsHelper.toRenderCoords(new M.Z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,C.q)(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return(0,l.pC)(i)?V(i.x,i.y,this.defaultZ):null}}function k(e,t){if("2d"===e.type)return new O(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){const i=t.length>2?new M.Z({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new M.Z({x:t[0],y:t[1],spatialReference:e.spatialReference});return new I(e,i)}return null}var W=i(77577),P=i(29909),G=i(80885);function D(e,t){const i=new M.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function Z(e,t,i){const n=new P.Z({paths:e,spatialReference:t});return i&&(0,v.nc)(n),n}function A(e,t,i){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=(0,u.d9)(e);a.forEach((e=>{const t=e[0],i=e[e.length-1];(0,h.fS)(t,i)&&1!==e.length||e.push(e[0])}));let r=new G.Z({rings:a,spatialReference:t});return r.rings.forEach((e=>{(0,v.bu)(e,!1,!1)||e.reverse()})),i&&(0,v.nc)(r),n&&r.isSelfIntersecting&&(0,f.JY)(t)&&(r=(0,y.simplify)(r)),r}function H(e,t,i){const n=t.mapToLocalMultiple(e),a=[],r={x:n[0].x,y:n[0].y},s=n[1].x,o=n[1].y,p=Math.round(s-r.x),h=Math.round(o-r.y),c=Math.max(Math.abs(p),Math.abs(h));if(i){const e={x:r.x+c,y:r.y+c},t={x:r.x-c,y:r.y-c};a.push(E(e.x,t.y),E(t.x,t.y),E(t.x,e.y),E(e.x,e.y))}else{const e={x:p>0?r.x+c:r.x-c,y:h>0?r.y+c:r.y-c};a.push(E(r.x,r.y),E(e.x,r.y),E(e.x,e.y),E(r.x,e.y))}return A([(0,l.lV)(a.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}function z(e,t,i,n){const a=t.mapToLocalMultiple(e);let r=null,s=null;if(i)r=a[0],s=a[1];else{const e=a[0],t=a[1],i=Math.round(t.x-e.x),n=Math.round(t.y-e.y),o=Math.max(Math.abs(i),Math.abs(n));r=E(i>0?e.x+o/2:e.x-o/2,n>0?e.y+o/2:e.y-o/2),s=E(Math.abs(i)>Math.abs(n)?r.x-o/2:r.x,Math.abs(i)>Math.abs(n)?r.y:r.y-o/2)}const o=t.localToMap(r),p=t.localToMap(s);if((0,l.Wi)(o)||(0,l.Wi)(p))return null;t.doUnnormalization&&(0,v.Sq)([[o,p]],t.spatialReference);const h=D(o,t.spatialReference),c=D(p,t.spatialReference),d=(0,m.c9)(t.spatialReference);let u=0;if((0,f.JY)(t.spatialReference))u=d*(0,y.distance)(h,c,null);else{const e=r.x-s.x,t=r.y-s.y;u=d*Math.sqrt(e*e+t*t)*(n||1)}const _=new g.Z({center:h,radius:u,radiusUnit:"meters",spatialReference:t.spatialReference});return A(_.rings,_.spatialReference,!1)}var F=i(29919);let U=class extends((0,s.p)(r.Z.EventedMixin(F.m))){constructor(e){super(e),this._graphic=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.mode=null,this.snappingManager=null,this.snapToScene=!1}initialize(){this.internalGraphicsLayer=new d.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(e=>this.onVertexAdd(e))),this.drawOperation.on("vertex-remove",(e=>this.onVertexRemove(e))),this.drawOperation.on("vertex-update",(e=>this.onVertexUpdate(e))),this.drawOperation.on("cursor-update",(e=>this.onCursorUpdate(e))),this.drawOperation.on("complete",(e=>this.onComplete(e)))]),this.finishToolCreation()}destroy(){this.drawOperation=(0,l.SC)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,l.SC)(this.internalGraphicsLayer),this._set("view",null)}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),(0,l.pC)(this._graphic)&&(this._graphic.symbol=e)}get updating(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(e){this._graphic=new a.Z({...this.graphicProperties,geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,o.kB)((()=>{(0,l.pC)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=(0,l.SC)(this._graphic))})),L)}_destroyAllVisualisations(){this.handles.remove(N.outline),this.handles.remove(N.regularVertices),this.handles.remove(N.activeVertex),this.handles.remove(L)}_getCreateOperationGeometry(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const t=this.drawOperation.stagedVertex,i=this.drawOperation.committedVertices,n=i.slice();(0,l.pC)(t)&&n.push(this.drawOperation.coordinateHelper.pointToArray(t));const a=(0,l.pC)(t)?this.drawOperation.coordinateHelper.pointToArray(t):i.splice(-1)[0],r={regularVertices:null,activeVertex:null,full:null,outline:null},s=n.length,o=this.drawOperation.spatialReference,p="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":r.regularVertices=i,r.activeVertex=a,r.full=this.drawOperation.coordinateHelper.arrayToPoint(n[0]);break;case"multipoint":r.regularVertices=i,r.activeVertex=a,s>0&&(r.full=function(e,t){return new W.Z({points:e,spatialReference:t})}(n,o));break;case"polyline":r.regularVertices=i,r.activeVertex=a,s>0&&(r.full=Z([n],o,p));break;case"polygon":r.regularVertices=i,r.activeVertex=a,s>0&&(r.full=A([n],o,p,!0));break;case"circle":if(s>0){const t=k(this.view,n[0]);if(1===s&&e.operationComplete){const e=n[0],i=t.makeMapPoint(e[0]+Y*this.view.resolution,e[1]);r.full=z([e,i],t,!0)}else 2===s&&(r.full=this.forceUniformSize?z(n,t,this.centered):function(e,t,i){const n=t.mapToLocalMultiple(e),a=n[0],r=n[1],s=Math.round(r.x-a.x),o=Math.round(r.y-a.y),p=E(i?a.x:a.x+s/2,i?a.y:a.y+o/2),h=i?s:s/2,c=i?o:o/2,d=[],u=2*Math.PI/60;for(let l=0;l<60;l++){const e=Math.cos(l*u),t=Math.sin(l*u),i=E(h*e+p.x,c*t+p.y);d.push(i)}return d.push(d[0]),A([(0,l.lV)(d.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!1)}(n,t,this.centered))}break;case"rectangle":if(s>0){const t=k(this.view,n[0]);if(1===s&&e.operationComplete){const e=n[0],i=t.makeMapPoint(e[0]+Y*this.view.resolution,e[1]);r.full=H([e,i],t,!0)}else 2===s&&(r.full=this.forceUniformSize?H(n,t,this.centered):function(e,t,i){let n=t.mapToLocalMultiple(e);if(1===n.length){const e=48,t=n[0];n=[E(t.x-e,t.y+e),E(t.x+e,t.y-e),E(t.x+e,t.y-e),E(t.x-e,t.y+e)]}const a=[],r={x:n[0].x,y:n[0].y},s={x:n[1].x,y:n[1].y};if(i){const e=Math.round(s.x-r.x),t=Math.round(s.y-r.y);a.push(E(r.x-e,r.y-t),E(s.x,r.y-t),E(s.x,s.y),E(r.x-e,s.y))}else a.push(E(r.x,r.y),E(s.x,r.y),E(s.x,s.y),E(r.x,s.y));return A([(0,l.lV)(a.map((e=>t.localToMap(e))))],t.spatialReference,t.doUnnormalization,!0)}(n,t,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":s>1&&(r.outline=Z([n],o,p));break;case"circle":case"rectangle":(0,l.pC)(r.full)&&"polygon"===r.full.type&&(r.outline=A(r.full.rings,o,p))}return r}initializeGraphic(e){return null}onComplete(e){this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});(0,l.pC)(e)&&((0,l.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full,t=(0,l.Wg)(this._graphic).clone())}this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(e){this._updateGraphic(),this.emit("vertex-add",e)}onVertexRemove(e){this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();(0,l.Wi)(e)?this._destroyAllVisualisations():((0,l.pC)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),N.outline):this.handles.remove(N.outline),(0,l.pC)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),N.regularVertices):this.handles.remove(N.regularVertices),(0,l.pC)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),N.activeVertex):this.handles.remove(N.activeVertex),(0,l.pC)(e.full)?(0,l.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(L))}};(0,n._)([(0,p.Cb)({value:!0})],U.prototype,"centered",null),(0,n._)([(0,p.Cb)({nonNullable:!0})],U.prototype,"defaultZ",void 0),(0,n._)([(0,p.Cb)()],U.prototype,"drawOperation",void 0),(0,n._)([(0,p.Cb)({value:!0})],U.prototype,"enabled",null),(0,n._)([(0,p.Cb)({value:!0})],U.prototype,"forceUniformSize",null),(0,n._)([(0,p.Cb)({constructOnly:!0})],U.prototype,"geometryType",void 0),(0,n._)([(0,p.Cb)()],U.prototype,"graphic",null),(0,n._)([(0,p.Cb)({constructOnly:!0})],U.prototype,"graphicProperties",void 0),(0,n._)([(0,p.Cb)()],U.prototype,"graphicSymbol",null),(0,n._)([(0,p.Cb)({constructOnly:!0})],U.prototype,"hasZ",void 0),(0,n._)([(0,p.Cb)({constructOnly:!0})],U.prototype,"mode",void 0),(0,n._)([(0,p.Cb)()],U.prototype,"snappingManager",void 0),(0,n._)([(0,p.Cb)()],U.prototype,"snapToScene",void 0),(0,n._)([(0,p.Cb)({readOnly:!0})],U.prototype,"type",void 0),(0,n._)([(0,p.Cb)({readOnly:!0})],U.prototype,"updating",null),(0,n._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],U.prototype,"view",void 0),U=(0,n._)([(0,c.j)("esri.views.draw.DrawGraphicTool")],U);const L="create-operation-graphic",N={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function q(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}const Y=48},42046:(e,t,i)=>{i.d(t,{w:()=>C});var n=i(27366),a=i(91505),r=i(41691),s=i(84652),o=i(92026),l=i(66978),p=i(17842),h=i(49861),c=(i(25243),i(69912)),d=i(70178),u=i(50951);class m{constructor(e){let{grabbableForEvent:t}=e;this.events=new a.Z,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=t}intersectionDistance(e,t){return 0}attach(){}detach(){}}const g="click";var y=i(14813),v=i(74229),f=i(84954),_=i(87268),x=i(34019),w=i(80151),b=i(99912);let C=class extends(a.Z.EventedMixin(r.r)){constructor(e){super(e),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this._snappingPipeline=new w.n,this._snappingTask=null,this._stagedVertex=null,this.snapToSceneEnabled=null,(0,o.Wi)(e.elevationInfo)&&(this.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0})}initialize(){var e,t;this.coordinateHelper=(0,y.Y6)(this.hasZ,this.hasM,this.view.spatialReference);const i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=i?i.registerTask(b.T8.SNAPPING):b.sq;const n="viewingMode"in this.view.state?this.view.state.viewingMode:u.JY.Local,a="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new _.c(new f.XE(a,this.coordinateHelper,n)),this._activeComponent=new f.wA(this.spatialReference,n),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(e=>{const t=e.vertices.map((e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)}))),i=t.map((e=>e.coordinates));switch(e.type){case"vertex-add":this.emit(e.type,{...e,added:i,vertices:t});break;case"vertex-update":this.emit(e.type,{...e,updated:i,vertices:t});break;case"vertex-remove":this.emit(e.type,{...e,removed:i,vertices:t})}}))),this._manipulator=new m({grabbableForEvent:e=>"click"!==this.drawingMode||"touch"===e.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(e=>this._onImmediateClick(e))),this._manipulator.events.on("immediate-double-click",(e=>this._onImmediateDoubleClick(e)))])}destroy(){this._editGeometryOperations=(0,o.SC)(this._editGeometryOperations),this._frameTask=(0,o.hw)(this._frameTask)}get _snappingEnabled(){return(0,o.pC)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map((e=>this.coordinateHelper.vectorToArray(e.pos)))}set drawingMode(e){this._set("drawingMode",null!=e?e:g)}get hasStagedVertex(){return(0,o.pC)(this._stagedVertex)}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return(0,o.pC)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get spatialReference(){return this.view.spatialReference}get stagedVertex(){return this._stagedVertex}set stagedVertex(e){if((0,o.Wi)(e))this.discardStagedVertex();else if(!(0,o.pC)(this._stagedVertex)||!(0,d.k)(this._stagedVertex,e)){if((0,o.Wi)(this._stagedVertex))this._stagedVertex=(0,s.d9)(e);else{if((0,d.k)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}get updating(){return this.updatingHandles.updating}get vertices(){const e=this.committedVertices;return(0,o.pC)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingTask=(0,o.IM)(this._snappingTask),(0,o.pC)(this._stagedVertex)){const e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}complete(e){const t=e&&e.aborted||!1;(0,o.IM)(this._snappingTask),(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();const i="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!i,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map(((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e}))),aborted:t,type:"complete"})}discardStagedVertex(){this._stagedVertex=null}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(e){const t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return(0,v.Xd)(e,((e,t,i,n)=>{const a="touch"===n&&this._snappingEnabled;!this.isCompleted&&a&&(t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&(this.stagedVertex=e.mapStart,("segment"===this.geometryType||a&&0===this.numVertices)&&this.commitStagedVertex()),e))).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>a,cancel:i,snappingManager:this.snappingManager,snappingContext:new x.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:n,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles}),this._snappingPipeline.next).next((e=>(a&&(this.stagedVertex=e.mapEnd,"end"===e.action&&this.commitStagedVertex()),e))).next((e=>("end"===e.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),e))),i.next((()=>{a&&(0,o.pC)(this.snappingManager)&&this.snappingManager.doneSnapping()})))}))}_createManipulatorDragPipelineFreehand(e){return(0,v.Xd)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&((0,o.Wi)(this.stagedVertex)&&(this.stagedVertex=e.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return e}))}))}_createManipulatorDragPipelineHybrid(e){return(0,v.Xd)(e,((e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next((e=>("start"===e.action&&((0,o.Wi)(this.stagedVertex)&&(this.stagedVertex=e.mapStart),this.commitStagedVertex()),e))).next((e=>{switch(e.action){case"start":case"update":this.stagedVertex=e.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return e}))}))}_getDrawSurface(){if((0,o.Wi)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let e=this.defaultZ,t=!1;(0,o.pC)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),(0,o.pC)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),(0,o.pC)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);const i=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&i>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}_mapToScreen(e){return this._getDrawSurface().mapToScreen(e)}_onHold(e){(0,o.IM)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)return;const t=this._activeComponent,i=this._closeOnClickVertexIndex(e.screenPoint);if((0,o.pC)(i))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();const n=this._screenToMap(e.screenPoint);if((0,o.pC)(n))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),this.complete());break;case"click":case"hybrid":this._snappingTask=(0,o.IM)(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(n)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}_onImmediateDoubleClick(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}_onPointerMove(e){if((0,o.IM)(this._snappingTask),this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return;const t=(0,p.vW)(e.x,e.y),i=this._closeOnClickVertexIndex(t);if((0,o.pC)(i)){this.discardStagedVertex();const e={componentIndex:0,vertexIndex:i,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[i].pos)};this.emit("cursor-update",{updated:null,vertices:[e],operation:"apply",type:"vertex-update"})}else{const i=this._screenToMap(t);if(this._manipulator.cursor=(0,o.pC)(i)?"crosshair":null,(0,o.pC)(i))if((0,o.pC)(this.snappingManager)){const t=this.snappingManager,n=new x.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=t.update(i,n),this._snappingTask=(0,l.vr)((async e=>{const a=await this._frameTask.schedule((()=>t.snap(i,n,e)),e);a.valid&&await this._frameTask.schedule((()=>{this.stagedVertex=a.apply()}),e)})),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=i}e.stopPropagation()}_screenToMap(e){return this._getDrawSurface().screenToMap(e)}_screenToMapDragEventStep(){let e=null;return t=>{if("start"===t.action&&(e=this._screenToMap(t.screenStart)),(0,o.Wi)(e))return null;const i=this._screenToMap(t.screenEnd);return(0,o.pC)(i)?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!(0,o.pC)(i)&&function(e,t,i){const n=e.x-t.x,a=e.y-t.y;return n*n+a*a<=i}(i,t,25)}};(0,n._)([(0,h.Cb)()],C.prototype,"defaultZ",void 0),(0,n._)([(0,h.Cb)({value:g})],C.prototype,"drawingMode",null),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"elevationDrawSurface",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"elevationInfo",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"geometryType",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"hasM",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"hasZ",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"manipulators",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"drawSurface",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"snappingManager",void 0),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"snappingVisualizer",void 0),(0,n._)([(0,h.Cb)()],C.prototype,"snapToSceneEnabled",void 0),(0,n._)([(0,h.Cb)({readOnly:!0})],C.prototype,"updating",null),(0,n._)([(0,h.Cb)({constructOnly:!0})],C.prototype,"view",void 0),C=(0,n._)([(0,c.j)("esri.views.draw.DrawOperation")],C)},54016:(e,t,i)=>{i.d(t,{aL:()=>o,hP:()=>p,iW:()=>l});var n=i(92026),a=i(17842),r=i(65618),s=i(74509);class o{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.elevationInfo=e,this.defaultZ=t,this.view=i,this.excludeGraphics=n}screenToMap(e){if((0,n.pC)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);const t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,a.s1)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return(0,n.pC)(t)&&(t.z=void 0),t}mapToScreen(e){const t=(0,r.Tx)(e.x,e.y,(0,s.vQ)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}class l{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.view=e,this.elevationInfo=t,this.exclude=i}screenToMap(e){const t=this.view.toMap(e,{exclude:this.exclude});return(0,n.pC)(t)&&(t.z=(0,s.Ou)(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return(0,n.pC)(this.elevationInfo)&&(t=(0,r.Tx)(e.x,e.y,(0,s.vQ)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}class p{constructor(e){this.view=e,this.screenToMap=t=>e.toMap(t),this.mapToScreen=t=>e.toScreen(t)}}},29919:(e,t,i)=>{i.d(t,{m:()=>y});var n,a=i(27366),r=i(85015),s=i(32718),o=i(92026),l=i(66978),p=i(49861),h=(i(63780),i(93169),i(25243),i(69912)),c=i(24043),d=i(99034),u=i(81608);!function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"}(n||(n={}));class m{constructor(){this._isToolEditable=!0,this._manipulators=new u.Z,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.WhenToolEditable;return this.addMany([e],t)[0]}addMany(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.WhenToolEditable;return e.map((e=>{const i=this._nextManipulatorId++,n={id:i,manipulator:e,visibilityPredicate:t,attached:!1};return this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n),i}))}remove(e){if("number"==typeof e){const t=e;for(let e=0;e<this._manipulators.length;e++)if(this._manipulators.getItemAt(e).id===t){const t=this._manipulators.splice(e,1)[0];return this._detachManipulator(t),t.id}return null}const t=e;for(let i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).manipulator===t){const e=this._manipulators.splice(i,1)[0];return this._detachManipulator(e),e.id}return null}removeAll(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._manipulators.removeAll()}attach(){this._manipulators.forEach((e=>{this._updateManipulatorAttachment(e)})),this._attached=!0}detach(){this._manipulators.forEach((e=>{this._detachManipulator(e)})),this._attached=!1}destroy(){this._manipulators.forEach((e=>{let{manipulator:t}=e;t.destroy&&t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,(e=>{t(e)}))}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach((t=>e.push(t.manipulator))),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((a=>{let{id:r,manipulator:s,attached:l}=a;if(!l||!s.interactive)return;const p=s.intersectionDistance(e,t);(0,o.pC)(p)&&p<n&&(n=p,i={id:r,manipulator:s})})),i}findById(e){if((0,o.Wi)(e))return null;for(const t of this._manipulators.items)if(e===t.id)return t.manipulator;return null}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===n.Always||(this._isToolEditable?e.visibilityPredicate===n.WhenToolEditable:e.visibilityPredicate===n.WhenToolNotEditable)}}const g=s.Z.getLogger("esri.views.interactive.InteractiveToolBase");let y=class extends r.Z{constructor(e){super(e),this.manipulators=new m,this.updating=!1,this.automaticManipulatorSelection=!0,this._editableFlags=new Map([[d.bH.MANAGER,!0],[d.bH.USER,!0]]),this._creationStartedResolver=(0,l.hh)(),this._creationFinishedResolver=(0,l.hh)()}set toolState(e){this._set("toolState",e),this._syncVisible()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(d.bH.USER)}set editable(e){this.setEditableFlag(d.bH.USER,e)}get created(){return"created"===this.toolState}get cursor(){return null}initialize(){this._syncVisible()}destroy(){this.manipulators.destroy(),this._set("view",null)}activate(){(0,o.Wi)(this.view)?g.error("Can't activate tool if view is not defined."):((0,c.t)(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===d.bH.USER&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(e){return this._editableFlags.get(e)}whenCreationStarted(){return this._creationStartedResolver.promise}whenCreated(){return this._creationFinishedResolver.promise}rejectCreation(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(d.bH.USER)&&this.getEditableFlag(d.bH.MANAGER)}startToolCreation(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}}_syncVisible(){if("pending"!==this.toolState)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,a._)([(0,p.Cb)({value:"pending"})],y.prototype,"toolState",null),(0,a._)([(0,p.Cb)({constructOnly:!0})],y.prototype,"view",void 0),(0,a._)([(0,p.Cb)({readOnly:!0})],y.prototype,"active",null),(0,a._)([(0,p.Cb)({value:!0})],y.prototype,"visible",null),(0,a._)([(0,p.Cb)({value:!0})],y.prototype,"editable",null),(0,a._)([(0,p.Cb)({readOnly:!0})],y.prototype,"created",null),(0,a._)([(0,p.Cb)({readOnly:!0})],y.prototype,"manipulators",void 0),(0,a._)([(0,p.Cb)({readOnly:!0})],y.prototype,"updating",void 0),(0,a._)([(0,p.Cb)()],y.prototype,"cursor",null),(0,a._)([(0,p.Cb)()],y.prototype,"automaticManipulatorSelection",void 0),y=(0,a._)([(0,h.j)("esri.views.interactive.InteractiveToolBase")],y)},74229:(e,t,i)=>{i.d(t,{AN:()=>x,M2:()=>u,QY:()=>_,Xd:()=>d,a9:()=>m,bD:()=>f,hM:()=>C,kY:()=>b,oq:()=>y,zh:()=>w});i(59486);var n=i(84652),a=i(16889),r=i(92026),s=i(17842),o=i(71353),l=i(79803),p=i(50951),h=i(20008),c=i(7882);function d(e,t){return e.events.on("drag",function(e,t){let i=null,n=null;return a=>{if("cancel"===a.action)return void((0,r.pC)(n)&&(n.execute({action:"cancel"}),i=null,n=null));const s={action:a.action,screenStart:a.start,screenEnd:a.screenPoint};"start"===a.action&&(0,r.Wi)(i)&&(i=new C,n=new C,t(e,i,n,a.pointerType,s)),(0,r.pC)(i)&&i.execute(s),"end"===a.action&&(0,r.pC)(i)&&(i=null,n=null)}}(e,t))}function u(e,t){const i=[e.x,e.y,e.z],n=t,a=[Math.cos(n),Math.sin(n)],r=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===r)return null;a[0]/=r,a[1]/=r;const s=e=>{const t=(e.x-i[0])*a[0]+(e.y-i[1])*a[1];e.x=i[0]+t*a[0],e.y=i[1]+t*a[1]};return e=>(s(e.mapStart),s(e.mapEnd),e)}function m(e,t){let i=null;return n=>{if("start"===n.action&&(i=function(e,t,i){const n=e.geometry;if((0,r.Wi)(n))return null;if("mesh"===n.type)return function(e,t,i,n){if((0,r.pC)(t.transform))return function(e,t,i,n){const a=g(i.getOriginPoint(t.spatialReference),n),s=t.spatialReference;return(0,r.Wi)(a)?null:{move:(t,n,p)=>{const c=(0,h.pB)(a.clone(),t,n,p);if(c.spatialReference.equals(s))i.origin=(0,o.f)(c.x,c.y,c.z);else{const e=(0,l.iV)(c,s);(0,r.pC)(e)&&(i.origin=(0,o.f)(e.x,e.y,e.z))}e.notifyMeshTransformChanged(),e.notifyGeometryChanged()}}}(e,t,t.transform,i);if(!t.spatialReference.equals(i))return null;let a=0,s=0,d=0;return{move:(i,r,o)=>{const l=i-a,h=r-s,u=o-d;if(l||h||u){const m=new c.Z(t.origin.x+l,t.origin.y+h,t.origin.z+u,t.origin.spatialReference);t.centerAt(m,{geographic:n===p.JY.Global}),e.notifyGeometryChanged(),a=i,s=r,d=o}}}}(e,n,t,i);const a=g(n,t),s=n.spatialReference;return(0,r.Wi)(a)?null:{move:(t,i,n)=>{const r=(0,h.pB)(a.clone(),t,i,n);r.spatialReference.equals(s)?e.geometry=r:e.geometry=(0,l.iV)(r,s)}}}(e,n.mapStart.spatialReference,t)),(0,r.Wi)(i))return null;const a=n.mapEnd.x-n.mapStart.x,s=n.mapEnd.y-n.mapStart.y,d=n.mapEnd.z-n.mapStart.z;return i.move(a,s,d),{...n,translationX:a,translationY:s,translationZ:d}}}function g(e,t){return(0,r.Wi)(e)?null:e.spatialReference.equals(t)?e.clone():(0,l.iV)(e,t)}function y(e,t){const i=e.map((e=>(0,r.Wg)(m(e,t)))).filter((e=>(0,r.pC)(e)));return e=>{const t=e.mapEnd.x-e.mapStart.x,n=e.mapEnd.y-e.mapStart.y,a=e.mapEnd.z-e.mapStart.z;return i.forEach((t=>t(e))),{...e,translationX:t,translationY:n,translationZ:a}}}function v(e,t){const i=new Map;for(const a of t)i.set(a,(0,n.d9)(e[a]));return t=>(i.forEach(((t,i)=>{e[i]=t})),t)}function f(e){return(0,r.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){const i=(0,r.pC)(t.transform)?t.transform.clone():null,n=t.vertexAttributes.clonePositional();return a=>(t.transform=i,t.vertexAttributes=n,e.notifyGeometryChanged(),a)}(e,e.geometry):v(e,["geometry"])}function _(e){const t=e.map((e=>(0,r.Wg)(f(e)))).filter((e=>(0,r.pC)(e)));return e=>(t.forEach((t=>t(e))),e)}function x(){let e=0,t=0,i=0;return n=>{"start"===n.action&&(e=n.mapStart.x,t=n.mapStart.y,i=n.mapStart.z);const a=n.mapEnd.x-e,r=n.mapEnd.y-t,s=n.mapEnd.z-i;return e=n.mapEnd.x,t=n.mapEnd.y,i=n.mapEnd.z,{...n,mapDeltaX:a,mapDeltaY:r,mapDeltaZ:s,mapDeltaSpatialReference:n.mapStart.spatialReference}}}function w(){let e=0,t=0;return i=>{"start"===i.action&&(e=i.screenStart.x,t=i.screenStart.y);const n=i.screenEnd.x-e,a=i.screenEnd.y-t;return e=i.screenEnd.x,t=i.screenEnd.y,{...i,screenDeltaX:n,screenDeltaY:a}}}function b(e,t){let i=null,n=0,r=0;return o=>{if("start"===o.action&&(i=e.toScreen(t),i.x<0||i.x>e.width||i.y<0||i.y>e.height?i=null:(n=o.screenStart.x-i.x,r=o.screenStart.y-i.y)),null==i)return null;const l=(0,a.uZ)(o.screenEnd.x-n,0,e.width),p=(0,a.uZ)(o.screenEnd.y-r,0,e.height),h=(0,s.vW)(l,p);return o.screenStart=i,o.screenEnd=h,o}}class C{constructor(){this.execute=()=>{}}next(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new C;return(0,r.pC)(e)&&(this.execute=i=>{const n=e(i);(0,r.pC)(n)&&t.execute(n)}),t}}},80151:(e,t,i)=>{i.d(t,{n:()=>p});var n=i(92026),a=i(66978),r=i(70178),s=i(74229),o=i(34019),l=i(99912);class p{constructor(){this.next=new s.hM}createSnapDragEventPipelineStep(e){let{predicate:t=(()=>!0),cancel:i,snappingManager:p,snappingContext:h,updatingHandles:c}=e;if((0,n.Wi)(p))return e=>e;let d=null,u=null;const m=()=>{d=(0,n.IM)(d),p.doneSnapping(),(0,n.pC)(u)&&u.frameTask.remove(),u=null};return i.next((e=>(m(),e))),this.next=new s.hM,e=>{if(!t(e))return e;if(d=(0,n.IM)(d),"start"===e.action){const t="3d"===p.view.type?p.view.resourceController.scheduler.registerTask(l.T8.SNAPPING):l.sq;u={context:new o.N({editGeometryOperations:h.editGeometryOperations,elevationInfo:h.elevationInfo,pointer:h.pointer,vertexHandle:(0,n.pC)(e.info)?e.info.handle:null,excludeFeature:h.excludeFeature,visualizer:h.visualizer}),originalPos:(0,n.pC)(e.snapOrigin)?h.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,frameTask:t}}if((0,n.pC)(u)){const t=u.context.coordinateHelper.vectorToDehydratedPoint(u.context.coordinateHelper.arrayToVector([u.originalPos.x,u.originalPos.y,u.originalPos.z]));t.x+=e.mapEnd.x-e.mapStart.x,t.y+=e.mapEnd.y-e.mapStart.y;const i=e.mapStart.x-u.originalPos.x,n=e.mapStart.y-u.originalPos.y,s={...e,action:"udpate"},o=u.context,l=p.update(t,u.context);if(e.mapEnd.x=l.x+i,e.mapEnd.y=l.y+n,"end"!==e.action){const e=u.frameTask;d=(0,a.vr)((async a=>{const h=await e.schedule((()=>p.snap(t,o,a)),a);if(h.valid){const t=await e.schedule((()=>h.apply()),a);(0,r.k)(t,l)||(s.mapEnd.x=t.x+i,s.mapEnd.y=t.y+n,this.next.execute(s))}})),c.addPromise(d.promise)}}return"end"===e.action&&m(),e}}}}}]);
//# sourceMappingURL=2490.f4a8ca40.chunk.js.map