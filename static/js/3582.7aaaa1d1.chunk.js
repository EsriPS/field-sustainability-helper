"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[3582],{41978:function(e,t,r){r.d(t,{AM:function(){return g}});var n=r(93433),i=r(15671),a=r(43144),l=r(60136),s=r(54062),o=r(27366),u=r(85015),c=r(93169),d=r(84652),f=r(32718),y=r(49861),h=(r(25243),r(69912)),p=r(85411),v=r(32551),m=-1,g=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e))._from=null,n._to=null,n._final=null,n._current=[],n._time=0,n.duration=(0,c.Z)("mapview-transitions-duration"),n.effects=[],n}return(0,a.Z)(r,[{key:"effect",set:function(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(b(e))}catch(t){this._transitionTo([]),f.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(e){this._updateForScale(e)}},{key:"transitioning",get:function(){return null!==this._to}},{key:"canTransitionTo",value:function(e){try{return this.scale>0&&_(this._current,b(e),this.scale)}catch(t){return!1}}},{key:"transitionStep",value:function(e,t){this._applyTimeTransition(e),this._updateForScale(t)}},{key:"end",value:function(){this._applyTimeTransition(this.duration)}},{key:"_transitionTo",value:function(e){this.scale>0&&_(this._current,e,this.scale)?(this._final=e,this._to=(0,d.d9)(e),function(e,t,r){for(var i,a,l=e.length>t.length?e:t,s=e.length>t.length?t:e,o=s[s.length-1],u=null!=(i=null==o?void 0:o.scale)?i:r,c=null!=(a=null==o?void 0:o.effects)?a:[],d=s.length;d<l.length;d++)s.push({scale:u,effects:(0,n.Z)(c)});for(var f=0;f<l.length;f++)s[f].scale=s[f].scale===m?r:s[f].scale,l[f].scale=l[f].scale===m?r:l[f].scale,(0,v.uF)(s[f].effects,l[f].effects)}(this._current,this._to,this.scale),this._from=(0,d.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[])}},{key:"_applyTimeTransition",value:function(e){if(this._to&&this._from&&this._current&&this._final){this._time+=e;for(var t=Math.min(1,this._time/this.duration),r=0;r<this._current.length;r++){var n=this._current[r],i=this._from[r],a=this._to[r];n.scale=w(i.scale,a.scale,t);for(var l=0;l<n.effects.length;l++){var s=n.effects[l],o=i.effects[l],u=a.effects[l];s.interpolate(o,u,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}}},{key:"_updateForScale",value:function(e){if(this._set("scale",e),0!==this._current.length){var t,r,n=this._current,i=this._current.length-1,a=1;if(1===n.length||e>=n[0].scale)r=t=n[0].effects;else if(e<=n[i].scale)r=t=n[i].effects;else for(var l=0;l<i;l++){var s=n[l],o=n[l+1];if(s.scale>=e&&o.scale<=e){a=(e-s.scale)/(o.scale-s.scale),t=s.effects,r=o.effects;break}}for(var u=0;u<this.effects.length;u++)this.effects[u].interpolate(t[u],r[u],a)}}}]),r}(u.Z);function b(e){var t=(0,p.Q)(e)||[];return function(e){var t=e[0];return!!t&&"type"in t}(t)?[{scale:m,effects:t}]:t}function _(e,t,r){var n,i,a,l;return null==(n=e[0])||!n.effects||null==(i=t[0])||!i.effects||!(((null==(a=e[0])?void 0:a.scale)===m||(null==(l=t[0])?void 0:l.scale)===m)&&(e.length>1||t.length>1)&&r<=0)&&(0,v.AS)(e[0].effects,t[0].effects)}function w(e,t,r){return e+(t-e)*r}(0,o._)([(0,y.Cb)()],g.prototype,"_to",void 0),(0,o._)([(0,y.Cb)()],g.prototype,"duration",void 0),(0,o._)([(0,y.Cb)({value:""})],g.prototype,"effect",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"effects",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"hasEffects",null),(0,o._)([(0,y.Cb)({value:0})],g.prototype,"scale",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"transitioning",null),g=(0,o._)([(0,h.j)("esri.layers.effects.EffectView")],g)},44041:function(e,t,r){r.d(t,{R:function(){return g}});var n=r(1413),i=r(15671),a=r(43144),l=r(60136),s=r(54062),o=r(27366),u=r(85015),c=r(41691),d=r(92026),f=r(49861),y=(r(63780),r(93169),r(25243),r(69912)),h=r(45948),p=r(58132),v=r(10141),m={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},g=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).floors=null,n.scale=0,n}return(0,a.Z)(r,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var r=(0,v.ff)(e.floors,t);return t.toExportImageJSON(r)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,p.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(m[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,r=!(null==(e=this.floors)||!e.length),n=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?JSON.stringify(n.reduce((function(e,r){var n=(0,v.ff)(t.floors,r),i=(0,d.pC)(n)?(0,v.Hp)(n,r):r.definitionExpression;return e[r.id]=i,e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers;r&&r.forEach((function r(n){var i=e.scale,a=0===i,l=0===n.minScale||i<=n.minScale,s=0===n.maxScale||i>=n.maxScale;n.visible&&(a||l&&s)&&(n.sublayers?n.sublayers.forEach(r):t.unshift(n))}));var n=this._get("visibleSublayers");return!n||n.length!==t.length||n.some((function(e,r){return t[r]!==e}))?t:n}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,n.Z)((0,n.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),r}((0,c.p)(u.Z));(0,o._)([(0,f.Cb)({readOnly:!0})],g.prototype,"dynamicLayers",null),(0,o._)([(0,f.Cb)()],g.prototype,"floors",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],g.prototype,"hasDynamicLayers",null),(0,o._)([(0,f.Cb)()],g.prototype,"layer",null),(0,o._)([(0,f.Cb)({readOnly:!0})],g.prototype,"layers",null),(0,o._)([(0,f.Cb)({readOnly:!0})],g.prototype,"layerDefs",null),(0,o._)([(0,f.Cb)({type:Number})],g.prototype,"scale",void 0),(0,o._)([(0,f.Cb)(h.qG)],g.prototype,"timeExtent",void 0),(0,o._)([(0,f.Cb)({readOnly:!0})],g.prototype,"version",null),(0,o._)([(0,f.Cb)({readOnly:!0})],g.prototype,"visibleSublayers",null),g=(0,o._)([(0,y.j)("esri.layers.mixins.ExportImageParameters")],g)},58132:function(e,t,r){r.d(t,{FN:function(){return l},QV:function(){return a},ac:function(){return o}});var n=r(37762),i=r(25265);function a(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!s(e,t))}function l(e,t,r){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(!t.gdbVersion||t.gdbVersion===r.gdbVersion))||e.originIdOf("renderer")>i.s3.SERVICE||e.originIdOf("labelingInfo")>i.s3.SERVICE||e.originIdOf("opacity")>i.s3.SERVICE||e.originIdOf("labelsVisible")>i.s3.SERVICE}))||!s(e,t)}function s(e,t){if(!e||!e.length)return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var i,a=0,l=r.length,s=(0,n.Z)(e);try{for(s.s();!(i=s.n()).done;){for(var o=i.value.id;a<l&&r[a]!==o;)a++;if(a>=l)return!1}}catch(u){s.e(u)}finally{s.f()}return!0}function o(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},61029:function(e,t,r){r.d(t,{e:function(){return l},s:function(){return s}});r(93169);var n=r(10064),i=r(92026),a=r(23707);function l(e){return(0,i.Wi)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function s(e){if((0,i.Wi)(e))return null;if(!l(e))return new n.Z("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return function(e){return o(e,(0,a.q)(e.symbol).error)}(e);case"unique-value":return function(e){var t=e.uniqueValueInfos.map((function(e){return(0,a.q)(e.symbol).error})).filter((function(e){return!!e})),r=(0,a.q)(e.defaultSymbol);return r.error&&t.unshift(r.error),o(e,t)}(e);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return(0,a.q)(e.symbol).error})).filter((function(e){return!!e})),r=(0,a.q)(e.defaultSymbol);return r.error&&t.unshift(r.error),o(e,t)}(e);case"dictionary":case"heatmap":return null}return null}function o(e,t){if(!t)return null;var r;if((r=Array.isArray(t)?t:[t]).length>0){var i=r.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));i.sort();var a=[];return i.forEach((function(e,t){0!==t&&e===i[t-1]||a.push(e)})),new n.Z("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(a.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:r})}return null}},10141:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!=(t=r.floorInfo)&&t.floorField&&"floors"in e.view?l(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!=(r=t.floorInfo)&&r.floorField?l(e,t.floorInfo.floorField):null}function a(e,t){var r=t.definitionExpression;return e?r?"(".concat(r,") AND (").concat(e,")"):e:r}function l(e,t){if(null==e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{Hp:function(){return a},cx:function(){return n},ff:function(){return i}})},63582:function(e,t,r){r.r(t),r.d(t,{default:function(){return fi}});var n=r(1413),i=r(15671),a=r(43144),l=r(60136),s=r(54062),o=r(27366),u=r(100),c=r(8537),d=r(8025),f=(r(63780),r(93169),r(89125)),y=r(49861),h=r(69912),p=r(27496),v=(r(59166),r(85015)),m=r(81608),g=(r(25243),r(37762)),b=r(74165),_=r(93433),w=r(15861),L=r(51995),k=r(19545),x=r(76200),S=r(51508),I=r(43404),C=r(32718),A=r(92026),E=r(66978),Z=r(17842),V=r(35995),F=r(25265),R=r(41978),z=r(60676),M=r(44041),T=r(80031),O=r(9014),N=r(61029),D=r(12726),B=r(49729),P=r(37817),H=r(69157),q=r(86828),U=r(74579),W=r(245);function j(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var r=e.visualVariables.find((function(e){return"size"===e.type})),n=function(e,t){var r=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!=t&&t.levels?t.levels[r]:null}(t,r);return n?new W.Z({field:r.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}var Y=r(76969),G=r(6291),Q=/^-?(\d+)(\.(\d+))?$/i;function J(e,t){return e-t}function X(e,t){var r,n;return(r=Number(e.toFixed(t)))<e?n=r+1/Math.pow(10,t):(n=r,r-=1/Math.pow(10,t)),[r=Number(r.toFixed(t)),n=Number(n.toFixed(t))]}function K(e,t,r,n,i){var a=ee(e,t,r,n),l=null==a.previous||a.previous<=i,s=null==a.next||a.next<=i;return l&&s||a.previous+a.next<=2*i}function $(e){var t=String(e),r=t.match(Q);if(r&&r[1])return{integer:r[1].split("").length,fractional:r[3]?r[3].split("").length:0};if(t.toLowerCase().indexOf("e")>-1){var n=t.split("e"),i=n[0],a=n[1];if(i&&a){var l=Number(i),s=Number(a),o=s>0;o||(s=Math.abs(s));var u=$(l);return o?(u.integer+=s,s>u.fractional?u.fractional=0:u.fractional-=s):(u.fractional+=s,s>u.integer?u.integer=1:u.integer-=s),u}}return{integer:0,fractional:0}}function ee(e,t,r,n){var i={previous:null,next:null};if(null!=r){var a=e-r,l=t-r-a;i.previous=Math.floor(Math.abs(100*l/a))}if(null!=n){var s=n-e,o=n-t-s;i.next=Math.floor(Math.abs(100*o/s))}return i}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.slice(0),n=t.tolerance,i=void 0===n?2:n,a=t.strictBounds,l=void 0!==a&&a,s=t.indexes,o=void 0===s?r.map((function(e,t){return t})):s;o.sort(J);for(var u=0;u<o.length;u++){var c=o[u],d=r[c],f=0===c?null:r[c-1],y=c===r.length-1?null:r[c+1],h=$(d).fractional;if(h){for(var p=void 0,v=0,m=!1;v<=h&&!m;){var g=X(d,v);m=K(d,p=l&&0===u?g[1]:g[0],f,y,i),v++}m&&(r[c]=p)}}return r}var re={maximumFractionDigits:20};function ne(e){return(0,G.uf)(e,re)}var ie=r(16851),ae=(0,Y.Ze)("short-date");function le(e,t,r,n){var i="";0===t?i="".concat("<"," "):t===r&&(i="".concat(">"," "));return i+(n?(0,Y.p6)(e,ae):ne(e))}var se=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];function oe(e){return ue.apply(this,arguments)}function ue(){return ue=(0,w.Z)((0,b.Z)().mark((function e(t){var n,i,a,l,s,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.visualVariables.find((function(e){return"color"===e.type}))){e.next=5;break}return e.abrupt("return",null);case 5:if(i=null,a=null,!n.stops){e.next=10;break}if(1!==n.stops.length){e.next=9;break}return e.abrupt("return",n.stops[0].color);case 9:i=n.stops[0].value,a=n.stops[n.stops.length-1].value;case 10:return l=i+(a-i)/2,e.next=13,Promise.resolve().then(r.bind(r,56011));case 13:return s=e.sent,o=s.getColor,e.abrupt("return",o(n,l));case 16:case"end":return e.stop()}}),e)}))),ue.apply(this,arguments)}function ce(e,t){return de.apply(this,arguments)}function de(){return de=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.trailWidth||1,e.t1=r,e.t1){e.next=6;break}return e.next=5,oe(t);case 5:e.t1=e.sent;case 6:if(e.t0=e.t1,e.t0){e.next=9;break}e.t0=t.color;case 9:return i=e.t0,e.abrupt("return",new ie.Z({cap:"butt",color:i,width:n}));case 11:case"end":return e.stop()}}),e)}))),de.apply(this,arguments)}var fe=new L.Z([64,64,64]);function ye(e,t){var r=[],n=e.length-1;return 5===e.length?r.push(0,2,4):r.push(0,n),e.map((function(e,i){return r.indexOf(i)>-1?le(e,i,n,t):null}))}function he(e,t,r){return pe.apply(this,arguments)}function pe(){return pe=(0,w.Z)((0,b.Z)().mark((function e(t,n,i){var a,l,s,o,u,c,d;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!1,l=[],s=[],t.stops&&(o=t.stops,l=o.map((function(e){return e.value})),a=o.some((function(e){return!!e.label})),a&&(s=o.map((function(e){return e.label})))),u=l[0],c=l[l.length-1],null!=u||null!=c){e.next=5;break}return e.abrupt("return",null);case 5:return d=a?null:ye(l,i),e.next=8,Promise.all(l.map(function(){var e=(0,w.Z)((0,b.Z)().mark((function e(i,l){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i,"opacity"!==t.type){e.next=7;break}return e.next=4,ve(i,t,n);case 4:e.t1=e.sent,e.next=10;break;case 7:return e.next=9,Promise.resolve().then(r.bind(r,56011));case 9:e.t1=e.sent.getColor(t,i);case 10:return e.t2=e.t1,e.t3=a?s[l]:d[l],e.abrupt("return",{value:e.t0,color:e.t2,label:e.t3});case 13:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",e.sent.reverse());case 9:case"end":return e.stop()}}),e)}))),pe.apply(this,arguments)}function ve(e,t){return me.apply(this,arguments)}function me(){return me=(0,w.Z)((0,b.Z)().mark((function e(t,n){var i,a,l,s=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.length>2&&void 0!==s[2]?s[2]:fe,a=new L.Z(i),e.next=4,Promise.resolve().then(r.bind(r,56011));case 4:return l=e.sent.getOpacity(n,t),e.abrupt("return",(null!=l&&(a.a=l),a));case 6:case"end":return e.stop()}}),e)}))),me.apply(this,arguments)}function ge(e){var t,r=[],n=[];r=e.map((function(e){return e.value})),(t=e.some((function(e){return!!e.label})))&&(n=e.map((function(e){return e.label})));var i=r[0],a=r[r.length-1];if(null==i&&null==a)return null;var l=t?null:ye(r,!1);return r.map((function(r,i){return{value:r,color:be(r,e),label:t?n[i]:l[i]}})).reverse()}function be(e,t){var r=function(e,t){var r=0,n=t.length-1;return t.some((function(t,i){return e<t.value?(n=i,!0):(r=i,!1)})),{startIndex:r,endIndex:n,weight:(e-t[r].value)/(t[n].value-t[r].value)}}(e,t),n=r.startIndex,i=r.endIndex,a=r.weight;if(n===i)return t[n].color;var l=L.Z.blendColors(t[n].color,t[i].color,a);return new L.Z(l)}var _e=r(6711);function we(e){var t=e.colorStops,r=t.length-1;if(t&&t[0]){var n=t[r];n&&1!==n.ratio&&((t=t.slice(0)).push(new _e.Z({ratio:1,color:n.color})),r++)}return t.map((function(e,t){var n="";return 0===t?n="low":t===r&&(n="high"),{color:e.color,label:n,ratio:e.ratio}})).reverse()}r(84652);var Le=r(79563),ke=r(36009),xe={HH:315,HL:45,LL:135,LH:225},Se={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function Ie(e){if(e){var t=e.type;if(t.indexOf("3d")>-1)return(0,ke.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){var r=(0,Le.mx)(e);return r&&r.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){var n=(0,Le.mx)(e);return n&&n.color}return(0,Le._M)(e)}}function Ce(e,t){var r=t.HH.label,n=t.LL.label,i=t.HL.label,a=t.LH.label;switch(e){case"HH":default:return{top:r,bottom:n,left:i,right:a};case"HL":return{top:i,bottom:a,left:n,right:r};case"LL":return{top:n,bottom:r,left:a,right:i};case"LH":return{top:a,bottom:i,left:r,right:n}}}function Ae(e){var t=e.focus,r=e.infos,n=e.numClasses,i=Se[n],a={};r.forEach((function(e){a[e.value]={label:e.label,fill:Ie(e.symbol)}}));for(var l=[],s=0;s<n;s++){for(var o=[],u=0;u<n;u++){var c=a[i[s][u]];o.push(c.fill)}l.push(o)}return{type:"relationship-ramp",numClasses:n,focus:t,colors:l,labels:Ce(t,a),rotation:Ee(t)}}function Ee(e){var t=xe[e];return e&&null==t&&(t=xe.HH),t||0}var Ze=r(29439),Ve=r(2278),Fe=[255,255,255],Re=[200,200,200],ze=[128,128,128];function Me(e,t){var r=e.length-1;return e.map((function(e,n){return le(e,n,r,t)}))}function Te(e,t,r,n,i,a){return Oe.apply(this,arguments)}function Oe(){return Oe=(0,w.Z)((0,b.Z)().mark((function e(t,r,n,i,a,l){var s,o,u,c,d,f,y,h,p,v,m,g,_,L,k,x,S,I,C,A;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.legendOptions,c=u&&u.customValues,e.next=4,Be(t,n);case 4:if(d=e.sent,f=!!d,y=!!c,h=null!=r.minSize&&null!=r.maxSize,p=r.stops&&r.stops.length>1,v=!!r.target,f&&(y||h||p&&!v)){e.next=12;break}return e.abrupt("return");case 12:if(m=(0,U.YW)(d),g=null,_=null,L=null,!m||p){e.next=18;break}e.t0=te([r.minDataValue,r.maxDataValue]),e.next=24;break;case 18:if(e.t1=c,e.t1){e.next=23;break}return e.next=22,We(r,d,i,a);case 22:e.t1=e.sent;case 23:e.t0=e.t1;case 24:if(_=e.t0,k=null==t?void 0:t.authoringInfo,x="univariate-color-size"===(null==k?void 0:k.type),S=x&&"above-and-below"===(null==k?void 0:k.univariateTheme),!_&&p&&(_=r.stops.map((function(e){return e.value})),g=r.stops.some((function(e){return!!e.label})),"flow"===t.type&&(_=te(_)),g&&(L=r.stops.map((function(e){return e.label})))),m&&(null==(s=_)?void 0:s.length)>2&&!S&&(_=[_[0],_[_.length-1]]),_){e.next=28;break}return e.abrupt("return",null);case 28:return x&&5!==(null==(o=_)?void 0:o.length)&&(_=Ye({minSize:_[0],maxSize:_[_.length-1]})),I=m?Ne(t,_):null,C=(0,U.Y6)(d),A=g?null:Me(_,l),e.next=32,Promise.all(_.map(function(){var e=(0,w.Z)((0,b.Z)().mark((function e(n,l){var s;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=4;break}e.t0=I[l],e.next=7;break;case 4:return e.next=6,Xe(r,d,n,i,a);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",{value:n,symbol:$e(S&&"class-breaks"===t.type?De(t,l):d,s),label:g?L[l]:A[l],size:s,outlineSize:C});case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 32:return e.abrupt("return",e.sent.reverse());case 33:case"end":return e.stop()}}),e)}))),Oe.apply(this,arguments)}function Ne(e,t){var r=null==e?void 0:e.authoringInfo,n="univariate-color-size"===(null==r?void 0:r.type),i=[12,30];if(n){var a=t[0],l=t[t.length-1];i=t.map((function(e){return 12+(e-a)/(l-a)*18}))}return n&&"below"===(null==r?void 0:r.univariateTheme)&&i.reverse(),i}function De(e,t){var r=e.classBreakInfos,n=r.length,i=n<2||!(t>=2)?r[0].symbol.clone():r[n-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(i.type.indexOf("3d")>-1?qe(i):Ue(i)),i}function Be(e,t){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n,i,a,l;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("flow"!==t.type){e.next=2;break}return e.abrupt("return",ce(t,r));case 2:return n=null,i=null,"simple"===t.type?n=t.symbol:"class-breaks"===t.type?(a=t.classBreakInfos,n=a&&a[0]&&a[0].symbol,i=a.length>1):"unique-value"===t.type&&(l=t.uniqueValueInfos,n=l&&l[0]&&l[0].symbol,i=l.length>1),e.abrupt("return",!n||He(n)?null:(n=n.clone(),(r||i)&&(n.type.indexOf("3d")>-1?qe(n):Ue(n)),n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function He(e){return!!e&&((0,S.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):-1!==e.type.indexOf("fill"))}function qe(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:ze}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:Re}:(e.material={color:Fe},e.outline={color:ze,size:1.5})}))}function Ue(e){var t=(0,Ve.$o)();if("cim"===e.type)(0,B.ZB)(e,new L.Z(Re));else if(-1!==e.type.indexOf("line"))e.color=ze;else if(e.color=t?ze:Fe,"simple-marker"===e.type)if(e.outline){var r,n;"#ffffff"===(null==(r=e.outline)||null==(n=r.color)?void 0:n.toHex())&&(e.outline.color=ze)}else e.outline={color:ze,width:1.5}}function We(e,t,r,n){return je.apply(this,arguments)}function je(){return je=(0,w.Z)((0,b.Z)().mark((function e(t,n,i,a){var l,s,o,u,c;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,56011));case 2:if(l=e.sent.getSizeRangeAtScale(t,i,a),s=l&&Ye(l),l||s){e.next=6;break}return e.abrupt("return");case 6:o=s.map((function(e){return Ge(e,t,l)})),o=te(o),u=1;case 9:if(!(u<o.length-1)){e.next=17;break}return e.next=12,Qe(t,n,o[u],o[u-1],i,a);case 12:(c=e.sent)&&(o[u]=c[0],s[u]=c[1]);case 14:u++,e.next=9;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)}))),je.apply(this,arguments)}function Ye(e){for(var t=e.minSize,r=(e.maxSize-t)/4,n=[],i=0;i<5;i++)n.push(t+r*i);return n}function Ge(e,t,r){var n=r.minSize,i=r.maxSize,a=t.minDataValue,l=t.maxDataValue;return e<=n?a:e>=i?l:(e-n)/(i-n)*(l-a)+a}function Qe(e,t,r,n,i,a){return Je.apply(this,arguments)}function Je(){return Je=(0,w.Z)((0,b.Z)().mark((function e(t,r,n,i,a,l){var s,o,u,c,d,f,y,h,p,v,m,g,_,w,L,k,x,S,I,C,A,E,Z;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xe(t,r,n,a,l);case 2:return s=e.sent,e.next=5,Xe(t,r,i,a,l);case 5:o=e.sent,u=$(n),c=u.fractional,d=20,f=u.integer,y=null,h=null,n>0&&n<1&&(y=Math.pow(10,c),f=$(n*=y).integer),p=f-1;case 12:if(!(p>=0)){e.next=38;break}return v=Math.pow(10,p),m=Math.floor(n/v)*v,g=Math.ceil(n/v)*v,null!=y&&(m/=y,g/=y),w=te([m,_=(m+g)/2,g],{indexes:[1]}),L=(0,Ze.Z)(w,2),_=L[1],e.next=22,Xe(t,r,m,a,l);case 22:return k=e.sent,e.next=25,Xe(t,r,g,a,l);case 25:return x=e.sent,e.next=28,Xe(t,r,_,a,l);case 28:if(S=e.sent,I=ee(s,k,o,null),C=ee(s,x,o,null),A=ee(s,S,o,null),E=I.previous<=d,Z=C.previous<=d,E&&Z&&(I.previous<=C.previous?(E=!0,Z=!1):(Z=!0,E=!1)),E?h=[m,k]:Z?h=[g,x]:A.previous<=d&&(h=[_,S]),!h){e.next=35;break}return e.abrupt("break",38);case 35:p--,e.next=12;break;case 38:return e.abrupt("return",h);case 39:case"end":return e.stop()}}),e)}))),Je.apply(this,arguments)}function Xe(e,t,r,n,i){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,w.Z)((0,b.Z)().mark((function e(t,n,i,a,l){var s,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,56011));case 2:return s=e.sent,o=s.getSize,e.abrupt("return",o(t,i,{scale:a,view:l,shape:"simple-marker"===n.type?n.style:null}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $e(e,t){var r=e.clone();if((0,S.dU)(r))(0,U.YW)(r)||r.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(r))r.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(r)){var n=r.width,i=r.height;r.height=t,r.width=t*(n/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(r)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(r)&&r.font&&(r.font.size=t):r.width=t;return r}r(57203),C.Z.getLogger("esri.renderers.support.utils"),(0,Y.Ze)("short-date");function et(e){var t=Math.floor(Math.log10(Math.abs(e)))+1,r=t<4||t>6?4:t,n=Math.abs(e)>=1e6?"compact":"standard";return(0,G.uf)(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:r})}var tt=r(16072),rt=r(61459),nt=C.Z.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),it=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,at=new I.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),lt={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},st=new tt.Z({size:6,outline:{color:[128,128,128,.5],width:.5}}),ot=new rt.Z({style:"solid"});function ut(e){return"flow"===e.type}function ct(e){return"vector-field"===e.type}function dt(e){return"raster-colormap"===e.type}function ft(e){return"raster-stretch"===e.type}function yt(e){return"raster-shaded-relief"===e.type}function ht(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function pt(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function vt(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function mt(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function gt(e){return bt(e)||_t(e)||wt(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function bt(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function _t(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function wt(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Lt(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function kt(e,t){return ht(e)||pt(e)||vt(e)||mt(e)||Lt(e)?"2d"===t.type||(0,N.e)(e):ft(e)||dt(e)||yt(e)||bt(e)||_t(e)||wt(e)||ct(e)||ut(e)}function xt(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function St(e){return"esri.layers.VoxelLayer"===e.declaredClass}function It(e){return"esri.layers.WMSLayer"===e.declaredClass}function Ct(e){return"esri.layers.WMTSLayer"===e.declaredClass}function At(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Et(e){return"esri.layers.TileLayer"===e.declaredClass}function Zt(e){return"esri.layers.FeatureLayer"===e.declaredClass}function Vt(e){return"esri.layers.ImageryLayer"===e.declaredClass}function Ft(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function Rt(e){return"esri.layers.WCSLayer"===e.declaredClass}function zt(e){return"stretch-ramp"===e.type}function Mt(e){var t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)}function Tt(e){var t="authoringInfo"in e&&(null==e?void 0:e.authoringInfo);return"univariate-color-size"===(null==t?void 0:t.type)&&"above-and-below"===(null==t?void 0:t.univariateTheme)}var Ot=new tt.Z({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),Nt={},Dt=function(e){(0,l.Z)(o,e);var t=(0,s.Z)(o);function o(e){var r;return(0,i.Z)(this,o),(r=t.call(this,e))._handles=new u.Z,r._hasColorRamp=!1,r._hasOpacityRamp=!1,r._hasSizeRamp=!1,r._webStyleSymbolCache=new Map,r._dotDensityUrlCache=new Map,r._scaleDrivenSizeVariable=null,r._hasClusterSizeVariable=!1,r.children=new m.Z,r.layerView=null,r.layer=null,r.legendElements=[],r.parent=null,r.hideLayersNotInCurrentView=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.sublayerIds=[],r.title=null,r.view=null,r}return(0,a.Z)(o,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([(0,c.on)(this,"children","change",(function(r){var n=r.added,i=r.removed,a=e._handles;n.forEach((function(e){var r="activeLayerInfo-ready-watcher-".concat(e.layer.uid);a.add((0,c.S1)(e,"ready",t),r)})),i.forEach((function(e){return a.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(Nt={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Nt=null)}},{key:"effectList",get:function(){var e=this.layer,t=null;return"effect"in e&&e.effect&&((t=new R.AM).effect=e.effect,t.end(),t.scale=this.scale),t}},{key:"opacity",get:function(){var e,t=this.layer.opacity,r=null==(e=this.parent)?void 0:e.opacity,n=this.layer.parent,i=n&&"uid"in n?this._getParentLayerOpacity(n):null;return null!=r?r*t:null!=i?i*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this,t=this.layer;if(null===t)return!1;if("effect"in t&&t.effect&&Array.isArray(t.effect))return!0;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type)return!0;if("renderer"in t&&t.renderer){if("dot-density"===t.renderer.type)return!0;var r=t.get("renderer.valueExpression");if(it.test(r))return!0;var n=t.get("renderer.visualVariables");if(n)return n.some((function(t){return e._isScaleDrivenSizeVariable(t)}))}return this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){var r,n,i=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=5;break}return e.next=4,this._isLayerInCurrentView();case 4:e.t0=e.sent;case 5:if(e.t0){e.next=7;break}return e.abrupt("return",(this.legendElements=[],void this.notifyChange("ready")));case 7:return r=Array.from(t,(function(e){if(Zt(e))return i._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,r=t&&t.drawingInfo,n=r&&(0,O.i)(r.renderer),a=at.read(t.geometryType);return n?i._getRendererLegendElements(n,{title:e.name,geometryType:a}):(nt.warn("drawingInfo not available!"),null)}return null})),e.prev=8,n=[],e.next=12,(0,E.as)(r).then((function(e){e.forEach((function(e){var t=e.value;return t&&n.push.apply(n,(0,_.Z)(t))}))}));case 12:this.legendElements=n,this.notifyChange("ready"),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(8),nt.warn("error while building legend for layer!",e.t1);case 19:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getRendererLegendElements(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),nt.warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){var t,r,n,i,a,l=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!St(t=this.layer)){e.next=5;break}this._constructLegendElementsForVoxellayer(),e.next=29;break;case 5:if(!Ct(t)){e.next=9;break}this._constructLegendElementsForWMTSlayer(),e.next=29;break;case 9:if(!It(t)){e.next=14;break}return e.next=12,this._constructLegendElementsForWMSSublayers();case 12:case 17:case 22:e.next=29;break;case 14:if(!xt(t)){e.next=19;break}return e.next=17,this._constructLegendElementsForBuildingSceneLayer();case 19:if(!(At(t)||Et(t)||xt(t))){e.next=24;break}return e.next=22,this._constructLegendElementsForSublayers();case 24:return this._handles.remove("imageryLayers-watcher"),r="default",Vt(t)&&(r=((null==(a=t)||null==(n=a.renderingRule)?void 0:n.functionName)||"default")+"_"+(null!=(i=t.bandIds)&&i.length?t.bandIds.join(""):"###")),e.next=29,this._getLegendLayers("".concat(t.uid,"-").concat(r)).then(function(){var e=(0,w.Z)((0,b.Z)().mark((function e(r){var n;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l.legendElements=[],l.notifyChange("ready"),n=r.map(function(){var e=(0,w.Z)((0,b.Z)().mark((function e(r){var n,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(Vt(t)||Ft(t))&&(n=t.watch(["renderingRule","bandIds"],(function(){return(0,E.Ds)((0,w.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Nt.default=null,!t.renderer){e.next=6;break}return e.next=4,l.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,l.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),l._handles.add(n,"imageryLayers-watcher")),(i=l._generateSymbolTableElementForLegendLayer(r))&&i.infos.length&&(Vt(t)&&(i.title=t.title),l.legendElements.push(i)),l.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,(0,E.as)(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){nt.warn("Request to server for legend has failed!",e)}));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isLayerInCurrentView",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){var t,r,n,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer,r=this.layerView,(n=r&&"createQuery"in r&&"queryFeatureCount"in r)||r&&"createQuery"in t&&"queryFeatureCount"in t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.next=5,(0,c.OY)(r,"updating");case 5:if((i=n?"createQuery"in r&&r.createQuery():"createQuery"in t&&t.createQuery()).geometry=this.view.extent,!n){e.next=16;break}if(e.t1="queryFeatureCount"in r,!e.t1){e.next=13;break}return e.next=12,r.queryFeatureCount(i);case 12:e.t1=e.sent;case 13:e.t0=e.t1,e.next=22;break;case 16:if(e.t2="queryFeatureCount"in t,!e.t2){e.next=21;break}return e.next=20,t.queryFeatureCount(i);case 20:e.t2=e.sent;case 21:e.t0=e.t2;case 22:return e.t3=e.t0,e.abrupt("return",0!==e.t3);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,r=e.parent;return r&&"uid"in r&&(t=this._getParentLayerOpacity(r)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,r=t.minSize,n=t.maxSize;return"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):!!t.expression||it.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var r=e.parent;if(!1===e.loaded&&r&&At(r)&&"source"in e&&e.source&&"map-layer"===e.source.type){var n,i=(0,g.Z)(r.sourceJSON.layers);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0}}catch(l){i.e(l)}finally{i.f()}}return!1}},{key:"_constructLegendElementsForVoxellayer",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){var t,r,n,i,a,l,s,o,u,d,f,y,h,p=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("voxel-style-watcher"),t=this.layer,this._handles.add((0,c.YP)(t,"style",(function(){return p._constructLegendElementsForVoxellayer()})),"voxel-style-watcher"),r=(0,A.Wg)(t.getVariableStyle(null)),n=[],r&&(null!=(i=r.uniqueValues)&&i.length?(a=[],r.uniqueValues.forEach((function(e){e.enabled&&a.push({label:e.label||"".concat(e.value),value:e.value,symbol:new rt.Z({color:e.color,outline:null})})})),a.length&&n.push({type:"symbol-table",title:r.label,infos:a})):r.transferFunction&&(l=r.transferFunction,s=l.colorStops,o=l.stretchRange,u=s.toArray().reverse(),d=o.map((function(e,t){return"".concat(0===t?"<":">"," ").concat(et(e))})).reverse(),f=u.map((function(e){return{color:e.color,value:null,label:null}})),f[0].label=d[0],f[f.length-1].label=d[1],n.push({type:"color-ramp",title:r.label,infos:f,preview:(0,q.jT)(u.map((function(e){return e.color})))}))),y=t.opacity,h=n.reduce((function(e,t){return e.concat(p._getAllInfos(t))}),[]).filter((function(e){return!(null==e||!e.symbol)})).map((function(e){return p._getSymbolPreview(e,y)})),e.next=8,(0,E.as)(h);case 8:this.legendElements=n,this.notifyChange("ready");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add((0,c.YP)(this.layer,"activeLayer",(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var r=null;t.styles.some((function(e){return t.styleId===e.id&&(r=e.legendUrl,!0)})),r&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:r,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){var t,r,i=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,r=null,(t.customParameters||t.customLayerParameters)&&(r=(0,n.Z)((0,n.Z)({},t.customParameters),t.customLayerParameters)),this._handles.add((0,c.YP)(this.layer,"sublayers",(function(){return i._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,r);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n,i,a,l,s,o,u,c=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this._handles.add(t.on("change",(function(){return c._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),i=t.toArray(),a=(0,g.Z)(i),e.prev=4,a.s();case 6:if((l=a.n()).done){e.next=16;break}if(s=l.value,o=s.watch(["title","visible","legendEnabled"],(function(){return c._constructLegendElementsForWMSSublayers()})),this._handles.add(o,"wms-sublayers-watcher"),!(!this.respectLayerVisibility||s.visible&&s.legendEnabled)){e.next=14;break}return e.next=12,this._generateSymbolTableElementForWMSSublayer(s,r);case 12:(u=e.sent)&&u.infos.length&&n.unshift(u);case 14:e.next=6;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),a.e(e.t0);case 21:return e.prev=21,a.f(),e.finish(21);case 24:return e.abrupt("return",n);case 25:case"end":return e.stop()}}),e,this,[[4,18,21,24]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,r);case 3:return n=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:n});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n,i,a,l,s;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return a={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},r&&(i=(0,V.fl)(i,r)),l=null,s=null==(n=t.layer)?void 0:n.opacity,e.prev=7,e.next=10,(0,x.default)(i,{responseType:"image"});case 10:(l=e.sent.data)&&(l.style.opacity=s),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(a.infos.push({src:i,preview:l,opacity:s}),a));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var r=Nt&&Nt[e];return r?Promise.resolve(r):this._legendRequest(t).then((function(t){var r=t.layers;return Nt[e]=r,r}))}},{key:"_legendRequest",value:function(e){var t=this.layer,r={f:"json",dynamicLayers:e};if(Vt(t)){var i=t.exportImageServiceParameters.renderingRule;if(i&&(r.renderingRule=JSON.stringify(i.rasterFunctionDefinition||i.toJSON())),t.bandIds&&(r.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){var a=t.raster,l=t.viewId,s=t.customParameters;r=(0,n.Z)((0,n.Z)({raster:a,viewId:l},r),s)}}var o=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var u=o.indexOf("?");u>-1?o=o.substring(0,u)+"/legend"+o.substring(u):o+="/legend"}else{var c=o.toLowerCase().indexOf("/rest/"),d=o.substring(0,c)+o.substring(c+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(d)+"&returnbytes=true"}return(0,x.default)(o,{query:r}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){var t,r=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,c.YP)(t,"sublayers",(function(){return r._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),nt.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n,i,a,l,s,o,u,c,d,f,y,h=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this._handles.add(t.on("change",(function(){return h._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),i=t.toArray(),a=(0,g.Z)(i),e.prev=4,a.s();case 6:if((l=a.n()).done){e.next=30;break}if(s=l.value,o=s.watch(["renderer","opacity","title","visible"],(function(){return h._constructLegendElementsForBuildingSceneLayer()})),this._handles.add(o,"sublayers-watcher"),this.respectLayerVisibility&&!s.visible){e.next=28;break}if(u=s&&null!=s.opacity?s.opacity:null,c=null!=u?u*r:r,"building-group"!==s.type){e.next=19;break}return f={type:"symbol-table",title:s.title,infos:[]},e.next=15,this._generateLegendElementsForBuildingSublayers(s.sublayers,c);case 15:y=e.sent,(d=f.infos).push.apply(d,(0,_.Z)(y)),n=[f].concat((0,_.Z)(n)),e.next=28;break;case 19:if(!s.renderer){e.next=28;break}return e.t0=[],e.t1=_.Z,e.next=24,this._getRendererLegendElements(s.renderer,{title:s.title,opacity:c,sublayer:s});case 24:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,_.Z)(n),n=e.t0.concat.call(e.t0,e.t3,e.t4);case 28:e.next=6;break;case 30:e.next=35;break;case 32:e.prev=32,e.t5=e.catch(4),a.e(e.t5);case 35:return e.prev=35,a.f(),e.finish(35);case 38:return e.abrupt("return",n.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 39:case"end":return e.stop()}}),e,this,[[4,32,35,38]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(){var t,r=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,c.YP)(t,"sublayers",(function(){return r._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),nt.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r,n){var i,a,l,s,o,u,c,d,f,y,h=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.layer,a=[],this._handles.add(t.on("change",(function(){return h._constructLegendElementsForSublayers()})),"sublayers-watcher"),l=t.toArray(),!n&&this.sublayerIds&&this.sublayerIds.length&&(l=this.sublayerIds.map((function(e){return i.findSublayerById(e)})).filter(Boolean)),s=(0,g.Z)(l),e.prev=6,s.s();case 8:if((o=s.n()).done){e.next=32;break}if(u=o.value,c=u.watch("renderer, opacity, title, visible, legendEnabled",(function(){return h._constructLegendElementsForSublayers()})),this._handles.add(c,"sublayers-watcher"),this.respectLayerVisibility&&!(u.visible&&u.legendEnabled&&this._isSublayerInScale(u))){e.next=30;break}if(d=u&&null!=u.opacity?u.opacity:null,f=null!=d?d*r:r,!(u.renderer&&!u.sublayers&&u.originIdOf("renderer")>F.s3.SERVICE)){e.next=26;break}return e.next=16,u.load();case 16:return e.t0=[],e.t1=_.Z,e.next=20,this._getRendererLegendElements(u.renderer,{title:u.title,opacity:f,sublayer:u});case 20:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,_.Z)(a),a=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=30;break;case 26:return e.next=28,this._generateSymbolTableElementForSublayer(u,f,n);case 28:(y=e.sent)&&a.unshift(y);case 30:e.next=8;break;case 32:e.next=37;break;case 34:e.prev=34,e.t5=e.catch(6),s.e(e.t5);case 37:return e.prev=37,s.f(),e.finish(37);case 40:return e.abrupt("return",a.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 41:case"end":return e.stop()}}),e,this,[[6,34,37,40]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r,n){var i,a,l,s,o,u,c;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=9;break}return n=new Map,i=this.layer,a=t.source,l=null,(a&&("map-layer"!==a.type||a.mapLayerId!==t.id||a.gdbVersion&&a.gdbVersion!==("gdbVersion"in i&&i.gdbVersion))||t.originIdOf("renderer")>F.s3.SERVICE||t.originIdOf("labelingInfo")>F.s3.SERVICE||t.originIdOf("labelsVisible")>F.s3.SERVICE)&&(s=new M.R({layer:this.layer}),l=s.hasDynamicLayers?s.dynamicLayers:null,s.destroy()),o=l||"".concat(i.uid,"-default"),e.next=8,this._getLegendLayers(o,l);case 8:e.sent.forEach((function(e){return n.set(e.layerId,e)}));case 9:if(!(!(u=n.get(t.id))||null!=u&&u.subLayerIds&&u.defaultVisibility)||!t.sublayers){e.next=15;break}return e.next=13,this._generateLegendElementsForSublayers(t.sublayers,r,n);case 13:return c=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:c});case 15:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(u,t,r));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,r){var n,i=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var a=null==t?void 0:t.renderer,l=(null==t?void 0:t.title)||e.layerName;if(a&&(!t||(null==t?void 0:t.originIdOf("renderer"))>F.s3.SERVICE)){var s=(null==t?void 0:t.title)||this._getRendererTitle(a,t);s&&(l&&"string"!=typeof s&&"title"in s&&(s.title=l),l=s)}var o={type:"symbol-table",title:l,legendType:e.legendType?e.legendType:null,infos:[]},u=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null==(n=e.legendGroups)?void 0:n.length)>0?e.legendGroups.forEach((function(t){var n,a={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:i._generateSymbolTableElementInfosForLegendLayer(u.filter((function(e){return e.groupId===t.id})),e.layerId,r)};(null==(n=a.infos)?void 0:n.length)>0&&o.infos.push(a)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(u,e.layerId,r),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,r){var n=this;return e.map((function(e){var i=e.url;if(e.imageData&&e.imageData.length>0)i="data:image/png;base64,".concat(e.imageData);else{if(0===i.indexOf("http"))return null;i=(0,k.Dp)("".concat(n.layer.url,"/").concat(t,"/images/").concat(i))}return{label:e.label,src:i,opacity:null==r?n.opacity:r,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,r=e.maxScale||0;return!(t>0&&t<this.scale||r>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var r=t||this.layer,n=null,i=null,a=!0;return!r.minScale&&0!==r.minScale||!r.maxScale&&0!==r.maxScale?(0===e.minScale&&r.tileInfo&&(n=r.tileInfo.lods[0].scale),0===e.maxScale&&r.tileInfo&&(i=r.tileInfo.lods[r.tileInfo.lods.length-1].scale)):(n=Math.min(r.minScale,e.minScale)||r.minScale||e.minScale,i=Math.max(r.maxScale,e.maxScale)),(n>0&&n<this.scale||i>this.scale)&&(a=!1),a}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var r=t.renderer,n=e.some((function(e){return e.values})),i=null,a=null;return n&&e.some((function(e,t){return e.values||(i=t,(a=e).label||(a.label="others")),null!=a})),r?"unique-value"===r.type?a&&(e.splice(i,1),e.push(a)):"class-breaks"===r.type&&(a&&e.splice(i,1),e.reverse(),a&&e.push(a)):a&&(e.splice(i,1),e.push(a)),e}},{key:"_getRendererLegendElements",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){var r,n=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",kt(t,this.view)?gt(t)?this._constructPointCloudRendererLegendElements(t,r):Lt(t)?this._constructDotDensityRendererLegendElements(t):this._constructRendererLegendElements(t,r):(nt.warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.title,i=[],a=null,l=null;if(bt(e))a={type:"symbol-table",title:n||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){a.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(st,e.color)})}));else if(_t(e)){var s=e.stops,o=null;if(s.length&&(1===s.length&&(o=s[0].color),!o)){var u=s[0].value,c=s[s.length-1].value;null!=u&&null!=c&&(o=be(u+(c-u)/2,s))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(st,o||st.color)}]};var d=ge(e.stops);l={type:"color-ramp",title:n||this._getPointCloudRendererTitle(e),infos:d,preview:(0,q.jT)(d.map((function(e){return e.color})))}}else wt(e)&&(a={type:"symbol-table",title:n||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){a.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(st,e.color)})})));a&&a.infos.length&&i.push(a),l&&l.infos.length&&i.push(l);var f=i.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(r){return t._getSymbolPreview(r,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return(0,E.as)(f).then((function(){return i}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var r=e.backgroundColor,n=e.outline,i=e.dotSize,a=this.effectList,l=null==a?void 0:a.effects.map((function(e){return e.toJSON()})),s=(0,z.rM)(l),o=i+"-"+t+"-"+r+"-"+(n&&JSON.stringify(n.toJSON()))+"-"+s,u=this._dotDensityUrlCache,c=u.has(o)?u.get(o):(0,q.k)(e,t);u.set(o,c);var d={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},f=(0,H.w)([[d]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:f,width:c.width,height:c.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,r=e.calculateDotValue(this.view.scale),n=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:r&&Math.round(r),unit:n||""},infos:[]};return e.attributes.forEach((function(r){var n=t._getElementInfoForDotDensity(e,r.color);n.label=r.label||r.valueExpressionTitle||r.field,i.infos.push(n)})),Promise.resolve([i])}},{key:"_constructRendererLegendElements",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){var r,n,i,a,l,s,o,u,c,d,f,y,h,p,v,m,g,_,w,L,k,x,S,I,C,Z,V,F,R,z,M,T,O,N,D,B,P,H,U,W,j,Y,G,Q,J,X,K,$,ee,te,re,ne=this,ie=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ie.length>1&&void 0!==ie[1]?ie[1]:{},n=r.title,i=r.sublayer,a=i||this.layer,e.next=4,this._loadRenderer(t);case 4:return l=e.sent,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=8,this._getVisualVariableLegendElements(l,a);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:if(s=e.t0,o={type:"symbol-table",title:n||this._getRendererTitle(l,a),infos:[]},u=null,c=!1,d=new Set,!ut(l)||this._hasSizeRamp){e.next=22;break}return e.next=18,ce(l);case 18:f=e.sent,o.infos.push({label:null,symbol:f}),e.next=86;break;case 22:if(!Mt(l)){e.next=28;break}y=n,h=Tt(l)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",p=s.findIndex((function(e){return"color-ramp"===e.type})),v=-1!==p?s.splice(p,1)[0]:null,m=s.findIndex((function(e){return"size-ramp"===e.type})),g=-1!==m?s.splice(m,1)[0]:null,_=[],v&&(y=v.title,_.push(v)),g&&(y=g.title,_.push(g)),_.length>0&&s.push({type:h,title:y,infos:_}),e.next=86;break;case 28:if(!mt(l)){e.next=33;break}w=we(l),s.push({type:"heatmap-ramp",title:n,infos:w,preview:(0,q.jT)(w.map((function(e){return e.color})),{effectList:this.effectList})}),e.next=86;break;case 33:if(!vt(l)){e.next=39;break}if((L=l&&l.authoringInfo)&&"relationship"===L.type){if(k=L.focus,x=L.numClasses,S=L.field1,I=L.field2,x&&S&&I){for(C=[S,I],Z=Ee(k)||0,V=0,F=C;V<F.length;V++)R=F[V],z=R.field,M=R.normalizationField,T=R.label,O=T||{field:this._getFieldAlias(z,a),normField:M&&this._getFieldAlias(M,a)},(N=Ot.clone()).angle=Z,o.infos.push({label:O,symbol:N}),d.add(N),Z+=90;D=Ae({focus:k,numClasses:x,infos:l.uniqueValueInfos}),s.unshift(D)}}else B=l.field,l.uniqueValueInfos.forEach((function(e){e.symbol&&o.infos.push({label:e.label||ne._getDomainName(B,e.value,a)||e.value,value:e.value,symbol:e.symbol})}));l.defaultSymbol&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),c=!0),e.next=86;break;case 39:if(!pt(l)){e.next=44;break}(!(u=this._isUnclassedRenderer(l))||!this._hasSizeRamp)&&(l.classBreakInfos.forEach((function(e){e.symbol&&o.infos.unshift({label:e.label||(u?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),u&&(o.title=null),this._updateInfosforClassedSizeRenderer(l,o.infos)),l.defaultSymbol&&!u&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),c=!0),e.next=86;break;case 44:if(!ft(l)){e.next=68;break}if(!Ft(this.layer)&&!Rt(this.layer)){e.next=50;break}zt(P=this._constructTileImageryStretchRendererElements(l))?s.push(P):o.infos=P,e.next=66;break;case 50:if(H=this.layer,l.statistics&&l.statistics.length&&(U=null!=l.statistics[0].min?l.statistics[0].min:l.statistics[0][0],W=null!=l.statistics[0].max?l.statistics[0].max:l.statistics[0][1]),j=[],e.t1=A.Wg,!H.renderingRule){e.next=60;break}return e.next=57,H.generateRasterInfo(H.renderingRule);case 57:e.t2=e.sent,e.next=61;break;case 60:e.t2=H.serviceRasterInfo;case 61:e.t3=e.t2,Y=(0,e.t1)(e.t3),G=Y.keyProperties.BandProperties,Q=lt[H.rasterInfo.pixelType.toLowerCase()],1===Y.bandCount||H.bandIds&&1===H.bandIds.length?(U=null!=U?U:Y.statistics?Y.statistics[H.bandIds[0]].min:Q[0],W=null!=W?W:Y.statistics?Y.statistics[H.bandIds[0]].max:Q[1],U||W?s.push(this._getStretchLegendElements(l,{min:U,max:W})):this._getServerSideLegend()):Y.bandCount>=3?G&&G.length>=Y.bandCount?H.bandIds&&3===H.bandIds.length?(j=H.bandIds.map((function(e){return G[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(j)):"lerc"===H.format?(j=[0,1,2].map((function(e){return G[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(j)):this._getServerSideLegend():"lerc"===H.format?(j=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(j)):this._getServerSideLegend():this._getServerSideLegend();case 66:e.next=86;break;case 68:if(!dt(l)){e.next=72;break}l.colormapInfos.forEach((function(e){o.infos.push({label:e.label,value:e.value,symbol:ne._getAppliedCloneSymbol(ot,e.color)})})),e.next=86;break;case 72:if(!ht(l)){e.next=85;break}J=l.symbol,e.t4=r.geometryType,e.next="point"===e.t4?77:"polyline"===e.t4?79:"polygon"===e.t4?81:82;break;case 77:return J="pointSymbol"in a&&a.pointSymbol,e.abrupt("break",82);case 79:return J="lineSymbol"in a&&a.lineSymbol,e.abrupt("break",82);case 81:J="polygonSymbol"in a&&a.polygonSymbol;case 82:l.symbol&&!this._hasSizeRamp&&o.infos.push({label:l.label,symbol:J}),e.next=86;break;case 85:ct(l)?(l.outputUnit&&(this.title="("+l.toJSON().outputUnit+")"),o.title=l.attributeField,null!=(X=l.getClassBreakInfos())&&X.length?X.forEach((function(e){o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:l.attributeField,symbol:l.getDefaultSymbol()})):yt(l)&&s.push(this._getStretchLegendElements(l,{min:0,max:255}));case 86:return!(K=l.defaultSymbol)||c||ht(l)||u&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||s.push({type:"symbol-table",infos:[{label:l.defaultLabel||"others",symbol:K}]}),o.infos.length&&s.unshift(o),$=null==r.opacity?this.opacity:r.opacity,ee=this._isTallSymbol("visualVariables"in l&&l.visualVariables),te=Vt(this.layer)||Ft(this.layer),re=s.reduce((function(e,t){return e.concat(ne._getAllInfos(t))}),[]).filter((function(e){return!(null==e||!e.symbol)})).map((function(e){return ne._getSymbolPreview(e,$,{isDefault:e.symbol===K,applyScaleDrivenSize:!d.has(e.symbol),symbolConfig:{isTall:ee,isSquareFill:te},effectList:d.has(e.symbol)?null:ne.effectList})})),l=null,e.next=92,(0,E.as)(re);case 92:return e.abrupt("return",s);case 93:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,r=null==e?void 0:e.infos;return r?r.reduce((function(e,r){return e.concat(t._getAllInfos(r))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,r,n,i,a,l=this.layer,s=l.rasterInfo,o=s.bandCount||e.statistics.length,u=s.keyProperties&&s.keyProperties.BandProperties,c=null!=e&&null!=(t=e.statistics)&&t.length?e.statistics:null==s?void 0:s.statistics;if(c)n=void 0!==c[0].min?c[0].min:c[0][0],i=c[0].max||c[0][1];else{var d=lt[l.rasterInfo.pixelType.toLowerCase()];n=d[0],i=d[1]}if(l.hasStandardTime()&&(n=l.getStandardTimeValue(n),i=l.getStandardTimeValue(i)),1===s.bandCount||1===(null==(r=l.bandIds)?void 0:r.length))return this._getStretchLegendElements(e,{min:n,max:i});function f(e){var t,r=(null!=l&&null!=(t=l.bandIds)&&t.length?l.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return r.length<3?r.push(r[1]):r.length>3&&r.splice(3),r}return a=u&&u.length>=o?f(u):f(),this._createSymbolTableElementMultiBand(a)}},{key:"_getStretchLegendElements",value:function(e,t){var r=function(e,t){var r,n,i=[];return e&&"multipart"===e.type?e.colorRamps.reverse().forEach((function(r,n){0===n?i.push({value:t.max,color:new L.Z(r.toColor),label:"high"}):i.push({value:null,color:new L.Z(r.toColor),label:""}),n===e.colorRamps.length-1?i.push({value:t.min,color:new L.Z(r.fromColor),label:"low"}):i.push({value:null,color:new L.Z(r.fromColor),label:""})})):(e&&"algorithmic"===e.type?(r=e.fromColor,n=e.toColor):(r=[0,0,0,1],n=[255,255,255,1]),i=[{value:t.max,color:new L.Z(n),label:"high"},{value:t.min,color:new L.Z(r),label:"low"}]),i}(e.colorRamp,t);return{type:"stretch-ramp",title:"",infos:r,preview:(0,q.jT)(r.map((function(e){return e.color})))}}},{key:"_getSizeLegendElement",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r,n,i){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._hasClusterSizeVariable?this._getClusterTitle(r):t,e.t1=Te,e.t2=n,e.t3=r,e.next=6,oe(n);case 6:return e.t4=e.sent,e.t5=this.scale,e.t6=this.view.type,e.t7=i,e.next=12,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7);case 12:return e.t8=e.sent,e.abrupt("return",{type:"size-ramp",title:e.t0,infos:e.t8});case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=[],r=["red","green","blue"];return e.forEach((function(e,n){t.push({label:{colorName:r[n],bandName:e},src:se[n],opacity:1})})),t}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var r=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,n=e.classBreakInfos.some((function(e){return(0,U.YW)(e.symbol)}));if(r&&n){var i=e.classBreakInfos.length,a=18/(i>1?i-1:i);t.forEach((function(e,t){e.size=30-a*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,r=!1;if(e)for(var n=0;n<e.length&&(!t||!r);n++){var i=e[n];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(r=!0))}return t&&r}},{key:"_getSymbolPreview",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,n,i){var a,l,s;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=i&&i.isDefault||null!=t.size||!this._hasSizeRamp?t.size:(0,Z.Wz)(P.b_.size),!this._scaleDrivenSizeVariable||null==i||!i.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(r.bind(r,56011));case 4:l=e.sent,s=l.getSize,a=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",(0,q.l3)(t.symbol,{size:a,opacity:n,scale:!1,symbolConfig:null==i?void 0:i.symbolConfig,effectView:null==i?void 0:i.effectList}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_loadRenderer",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t){var r,n,i,a,l,s,o,u,c,d,f,y,h,p=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],a=this.layer,t=t.clone(),this._hasClusterSizeVariable=!1,l="visualVariables"in t&&(null==(r=t.visualVariables)?void 0:r.some((function(e){return"size"===e.type&&"outline"!==e.target&&!it.test(e.valueExpression)}))),t&&"visualVariables"in t&&!l&&"featureReduction"in a&&"cluster"===(null==(n=a.featureReduction)?void 0:n.type)&&(s=this.layerView._effectiveRenderer,(o=(0,A.Wg)(j(s,this.view)))&&("clusterMinSize"in(u=a.featureReduction)&&"clusterMaxSize"in u&&(c=u.clusterMinSize,d=u.clusterMaxSize,o.legendOptions=new D.Z({showLegend:c!==d})),f=t.visualVariables||[],t.visualVariables=f.concat([o]),this._hasClusterSizeVariable=!0)),e.next=6,oe(t);case 6:return y=e.sent,(pt(t)||vt(t))&&(h=(t.classBreakInfos||t.uniqueValueInfos).map((function(e){return p._fetchSymbol(e.symbol,y).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(i,h)),e.abrupt("return",(i.push(this._fetchSymbol(t.symbol||t.defaultSymbol,t.defaultSymbol?null:y).then((function(e){p._applySymbolToRenderer(t,e,ht(t))})).catch((function(){p._applySymbolToRenderer(t,null,ht(t))}))),(0,E.as)(i).then((function(){return t}))));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,r){r?e.symbol=t:e.defaultSymbol=t}},{key:"_fetchSymbol",value:function(e,t){var r=this;if(!e)return Promise.reject();if("web-style"===e.type){var n=e.portal,i=n&&n.url,a=n&&n.user&&n.user.username,l=e.name+"-"+e.styleName+"-"+e.styleUrl+"-"+i+"-"+a,s=this._webStyleSymbolCache;return s.has(l)||("2d"===this.view.type?s.set(l,e.fetchCIMSymbol()):s.set(l,e.fetchSymbol())),s.get(l).then((function(e){return r._getAppliedCloneSymbol(e,t)})).catch((function(){return nt.warn("Fetching web-style failed!"),Promise.reject()}))}return Promise.resolve(this._getAppliedCloneSymbol(e,t))}},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var r=e.clone(),n=t&&t.toRgba();return r.type.indexOf("3d")>-1?this._applyColorTo3dSymbol(r,n):"cim"===r.type?(0,B.ZB)(r,t):r.color&&(r.color=new L.Z(n||r.color)),r}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new L.Z(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=(0,w.Z)((0,b.Z)().mark((function e(t,r){var n,i,a,l,s,o,u,c,d,f,y,h,p,v=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:n=t.visualVariables,i=[],a=[],l=[],s=(0,g.Z)(n);try{for(s.s();!(o=s.n()).done;)"color"===(u=o.value).type?i.push(u):"size"===u.type?a.push(u):"opacity"===u.type&&l.push(u)}catch(m){s.e(m)}finally{s.f()}return c=[].concat(i,a,l),0===i.length&&pt(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(y=t.classBreakInfos[0],d=y&&y.symbol),0===i.length&&ht(t)&&(d=t.symbol),d&&(d.type.indexOf("3d")>-1?"water"===(h=d.symbolLayers.getItemAt(0)).type?(0,A.pC)(h.color)&&(f=h.color):(0,A.pC)(h.material)&&(0,A.pC)(h.material.color)&&(f=h.material.color):d.url||(f=d.color)),p=this.effectList,e.next=11,Promise.all(c.map(function(){var e=(0,w.Z)((0,b.Z)().mark((function e(n){var i,a,l,s,o,u;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.legendOptions&&!1===n.legendOptions.showLegend){e.next=28;break}if(i=ut(t)?n.field:v._getRampTitle(n,r),a=null,l="getField"in r&&r.getField&&r.getField(n.field),s=l&&(0,T.y2)(l),"color"!==n.type){e.next=11;break}return e.next=7,he(n,null,s);case 7:o=e.sent,a={type:"color-ramp",title:i,infos:o,preview:(0,q.jT)(o.map((function(e){return e.color})),{effectList:p})},v._hasColorRamp||(v._hasColorRamp=!(null==a.infos||!a.infos.length)),e.next=27;break;case 11:if("size"!==n.type||"outline"===n.target){e.next=22;break}if(!it.test(n.valueExpression)){e.next=16;break}v._hasClusterSizeVariable||(v._scaleDrivenSizeVariable=n),e.next=20;break;case 16:return e.next=18,v._getSizeLegendElement(i,n,t,s);case 18:a=e.sent,v._hasSizeRamp||(v._hasSizeRamp=!(null==a.infos||!a.infos.length));case 20:e.next=27;break;case 22:if("opacity"!==n.type){e.next=27;break}return e.next=25,he(n,f,s);case 25:u=e.sent,a={type:"opacity-ramp",title:i,infos:u,preview:(0,q.jT)(u.map((function(e){return e.color})),{effectList:p})},v._hasOpacityRamp||(v._hasOpacityRamp=!(null==a.infos||!a.infos.length));case 27:return e.abrupt("return",a&&a.infos?a:null);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,r){if(e&&"function"!=typeof e){var n="getField"in r&&r.getField&&r.getField(e),i=n&&"getFieldDomain"in r&&r.getFieldDomain?r.getFieldDomain(n.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,r=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var n=t.featureReduction,i="popupTemplate"in n&&n.popupTemplate,a=i&&i.fieldInfos;if(a){var l,s=(0,g.Z)(a);try{for(s.s();!(l=s.n()).done;){var o=l.value;if(o.fieldName===r)return"cluster_count"===r?o.label||{showCount:!0}:o.label}}catch(u){s.e(u)}finally{s.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var r=e.field,n=e.normalizationField,i=!1,a=!1,l=!1,s=null;r="function"==typeof r?null:r,n="function"==typeof n?null:n;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)s=o;else if(e.valueExpressionTitle)s=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var u=t.renderer.authoringInfo.visualVariables,c=0;c<u.length;c++){var d=u[c];if("color"===d.type){if("ratio"===d.style){i=!0;break}if("percent"===d.style){a=!0;break}if("percent-of-total"===d.style){l=!0;break}}}s={field:r&&this._getFieldAlias(r,t),normField:n&&this._getFieldAlias(n,t),ratio:i,ratioPercent:a,ratioPercentTotal:l}}return s}},{key:"_getRendererTitle",value:function(e,t){var r=e;if(r.legendOptions&&r.legendOptions.title)return r.legendOptions.title;if(r.valueExpressionTitle)return r.valueExpressionTitle;var n=r.field,i=null,a=null;pt(r)&&(i=r.normalizationField,a="percent-of-total"===r.normalizationType),i="function"==typeof i?null:i;var l=null;return((n="function"==typeof n?null:n)||i)&&(l={field:n&&this._getFieldAlias(n,t),normField:i&&this._getFieldAlias(i,t),normByPct:a}),l}},{key:"_getFieldAlias",value:function(e,t){var r="popupTemplate"in t&&t.popupTemplate,n=r&&r.fieldInfos,i=null;n&&n.some((function(t){return e===t.fieldName&&(i=t,!0)}));var a=null;"getField"in t&&t.getField?a=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(a=t.fieldsIndex.get(e));var l=i||a,s=null;return l&&(s=i&&i.label||a&&a.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName),s}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,r=!1;return pt(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(r=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),r}}]),o}(v.Z);(0,o._)([(0,y.Cb)()],Dt.prototype,"children",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],Dt.prototype,"effectList",null),(0,o._)([(0,y.Cb)()],Dt.prototype,"layerView",void 0),(0,o._)([(0,y.Cb)()],Dt.prototype,"layer",void 0),(0,o._)([(0,y.Cb)()],Dt.prototype,"legendElements",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],Dt.prototype,"opacity",null),(0,o._)([(0,y.Cb)()],Dt.prototype,"parent",void 0),(0,o._)([(0,y.Cb)({readOnly:!0,dependsOn:[]})],Dt.prototype,"ready",null),(0,o._)([(0,y.Cb)()],Dt.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,y.Cb)()],Dt.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,y.Cb)()],Dt.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],Dt.prototype,"scale",null),(0,o._)([(0,y.Cb)()],Dt.prototype,"sublayerIds",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],Dt.prototype,"isScaleDriven",null),(0,o._)([(0,y.Cb)()],Dt.prototype,"title",void 0),(0,o._)([(0,y.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],Dt.prototype,"version",null),(0,o._)([(0,y.Cb)()],Dt.prototype,"view",void 0);var Bt=Dt=(0,o._)([(0,h.j)("esri.widgets.Legend.support.ActiveLayerInfo")],Dt),Pt=r(36257),Ht="state",qt="view",Ut="all-layer-views",Wt="legend-properties",jt=m.Z.ofType(Bt),Yt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Gt="view.basemapView.baseLayerViews",Qt="view.groundView.layerViews",Jt="view.basemapView.referenceLayerViews",Xt=[Gt,Qt,"view.layerViews",Jt],Kt=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e))._handles=new u.Z,n._layerViewByLayerId={},n._layerInfosByLayerViewId={},n._activeLayerInfosByLayerViewId={},n._activeLayerInfosWithNoParent=new m.Z,n.activeLayerInfos=new jt,n.basemapLegendVisible=!1,n.groundLegendVisible=!1,n.hideLayersNotInCurrentView=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.layerInfos=[],n.view=null,n}return(0,a.Z)(r,[{key:"initialize",value:function(){var e=this;this._handles.add((0,c.S1)(this,"view",this._viewHandles),qt),this._handles.add((0,Pt.qe)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){this._handles.remove(Ht),this.view&&this._handles.add((0,c.S1)(this,"state",this._stateHandles),Ht)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([Ut,Wt]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this.view.allLayerViews;e.length&&this._refresh(),this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),Ut),this._handles.add((0,c.YP)(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),Wt)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var r=[];e.forEach((function(n){if(!n.parent){var i=n.layer.parent,a=i&&"uid"in i&&t._layerViewByLayerId[i.uid],l=a&&t._activeLayerInfosByLayerViewId[a.uid];l&&-1!==e.indexOf(l)&&(r.push(n),n.parent=l,l.children.add(n),t._sortActiveLayerInfos(l.children))}})),e.removeMany(r);var n={};this.view.allLayerViews.forEach((function(e,t){return n[e.layer.uid]=t})),e.sort((function(e,t){var r=n[e.layer.uid]||0;return(n[t.layer.uid]||0)-r}))}}},{key:"_generateLayerViews",value:function(){var e=[];return Xt.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===Gt||e===Jt),r=!this.groundLegendVisible&&e===Qt;return!t&&!r}},{key:"_collectLayerViews",value:function(e,t){return function r(n){return n&&n.forEach((function(n){t.push(n),r(n[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,r=this.layerInfos;return!r||!r.length||r.some((function(r){return t._hasLayerInfo(r,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var r=this._isLayerUIDMatching(e.layer,t.layer.uid);return r&&(this._layerInfosByLayerViewId[t.uid]=e),r}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var r=this;return e&&e.some((function(e){return r._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!Yt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,c.YP)(e,"legendEnabled, layer.legendEnabled",(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,r=this,n=e.layer,i=e.uid,a=this._layerInfosByLayerViewId[i],l=this._activeLayerInfosByLayerViewId[i];if(!l){var s=a&&void 0!==a.title&&a.layer.uid===n.uid;l=new Bt({layer:n,layerView:e,title:s?a.title:n.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:a&&a.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=l}var o=n.parent&&"uid"in n.parent&&this._layerViewByLayerId[null==(t=n.parent)?void 0:t.uid];if(l.parent=this._activeLayerInfosByLayerViewId[null==o?void 0:o.uid],!this._handles.has(i)){var u=[(0,c.YP)(n,"title",(function(e){return r._titleHandle(e,l)})),(0,c.YP)(n,"renderer?, opacity, pointSymbol?, lineSymbol?, polygonSymbol?",(function(){return r._constructLegendElements(l)})),(0,c.Z4)(this.view,"stationary",(function(){return r._scaleHandle(l)})),(0,c.YP)(e,"_effectiveRenderer",(function(){return r._constructLegendElements(l)})),(0,c.YP)(n,"effect",(function(){return r._constructLegendElements(l)}))];if(this.respectLayerVisibility){var d=(0,c.YP)(e,"legendEnabled",(function(e){return r._legendEnabledHandle(e,l)})),f=(0,c.YP)(n,"legendEnabled",(function(e){return r._legendEnabledHandle(e,l)}));u.push(d,f)}this._handles.add(u,i)}l.isScaleDriven||this._constructLegendElements(l),this._addActiveLayerInfo(l)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,r=e.layerView,n=e.layer;if(this._isLayerActive(r)&&-1===this.activeLayerInfos.indexOf(e)){var i=e.parent;if(i)-1===i.children.indexOf(e)&&i.children.push(e),this._sortActiveLayerInfos(i.children);else{var a,l=null==(a=this.layerInfos)?void 0:a.some((function(e){return e.layer.uid===n.uid}));n.parent&&"uid"in n.parent&&!l?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var s=[];this._activeLayerInfosWithNoParent.forEach((function(e){var r=e.layer.parent,n=r&&"uid"in r&&t._layerViewByLayerId[null==r?void 0:r.uid],i=t._activeLayerInfosByLayerViewId[null==n?void 0:n.uid];i&&(s.push(e),e.parent=i)})),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t=this,r=e.layer;"featureCollections"in r&&r.featureCollections?e.buildLegendElementsForFeatureCollections(r.featureCollections):"renderer"in r&&r.renderer?e.buildLegendElementsForRenderer(r.renderer):"url"in r&&r.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return t._constructLegendElements(e)}))}}]),r}(v.Z);(0,o._)([(0,y.Cb)({type:jt})],Kt.prototype,"activeLayerInfos",void 0),(0,o._)([(0,y.Cb)()],Kt.prototype,"basemapLegendVisible",void 0),(0,o._)([(0,y.Cb)()],Kt.prototype,"groundLegendVisible",void 0),(0,o._)([(0,y.Cb)()],Kt.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,y.Cb)()],Kt.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,y.Cb)()],Kt.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,y.Cb)()],Kt.prototype,"layerInfos",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],Kt.prototype,"state",null),(0,o._)([(0,y.Cb)()],Kt.prototype,"view",void 0);var $t=Kt=(0,o._)([(0,h.j)("esri.widgets.Legend.LegendViewModel")],Kt),er=r(4942),tr=r(99653),rr=r(80975),nr=r(67005),ir="http://www.w3.org/2000/svg",ar="esri-relationship-ramp--diamond__container",lr="esri-relationship-ramp--diamond__left-column",sr="esri-relationship-ramp--diamond__right-column",or="esri-relationship-ramp--diamond__middle-column",ur="esri-relationship-ramp--diamond__middle-column--label",cr="esri-relationship-ramp--diamond__middle-column--ramp",dr="esri-relationship-ramp--square__table",fr="esri-relationship-ramp--square__table-row",yr="esri-relationship-ramp--square__table-cell",hr="esri-relationship-ramp--square__table-label",pr="esri-relationship-ramp--square__table-label--left-bottom",vr="esri-relationship-ramp--square__table-label--right-bottom",mr="esri-relationship-ramp--square__table-label--left-top",gr="esri-relationship-ramp--square__table-label--right-top";function br(e,t,r,n){var i=e.focus,a=e.labels,l=!!i,s=function(e,t,r,n){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:60,a=e.focus,l=e.numClasses,s=e.colors,o=e.rotation,u=!!a,c=Math.sqrt(Math.pow(i,2)+Math.pow(i,2))+(u?0:5),d=[],f=[],y=[],h=(i||75)/l,p=0;p<l;p++)for(var v=p*h,m=0;m<l;m++){var g=m*h,b=(0,tr.jA)(s[p][m]),_=(0,tr.kQ)(null),w={type:"rect",x:g,y:v,width:h,height:h};d.push((0,tr.ch)(b)),f.push((0,tr.vq)(w,b.fill,_,null)),y.push((0,tr.A5)(w))}var L=10,k=15,x=15,S=10,I=null;u||(I="margin: -15px -15px -18px -15px");var C=_r("left",a,t),A=_r("right",a,t),E=(0,tr.al)(y),Z=(0,tr.iL)(E,c,c,0,!1,o,!1),V=(0,tr.iL)(E,c,c,0,!1,u?-45:null,!1),F={filter:(0,U.wJ)(n),opacity:null==r?null:"".concat(r)};return(0,nr.u)("div",{styles:F,class:u?cr:yr},(0,nr.u)("svg",{xmlns:ir,width:c,height:c,style:I},(0,nr.u)("defs",null,(0,nr.u)("marker",{id:"".concat(t,"_arrowStart"),markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,nr.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,nr.u)("marker",{id:"".concat(t,"_arrowEnd"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,nr.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),(0,nr.u)("g",{transform:Z},f),(0,nr.u)("g",{transform:V},(0,nr.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:-L,y1:i-k,x2:-L,y2:k}),(0,nr.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":A.markerStart,"marker-end":A.markerEnd,x1:x,y1:i+S,x2:i-x,y2:i+S}))))}(e,t,r,n),o=(0,rr.dZ)();return l?(0,nr.u)("div",{class:ar,styles:{justifyContent:"center"}},(0,nr.u)("div",{class:lr},o?a.right:a.left),(0,nr.u)("div",{class:or},(0,nr.u)("div",{class:ur},a.top),s,(0,nr.u)("div",{class:ur},a.bottom)),(0,nr.u)("div",{class:sr},o?a.left:a.right)):(0,nr.u)("div",{class:dr},(0,nr.u)("div",{class:fr},(0,nr.u)("div",{class:(0,rr.Sh)(yr,hr,vr)},o?a.top:a.left),(0,nr.u)("div",{class:yr}),(0,nr.u)("div",{class:(0,rr.Sh)(yr,hr,pr)},o?a.left:a.top)),(0,nr.u)("div",{class:fr},(0,nr.u)("div",{class:yr}),s,(0,nr.u)("div",{class:yr})),(0,nr.u)("div",{class:fr},(0,nr.u)("div",{class:(0,rr.Sh)(yr,hr,gr)},o?a.right:a.bottom),(0,nr.u)("div",{class:yr}),(0,nr.u)("div",{class:(0,rr.Sh)(yr,hr,mr)},o?a.bottom:a.right)))}function _r(e,t,r){var n="".concat(r,"_arrowStart"),i="".concat(r,"_arrowEnd"),a="left"===e,l={markerStart:null,markerEnd:null};switch(t){case"HL":a?l.markerStart="url(#".concat(i,")"):l.markerEnd="url(#".concat(n,")");break;case"LL":l.markerStart="url(#".concat(i,")");break;case"LH":a?l.markerEnd="url(#".concat(n,")"):l.markerStart="url(#".concat(i,")");break;default:l.markerEnd="url(#".concat(n,")")}return l}r(42877);var wr=(0,r(88367).E)(),Lr=20,kr=10,xr=20,Sr="esri-univariate-above-and-below-ramp__symbol",Ir="esri-legend__color-ramp";function Cr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,nr.u)("svg",{height:"4",width:"10"},(0,nr.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,nr.u)("svg",{height:"10",width:"10"},(0,nr.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function Ar(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",r=document.createElement("div");return r.style.height="".concat(Lr,"px"),r.className=Sr,null!=e&&(r.style.opacity=e.toString()),wr.append(r,Cr.bind(null,t)),r}function Er(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",n=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,i){if(n&&2===i)e.preview=Ar(t,r);else{var a=(0,Z.F2)(e.size)+("horizontal"===r?xr:kr),l="div"===e.preview.tagName.toLowerCase(),s=l?e.preview:document.createElement("div");s.className=Sr,"horizontal"===r?s.style.width="".concat(a,"px"):s.style.height="".concat(a,"px"),l||s.appendChild(e.preview),e.preview=s}}))}function Zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",r=e.infos;return"classic"===t?((0,Z.F2)(r[0].size)+kr)/2:((0,Z.F2)(r[0].size)-(0,Z.F2)(r[r.length-1].size))/2}function Vr(e,t){if(!e)return null;var r=e.infos.map((function(e){return e.color})),n=(0,q.jT)("full"===t.type?r:"above"===t.type?r.slice(0,3):r.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return n.className=Ir,null!=t.opacity&&(n.style.opacity=t.opacity.toString()),n}function Fr(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=0,a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u=s;u<=o;u++)i+=r&&u===l?"horizontal"===n?10:Lr:(0,Z.F2)(a[u].size)+("horizontal"===n?xr:kr);return Math.round(i)}function Rr(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=Fr(e,t,r,n),a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u="full"===t?a[s].size+a[o].size:"above"===t?a[s].size:a[o].size,c=r?"vertical"===n?Lr:10:0,d="vertical"===n?kr*("full"===t?2:1):xr*("full"===t?2:1);return Math.round(i-((0,Z.F2)(u)/2+c/2+d/2))}function zr(e,t){var r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",l=e.infos,s=l.find((function(e){return"size-ramp"===e.type})),o=l.find((function(e){return"color-ramp"===e.type}));return s&&((s=(0,n.Z)({},s)).infos=(0,_.Z)(s.infos),Er(s,t,a,!0)),o&&((o=(0,n.Z)({},o)).infos=(0,_.Z)(o.infos)),"horizontal"===a&&(null==(r=s)||r.infos.reverse(),null==(i=o)||i.infos.reverse()),{sizeRampElement:s,colorRampElement:o}}function Mr(e){var t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",a=e.infos,l=a.find((function(e){return"size-ramp"===e.type})),s=a.find((function(e){return"color-ramp"===e.type}));return l&&((l=(0,n.Z)({},l)).infos=(0,_.Z)(l.infos),Er(l,null,i,!1)),s&&((s=(0,n.Z)({},s)).infos=(0,_.Z)(s.infos)),"horizontal"===i&&(null==(t=l)||t.infos.reverse(),null==(r=s)||r.infos.reverse()),{sizeRampElement:l,colorRampElement:s}}var Tr=r(8704);function Or(e){e.appendChild(this)}function Nr(e,t,r){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,Tr.n)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var n=null;return function(e,t){return t}(0,r)?n=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Dr(t,r)&&(n=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),n?(0,Tr.n)("showField"===n?"{field}":e[n],{field:t.field,normField:t.normField}):null}}function Dr(e,t){return!t}function Br(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var Pr,Hr=r(96919),qr=r(78088),Ur=r(80532),Wr="esri-legend--card__carousel-indicator--activated",jr="esri-legend--card",Yr="esri-legend--stacked",Gr="esri-legend--card__carousel-title",Qr="esri-legend--card__carousel-indicator",Jr="esri-legend--card__interval-separator",Xr="esri-legend--card__imagery-layer-image--stretched",Kr="esri-legend--card__image-label",$r="esri-legend--card__layer-caption",en="esri-legend--card__label-element",tn="esri-legend--card__layer-row",rn="esri-legend--card__label-cell",nn="esri-legend--card__message",an="esri-legend--card__ramp-label",ln="esri-legend--card__section",sn="esri-legend--card__service-caption-text",on="esri-legend--card__service-content",un="esri-legend--card__service",cn="esri-legend--card__group-layer",dn="esri-legend--card__group-layer-child",fn="esri-legend--card__symbol",yn="esri-legend--card__size-ramp-row",hn="esri-legend--card__symbol-row",pn="esri-legend--card__symbol-cell",vn="esri-legend--card__carousel-indicator-container",mn="esri-legend--card__interval-separators-container",gn="esri-legend--card__relationship-label-container",bn="esri-legend--card__label-container",_n="esri-legend--card__service-caption-container",wn="esri-legend--card__symbol-container",Ln="esri-legend--card__size-ramp-container",kn="esri-legend--card__size-ramp-preview",xn="esri-legend__size-ramp--horizontal",Sn="esri-legend__ramp-labels",In="esri-legend__layer-cell esri-legend__layer-cell--info",Cn="esri-univariate-above-and-below-ramp__color--card";!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(Pr||(Pr={}));var An=window.devicePixelRatio;var En=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,i.Z)(this,r),(a=t.call(this,e,n))._handles=new u.Z,a._hasIndicators=!1,a._selectedSectionName=null,a._sectionNames=[],a._sectionMap=new Map,a.activeLayerInfos=null,a.headingLevel=3,a.layout=Pr.Stack,a.messages=null,a.messagesCommon=null,a.type="card",a.view=null,a}return(0,a.Z)(r,[{key:"initialize",value:function(){var e=this;this.own([this.watch("activeLayerInfos",(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)}))])}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators=this.layout===Pr.Auto&&this.view.container.clientWidth<=768||this.layout===Pr.Stack;var t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var n=this._sectionNames.length,i=this._sectionNames.map((function(t,r){var i=(0,Tr.n)(e.messagesCommon.pagination.pageText,{index:r+1,total:n});return(0,nr.u)("div",{key:t,role:"tab",id:t,"aria-label":i,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:i,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes(Qr,(0,er.Z)({},Wr,e._selectedSectionName===t)),"data-section-name":t})})),a=this._hasIndicators&&n>1?(0,nr.u)("div",{class:vn,key:"carousel-navigation",role:"tablist"},i):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):r&&r.length?r:null,s=(0,er.Z)({},Yr,this._hasIndicators);return(0,nr.u)("div",{class:this.classes(jr,s)},l||(0,nr.u)("div",{class:nn},this.messages.noLegend),a)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,r="ArrowLeft"===t?-1:1,n=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(n),a=this._sectionNames,l=null;-1!==i&&(a[i+r]?l=document.getElementById(a[i+r]):"ArrowLeft"===t?l=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(l=document.getElementById(a[0])),l&&l.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var r="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(r),t._watchForSectionChanges(e.children),t._handles.add(e.watch("version",(function(){return t._generateSectionNames()})),r)}));var r="activeLayerInfos-collection-change";this._handles.remove(r),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),r)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,r){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(r)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(r,n){t._sectionNames.push(t._getSectionName(e.layer,r,n))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var r=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,nr.u)("div",{key:e.layer.uid,class:this.classes(un,cn)},(0,nr.u)("div",{class:_n},e.title),r)}var n=e.legendElements;if(n&&!n.length)return null;var i=n.some((function(e){return"relationship-ramp"===e.type})),a=n.map((function(r,n){return t._renderLegendForElement(r,e,n,i)})).filter((function(e){return!!e}));if(!a.length)return null;var l=(0,er.Z)({},dn,!!e.parent);return(0,nr.u)("div",{key:e.layer.uid,class:this.classes(un,l)},(0,nr.u)("div",{class:_n},(0,nr.u)("div",{class:sn},e.title)),(0,nr.u)("div",{class:on},a))}},{key:"_renderLegendForElement",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=t.layer,u=null;if("string"==typeof e.title)u=e.title;else if(e.title){var c=e.title,d=Nr(this.messages,c,a||l);u=c.title?"".concat(c.title," (").concat(d,")"):d}var f=this._getSectionName(o,e,r),y=this._hasIndicators?(0,nr.u)("div",null,(0,nr.u)(Hr.X6,{level:this.headingLevel,class:Gr},t.title),(0,nr.u)(Hr.X6,{level:(0,Hr.MJ)(this.headingLevel),class:$r},u)):u?(0,nr.u)(Hr.X6,{level:this.headingLevel,class:$r},u):null,h=t.effectList,p=null;if("symbol-table"===e.type){var v=e.infos.map((function(r,i){return n._renderLegendForElementInfo(r,t,e.legendType,i)})).filter((function(e){return!!e}));if(v.length){var m,g=v[0].properties.classes&&v[0].properties.classes[hn],b=(m={},(0,er.Z)(m,bn,!g&&!i),(0,er.Z)(m,gn,i),m);p=(0,nr.u)("div",{class:this.classes(b)},v)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?p=this._renderLegendForRamp(e,o.opacity,h):s?p=this._renderSizeRamp(e,o.opacity):"relationship-ramp"===e.type?p=br(e,this.id,o.opacity,h):"univariate-above-and-below-ramp"===e.type?p=this._renderUnivariateAboveAndBelowRamp(e,o.opacity,h):"univariate-color-size-ramp"===e.type&&(p=this._renderUnivariateColorSizeRamp(e,o.opacity,h));if(!p)return null;var _=(0,nr.u)("div",{key:f,class:ln,id:"".concat(f,"-panel"),role:"tabpanel","aria-labelledby":f,tabIndex:0},[y,p]);return this._sectionMap.set(f,_),_}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,r){var n=zr(e,t,"horizontal"),i=n.sizeRampElement,a=n.colorRampElement;if(!i)return null;var l=Fr(i,"full",!0,"horizontal"),s=Rr(i,"above",!0,"horizontal"),o=Rr(i,"below",!0,"horizontal"),u=Vr(a,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:r}),c=Vr(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:r}),d=Zr(i,"card"),f=i.infos.map((function(e){return e.label})),y=f.length-1,h=f.map((function(e,t){return 0===t||t===y?(0,nr.u)("div",{key:t},e):null})),p={marginTop:"3px",display:"flex"};(0,rr.dZ)(this.container)?p.marginRight="".concat(d,"px"):p.marginLeft="".concat(d,"px");var v={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,nr.u)("div",{class:tn,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,nr.u)("div",{class:this.classes(wn,xn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,nr.u)("div",{key:t,class:fn,bind:e.preview,afterCreate:Or})}))),u?(0,nr.u)("div",{class:Cn,styles:p,key:"color-ramp-preview"},(0,nr.u)("div",{bind:u,afterCreate:Or}),(0,nr.u)("div",{bind:c,afterCreate:Or})):null,(0,nr.u)("div",{class:In},(0,nr.u)("div",{class:Sn,styles:v},h)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,r){var n=Mr(e,"horizontal"),i=n.sizeRampElement,a=n.colorRampElement;if(!i)return null;var l=Fr(i,"full",!1,"horizontal"),s=Vr(a,{width:Rr(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:r}),o=Zr(i,"card"),u=i.infos.length-1,c=i.infos.map((function(e,t){return 0===t||t===u?(0,nr.u)("div",{key:t},e.label):null})),d={marginTop:"3px",display:"flex"};(0,rr.dZ)(this.container)?d.marginRight="".concat(o,"px"):d.marginLeft="".concat(o,"px");var f={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,nr.u)("div",{class:tn,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,nr.u)("div",{class:this.classes(wn,xn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,nr.u)("div",{key:t,class:fn,bind:e.preview,afterCreate:Or})}))),(0,nr.u)("div",{class:Cn,styles:d,key:"color-ramp-preview"},(0,nr.u)("div",{bind:s,afterCreate:Or})),(0,nr.u)("div",{class:In},(0,nr.u)("div",{class:Sn,styles:f},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,r,n){var i=t.layer;if(e.type)return this._renderLegendForElement(e,t,n);var a=Br(i,r);if(e.preview){var l,s;if(!e.symbol||-1===e.symbol.type.indexOf("simple-fill")){if(!e.label)return(0,nr.u)("div",{key:n,bind:e.preview,afterCreate:Or});var o=(0,er.Z)({},pn,this._hasIndicators);return(0,nr.u)("div",{key:n,class:this.classes(tn,(0,er.Z)({},hn,this._hasIndicators))},(0,nr.u)("div",{class:this.classes(o),bind:e.preview,afterCreate:Or}),(0,nr.u)("div",{class:this.classes(Kr,(0,er.Z)({},rn,this._hasIndicators))},Nr(this.messages,e.label,!1)||""))}var u=255,c=255,d=255,f=0,y=255,h=255,p=255,v=0,m=e.symbol.color&&e.symbol.color.a,g=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;m&&(u=e.symbol.color.r,c=e.symbol.color.g,d=e.symbol.color.b,f=e.symbol.color.a*i.opacity),g&&(y=e.symbol.outline.color.r,h=e.symbol.outline.color.g,p=e.symbol.outline.color.b,v=e.symbol.outline.color.a*i.opacity);var b=null==(l=null==(s=e.symbol.color)?void 0:s.isBright)||l,_=b?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",w={background:m?"rgba(".concat(u,", ").concat(c,", ").concat(d,", ").concat(f,")"):"none",color:b?"black":"white",textShadow:"-1px -1px 0 ".concat(_,",\n                                              1px -1px 0 ").concat(_,",\n                                              -1px 1px 0 ").concat(_,",\n                                              1px 1px 0 ").concat(_),border:g?"1px solid rgba(".concat(y,", ").concat(h,", ").concat(p,", ").concat(v,")"):"none",filter:(0,U.wJ)(t.effectList)};return(0,nr.u)("div",{key:n,class:tn},(0,nr.u)("div",{class:en,styles:w}," ",e.label," "))}if(e.src){var L=this._renderImage(e,i,a);return(0,nr.u)("div",{key:n,class:tn},L,(0,nr.u)("div",{class:Kr},e.label||""))}}},{key:"_renderImage",value:function(e,t,r){var n,i=e.label,a=e.src,l=e.opacity,s=(n={},(0,er.Z)(n,Xr,r),(0,er.Z)(n,fn,!r),n),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,nr.u)("img",{alt:Nr(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,r=t[0],n=t[t.length-1],i=r.symbol,a=this._hasIndicators,l=(0,Z.F2)(r.size+r.outlineSize)*An,s=(0,Z.F2)(n.size+n.outlineSize)*An,o=a?l:l+50*An,u=a?l/2+50*An:l,c=function(e){if(e){if(e.type.indexOf("3d")>-1){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===r||"cone"===r||"tetrahedron"===r}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.indexOf("3d")>-1){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1),n=r.resource&&r.resource.primitive;return"circle"===n||"cross"===n||"kite"===n||"sphere"===n||"cube"===n||"diamond"===n}var i=e.style;return"circle"===i||"diamond"===i||"cross"===i}}(i),f=document.createElement("canvas");f.width=o,f.height=u,f.style.width=f.width/An+"px",f.style.height=f.height/An+"px";var y=f.getContext("2d");if(a){y.beginPath();var h=o/2-s/2,p=u;y.moveTo(0,0),y.lineTo(h,p);var v=o,m=o/2+s/2,g=u;y.moveTo(v,0),y.lineTo(m,g)}else{y.beginPath();var b=u/2-s/2,_=o;y.moveTo(0,b),y.lineTo(_,0);var w=u/2+s/2,L=o,k=u;y.moveTo(0,w),y.lineTo(L,k)}return y.strokeStyle="#ddd",y.stroke(),(0,nr.u)("div",{bind:f,afterCreate:Or,styles:a?{display:"flex",marginTop:"-".concat(c?0:d?l/2:0,"px"),marginBottom:"-".concat(c?s:d?s/2:0,"px")}:{display:"flex",marginRight:"-".concat(c?0:d?l/2:0,"px"),marginLeft:"-".concat(c?0:d?s/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var r=e.infos,n=r[0].label,i=r[r.length-1].label,a=r[0].preview,l=r[r.length-1].preview,s=this._hasIndicators,o={"flex-direction":s?"column":"row-reverse"};a&&((a=a.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var u={opacity:null!=t?"".concat(t):""};return(0,nr.u)("div",{class:this.classes(tn,(0,er.Z)({},yn,s))},(0,nr.u)("div",{class:an},s?n:i),(0,nr.u)("div",{class:Ln,styles:o},(0,nr.u)("div",{bind:a,afterCreate:Or,class:kn,styles:u}),this._renderSizeRampLines(e),(0,nr.u)("div",{bind:l,afterCreate:Or,class:Ln,styles:u})),(0,nr.u)("div",{class:an},s?i:n))}},{key:"_renderLegendForRamp",value:function(e,t,r){var n=e.infos,i="heatmap-ramp"===e.type,a=n.length-1,l=25,s=a>2&&!i?25*a:100,o=s+20,u=10,c=n.slice(0).reverse();c.forEach((function(e,t){e.offset=i?e.ratio:t/a}));var d=c.length-1,f=c.length%2!=0&&c[c.length/2|0],y=f&&(0,nr.u)("div",{class:mn},(0,nr.u)("div",{class:Jr},"|"),(0,nr.u)("div",{class:an},f.label)),h=n[n.length-1].label,p=n[0].label,v=[[{shape:{type:"path",path:"M0 ".concat(l/2," L").concat(u," 0 L").concat(u," ").concat(l," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:s,height:l},fill:{type:"linear",x1:u,y1:0,x2:s+u,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(s+u," 0 L").concat(o," ").concat(l/2," L").concat(s+u," ").concat(l," Z")},fill:c[d].color,stroke:{width:0}}]],m=(0,tr.KB)(v,o,l),g=this.messages,b={filter:(0,U.wJ)(r),opacity:null==t?null:"".concat(t)};return(0,nr.u)("div",{class:tn,styles:{justifyContent:"center"}},(0,nr.u)("div",{class:an},i?g[h]:h),(0,nr.u)("div",{class:wn},(0,nr.u)("div",{styles:b},m),y),(0,nr.u)("div",{class:an},i?g[p]:p))}}]),r}(p.Z);(0,o._)([(0,y.Cb)()],En.prototype,"activeLayerInfos",void 0),(0,o._)([(0,y.Cb)()],En.prototype,"headingLevel",void 0),(0,o._)([(0,y.Cb)()],En.prototype,"layout",void 0),(0,o._)([(0,y.Cb)(),(0,Ur.H)("esri/widgets/Legend/t9n/Legend")],En.prototype,"messages",void 0),(0,o._)([(0,y.Cb)(),(0,Ur.H)("esri/t9n/common")],En.prototype,"messagesCommon",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],En.prototype,"type",void 0),(0,o._)([(0,y.Cb)()],En.prototype,"view",void 0),(0,o._)([(0,qr.h)()],En.prototype,"_selectSection",null);var Zn=En=(0,o._)([(0,h.j)("esri.widgets.Legend.styles.Card")],En),Vn="esri-legend__service",Fn="esri-legend__service-label",Rn="esri-legend__layer",zn="esri-legend__group-layer",Mn="esri-legend__group-layer-child",Tn="esri-legend__layer-table",On="esri-legend__layer-table--size-ramp",Nn="esri-legend__layer-child-table",Dn="esri-legend__layer-caption",Bn="esri-legend__layer-body",Pn="esri-legend__layer-row",Hn="esri-legend__layer-cell esri-legend__layer-cell--info",qn="esri-legend__imagery-layer-image--stretched",Un="esri-legend__imagery-layer-info--stretched",Wn="esri-legend__layer-cell esri-legend__layer-cell--symbols",jn="esri-legend__symbol",Yn="esri-legend__ramps",Gn="esri-legend__size-ramp",Qn="esri-legend__color-ramp",Jn="esri-legend__opacity-ramp",Xn="esri-legend__ramp-labels",Kn="esri-legend__ramp-label",$n="esri-univariate-above-and-below-ramp__label",ei="esri-legend__message",ti="esri-widget__heading",ri={display:"flex",alignItems:"flex-start"},ni={marginLeft:"3px"},ii={display:"table-cell",verticalAlign:"middle"},ai=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,i.Z)(this,r),(a=t.call(this,e,n)).activeLayerInfos=null,a.headingLevel=3,a.messages=null,a.type="classic",a}return(0,a.Z)(r,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return(0,nr.u)("div",null,r&&r.length?r:(0,nr.u)("div",{class:ei},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var r=!!e.children.length,n="".concat("esri-legend__").concat(e.layer.uid,"-version-").concat(e.version),i=e.title?(0,Hr.X6)({level:this.headingLevel,class:this.classes(ti,Fn)},e.title):null;if(r){var a=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,nr.u)("div",{key:n,class:this.classes(Vn,zn)},i,a)}var l=e.legendElements;if(l&&!l.length)return null;var s=l.map((function(r){return t._renderLegendForElement(r,e.layer,e.effectList)})).filter((function(e){return!!e}));if(!s.length)return null;var o=(0,er.Z)({},Mn,!!e.parent);return(0,nr.u)("div",{key:n,class:this.classes(Vn,o),tabIndex:0},i,(0,nr.u)("div",{class:Rn},s))}},{key:"_renderLegendForElement",value:function(e,t,r,n){var i=this,a="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=null;if("symbol-table"===e.type||s){var u=e.infos.map((function(n){return i._renderLegendForElementInfo(n,t,r,s,e.legendType)})).filter((function(e){return!!e}));u.length&&(o=(0,nr.u)("div",{class:Bn},u))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?o=br(e,this.id,t.opacity,r):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,r):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity,r));if(!o)return null;var c=e.title,d=null;if("string"==typeof c)d=c;else if(c){var f=Nr(this.messages,c,a||l);d=Dr(0,a||l)&&c.title?"".concat(c.title," (").concat(f,")"):f}var y=n?Nn:Tn,h=d?(0,nr.u)("div",{class:Dn},d):null,p=(0,er.Z)({},On,s||!n);return(0,nr.u)("div",{class:this.classes(y,p)},h,o)}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,r){var n=this,i=zr(e,t),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=Rr(a,"above",!0),o=Rr(a,"below",!0),u=Vr(l,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:r}),c=Vr(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:r}),d=Zr(a),f=a.infos.map((function(e){return e.label})),y=f.map((function(e,t){var r=2===t;return 0===t?(0,nr.u)("div",{key:t,class:e?u?$n:Kn:null},e):r?(0,nr.u)("div",null):null})),h=f.length-1,p=Math.floor(f.length/2),v=f.map((function(e,t){return t===p||t===h?(0,nr.u)("div",{key:t,class:e?u?$n:Kn:null},e):null})),m={display:"table-cell",verticalAlign:"middle"},g={marginTop:"".concat(d,"px")},b={height:"".concat(s,"px")},_={height:"".concat(o,"px")};return(0,nr.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:ri},(0,nr.u)("div",{class:Bn},a.infos.map((function(e,t){return(0,nr.u)("div",{class:n.classes(Pn,Gn)},(0,nr.u)("div",{class:jn,styles:m,bind:e.preview,afterCreate:Or}),u||t%2!=0?null:(0,nr.u)("div",{class:Hn},f[t]))}))),u?(0,nr.u)("div",{styles:g,key:"color-ramp-preview"},(0,nr.u)("div",{styles:ni},(0,nr.u)("div",{styles:ii},(0,nr.u)("div",{class:Yn,bind:u,afterCreate:Or})),(0,nr.u)("div",{styles:ii},(0,nr.u)("div",{class:Xn,styles:b},y))),(0,nr.u)("div",{styles:ni},(0,nr.u)("div",{styles:ii},(0,nr.u)("div",{class:Yn,bind:c,afterCreate:Or})),(0,nr.u)("div",{styles:ii},(0,nr.u)("div",{class:Xn,styles:_},v)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,r){var n=this,i=Mr(e),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=Zr(a),o=Rr(a,"full",!1),u=Vr(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:r}),c=a.infos.length-1,d=a.infos.map((function(e,t){return 0===t||t===c?(0,nr.u)("div",{key:t,class:e.label?l?$n:Kn:null},e.label):null})),f={display:"table-cell",verticalAlign:"middle"},y={marginTop:"".concat(s,"px")},h={height:"".concat(o,"px")};return(0,nr.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:ri},(0,nr.u)("div",{class:Bn},a.infos.map((function(e){return(0,nr.u)("div",{class:n.classes(Pn,Gn)},(0,nr.u)("div",{class:jn,styles:f,bind:e.preview,afterCreate:Or}))}))),(0,nr.u)("div",{styles:y,key:"color-ramp-preview"},(0,nr.u)("div",{styles:ni},(0,nr.u)("div",{styles:ii},(0,nr.u)("div",{class:Yn,bind:u,afterCreate:Or})),(0,nr.u)("div",{styles:ii},(0,nr.u)("div",{class:Xn,styles:h},d)))))}},{key:"_renderLegendForRamp",value:function(e,t){var r=this,n=e.infos,i="opacity-ramp"===e.type,a="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,s=e.preview,o=i?Jn:"";s.className="".concat(Qn," ").concat(o),null!=t&&(s.style.opacity=t.toString());var u=n.map((function(e){return(0,nr.u)("div",{class:e.label?Kn:null},a?r.messages[e.label]:l?r._getStretchStopLabel(e):e.label)})),c={width:"".concat(24,"px")},d={height:s.style.height};return(0,nr.u)("div",{class:Pn},(0,nr.u)("div",{class:Wn,styles:c},(0,nr.u)("div",{class:Yn,bind:s,afterCreate:Or})),(0,nr.u)("div",{class:Hn},(0,nr.u)("div",{class:Xn,styles:d},u)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,G.uf)(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,r,n,i){var a;if(e.type)return this._renderLegendForElement(e,t,r,!0);var l=null,s=Br(t,i);if(e.preview?l=(0,nr.u)("div",{class:jn,bind:e.preview,afterCreate:Or}):e.src&&(l=this._renderImage(e,t,s)),!l)return null;var o=(0,er.Z)({},Un,s),u=(a={},(0,er.Z)(a,Un,s),(0,er.Z)(a,Gn,!s&&n),a);return(0,nr.u)("div",{class:Pn},(0,nr.u)("div",{class:this.classes(Wn,u)},l),(0,nr.u)("div",{class:this.classes(Hn,o)},Nr(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,r){var n,i=e.label,a=e.src,l=e.opacity,s=(n={},(0,er.Z)(n,qn,r),(0,er.Z)(n,jn,!r),n),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,nr.u)("img",{alt:Nr(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}}]),r}(p.Z);(0,o._)([(0,y.Cb)()],ai.prototype,"activeLayerInfos",void 0),(0,o._)([(0,y.Cb)()],ai.prototype,"headingLevel",void 0),(0,o._)([(0,y.Cb)(),(0,Ur.H)("esri/widgets/Legend/t9n/Legend")],ai.prototype,"messages",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],ai.prototype,"type",void 0);var li=ai=(0,o._)([(0,h.j)("esri.widgets.Legend.styles.Classic")],ai),si="esri-legend",oi="esri-widget",ui="esri-widget--panel",ci="esri-icon-layer-list",di=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,i.Z)(this,r),(a=t.call(this,e,n))._handles=new u.Z,a.activeLayerInfos=null,a.basemapLegendVisible=!1,a.groundLegendVisible=!1,a.headingLevel=3,a.hideLayersNotInCurrentView=!1,a.keepCacheOnDestroy=!1,a.respectLayerVisibility=!0,a.iconClass=ci,a.label=void 0,a.layerInfos=null,a.messages=null,a.style=new li,a.view=null,a.viewModel=new $t,a}return(0,a.Z)(r,[{key:"initialize",value:function(){var e=this;this.own((0,c.on)(this,"view","resize",(function(){return e.scheduleRender()})),(0,c.on)(this,"activeLayerInfos","change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),(0,c.YP)(this,"headingLevel",(function(t){var r=e.style;r&&(r.headingLevel=t)})),(0,c.S1)(this,"style",(function(t,r){r&&t!==r&&r.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"castStyle",value:function(e){if(e instanceof Zn||e instanceof li)return e;if("string"==typeof e)return"card"===e?new Zn:new li;if(e&&"string"==typeof e.type){var t=(0,n.Z)({},e);return delete t.type,new("card"===e.type?Zn:li)(t)}return new li}},{key:"render",value:function(){return(0,nr.u)("div",{class:this.classes(si,oi,this.style instanceof li?ui:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,r=(0,c.S1)(e,"version",(function(){return t.scheduleRender()}));this._handles.add(r,"version_".concat(e.layer.uid));var n=(0,c.on)(e,"children","change",(function(){e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}));this._handles.add(n,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),r}(p.Z);(0,o._)([(0,d.B)("viewModel.activeLayerInfos")],di.prototype,"activeLayerInfos",void 0),(0,o._)([(0,d.B)("viewModel.basemapLegendVisible")],di.prototype,"basemapLegendVisible",void 0),(0,o._)([(0,d.B)("viewModel.groundLegendVisible")],di.prototype,"groundLegendVisible",void 0),(0,o._)([(0,y.Cb)()],di.prototype,"headingLevel",void 0),(0,o._)([(0,d.B)("viewModel.hideLayersNotInCurrentView")],di.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,d.B)("viewModel.keepCacheOnDestroy")],di.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,d.B)("viewModel.respectLayerVisibility")],di.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,y.Cb)()],di.prototype,"iconClass",void 0),(0,o._)([(0,y.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],di.prototype,"label",void 0),(0,o._)([(0,d.B)("viewModel.layerInfos")],di.prototype,"layerInfos",void 0),(0,o._)([(0,y.Cb)(),(0,Ur.H)("esri/widgets/Legend/t9n/Legend")],di.prototype,"messages",void 0),(0,o._)([(0,y.Cb)()],di.prototype,"style",void 0),(0,o._)([(0,f.p)("style")],di.prototype,"castStyle",null),(0,o._)([(0,d.B)("viewModel.view")],di.prototype,"view",void 0),(0,o._)([(0,y.Cb)()],di.prototype,"viewModel",void 0);var fi=di=(0,o._)([(0,h.j)("esri.widgets.Legend")],di)}}]);
//# sourceMappingURL=3582.7aaaa1d1.chunk.js.map