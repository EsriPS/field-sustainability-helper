"use strict";(globalThis.webpackChunkfield_sustainability_helper=globalThis.webpackChunkfield_sustainability_helper||[]).push([[4958],{26686:(e,t,i)=>{i.d(t,{Z:()=>Z});var s=i(27366),a=i(52639),r=i(41691),n=i(94172),o=i(49861),l=(i(63780),i(93169),i(25243),i(69912)),d=i(55185),h=i(28959),c=i(80613),u=i(64510);class p extends u.Z{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"flow",brushes:[h.Z],target:()=>this.children,drawPhase:c.jx.MAP});return[...super.prepareRenderPasses(e),t]}}i(59486);var _=i(85015),g=i(32718),y=i(16889),m=i(92026),f=i(66978),x=i(7882);const v=g.Z.getLogger("esri.views.2d.engine.flow.FlowDisplayData");class S{constructor(e,t,i,s){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=s}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:"loaded",resources:t}}prepareForRendering(e){if("loaded"!==this.state.name)return void v.error("Only loaded resources can be attached.");const t=this.state.resources;t.prepareForRendering(e),this.state={name:"attached",resources:t}}destroy(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&(!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0))}}var w=i(22753),b=i(23588),D=i(87422);class C extends D.s{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){(0,m.pC)(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:t}=this;if((0,m.Wi)(t))return;const i=t.extent.xmin,s=t.extent.ymax,a=[0,0];e.toScreen(a,[i,s]);const r=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,n=(0,y.Vl)(e.rotation),{dvs:o}=this.transforms;(0,w.l)(o,[-1,1,0]),(0,w.d)(o,o,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),(0,w.c)(o,o,[a[0],a[1],0]),(0,w.r)(o,o,n),(0,w.d)(o,o,[r*e.pixelRatio,r*e.pixelRatio,1])}_createTransforms(){return{dvs:(0,b.c)()}}}var R=i(53866);const V=g.Z.getLogger("esri.views.2d.engine.flow.FlowStrategy");let A=class extends _.Z{constructor(e){super(e),this._flowDisplayObject=new C,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if((0,m.Wi)(t))return void this._clear();const{extent:i,rotation:s,resolution:a,pixelRatio:r}=e.state,n=function(e,t){const i=new x.Z({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),s=e.xmax-e.xmin,a=e.ymax-e.ymin,r=Math.abs(Math.cos((0,y.Vl)(t))),n=Math.abs(Math.sin((0,y.Vl)(t))),o=r*s+n*a,l=n*s+r*a,d=new R.Z({xmin:i.x-o/2,ymin:i.y-l/2,xmax:i.x+o/2,ymax:i.y+l/2,spatialReference:e.spatialReference});return d.centerAt(i),d}(i,s);n.expand(1.15);const o=[Math.round((n.xmax-n.xmin)/a),Math.round((n.ymax-n.ymin)/a)],l=new S(t,n,o,r);if((0,m.pC)(this._loading)){if(this._loading.update(l))return;this._loading.destroy(),this._loading=null}!(0,m.Wi)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(e=>{(0,f.D_)(e)||(V.error("A resource failed to load.",e),this._loading=null)})),this._loading=l)}_clear(){this._flowDisplayObject.clear(),(0,m.pC)(this._loading)&&(this._loading.destroy(),this._loading=null)}};(0,s._)([(0,o.Cb)()],A.prototype,"_loading",void 0),(0,s._)([(0,o.Cb)()],A.prototype,"flowContainer",void 0),(0,s._)([(0,o.Cb)()],A.prototype,"updating",null),A=(0,s._)([(0,l.j)("esri.views.2d.engine.flow.FlowStrategy")],A);const O=A;var T=i(44070),F=i(8548),z=i(45412),I=i(61109);const P=new Map;P.set("a_positionAndSide",0),P.set("a_timeInfo",1),P.set("a_extrude",2),P.set("a_speed",3);const k={geometry:[new I.G("a_positionAndSide",3,F.g.FLOAT,0,36),new I.G("a_timeInfo",3,F.g.FLOAT,12,36),new I.G("a_extrude",2,F.g.FLOAT,24,36),new I.G("a_speed",1,F.g.FLOAT,32,36)]};class L{constructor(e,t,i){this.values=i,this._vertexData=e,this._indexData=t}prepareForRendering(e){const t=T.f.createVertex(e,F.l1.STATIC_DRAW,this._vertexData),i=T.f.createIndex(e,F.l1.STATIC_DRAW,this._indexData),s=new z.U(e,P,k,{geometry:t},i);this.vertexBuffer=t,this.indexBuffer=i,this.vertexArray=s,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}get locations(){return P}}var M=i(17842);function W(e){const t=function(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,M.F2)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],i=[],s=[];let a;if(t.stops){for(const e of t.stops)i.push(e.value),s.push(e.size);a=t.stops.length}else i.push(t.minDataValue,t.maxDataValue),s.push(t.minSize,t.maxSize),a=2;return{kind:"ramp",stops:i,values:s,count:a}}(e),i="constant"===(c=t).kind?c.value[0]:c.values[c.values.length-1],s=2*i,a=Math.round((0,M.F2)(e.maxPathLength)/s)+1,r=i,n=function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:E(e.color)};const t=e.getVisualVariablesForType("color")[0],i=[],s=[];for(const a of t.stops)i.push(a.value),Array.prototype.push.apply(s,E(a.color));return{kind:"ramp",stops:i,values:s,count:t.stops.length}}(e),o=function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],i=[],s=[];for(const a of t.stops)i.push(a.value),s.push(a.opacity);return{kind:"ramp",stops:i,values:s,count:t.stops.length}}(e),{flowSpeed:l,trailLength:d,density:h}=e;var c;return{lineRenderWidth:t,segmentLength:s,verticesPerLine:a,lineCollisionWidth:r,lineSpacing:10,lineColor:n,lineOpacity:o,lineSpeed:l,fadeDuration:d,density:h,smoothing:(0,M.F2)(e.smoothing),velocityScale:"flow-from"===e.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}function E(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}class j{constructor(e,t,i,s){this._loadImagery=e,this._createStreamlinesMesh=t,this._timeExtent=s,this._rendererSettings=W(i)}get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(e){let t=!0;return t=t&&e._loadImagery===this._loadImagery,t=t&&e._createStreamlinesMesh===this._createStreamlinesMesh,t=t&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,t=t&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength,t=t&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,t=t&&e._rendererSettings.density===this._rendererSettings.density,t=t&&e._rendererSettings.smoothing===this._rendererSettings.smoothing,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,t=t&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,t=t&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.interpolate===this._rendererSettings.interpolate,t=t&&e._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind,t=t&&e._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind,t=t&&e._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind,t&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),t&&e._timeExtent!==this._timeExtent&&(t=!(!(0,m.pC)(e._timeExtent)||!(0,m.pC)(this._timeExtent))&&e._timeExtent.equals(this._timeExtent)),t}async loadResources(e,t){const{extent:i,size:s}=e;(0,f.k_)(t);const a=await this._loadImagery(i,s[0],s[1],this._timeExtent,t),{vertexData:r,indexData:n}=await this._createStreamlinesMesh(this._rendererSettings,a,t);return new L(r,n,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})}}let q=class extends r.r{constructor(){super(...arguments),this._loadImagery=(e,t,i,s,a)=>(0,d.KK)(this.layer,e,t,i,s,a),this._createStreamlinesMesh=(e,t,i)=>this.layer.createStreamlinesMesh({flowData:t,rendererSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:e}=this,t=()=>{this._loadImagery=(t,i,s,a,r)=>(0,d.KK)(e,t,i,s,a,r),this._updateVisualization()};"multidimensionalDefinition"in e?this.handles.add((0,n.YP)((()=>e.multidimensionalDefinition),t)):this.handles.add([(0,n.YP)((()=>e.mosaicRule),t),(0,n.YP)((()=>e.renderingRule),t),(0,n.YP)((()=>e.definitionExpression),t)]),this.container=new p,this._strategy=new O({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new a.Z({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){if("flow"!==this.layer.renderer.type)return;const e=new j(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=e,this.layerView.requestUpdate()}};(0,s._)([(0,o.Cb)()],q.prototype,"_strategy",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"attached",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"container",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"layer",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"layerView",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"type",void 0),(0,s._)([(0,o.Cb)()],q.prototype,"updating",null),(0,s._)([(0,o.Cb)()],q.prototype,"timeExtent",void 0),q=(0,s._)([(0,l.j)("esri.views.2d.engine.flow.FlowView2D")],q);const Z=q},60831:(e,t,i)=>{i.d(t,{F:()=>p});i(93169);var s=i(92026),a=i(22753),r=i(23588),n=i(15245),o=i(64145),l=i(87422),d=i(46640),h=i(44070),c=i(8548),u=i(45412);class p extends l.s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,t;(0,s.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&(0,s.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,s.pC)(this.source)&&!(0,s.pC)(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=(0,o.wF)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=(0,o.K)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=(0,o.wF)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),s=(0,o.K)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(e.context,s);this.vaoData={magdir:i,scalar:a}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,r.c)()}}setTransform(e){const t=(0,a.b)(this.transforms.dvs),[i,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),r=this.resolution/this.pixelRatio/e.resolution,o=r*this.width,l=r*this.height,d=Math.PI*this.rotation/180;(0,a.c)(t,t,(0,n.f)(i,s)),(0,a.c)(t,t,(0,n.f)(o/2,l/2)),(0,a.r)(t,t,-d),(0,a.c)(t,t,(0,n.f)(-o/2,-l/2)),(0,a.j)(t,t,(0,n.f)(o,l)),(0,a.m)(this.transforms.dvs,e.displayViewMat3,t)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:s}=t,a=h.f.createVertex(e,c.l1.STATIC_DRAW,new Float32Array(i)),r=h.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(s)),n=(0,d.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:c.g.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:c.g.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:c.g.FLOAT,normalized:!1}]});return{vao:new u.U(e,n.attributes,n.bufferLayouts,{geometry:a},r),elementCount:s.length}}}},24405:(e,t,i)=>{i.d(t,{V:()=>n,e:()=>r});var s=i(92026),a=i(80031);async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.popupTemplate;if(!(0,s.pC)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:n,typeIdField:o,globalIdField:l,relationships:d}=e;if(i.includes("*"))return["*"];const h=r?await(0,a.CH)(e):[],c=(0,a.Q0)(e.fieldsIndex,[...i,...h]);return o&&c.push(o),c&&n&&e.fieldsIndex.has(n)&&-1===c.indexOf(n)&&c.push(n),c&&l&&e.fieldsIndex.has(l)&&-1===c.indexOf(l)&&c.push(l),d&&d.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex.has(i)&&-1===c.indexOf(i)&&c.push(i)})),c}function n(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=4958.237cf9b1.chunk.js.map