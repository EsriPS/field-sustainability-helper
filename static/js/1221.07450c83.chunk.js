"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[1221],{4685:function(e,t,r){r.d(t,{C:function(){return y},b:function(){return g}});var n,i,a=r(30168),o=r(60750),s=r(53685),l=r(29202),u=r(41481),c=r(85586),d=r(8973),h=r(116),f=r(78980),p=r(98634),v=r(64201),m=r(4760);function g(){var e=new v.kG;return e.attributes.add(m.T.POSITION,"vec2"),e.varyings.add("worldRay","vec3"),e.vertex.uniforms.add("inverseProjectionMatrix","mat4"),e.vertex.uniforms.add("inverseViewMatrix","mat4"),e.vertex.code.add((0,p.H)(n||(n=(0,a.Z)(["void main(void) {\nvec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;\nworldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;\ngl_Position = vec4(position, 1.0, 1.0);\n}"])))),e.fragment.uniforms.add("lightingMainDirection","vec3"),e.fragment.include(h.Y),e.fragment.include(f.n),e.include(s.v),e.include(o._,{pbrMode:u.f7.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(c.e),e.include(l.D),e.include(d.j),e.fragment.code.add((0,p.H)(i||(i=(0,a.Z)(["void main() {\nvec4 cloudsColor = crossFade == 0 ? renderCloud(normalize(worldRay), cameraPosition) : renderCloudCrossFade(normalize(worldRay), cameraPosition);\ngl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);\n}"])))),e}var y=Object.freeze({__proto__:null,build:g})},45028:function(e,t,r){r.d(t,{C:function(){return E},b:function(){return C}});var n,i,a,o,s,l,u,c,d=r(30168),h=r(71011),f=r(33280),p=r(94951),v=r(48655),m=r(16574),g=r(137),y=r(21002),_=r(15226),T=r(10763),x=r(116),b=r(98634),O=r(64201),S=r(4760);function C(e){var t=new O.kG,r=e.output===h.H.Depth;return t.include(p.w,{linearDepth:r}),t.include(v.c,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),t.attributes.add(S.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),r&&(t.include(m.F,e),t.vertex.uniforms.add("nearFar","vec2"),t.varyings.add("linearDepth","float")),t.vertex.code.add((0,b.H)(n||(n=(0,d.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      ","\n      gl_Position = ","\n    }\n  "])),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",r?(0,b.H)(i||(i=(0,d.Z)(["transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);"]))):(0,b.H)(a||(a=(0,d.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(f.p2,e),t.fragment.include(x.Y),e.multipassTerrainEnabled&&(t.fragment.include(y.S),t.include(_.l,e)),t.fragment.uniforms.add("eColor","vec4"),e.output===h.H.Highlight&&t.include(g.bA),t.fragment.code.add((0,b.H)(o||(o=(0,d.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n  }\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.attributeColor?"vColor * eColor;":"eColor;",b.H.float(T.bf),e.output===h.H.Alpha?(0,b.H)(s||(s=(0,d.Z)(["gl_FragColor = vec4(fColor.a);"]))):"",e.output===h.H.Color?(0,b.H)(l||(l=(0,d.Z)(["gl_FragColor = highlightSlice(fColor, vpos); ",""])),e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"",e.output===h.H.Highlight?(0,b.H)(u||(u=(0,d.Z)(["outputHighlight();"]))):"",e.output===h.H.Depth?(0,b.H)(c||(c=(0,d.Z)(["outputDepth(linearDepth);"]))):"")),t}var E=Object.freeze({__proto__:null,build:C})},4170:function(e,t,r){r.d(t,{C:function(){return l},a:function(){return p},b:function(){return f}});var n,i,a,o,s,l,u=r(30168),c=r(74321),d=r(98634),h=r(64201);function f(e){var t=new h.kG;return t.include(c.k),t.fragment.uniforms.add("tex","sampler2D"),e.function===l.Standard&&(e.hasOpacityFactor?(t.fragment.uniforms.add("opacity","float"),t.fragment.code.add((0,d.H)(n||(n=(0,u.Z)(["void main() {\ngl_FragColor = texture2D(tex, uv) * opacity;\n}"]))))):t.fragment.code.add((0,d.H)(i||(i=(0,u.Z)(["void main() {\ngl_FragColor = texture2D(tex, uv);\n}"]))))),e.function===l.OverlayWithTransparency&&(t.fragment.uniforms.add("overlayIdx","int"),e.hasOpacityFactor&&t.fragment.uniforms.add("opacity","float"),t.fragment.code.add((0,d.H)(a||(a=(0,u.Z)(["\n      void main() {\n        vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\n        gl_FragColor = texture2D(tex, overlayUV) ",";\n      }"])),e.hasOpacityFactor?"* opacity":""))),e.function===l.TransparentToHUDVisibility&&t.fragment.code.add((0,d.H)(o||(o=(0,u.Z)(["void main() {\ngl_FragColor = vec4(1.0 - texture2D(tex, uv).a);\n}"])))),e.function===l.Transparency&&(t.fragment.uniforms.add("colorTexture","sampler2D"),t.fragment.uniforms.add("alphaTexture","sampler2D"),t.fragment.uniforms.add("frontFaceTexture","sampler2D"),t.fragment.code.add((0,d.H)(s||(s=(0,u.Z)(["void main() {\nvec4 srcColor = texture2D(colorTexture, uv);\nfloat srcAlpha = texture2D(alphaTexture, uv).r;\nvec4 frontFace = texture2D(frontFaceTexture, uv);\nif(srcColor.a <= 1e-5){\ndiscard;\n}\ngl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);\n}"]))))),t}!function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"}(l||(l={}));var p=Object.freeze({__proto__:null,get CompositingFunction(){return l},build:f})},18442:function(e,t,r){r.d(t,{H:function(){return W},a:function(){return z},b:function(){return V},c:function(){return j}});var n,i,a,o,s,l,u,c,d,h,f,p,v,m,g,y,_,T,x,b=r(30168),O=r(88396),S=r(6394),C=r(67077),E=r(55360),A=r(71011),R=r(33280),w=r(28156),P=r(50600),I=r(50913),D=r(137),M=r(18607),H=r(10763),N=r(116),Z=r(78980),L=r(62993),F=r(98634),k=r(64201),U=r(4760);function z(e){var t=new k.kG,r=e.signedDistanceFieldEnabled;if(t.include(w.H),t.include(P.RL,e),t.include(R.p2,e),e.output===A.H.Occlusion)return t.include(I.R,e),t;t.include(L.c),t.fragment.include(Z.n),t.fragment.include(N.Y),t.include(M.kl,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),t.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4"),r&&t.vertex.uniforms.add("outlineColor","vec4"),e.screenSizePerspectiveEnabled&&t.vertex.uniforms.add("screenSizePerspective","vec4"),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(U.T.UV0,"vec2"),t.attributes.add(U.T.COLOR,"vec4"),t.attributes.add(U.T.SIZE,"vec2"),t.attributes.add(U.T.AUXPOS2,"vec4"),t.vertex.code.add((0,F.H)(n||(n=(0,b.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n\n      ","\n\n      ","\n    "])),e.screenSizePerspectiveEnabled?(0,F.H)(i||(i=(0,b.Z)(["\n      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,F.H)(a||(a=(0,b.Z)(["\n      inputSize = size;\n      vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(auxpos2).xx;":"",e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":"",e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""));var O=(0,F.H)(o||(o=(0,b.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),S=e.pixelSnappingEnabled?r?(0,F.H)(s||(s=(0,b.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,F.H)(l||(l=(0,b.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,F.H)(u||(u=(0,b.Z)(["posProj += quadOffset;"])));t.vertex.code.add((0,F.H)(c||(c=(0,b.Z)(["\n      ","\n      ","\n      ","\n\n      bool alphaDiscard = vcolor.a < ",";\n      ",'\n      if (alphaDiscard) {\n        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      } else {\n        ',"\n        gl_Position = posProj;\n      }\n\n      vtc = uv * textureCoordinateScaleFactor;\n\n      ","\n      vsize = inputSize;\n      ","\n    }\n    "])),e.occlusionTestEnabled?"if (visible) {":"",O,e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;",F.H.float(H.bf),r?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(F.H.float(H.bf),";"):"",S,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,F.H)(d||(d=(0,b.Z)(["} else { vtc = vec2(0.0);\n        ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),t.fragment.uniforms.add("tex","sampler2D"),r&&(t.fragment.uniforms.add("outlineColor","vec4"),t.fragment.uniforms.add("outlineSize","float"));var C=e.debugDrawLabelBorder?(0,F.H)(h||(h=(0,b.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),F.H.float(H.F)):F.H.float(H.F),z=(0,F.H)(f||(f=(0,b.Z)(["\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,F.H)(p||(p=(0,b.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",r?(0,F.H)(v||(v=(0,b.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize = ",";\n      const float texelSize = 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        gl_FragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),F.H.float(E.Ph),C,F.H.float(H.bf),C):(0,F.H)(m||(m=(0,b.Z)(["\n          vec4 texColor = texture2D(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          gl_FragColor = texColor * premultiplyAlpha(vcolor);\n          "])),C),e.debugDrawLabelBorder?(0,F.H)(g||(g=(0,b.Z)(["gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");return e.output===A.H.Alpha&&t.fragment.code.add((0,F.H)(y||(y=(0,b.Z)(["\n      void main() {\n        ","\n        gl_FragColor = vec4(gl_FragColor.a);\n      }\n      "])),z)),e.output===A.H.Color&&t.fragment.code.add((0,F.H)(_||(_=(0,b.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),z,e.frontFacePass?"gl_FragColor.rgb /= gl_FragColor.a;":"")),e.output===A.H.Highlight&&(t.include(D.bA),t.fragment.code.add((0,F.H)(T||(T=(0,b.Z)(["\n    void main() {\n      ","\n      ","\n    }\n    "])),z,e.binaryHighlightOcclusionEnabled?(0,F.H)(x||(x=(0,b.Z)(["\n          if (voccluded == 1.0) {\n            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();"))),t}function V(e,t,r){e.setUniform4fv("materialColor",t.color),t.textureIsSignedDistanceField&&(t.outlineColor[3]<=0||t.outlineSize<=0?(e.setUniform4fv("outlineColor",C.Z),e.setUniform1f("outlineSize",0)):(e.setUniform4fv("outlineColor",t.outlineColor),e.setUniform1f("outlineSize",t.outlineSize))),e.setUniform2f("screenOffset",2*t.screenOffset[0]*r,2*t.screenOffset[1]*r),e.setUniform2fv("anchorPos",j(t))}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;return e.textureIsSignedDistanceField?G(e.anchorPos,e.distanceFieldBoundingBox,t):(0,O.c)(t,e.anchorPos),t}function G(e,t,r){r[0]=e[0]*(t[2]-t[0])+t[0],r[1]=e[1]*(t[3]-t[1])+t[1]}var B=(0,S.a)(),W=Object.freeze({__proto__:null,build:z,bindHUDMaterialUniforms:V,calculateAnchorPosForRendering:j})},23819:function(e,t,r){r.d(t,{H:function(){return f},b:function(){return h}});var n,i,a=r(30168),o=r(74321),s=r(10763),l=r(98634),u=r(64201),c=r(68401),d=r(65322);function h(e){var t=new u.kG,r=e.mode;return t.include(o.k),t.include(s.sj,{alphaDiscardMode:c.JJ.Blend}),t.fragment.uniforms.add("densityMap","sampler2D"),t.fragment.uniforms.add("tex","sampler2D"),t.fragment.uniforms.add("densityNormalizer","float"),t.fragment.uniforms.add("minDensity","float"),r===d.H.KernelDensity&&t.fragment.uniforms.add("densityMultiplier","float"),t.fragment.code.add((0,l.H)(n||(n=(0,a.Z)(["\n    void main() {\n      float density = texture2D(densityMap, uv).r",";\n      float densityRatio = (density - minDensity) * densityNormalizer;\n\n      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));\n\n      discardOrAdjustAlpha(color);\n      gl_FragColor = color;\n    }\n  "])),r===d.H.KernelDensity?(0,l.H)(i||(i=(0,a.Z)([" * densityMultiplier"]))):"")),t}var f=Object.freeze({__proto__:null,build:h,get HeatmapMode(){return d.H}})},65322:function(e,t,r){r.d(t,{H:function(){return u},a:function(){return v},b:function(){return p}});var n,i,a,o,s,l,u,c=r(30168),d=r(98634),h=r(64201),f=r(4760);function p(e){var t=new h.kG,r=e.mode,p=e.isAttributeDriven;return t.attributes.add(f.T.POSITION,"vec3"),t.attributes.add(f.T.UV0,"vec2"),e.isAttributeDriven&&(t.attributes.add(f.T.FEATUREATTRIBUTE,"float"),t.varyings.add("attributeValue","float")),t.varyings.add("unitCirclePos","vec2"),t.vertex.uniforms.add("radius","float"),t.vertex.uniforms.add("proj","mat4"),t.vertex.uniforms.add("view","mat4"),t.vertex.code.add((0,d.H)(n||(n=(0,c.Z)(["\n    void main() {\n      unitCirclePos = uv0;\n\n      vec4 posProj = proj * (view * vec4(",", 1.0));\n      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);\n\n      ","\n      gl_Position = posProj + quadOffset;\n    }\n  "])),f.T.POSITION,p?(0,d.H)(i||(i=(0,c.Z)(["attributeValue = ",";"])),f.T.FEATUREATTRIBUTE):"")),r===u.KernelDensity?t.fragment.code.add((0,d.H)(a||(a=(0,c.Z)(["\n      void main() {\n        float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);\n        if (radiusRatioSquared > 1.0) {\n          discard;\n        }\n\n        float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;\n        float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ",";\n        gl_FragColor = vec4(density);\n      }\n    "])),p?(0,d.H)(o||(o=(0,c.Z)([" * attributeValue"]))):"")):r===u.GaussianBlur&&(t.fragment.uniforms.add("kernel","sampler2D"),t.fragment.code.add((0,d.H)(s||(s=(0,c.Z)(["\n    void main() {\n      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);\n      if (radiusRatioSquared > 1.0) {\n        discard;\n      }\n\n      vec2 uv = abs(unitCirclePos);\n      vec2 uvX = vec2(uv.x, 0.5);\n      vec2 uvY = vec2(uv.y, 0.5);\n      float intensity = texture2D(kernel, uvX).r * texture2D(kernel, uvY).r",";\n      gl_FragColor = vec4(intensity);\n    }\n  "])),p?(0,d.H)(l||(l=(0,c.Z)([" * attributeValue"]))):""))),t}!function(e){e[e.GaussianBlur=0]="GaussianBlur",e[e.KernelDensity=1]="KernelDensity"}(u||(u={}));var v=Object.freeze({__proto__:null,get HeatmapMode(){return u},build:p})},99337:function(e,t,r){r.d(t,{N:function(){return A},b:function(){return E}});var n,i,a,o,s,l,u,c,d,h,f,p=r(30168),v=r(1413),m=r(71011),g=r(33280),y=r(94951),_=r(48655),T=r(137),x=r(37248),b=r(10763),O=r(98634),S=r(64201),C=r(4760);function E(e){var t=new S.kG;return t.include(y.w,{linearDepth:!1}),t.include(_.c,e),t.include(x.q,(0,v.Z)((0,v.Z)({},e),{},{stippleRequiresStretchMeasure:!1})),t.vertex.uniforms.add("proj","mat4").add("view","mat4"),e.stippleEnabled&&(t.vertex.uniforms.add("ndcToPixel","vec2"),t.attributes.add(C.T.UV0,"vec2"),t.attributes.add(C.T.AUXPOS1,"vec3")),t.attributes.add(C.T.POSITION,"vec3"),t.varyings.add("vpos","vec3"),t.vertex.code.add((0,O.H)(n||(n=(0,p.Z)(["void main(void) {\nvpos = position;\nforwardNormalizedVertexColor();\ngl_Position = transformPosition(proj, view, vpos);"])))),e.stippleEnabled&&(t.vertex.code.add((0,O.H)(i||(i=(0,p.Z)(["vec4 vpos2 = transformPosition(proj, view, auxpos1);\nfloat lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);"])))),e.draped||t.vertex.code.add((0,O.H)(a||(a=(0,p.Z)(["vec3 segmentCenter = (position + auxpos1) * 0.5;\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),t.vertex.code.add((0,O.H)(o||(o=(0,p.Z)(["float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);"])))),e.draped?t.vertex.code.add((0,O.H)(s||(s=(0,p.Z)(["float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);\nfloat segmentLengthPseudoScreen = lineSegmentPixelSize;"])))):t.vertex.code.add((0,O.H)(l||(l=(0,p.Z)(["float segmentLengthRender = length(position - auxpos1);\nfloat startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),t.vertex.code.add((0,O.H)(u||(u=(0,p.Z)(["vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);\nvStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);\nvStippleDistance *= gl_Position.w;"]))))),t.vertex.code.add((0,O.H)(c||(c=(0,p.Z)(["}"])))),e.output===m.H.Highlight&&t.include(T.bA),t.include(g.p2,e),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add((0,O.H)(d||(d=(0,p.Z)(["\n  void main() {\n    discardBySlice(vpos);\n\n    vec4 color = ",";\n\n    float stippleAlpha = getStippleAlpha();\n    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\n\n    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n  }\n  "])),e.attributeColor?"vColor":"constantColor",O.H.float(b.bf),e.output===m.H.Color?(0,O.H)(h||(h=(0,p.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===m.H.Highlight?(0,O.H)(f||(f=(0,p.Z)(["outputHighlight();"]))):"")),t}var A=Object.freeze({__proto__:null,build:E})},98186:function(e,t,r){r.d(t,{C:function(){return j},N:function(){return ae},R:function(){return se},b:function(){return oe}});var n,i,a,o,s,l,u,c,d,h,f,p,v,m,g,y,_,T,x,b,O,S,C,E,A,R,w,P,I,D,M,H,N,Z,L,F,k,U,z,V,j,G=r(30168),B=r(1413),W=r(71011),q=r(33280),J=r(48353),X=r(16574),Y=r(21002),K=r(37248),$=r(15226),Q=r(85586),ee=r(10763),te=r(116),re=r(98634),ne=r(64201),ie=r(4760),ae=1;function oe(e){var t=new ne.kG,r=e.capType!==j.BUTT,oe=e.capType===j.ROUND,se=e.stippleEnabled&&oe,le=e.falloffEnabled||se,ue=e.innerColorEnabled||oe,ce=e.stippleEnabled&&e.stippleScaleWithLineWidth||oe,de=e.stippleEnabled&&e.stippleScaleWithLineWidth,he=e.stippleEnabled||oe;return t.include(Q.e),t.include(J.U,e),t.include(K.q,(0,B.Z)((0,B.Z)({},e),{},{stippleRequiresStretchMeasure:!0})),e.output===W.H.Depth&&t.include(X.F,e),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2").add("inverseProjectionMatrix","mat4"),t.vertex.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(ie.T.POSITION,"vec3"),t.attributes.add(ie.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(ie.T.UV0,"vec2"),t.attributes.add(ie.T.AUXPOS1,"vec3"),t.attributes.add(ie.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),ce&&t.varyings.add("vLineWidth","float"),de&&t.varyings.add("vLineSizeInv","float"),ue&&t.varyings.add("vLineDistance","float"),le&&t.varyings.add("vLineDistanceNorm","float"),e.falloffEnabled&&t.fragment.uniforms.add("falloff","float"),e.innerColorEnabled&&(t.fragment.uniforms.add("innerColor","vec4"),t.fragment.uniforms.add("innerWidth","float")),oe&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),t.vertex.code.add((0,re.H)(n||(n=(0,G.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),t.vertex.code.add((0,re.H)(i||(i=(0,G.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= screenSize / posNdc.w;\nreturn posNdc;\n}"])))),t.vertex.code.add((0,re.H)(a||(a=(0,G.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),e.multipassTerrainEnabled?"depth = pos.z;":"")),t.vertex.code.add((0,re.H)(o||(o=(0,G.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n\n      float lineSize = getSize();\n      float lineWidth = lineSize * pixelRatio;\n\n      ","\n      ","\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left = (pos.xy - prev.xy);\n      vec2 right = (next.xy - pos.xy);\n\n      float leftLen = length(left);\n      float rightLen = length(right);\n  "])),ce?(0,re.H)(s||(s=(0,G.Z)(["vLineWidth = lineWidth;"]))):"",de?(0,re.H)(l||(l=(0,G.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),he&&t.vertex.code.add((0,re.H)(u||(u=(0,G.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),oe?(0,re.H)(c||(c=(0,G.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),t.vertex.code.add((0,re.H)(d||(d=(0,G.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?t.vertex.code.add((0,re.H)(h||(h=(0,G.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,re.H)(f||(f=(0,G.Z)(["min(1.0, subdivisionFactor * ",")"])),re.H.float((ae+2)/(ae+1))):(0,re.H)(p||(p=(0,G.Z)(["subdivisionFactor"]))))):t.vertex.code.add((0,re.H)(v||(v=(0,G.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"])))),t.vertex.code.add((0,re.H)(m||(m=(0,G.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),r?(0,re.H)(g||(g=(0,G.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),t.vertex.code.add((0,re.H)(y||(y=(0,G.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n    ","\n\n    ","\n    ","\n\n    pos.xy += dpos;\n  "])),le||ue?(0,re.H)(_||(_=(0,G.Z)(["float lineDistNorm = sign(uv0.y) * pos.w;"]))):"",ue?(0,re.H)(T||(T=(0,G.Z)(["vLineDistance = lineWidth * lineDistNorm;"]))):"",le?(0,re.H)(x||(x=(0,G.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),oe&&t.vertex.code.add((0,re.H)(b||(b=(0,G.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped||t.vertex.code.add((0,re.H)(O||(O=(0,G.Z)(["vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),t.vertex.code.add((0,re.H)(S||(S=(0,G.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?t.vertex.code.add((0,re.H)(C||(C=(0,G.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):t.vertex.code.add((0,re.H)(E||(E=(0,G.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),t.vertex.code.add((0,re.H)(A||(A=(0,G.Z)(["\n      float patternLength = "," stipplePatternPixelSize;\n\n      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader\n      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\n\n      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\n\n      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)\n      if (segmentLengthScreenDouble >= 0.001) {\n        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the\n        // original vertex positions, and slightly outside of that range at the displaced positions\n        vec2 stippleDisplacement = pos.xy - segmentOrigin;\n        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\n\n        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)\n        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n      }\n\n      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance\n      vStippleDistanceLimits *= pos.w;\n      vStippleDistance *= pos.w;\n\n      // Disable stipple distance limits on caps\n      vStippleDistanceLimits = isJoin ?\n                                 vStippleDistanceLimits :\n                                 isStartVertex ?\n                                  vec2(-1e038, vStippleDistanceLimits.y) :\n                                  vec2(vStippleDistanceLimits.x, 1e038);\n    "])),e.stippleScaleWithLineWidth?"lineSize * ":""))),t.vertex.code.add((0,re.H)(R||(R=(0,G.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / screenSize) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),e.multipassTerrainEnabled&&(t.fragment.include(Y.S),t.include($.l,e)),t.include(q.p2,e),t.fragment.uniforms.add("intrinsicColor","vec4"),t.fragment.include(te.Y),t.fragment.code.add((0,re.H)(w||(w=(0,G.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"")),e.wireframe?t.fragment.code.add((0,re.H)(P||(P=(0,G.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(oe&&t.fragment.code.add((0,re.H)(I||(I=(0,G.Z)(["\n      float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n      vec2 fragmentPosition = vec2(\n        min(sdf, 0.0),\n        vLineDistance\n      ) * gl_FragCoord.w;\n\n      float fragmentRadius = length(fragmentPosition);\n      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n      if (capCoverage < ",") {\n        discard;\n      }\n    "])),re.H.float(ee.bf))),se?t.fragment.code.add((0,re.H)(D||(D=(0,G.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),re.H.float(ee.bf))):t.fragment.code.add((0,re.H)(M||(M=(0,G.Z)(["float stippleAlpha = getStippleAlpha();"])))),t.fragment.code.add((0,re.H)(H||(H=(0,G.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);\nvec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&t.fragment.code.add((0,re.H)(N||(N=(0,G.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"])))),t.fragment.code.add((0,re.H)(Z||(Z=(0,G.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&t.fragment.code.add((0,re.H)(L||(L=(0,G.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"]))))),t.fragment.code.add((0,re.H)(F||(F=(0,G.Z)(["\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),re.H.float(ee.bf),e.output===W.H.Alpha?(0,re.H)(k||(k=(0,G.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",e.output===W.H.Color?(0,re.H)(U||(U=(0,G.Z)(["gl_FragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===W.H.Color&&e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":"",e.output===W.H.Highlight?(0,re.H)(z||(z=(0,G.Z)(["gl_FragColor = vec4(1.0);"]))):"",e.output===W.H.Depth?(0,re.H)(V||(V=(0,G.Z)(["outputDepth(linearDepth);"]))):"")),t}!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(j||(j={}));var se=Object.freeze({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:ae,get CapType(){return j},build:oe})},61863:function(e,t,r){r.d(t,{T:function(){return u},b:function(){return l}});var n,i=r(30168),a=r(74321),o=r(98634),s=r(64201);function l(){var e=new s.kG;return e.include(a.k),e.fragment.uniforms.add("tex","sampler2D"),e.fragment.uniforms.add("uColor","vec4"),e.fragment.code.add((0,o.H)(n||(n=(0,i.Z)(["void main() {\nvec4 texColor = texture2D(tex, uv);\ngl_FragColor = texColor * uColor;\n}"])))),e}var u=Object.freeze({__proto__:null,build:l})},49810:function(e,t,r){r.d(t,{W:function(){return H},b:function(){return M}});var n,i,a,o,s,l,u,c,d,h,f=r(30168),p=r(22357),v=r(71011),m=r(33280),g=r(94951),y=r(137),_=r(21002),T=r(60750),x=r(53685),b=r(15226),O=r(8555),S=r(41481),C=r(23235),E=r(68618),A=r(79246),R=r(10763),w=r(116),P=r(98634),I=r(64201),D=r(4760);function M(e){var t=new I.kG;return t.include(g.w,{linearDepth:!1}),t.attributes.add(D.T.POSITION,"vec3"),t.attributes.add(D.T.UV0,"vec2"),t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3"),t.vertex.uniforms.add("waterColor","vec4"),e.output!==v.H.Color&&e.output!==v.H.Alpha||(t.include(O.n,e),t.include(p.q,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),t.fragment.uniforms.add("localOrigin","vec3"),e.multipassTerrainEnabled&&t.varyings.add("depth","float"),t.vertex.code.add((0,P.H)(n||(n=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),P.H.float(R.bf),e.multipassTerrainEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===v.H.Color?"forwardLinearDepth();":""))),e.multipassTerrainEnabled&&(t.fragment.include(_.S),t.include(b.l,e)),e.output===v.H.Alpha&&(t.include(m.p2,e),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add((0,P.H)(i||(i=(0,f.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          gl_FragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":""))),e.output===v.H.Color&&(t.include(x.v),t.include(T._,{pbrMode:S.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(A.M,e),t.include(m.p2,e),e.receiveShadows&&t.include(C.hX,e),t.include(E.B,e),t.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("lightingSpecularStrength","float").add("lightingEnvironmentStrength","float").add("cameraPosition","vec3").add("timeElapsed","float").add("view","mat4"),t.fragment.include(w.Y),t.fragment.code.add((0,P.H)(a||(a=(0,f.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - cameraPosition);\n        float shadow = ",";\n        vec4 vPosView = view*vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);\n\n        // gamma correction\n        gl_FragColor = delinearizeGamma(final);\n        gl_FragColor = highlightSlice(gl_FragColor, vpos);\n        ","\n      }\n    "])),e.multipassTerrainEnabled?"terrainDepthTest(gl_FragCoord, depth);":"",e.receiveShadows?(0,P.H)(o||(o=(0,f.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.oitEnabled?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),e.output===v.H.Normal&&(t.include(O.n,e),t.include(A.M,e),t.include(m.p2,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),t.vertex.code.add((0,P.H)(s||(s=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),P.H.float(R.bf))),t.fragment.uniforms.add("timeElapsed","float"),t.fragment.code.add((0,P.H)(l||(l=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\ngl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))))),e.output===v.H.Draped&&(t.varyings.add("vpos","vec3"),t.vertex.code.add((0,P.H)(u||(u=(0,f.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),P.H.float(R.bf))),t.fragment.uniforms.add("waterColor","vec4"),t.fragment.code.add((0,P.H)(c||(c=(0,f.Z)(["void main() {\ngl_FragColor = waterColor;\n}"]))))),e.output===v.H.Highlight&&(t.include(y.bA),t.varyings.add("vpos","vec3"),t.vertex.code.add((0,P.H)(d||(d=(0,f.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),P.H.float(R.bf))),t.include(m.p2,e),t.fragment.code.add((0,P.H)(h||(h=(0,f.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))))),t}var H=Object.freeze({__proto__:null,build:M})},82218:function(e,t,r){r.d(t,{a:function(){return b},c:function(){return x},g:function(){return M},h:function(){return E},u:function(){return S}});var n=r(37762),i=r(43144),a=r(15671),o=(r(93169),r(32718)),s=r(16889),l=r(21530),u=r(14226),c=r(81949),d=r(11186),h=r(71353),f=r(14320),p=r(85981),v=r(55652),m=r(40885),g=r(40927),y=r(11185),_=o.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),T=(0,i.Z)((function e(){(0,a.Z)(this,e),this.plane=(0,v.Ue)(),this.origin=(0,h.c)(),this.basis1=(0,h.c)(),this.basis2=(0,h.c)()}));function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return{plane:(0,v.Ue)(e.plane),origin:(0,h.a)(e.origin),basis1:(0,h.a)(e.basis1),basis2:(0,h.a)(e.basis2)}}function b(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x();return O(e.origin,e.basis1,e.basis2,t)}function O(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:x();return(0,d.g)(n.origin,e),(0,d.g)(n.basis1,t),(0,d.g)(n.basis2,r),S(n),k(n,"fromValues()"),n}function S(e){(0,v.my)(e.basis2,e.basis1,e.origin,e.plane)}function C(e,t,r){e!==r&&b(e,r);var n=(0,d.a)(y.WM.get(),N(e),t);return(0,d.b)(r.origin,r.origin,n),r.plane[3]-=t,r}function E(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x(),r=(e[2]-e[0])/2,n=(e[3]-e[1])/2;return(0,d.s)(t.origin,e[0]+r,e[1]+n,0),(0,d.s)(t.basis1,r,0,0),(0,d.s)(t.basis2,0,n,0),(0,v.al)(0,0,1,0,t.plane),t}function A(e,t,r){return!!(0,v.BR)(e.plane,t,r)&&Z(e,r)}function R(e,t,r){var i=V.get();U(e,t,i,V.get());var a,o=Number.POSITIVE_INFINITY,l=(0,n.Z)(W);try{for(l.s();!(a=l.n()).done;){var u=F(e,a.value,j.get()),c=y.WM.get();if((0,v.rx)(i,u,c)){var h=(0,d.r)(y.WM.get(),t.origin,c),f=Math.abs((0,s.ZF)((0,d.d)(t.direction,h)));f<o&&(o=f,(0,d.g)(r,c))}}}catch(p){l.e(p)}finally{l.f()}return o===Number.POSITIVE_INFINITY?w(e,t,r):r}function w(e,t,r){if(A(e,t,r))return r;var i=V.get(),a=V.get();U(e,t,i,a);var o,s=Number.POSITIVE_INFINITY,l=(0,n.Z)(W);try{for(l.s();!(o=l.n()).done;){var u=F(e,o.value,j.get()),c=y.WM.get();if((0,v.dZ)(i,u,c)){var h=(0,m.Jk)(t,c);if(!(0,v.Ac)(a,c))continue;h<s&&(s=h,(0,d.g)(r,c))}}}catch(f){l.e(f)}finally{l.f()}return D(e,t.origin)<s&&P(e,t.origin,r),r}function P(e,t,r){var n=(0,v.nF)(e.plane,t,y.WM.get()),i=(0,p.ct)(L(e,e.basis1),n,-1,1,y.WM.get()),a=(0,p.ct)(L(e,e.basis2),n,-1,1,y.WM.get());return(0,d.f)(r,(0,d.b)(y.WM.get(),i,a),e.origin),r}function I(e,t,r){var n=e.origin,i=e.basis1,a=e.basis2,o=(0,d.f)(y.WM.get(),t,n),s=(0,g.SR)(i,o),l=(0,g.SR)(a,o),u=(0,g.SR)(N(e),o);return(0,d.s)(r,s,l,u)}function D(e,t){var r=I(e,t,y.WM.get()),n=e.basis1,i=e.basis2,a=(0,d.l)(n),o=(0,d.l)(i),s=Math.max(Math.abs(r[0])-a,0),l=Math.max(Math.abs(r[1])-o,0),u=r[2];return s*s+l*l+u*u}function M(e,t){return Math.sqrt(D(e,t))}function H(e,t){var r=-e.plane[3];return(0,g.SR)(N(e),t)-r}function N(e){return(0,v.mJ)(e.plane)}function Z(e,t){var r=(0,d.f)(y.WM.get(),t,e.origin),n=(0,d.p)(e.basis1),i=(0,d.p)(e.basis2),a=(0,d.d)(e.basis1,r),o=(0,d.d)(e.basis2,r);return-a-n<0&&a-n<0&&-o-i<0&&o-i<0}function L(e,t){var r=j.get();return(0,d.g)(r.origin,e.origin),(0,d.g)(r.vector,t),r}function F(e,t,r){var n=e.basis1,i=e.basis2,a=e.origin,o=(0,d.a)(y.WM.get(),n,t.origin[0]),s=(0,d.a)(y.WM.get(),i,t.origin[1]);(0,d.b)(r.origin,o,s),(0,d.b)(r.origin,r.origin,a);var l=(0,d.a)(y.WM.get(),n,t.direction[0]),u=(0,d.a)(y.WM.get(),i,t.direction[1]);return(0,d.a)(r.vector,(0,d.b)(l,l,u),2),r}function k(e,t){Math.abs((0,d.d)(e.basis1,e.basis2)/((0,d.l)(e.basis1)*(0,d.l)(e.basis2)))>1e-6&&_.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,d.d)(e.basis1,N(e)))>1e-6&&_.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,d.d)(N(e),e.origin)-e.plane[3])>1e-6&&_.warn(t,"Plane offset is not consistent with plane origin")}function U(e,t,r,n){var i=N(e);(0,v.my)(i,t.direction,t.origin,r),(0,v.my)((0,v.mJ)(r),i,t.origin,n)}var z={plane:(0,v.Ue)(),origin:(0,h.f)(0,0,0),basis1:(0,h.f)(1,0,0),basis2:(0,h.f)(0,1,0)},V=new l.x(v.Ue),j=new l.x(p.Ue),G=(0,h.c)(),B=new l.x((function(){return{origin:null,basis1:null,basis2:null,plane:null}})),W=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],q=(0,c.c)(),J=(0,c.c)();Object.freeze({__proto__:null,BoundedPlaneClass:T,create:x,wrap:function(e,t,r){var n=B.get();return n.origin=e,n.basis1=t,n.basis2=r,n.plane=(0,v.re)(0,0,0,0),S(n),n},copy:b,copyWithoutVerify:function(e,t){(0,d.g)(t.origin,e.origin),(0,d.g)(t.basis1,e.basis1),(0,d.g)(t.basis2,e.basis2),(0,v.JG)(t.plane,e.plane)},fromValues:O,updateUnboundedPlane:S,elevate:C,setExtent:function(e,t,r){return E(t,r),C(r,H(e,e.origin),r),r},fromAABoundingRect:E,intersectRay:A,intersectRayClosestSilhouette:function(e,t,r){if(A(e,t,r))return r;var n=R(e,t,y.WM.get());return(0,d.b)(r,t.origin,(0,d.a)(y.WM.get(),t.direction,(0,d.i)(t.origin,n)/(0,d.l)(t.direction))),r},closestPointOnSilhouette:R,closestPoint:w,projectPoint:P,projectPointLocal:I,distance2:D,distance:M,distanceToSilhouette:function(e,t){var r,i=Number.NEGATIVE_INFINITY,a=(0,n.Z)(W);try{for(a.s();!(r=a.n()).done;){var o=F(e,r.value,j.get()),s=(0,p.Jk)(o,t);s>i&&(i=s)}}catch(l){a.e(l)}finally{a.f()}return Math.sqrt(i)},extrusionContainsPoint:function(e,t){return(0,v.Ac)(e.plane,t)&&Z(e,t)},axisAt:function(e,t,r,n){return function(e,t,r){switch(t){case f.R.X:(0,d.g)(r,e.basis1),(0,d.n)(r,r);break;case f.R.Y:(0,d.g)(r,e.basis2),(0,d.n)(r,r);break;case f.R.Z:(0,d.g)(r,N(e))}return r}(e,r,n)},altitudeAt:H,setAltitudeAt:function(e,t,r,n){var i=H(e,t),a=(0,d.a)(G,N(e),r-i);return(0,d.b)(n,t,a),n},equals:function(e,t){return(0,d.k)(e.basis1,t.basis1)&&(0,d.k)(e.basis2,t.basis2)&&(0,d.k)(e.origin,t.origin)},transform:function(e,t,r){return e!==r&&b(e,r),(0,u.a)(q,t),(0,u.t)(q,q),(0,d.m)(r.basis1,e.basis1,q),(0,d.m)(r.basis2,e.basis2,q),(0,d.m)((0,v.mJ)(r.plane),(0,v.mJ)(e.plane),q),(0,d.m)(r.origin,e.origin,t),(0,v.T5)(r.plane,r.plane,r.origin),r},rotate:function(e,t,r,n){return e!==n&&b(e,n),(0,u.d)(J,t,r),(0,d.m)(n.basis1,e.basis1,J),(0,d.m)(n.basis2,e.basis2,J),S(n),n},normal:N,UP:z})},79347:function(e,t,r){r.d(t,{e:function(){return s}});var n,i,a,o={exports:{}};n=o,i=function(){function e(e,r,i){i=i||2;var a,o,s,u,c,d,h,f=r&&r.length,p=f?r[0]*i:e.length,v=t(e,0,p,i,!0),m=[];if(!v||v.next===v.prev)return m;if(f&&(v=l(e,r,v,i)),e.length>80*i){a=s=e[0],o=u=e[1];for(var g=i;g<p;g+=i)(c=e[g])<a&&(a=c),(d=e[g+1])<o&&(o=d),c>s&&(s=c),d>u&&(u=d);h=0!==(h=Math.max(s-a,u-o))?1/h:0}return n(v,m,i,a,o,h),m}function t(e,t,r,n,i){var a,o;if(i===R(e,t,r,n)>0)for(a=t;a<r;a+=n)o=C(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=C(a,e[a],e[a+1],o);if(o&&_(o,o.next)){var s=o.next;E(o),o=s}return o}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!_(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(E(n),(n=t=i)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,u,c,d,h){if(e){!h&&d&&f(e,u,c,d);for(var p,v,m=e;e.prev!==e.next;)if(p=e.prev,v=e.next,d?a(e,u,c,d):i(e))t.push(p.i/l),t.push(e.i/l),t.push(v.i/l),E(e),e=v.next,m=v.next;else if((e=v)===m){h?1===h?n(e=o(r(e),t,l),t,l,u,c,d,2):2===h&&s(e,t,l,u,c,d):n(r(e),t,l,u,c,d,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(y(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(m(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&y(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,o=e.next;if(y(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,d=p(s,l,t,r,n),h=p(u,c,t,r,n),f=e.prevZ,v=e.nextZ;f&&f.z>=d&&v&&v.z<=h;){if(f!==e.prev&&f!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,v!==e.prev&&v!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;f&&f.z>=d;){if(f!==e.prev&&f!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&m(i.x,i.y,a.x,a.y,o.x,o.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function o(e,t,n){var i=e;do{var a=i.prev,o=i.next.next;!_(a,o)&&T(a,i,i.next,o)&&O(a,o)&&O(o,a)&&(t.push(a.i/n),t.push(i.i/n),t.push(o.i/n),E(i),E(i.next),i=e=o),i=i.next}while(i!==e);return r(i)}function s(e,t,i,a,o,s){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&g(l,u)){var c=S(l,u);return l=r(l,l.next),c=r(c,c.next),n(l,t,i,a,o,s),void n(c,t,i,a,o,s)}u=u.next}l=l.next}while(l!==e)}function l(e,n,i,a){var o,s,l,c=[];for(o=0,s=n.length;o<s;o++)(l=t(e,n[o]*a,o<s-1?n[o+1]*a:e.length,a,!1))===l.next&&(l.steiner=!0),c.push(v(l));for(c.sort(u),o=0;o<c.length;o++)i=r(i=d(c[o],i),i.next);return i}function u(e,t){return e.x-t.x}function c(e){if(e.next.prev===e)return e;for(var t=e;;){var r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function d(e,t){var n=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o){if(o=s,s===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r;var l,u=r,c=r.x,d=r.y,f=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&m(a<d?i:o,a,c,d,a<d?o:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),O(n,e)&&(l<f||l===f&&(n.x>r.x||n.x===r.x&&h(r,n)))&&(r=n,f=l)),n=n.next}while(n!==u);return r}(e,t);if(!n)return t;var i=S(n,e),a=r(n,n.next),o=c(i);return r(o,o.next),a=c(a),c(t===n?a:t)}function h(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function f(e,t,r,n){var i=e;do{null===i.z&&(i.z=p(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ);t++);for(l=u;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1)}(i)}function p(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,n,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(n-s)-(r-o)*(t-s)>=0&&(r-o)*(a-s)-(i-o)*(n-s)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&T(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(O(e,t)&&O(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||_(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function T(e,t,r,n){var i=b(y(e,t,r)),a=b(y(e,t,n)),o=b(y(r,n,e)),s=b(y(r,n,t));return i!==a&&o!==s||!(0!==i||!x(e,r,t))||!(0!==a||!x(e,n,t))||!(0!==o||!x(r,e,n))||!(0!==s||!x(r,t,n))}function x(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function b(e){return e>0?1:e<0?-1:0}function O(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function S(e,t){var r=new A(e.i,e.x,e.y),n=new A(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function C(e,t,r,n){var i=new A(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function E(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function A(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,o=Math.abs(R(e,0,a,r));if(i)for(var s=0,l=t.length;s<l;s++){var u=t[s]*r,c=s<l-1?t[s+1]*r:e.length;o-=Math.abs(R(e,u,c,r))}var d=0;for(s=0;s<n.length;s+=3){var h=n[s]*r,f=n[s+1]*r,p=n[s+2]*r;d+=Math.abs((e[h]-e[p])*(e[f+1]-e[h+1])-(e[h]-e[f])*(e[p+1]-e[h+1]))}return 0===o&&0===d?0:Math.abs((d-o)/o)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},e},void 0!==(a=i())&&(n.exports=a);var s=o.exports},59447:function(e,t,r){r.d(t,{r:function(){return a}});var n=r(15671),i=r(43144),a=function(){function e(){(0,n.Z)(this,e),this._outer=new Map}return(0,i.Z)(e,[{key:"clear",value:function(){this._outer.clear()}},{key:"empty",get:function(){return 0===this._outer.size}},{key:"get",value:function(e,t){var r;return null==(r=this._outer.get(e))?void 0:r.get(t)}},{key:"set",value:function(e,t,r){var n=this._outer.get(e);n?n.set(t,r):this._outer.set(e,new Map([[t,r]]))}},{key:"delete",value:function(e,t){var r=this._outer.get(e);r&&(r.delete(t),0===r.size&&this._outer.delete(e))}},{key:"forEach",value:function(e){this._outer.forEach((function(t,r){return e(t,r)}))}}]),e}()},46228:function(e,t,r){r.d(t,{I:function(){return i},v:function(){return a}});var n=r(16889);function i(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=(0,n.uZ)(e,0,l),a=0;a<4;a++)t[r+a]=Math.floor(256*u(i*o[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,n=0;n<4;n++)r+=e[t+n]*s[n];return r}var o=[1,256,65536,16777216],s=[1/256,1/65536,1/16777216,1/4294967296],l=a(new Uint8ClampedArray([255,255,255,255]));function u(e){return e-Math.floor(e)}},70444:function(e,t,r){r.d(t,{S$:function(){return u},Ue:function(){return o},Ws:function(){return l},iL:function(){return s}});var n=r(21530),i=r(11186),a=r(40885);r(11185);function o(e){return e?{ray:(0,a.Ue)(e.ray),c0:e.c0,c1:e.c1}:{ray:(0,a.Ue)(),c0:0,c1:Number.MAX_VALUE}}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return(0,a.JG)(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function l(e,t){return c(e,e.c0,t)}function u(e,t){return c(e,e.c1,t)}function c(e,t,r){return(0,i.b)(r,e.ray.origin,(0,i.a)(r,e.ray.direction,t))}new n.x((function(){return{c0:0,c1:0,ray:null}}))},95773:function(e,t,r){r.d(t,{JG:function(){return m},Nu:function(){return n},Ue:function(){return v},hr:function(){return _},q_:function(){return g},zq:function(){return T}});var n,i,a,o=r(21530),s=r(14226),l=r(11186),u=r(71353),c=r(90045),d=r(67077),h=r(70444),f=r(55652),p=r(11185);function v(e){return e?[(0,f.Ue)(e[0]),(0,f.Ue)(e[1]),(0,f.Ue)(e[2]),(0,f.Ue)(e[3]),(0,f.Ue)(e[4]),(0,f.Ue)(e[5])]:[(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)(),(0,f.Ue)()]}function m(e,t){for(var r=0;r<x.NUM;r++)(0,f.JG)(e[r],t[r])}function g(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S,i=(0,s.m)(p.MP.get(),t,e);(0,s.a)(i,i);for(var a=0;a<b.NUM;++a){var o=(0,c.t)(p.o6.get(),O[a],i);(0,l.s)(n[a],o[0]/o[3],o[1]/o[3],o[2]/o[3])}y(r,n)}function y(e,t){(0,f.zk)(t[i.FAR_BOTTOM_LEFT],t[i.NEAR_BOTTOM_LEFT],t[i.NEAR_TOP_LEFT],e[n.LEFT]),(0,f.zk)(t[i.NEAR_BOTTOM_RIGHT],t[i.FAR_BOTTOM_RIGHT],t[i.FAR_TOP_RIGHT],e[n.RIGHT]),(0,f.zk)(t[i.FAR_BOTTOM_LEFT],t[i.FAR_BOTTOM_RIGHT],t[i.NEAR_BOTTOM_RIGHT],e[n.BOTTOM]),(0,f.zk)(t[i.NEAR_TOP_LEFT],t[i.NEAR_TOP_RIGHT],t[i.FAR_TOP_RIGHT],e[n.TOP]),(0,f.zk)(t[i.NEAR_BOTTOM_LEFT],t[i.NEAR_BOTTOM_RIGHT],t[i.NEAR_TOP_RIGHT],e[n.NEAR]),(0,f.zk)(t[i.FAR_BOTTOM_RIGHT],t[i.FAR_BOTTOM_LEFT],t[i.FAR_TOP_LEFT],e[n.FAR])}function _(e,t){for(var r=0;r<x.NUM;r++){var n=e[r];if(n[0]*t[0]+n[1]*t[1]+n[2]*t[2]+n[3]>=t[3])return!1}return!0}function T(e,t){for(var r=0;r<x.NUM;r++){var n=e[r];if(!(0,f.Er)(n,t))return!1}return!0}(a=n||(n={}))[a.LEFT=0]="LEFT",a[a.RIGHT=1]="RIGHT",a[a.BOTTOM=2]="BOTTOM",a[a.TOP=3]="TOP",a[a.NEAR=4]="NEAR",a[a.FAR=5]="FAR",function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(i||(i={}));var x,b;i.FAR_BOTTOM_RIGHT,i.NEAR_BOTTOM_RIGHT,i.NEAR_BOTTOM_LEFT,i.FAR_BOTTOM_LEFT,i.NEAR_BOTTOM_LEFT,i.NEAR_BOTTOM_RIGHT,i.NEAR_TOP_RIGHT,i.NEAR_TOP_LEFT,i.FAR_BOTTOM_RIGHT,i.FAR_BOTTOM_LEFT,i.FAR_TOP_LEFT,i.FAR_TOP_RIGHT,i.NEAR_BOTTOM_RIGHT,i.FAR_BOTTOM_RIGHT,i.FAR_TOP_RIGHT,i.NEAR_TOP_RIGHT,i.FAR_BOTTOM_LEFT,i.NEAR_BOTTOM_LEFT,i.NEAR_TOP_LEFT,i.FAR_TOP_LEFT,i.FAR_TOP_LEFT,i.NEAR_TOP_LEFT,i.NEAR_TOP_RIGHT,i.FAR_TOP_RIGHT;!function(e){e[e.NUM=6]="NUM"}(x||(x={})),function(e){e[e.NUM=8]="NUM"}(b||(b={}));var O=[(0,d.f)(-1,-1,-1,1),(0,d.f)(1,-1,-1,1),(0,d.f)(1,1,-1,1),(0,d.f)(-1,1,-1,1),(0,d.f)(-1,-1,1,1),(0,d.f)(1,-1,1,1),(0,d.f)(1,1,1,1),(0,d.f)(-1,1,1,1)],S=(new o.x(h.Ue),[(0,u.c)(),(0,u.c)(),(0,u.c)(),(0,u.c)(),(0,u.c)(),(0,u.c)(),(0,u.c)(),(0,u.c)()])},35888:function(e,t,r){r.d(t,{d:function(){return i}});var n=r(16889);function i(e,t,r){var i,u=e.byteLength/(4*t),c=new Uint32Array(e,0,u*t),d=new Uint32Array(u),h=null!=(i=null==r?void 0:r.minReduction)?i:0,f=(null==r?void 0:r.originalIndices)||null,p=f?f.length:0,v=(null==r?void 0:r.componentOffsets)||null,m=0;if(v)for(var g=0;g<v.length-1;g++){var y=v[g+1]-v[g];y>m&&(m=y)}else m=u;var _=Math.floor(1.1*m)+1;(null==l||l.length<2*_)&&(l=new Uint32Array((0,n.Sf)(2*_)));for(var T=0;T<2*_;T++)l[T]=0;for(var x=0,b=!!v&&!!f,O=b?p:u,S=b?new Uint32Array(p):null,C=1.96,E=0!==h?Math.ceil(4*C*C/(h*h)*h*(1-h)):O,A=1,R=v?v[1]:O,w=0;w<O;w++){if(w===E){var P=1-x/w;if(P+C*Math.sqrt(P*(1-P)/w)<h)return null;E*=2}if(w===R){for(var I=0;I<2*_;I++)l[I]=0;if(f)for(var D=v[A-1];D<v[A];D++)S[D]=d[f[D]];R=v[++A]}for(var M=b?f[w]:w,H=M*t,N=s(c,H,t),Z=N%_,L=x;0!==l[2*Z+1];){if(l[2*Z]===N){var F=l[2*Z+1]-1;if(a(c,H,F*t,t)){L=d[F];break}}++Z>=_&&(Z-=_)}L===x&&(l[2*Z]=N,l[2*Z+1]=M+1,x++),d[M]=L}if(0!==h&&1-x/u<h)return null;if(b){for(var k=v[A-1];k<S.length;k++)S[k]=d[f[k]];d=S}var U=new Uint32Array(t*x);x=0;for(var z=0;z<O;z++)d[z]===x&&(o(c,(b?f[z]:z)*t,U,x*t,t),x++);if(f&&!b){for(var V=new Uint32Array(p),j=0;j<V.length;j++)V[j]=d[f[j]];d=V}return{buffer:U.buffer,indices:d,uniqueCount:x}}function a(e,t,r,n){for(var i=0;i<n;i++)if(e[t+i]!==e[r+i])return!1;return!0}function o(e,t,r,n,i){for(var a=0;a<i;a++)r[n+a]=e[t+a]}function s(e,t,r){for(var n=0,i=0;i<r;i++)n=(n=e[t+i]+n|0)+(n<<11)+(n>>>2)|0;return n>>>0}var l=null},91320:function(e,t,r){r.d(t,{Mk:function(){return u},ZI:function(){return n},bT:function(){return l}});var n,i=r(37762),a=r(79347),o=r(69662),s=r(35888);function l(e){var t,r=u(e.rings,e.hasZ,n.CCW_IS_HOLE),o=[],l=0,c=0,d=(0,i.Z)(r.polygons);try{var h=function(){var e=t.value,n=e.count,i=e.index,s=new Float64Array(r.position.buffer,3*i*r.position.BYTES_PER_ELEMENT,3*n),u=e.holeIndices.map((function(e){return e-i})),d=new Uint32Array((0,a.e)(s,u,3));o.push({position:s,faces:d}),l+=s.length,c+=d.length};for(d.s();!(t=d.n()).done;)h()}catch(v){d.e(v)}finally{d.f()}var f=function(e,t,r){if(1===e.length)return e[0];var n,a=new Float64Array(t),o=new Uint32Array(r),s=0,l=0,u=0,c=(0,i.Z)(e);try{for(c.s();!(n=c.n()).done;){for(var d=n.value,h=0;h<d.position.length;h++)a[s++]=d.position[h];for(var f=0;f<d.faces.length;f++)o[l++]=d.faces[f]+u;u=s/3}}catch(v){c.e(v)}finally{c.f()}return{position:a,faces:o}}(o,l,c),p=(0,s.d)(f.position.buffer,6,{originalIndices:f.faces});return f.position=new Float64Array(p.buffer),f.faces=p.indices,f}function u(e,t,r){for(var i=e.length,a=new Array(i),o=new Array(i),s=new Array(i),l=0,u=0,h=0,f=0,p=0;p<i;++p)f+=e[p].length;for(var v=new Float64Array(3*f),m=0,g=i-1;g>=0;g--){var y=e[g],_=r===n.CCW_IS_HOLE&&d(y);if(_&&1!==i)a[l++]=y;else{for(var T=y.length,x=0;x<l;++x)T+=a[x].length;var b={index:m,pathLengths:new Array(l+1),count:T,holeIndices:new Array(l)};b.pathLengths[0]=y.length,y.length>0&&(s[h++]={index:m,count:y.length}),m=_?c(y,y.length-1,-1,v,m,y.length,t):c(y,0,1,v,m,y.length,t);for(var O=0;O<l;++O){var S=a[O];b.holeIndices[O]=m,b.pathLengths[O+1]=S.length,S.length>0&&(s[h++]={index:m,count:S.length}),m=c(S,0,1,v,m,S.length,t)}l=0,b.count>0&&(o[u++]=b)}}for(var C=0;C<l;++C){var E=a[C];E.length>0&&(s[h++]={index:m,count:E.length}),m=c(E,0,1,v,m,E.length,t)}return u<i&&(o.length=u),h<i&&(s.length=h),{position:v,polygons:o,outlines:s}}function c(e,t,r,n,i,a,o){i*=3;for(var s=0;s<a;++s){var l=e[t];n[i++]=l[0],n[i++]=l[1],n[i++]=o?l[2]:0,t+=r}return i/3}function d(e){return!(0,o.bu)(e,!1,!1)}!function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"}(n||(n={}))},70178:function(e,t,r){r.d(t,{k:function(){return n}});r(93169);function n(e,t){return!!i(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function i(e,t){return e===t||e&&t&&e.equals(t)}},81020:function(e,t,r){function n(e){return"point"===e.type}r.d(t,{f:function(){return n}})},65618:function(e,t,r){r.d(t,{FS:function(){return p},MS:function(){return m},Pj:function(){return d},R3:function(){return f},S6:function(){return c},TF:function(){return v},Tx:function(){return h},Wh:function(){return u}});var n=r(37762),i=r(43144),a=r(15671),o=(r(59896),r(93169),r(92026)),s=(r(78952),r(41414)),l=r(65156),u=(r(58971),r(27823),r(83040),r(70178),(0,i.Z)((function e(t,r,n){(0,a.Z)(this,e),this.uid=t,this.geometry=r,this.attributes=n,this.visible=!0,this.objectId=null,this.centroid=null})));function c(e){return(0,o.pC)(e.geometry)}var d=(0,i.Z)((function e(){(0,a.Z)(this,e),this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}));function h(e,t,r,n){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:n,type:"point"}}function f(e){if((0,o.Wi)(e))return 0;switch(e.type){case"point":return 1;case"polyline":var t,r=0,i=(0,n.Z)(e.paths);try{for(i.s();!(t=i.n()).done;){r+=t.value.length}}catch(c){i.e(c)}finally{i.f()}return r;case"polygon":var a,s=0,l=(0,n.Z)(e.rings);try{for(l.s();!(a=l.n()).done;){s+=a.value.length}}catch(c){l.e(c)}finally{l.f()}return s;case"multipoint":return e.points.length;case"extent":return 2;case"mesh":var u=e.vertexAttributes&&e.vertexAttributes.position;return u?u.length/3:0;default:return}}function p(e,t){switch((0,s.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(var r=0;r<e.paths.length;r++)(0,s.Wi)(t,e.paths[r],e.hasZ);break;case"polygon":for(var n=0;n<e.rings.length;n++)(0,s.Wi)(t,e.rings[n],e.hasZ);break;case"multipoint":(0,s.Wi)(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}}function v(e,t){switch((0,l.cS)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(var r=0;r<e.paths.length;r++)(0,l.Wi)(t,e.paths[r]);break;case"polygon":for(var n=0;n<e.rings.length;n++)(0,l.Wi)(t,e.rings[n]);break;case"multipoint":(0,l.Wi)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function m(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}(0,s.Ue)(),(0,l.Ue)()},37818:function(e,t,r){r.d(t,{Ou:function(){return c},WG:function(){return g},kB:function(){return f},mW:function(){return h}});var n=r(37762),i=r(52639),a=(r(93169),r(84652)),o=r(92026),s=r(18722),l=r(77981),u=r(65618);function c(e){return"declaredClass"in e}function d(e){return"declaredClass"in e}function h(e,t){if(!e)return null;if(function(e){return"declaredClass"in e}(e))return e;var r=new i.Z({layer:t,sourceLayer:t});return r.visible=e.visible,r.symbol=(0,a.d9)(e.symbol),r.attributes=(0,a.d9)(e.attributes),r.geometry=f(e.geometry),r}function f(e){return(0,o.Wi)(e)?null:c(e)?e:(0,l.im)(function(e){var t=e.spatialReference.toJSON();switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m,spatialReference:t};case"polygon":var r=e.rings,n=e.hasZ,i=e.hasM;return{rings:p(r),hasZ:n,hasM:i,spatialReference:t};case"polyline":var a=e.paths,o=e.hasZ,s=e.hasM;return{paths:p(a),hasZ:o,hasM:s,spatialReference:t};case"extent":return{xmin:e.xmin,xmax:e.xmax,ymin:e.ymin,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax,hasZ:e.hasZ,hasM:e.hasM,spatialReference:t};case"multipoint":var l=e.points,u=e.hasZ,c=e.hasM;return{points:m(l)?v(l):l,hasZ:u,hasM:c,spatialReference:t};default:return}}(e))}function p(e){return function(e){var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(0!==i.length)return m(i)}}catch(a){r.e(a)}finally{r.f()}return!1}(e)?e.map((function(e){return v(e)})):e}function v(e){return e.map((function(e){return(0,s.qo)(e)}))}function m(e){return e.length&&((0,s.xZ)(e[0])||(0,s.fS)(e[0]))}function g(e,t){if(!e)return null;var r;if(d(e)){if(null==t)return e.clone();if(d(t))return t.copy(e)}return null!=t?((r=t).x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=null,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=null,r.hasM=!1)):(r=(0,u.Tx)(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r}},27811:function(e,t,r){r.d(t,{QM:function(){return o},cR:function(){return l},hy:function(){return s},uI:function(){return a}});var n=r(37762),i=r(16889),a=function(){if(!("document"in globalThis))return function(){return null};var e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,function(r){t.clearRect(0,0,1,e.height);var i,a=t.createLinearGradient(0,0,0,e.height),o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.ratio,u=s.color;a.addColorStop(Math.max(l,.001),"rgba(".concat(u.r,", ").concat(u.g,", ").concat(u.b,", ").concat(u.a,")"))}}catch(c){o.e(c)}finally{o.f()}return t.fillStyle=a,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}}();function o(e,t,r,i){var a,o,s=t.blurRadius,u=t.fieldOffset,c=t.field,d=new Float64Array(r*i),h=l(s),f=Math.round(3*s),p=Number.NEGATIVE_INFINITY,v=function(e,t){return null!=e?"string"==typeof t?function(t){return-1*+t.readAttribute(e)}:function(r){return+r.readAttribute(e)+t}:function(e){return 1}}(c,u),m=new Set,g=(0,n.Z)(e);try{for(g.s();!(o=g.n()).done;)for(var y=o.value.getCursor();y.next();){var _=y.getObjectId();if(!m.has(_)){m.add(_);var T=y.readLegacyPointGeometry(),x=128;if(!(T.x<-128||T.x>=r+x||T.y<-128||T.y>i+x))for(var b=+v(y),O=Math.round(T.x)-f,S=Math.round(T.y)-f,C=Math.max(0,O),E=Math.max(0,S),A=Math.min(i,Math.round(T.y)+f),R=Math.min(r,Math.round(T.x)+f),w=E;w<A;w++)for(var P=h[w-S],I=C;I<R;I++){var D=h[I-O];(a=d[w*r+I]+=P*D*b)>p&&(p=a)}}}}catch(M){g.e(M)}finally{g.f()}return{matrix:d.buffer,max:p}}function s(e,t,r,n,a,o){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);var s=e.getImageData(0,0,t,t);r&&n&&s.data.set(new Uint8ClampedArray(function(e,t,r,n,a){for(var o=new Uint32Array(e*e),s=("buffer"in t?t:new Float64Array(t)),l=("buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer)),u=l.length/(a-n),c=0;c<s.length;c++){var d=s[c],h=Math.floor((d-n)*u);o[c]=l[(0,i.uZ)(h,0,l.length-1)]}return o.buffer}(t,r,n,a,o))),e.putImageData(s,0,0)}function l(e){for(var t=Math.round(3*e),r=2*e*e,n=new Float64Array(2*t+1),i=0;i<=n.length;i++)n[i]=Math.exp(-Math.pow(i-t,2)/r)/Math.sqrt(2*Math.PI)*(e/2);return n}},78935:function(e,t,r){r.d(t,{o:function(){return l}});var n=r(15671),i=r(43144),a=r(92026),o=r(88152),s=r(8821),l=function(){function e(){(0,n.Z)(this,e),this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}return(0,i.Z)(e,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e,this._metersPerElevationInfoUnit=(0,o.Z7)(e)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"reset",value:function(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e,this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}},{key:"addOffsetRenderUnits",value:function(e){this._renderUnitOffset+=e}},{key:"geometryZWithOffset",value:function(e,t){var r=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?r:e+r}},{key:"calculateOffsetRenderUnits",value:function(e){var t=this._meterUnitOffset,r=this.featureExpressionInfoContext;return null!=r&&(t+=(0,s.ht)(r)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}},{key:"setFromElevationInfo",value:function(e){this.mode=e.mode,this.unit=(0,o.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=(0,a.Pt)(e.offset,0)}},{key:"updateFeatureExpressionInfoContext",value:function(e,t,r){if((0,a.Wi)(e))this._featureExpressionInfoContext=null;else{var n=e&&e.arcade;n&&(0,a.pC)(t)&&(0,a.pC)(r)?(this._featureExpressionInfoContext=(0,s.d9)(e),(0,s.aO)(this._featureExpressionInfoContext,(0,s.Tz)(n.modules,t,r))):this._featureExpressionInfoContext=e}}}],[{key:"fromElevationInfo",value:function(t){var r=new e;return(0,a.pC)(t)&&r.setFromElevationInfo(t),r}}]),e}()},61310:function(e,t,r){r.d(t,{ZF:function(){return i},a1:function(){return o},rD:function(){return a}});var n=r(67077),i=1.2,a=n.Z,o=n.O},69691:function(e,t,r){r.d(t,{B5:function(){return _},GC:function(){return g},Lm:function(){return b},Xf:function(){return y},bD:function(){return T},lO:function(){return x},qZ:function(){return v},rR:function(){return p},w7:function(){return m}});var n=r(43144),i=r(15671),a=r(41644),o=r(92026),s=r(14226),l=r(81949),u=r(71353),c=r(79803),d=r(81020),h=r(96387),f=r(77648);function p(e,t,r,n,i,a,o,s,l,u,d){var h,f,p=O[d.mode],v=0;if((0,c.CM)(e,t,r,n,l.spatialReference,i,s))return p.requiresAlignment(d)?(v=p.applyElevationAlignmentBuffer(n,i,a,o,s,l,u,d),h=a,f=o):(h=n,f=i),(0,c.CM)(h,l.spatialReference,f,a,u.spatialReference,o,s)?v:void 0}function v(e,t,r,n,i){var s=((0,d.f)(e)?e.z:(0,f.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(r.mode){case"on-the-ground":var l=(0,o.Pt)((0,f.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=0,i.sampledElevation=l,void(i.z=l);case"relative-to-ground":var u=(0,o.Pt)((0,f.KO)(t,e,"ground"),0),c=r.geometryZWithOffset(s,n);return i.verticalDistanceToGround=c,i.sampledElevation=u,void(i.z=c+u);case"relative-to-scene":var h=(0,o.Pt)((0,f.KO)(t,e,"scene"),0),p=r.geometryZWithOffset(s,n);return i.verticalDistanceToGround=p,i.sampledElevation=h,void(i.z=p+h);case"absolute-height":var v=r.geometryZWithOffset(s,n),m=(0,o.Pt)((0,f.KO)(t,e,"ground"),0);return i.verticalDistanceToGround=v-m,i.sampledElevation=m,void(i.z=v);default:return(0,a.Bg)(r.mode),void(i.z=0)}}function m(e,t,r,n){return v(e,t,r,n,C),C.z}function g(e,t,r){return null==t||null==r?e.definedChanged:"on-the-ground"===t&&"on-the-ground"===r?e.staysOnTheGround:t===r||"on-the-ground"!==t&&"on-the-ground"!==r?x.UPDATE:e.onTheGroundChanged}function y(e){return"relative-to-ground"===e||"relative-to-scene"===e}function _(e){return"absolute-height"!==e}function T(e,t,r,n,i){v(t,r,i,n,C),(0,h.CV)(e,C.verticalDistanceToGround);var a=C.sampledElevation,o=(0,s.c)(S,e.transformation);return E[0]=t.x,E[1]=t.y,E[2]=C.z,(0,c.Bm)(t.spatialReference,E,o,n.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),a}var x,b=(0,n.Z)((function e(){(0,i.Z)(this,e),this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}));!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(x||(x={}));var O={"absolute-height":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a,o,s){var l=s.calculateOffsetRenderUnits(o),u=s.featureExpressionInfoContext;t*=3,n*=3;for(var c=0;c<i;++c){var d=e[t+0],h=e[t+1],f=e[t+2];r[n+0]=d,r[n+1]=h,r[n+2]=null==u?f+l:l,t+=3,n+=3}return 0},requiresAlignment:function(e){var t=e.meterUnitOffset,r=e.featureExpressionInfoContext;return 0!==t||null!=r}},"on-the-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a){var s=0,l=a.spatialReference;t*=3,n*=3;for(var u=0;u<i;++u){var c=e[t+0],d=e[t+1],h=e[t+2],f=(0,o.Pt)(a.getElevation(c,d,h,l,"ground"),0);s+=f,r[n+0]=c,r[n+1]=d,r[n+2]=f,t+=3,n+=3}return s/i},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a,s,l){var u=0,c=l.calculateOffsetRenderUnits(s),d=l.featureExpressionInfoContext,h=a.spatialReference;t*=3,n*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],m=e[t+2],g=(0,o.Pt)(a.getElevation(p,v,m,h,"ground"),0);u+=g,r[n+0]=p,r[n+1]=v,r[n+2]=null==d?m+g+c:g+c,t+=3,n+=3}return u/i},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(e,t,r,n,i,a,s,l){var u=0,c=l.calculateOffsetRenderUnits(s),d=l.featureExpressionInfoContext,h=a.spatialReference;t*=3,n*=3;for(var f=0;f<i;++f){var p=e[t+0],v=e[t+1],m=e[t+2],g=(0,o.Pt)(a.getElevation(p,v,m,h,"scene"),0);u+=g,r[n+0]=p,r[n+1]=v,r[n+2]=null==d?m+g+c:g+c,t+=3,n+=3}return u/i},requiresAlignment:function(){return!0}}},S=(0,l.c)(),C=new b,E=(0,u.c)()},8821:function(e,t,r){r.d(t,{O$:function(){return m},Tz:function(){return h},WI:function(){return v},aO:function(){return f},d9:function(){return u},ht:function(){return p},kr:function(){return c}});var n=r(74165),i=r(15861),a=r(32718),o=r(37818),s=r(819),l=a.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function u(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function c(e,t,r){return d.apply(this,arguments)}function d(){return d=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var a,o,l,u,c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof(a=t&&t.expression)){e.next=3;break}return e.abrupt("return",null);case 3:if(null==(o=y(a))){e.next=6;break}return e.abrupt("return",{cachedResult:o});case 6:return e.next=8,(0,s.LC)();case 8:return l=e.sent,u=l.arcadeUtils,c=u.createSyntaxTree(a),e.abrupt("return",u.dependsOnView(c)?(null!=i&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:u.createFunction(c),context:u.createExecContext(null,{sr:r}),modules:l}});case 12:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function h(e,t,r){return e.arcadeUtils.createFeature(t.attributes,t.geometry,r)}function f(e,t){if(null!=e&&!g(e)){if(!t||!e.arcade)return void l.errorOncePerTick("Arcade support required but not provided");var r=t;r._geometry&&(r._geometry=(0,o.kB)(r._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function p(e){if(null!=e){if(g(e))return e.cachedResult;var t=e.arcade,r=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof r&&(e.cachedResult=0,r=0),r}return 0}function v(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e&&e.featureExpressionInfo,n=r&&r.expression;return t||"0"===n||(r=null),r}var m={cachedResult:0};function g(e){return null!=e.cachedResult}function y(e){return"0"===e?0:null}},96387:function(e,t,r){r.d(t,{CV:function(){return b},Go:function(){return x},Si:function(){return R},Uu:function(){return O},ZL:function(){return E},_Z:function(){return A},bD:function(){return S},bh:function(){return C},zE:function(){return y}});var n=r(37762),i=r(92026),a=r(14226),o=r(81949),s=r(71353),l=r(90045),u=r(67077),c=r(79803),d=r(41414),h=r(65156),f=r(4954),p=r(69662),v=r(65618),m=r(37818),g=r(4760);function y(e,t){if("point"===e.type)return T(e,t,!1);if((0,m.Ou)(e))switch(e.type){case"extent":return T(e.center,t,!1);case"polygon":return T(e.centroid,t,!1);case"polyline":return T(_(e),t,!0);case"mesh":return T(e.origin,t,!1)}else switch(e.type){case"extent":return T(function(e){var t=isFinite(e.zmin);return(0,v.Tx)(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return T(function(e){var t=e.rings[0];if(!t||0===t.length)return null;var r=(0,f.a)(e.rings,e.hasZ);return(0,v.Tx)(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return T(_(e),t,!0)}}function _(e){var t=e.paths[0];if(!t||0===t.length)return null;var r=(0,p.n8)(t,(0,p.ok)(t)/2);return(0,v.Tx)(r[0],r[1],r[2],e.spatialReference)}function T(e,t,r){var n=r?e:(0,m.WG)(e);return t&&e?(0,c.nF)(e,n,t)?n:null:n}function x(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e){t||(t=(0,h.Ue)());var i=e,a=.5*i.width*(r-1),o=.5*i.height*(r-1);return i.width<1e-7*i.height?a+=o/20:i.height<1e-7*i.width&&(o+=a/20),(0,l.s)(t,i.xmin-a-n,i.ymin-o-n,i.xmax+a+n,i.ymax+o+n),t}return null}function b(e,t){for(var r=0;r<e.geometries.length;++r){var n=e.geometries[r].getMutableAttribute(g.T.AUXPOS1);n&&n.data[3]!==t&&(n.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[r]))}}function O(e,t){var r=(0,u.b)(u.O);return(0,i.pC)(e)&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),(0,i.pC)(t)?r[3]=t:(0,i.pC)(e)&&e.length>3&&(r[3]=e[3]),r}function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.O,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new Array(3);if((0,i.Wi)(t)||(0,i.Wi)(r))a[0]=1,a[1]=1,a[2]=1;else{for(var o,l=0,u=2;u>=0;u--){var c=e[u],d=void 0,h=null!=c,f=0===u&&!o&&!h,p=r[u];"symbol-value"===c||f?d=0!==p?t[u]/p:1:h&&"proportional"!==c&&isFinite(c)&&(d=0!==p?c/p:1),null!=d&&(a[u]=d,o=d,l=Math.max(l,Math.abs(d)))}for(var v=2;v>=0;v--)null==a[v]?a[v]=o:0===a[v]&&(a[v]=.001*l)}for(var m=2;m>=0;m--)a[m]/=n;return(0,s.d)(a)}function C(e){return function(e){return null!=e.isPrimitive}(e)&&(e=[e.width,e.depth,e.height]),E(e)?null:"Symbol sizes may not be negative values"}function E(e){if(Array.isArray(e)){var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){if(!E(t.value))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}return null==e||e>=0}function A(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,o.c)(),i=e||0,s=t||0,l=r||0;return 0!==i&&(0,a.g)(n,n,-i/180*Math.PI),0!==s&&(0,a.r)(n,n,s/180*Math.PI),0!==l&&(0,a.o)(n,n,l/180*Math.PI),n}function R(e,t){return null!=t.minDemResolution?t.minDemResolution:(0,d.wp)(e)?t.minDemResolutionForPoints:.01*(0,d.aO)(e)}},75558:function(e,t,r){r.d(t,{NW:function(){return n},VP:function(){return b},YU:function(){return x},rm:function(){return S},u9:function(){return A}});var n,i=r(37762),a=(r(93169),r(92026)),o=r(18722),s=r(88396),l=r(11186),u=r(71353),c=r(79803),d=r(92183),h=r(91320),f=r(50951),p=r(61310),v=r(69691),m=r(38967),g=r(68401),y=r(74894),_=r(4760),T=r(98186);function x(e){var t=[],r=[];!function(e,t,r){for(var i=e.attributeData.position,a=e.removeDuplicateStartEnd,s=function(e){var t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(i)&&a===n.REMOVE,l=i.length/3-(s?1:0),u=new Uint32Array(2*(l-1)),c=s?(0,o.tP)(i,0,i.length-3):i,d=0,h=0;h<l-1;h++)u[d++]=h,u[d++]=h+1;t.push([_.T.POSITION,{size:3,data:c,exclusive:s}]),r.push([_.T.POSITION,u])}(e,r,t);var i=r[0][1].data,u=t[0][1].length,h=new Uint16Array(u);return function(e,t,r){var n=e.attributeData.mapPosition;(0,a.Wi)(n)||(r.push([_.T.MAPPOS,r[0][1]]),t.push([_.T.MAPPOS,{size:3,data:n}]))}(e,r,t),function(e,t,r,n){if((0,a.pC)(e.attributeData.colorFeature))return;var i=e.attributeData.color;t.push([_.T.COLOR,{size:4,data:(0,a.Pt)(i,p.a1)}]),r.push([_.T.COLOR,n])}(e,r,t,h),function(e,t,r,n){if((0,a.pC)(e.attributeData.sizeFeature))return;var i=e.attributeData.size;t.push([_.T.SIZE,{size:1,data:[(0,a.Pt)(i,1)]}]),r.push([_.T.SIZE,n])}(e,r,t,h),function(e,t,r,n){var i=e.attributeData.colorFeature;(0,a.Wi)(i)||(t.push([_.T.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),r.push([_.T.COLOR,n]))}(e,r,t,h),function(e,t,r,n){var i=e.attributeData.sizeFeature;(0,a.Wi)(i)||(t.push([_.T.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),r.push([_.T.SIZEFEATUREATTRIBUTE,n]))}(e,r,t,h),function(e,t,r,n){var i=e.attributeData.opacityFeature;(0,a.Wi)(i)||(t.push([_.T.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([i])}]),r.push([_.T.OPACITYFEATUREATTRIBUTE,n]))}(e,r,t,h),function(e,t,r,n){if((0,a.Wi)(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==f.JY.Global||!e.overlayInfo.spatialReference.isGeographic)return;for(var i=new Float64Array(n.length),o=(0,d.Iu)(e.overlayInfo.spatialReference),u=0;u<i.length;u+=3)(0,c.gH)(n,u,i,u,o);var h=n.length/3,p=new Float32Array(h+1),v=C,m=E,g=0,y=0;(0,l.s)(v,i[y++],i[y++],i[y++]),p[0]=0;for(var T=1;T<h+1;++T){var x;T===h&&(y=0),(0,l.s)(m,i[y++],i[y++],i[y++]),g+=(0,s.d)(v,m),p[T]=g,v=(x=[m,v])[0],m=x[1]}t.push([_.T.DISTANCETOSTART,{size:1,data:p}]),r.push([_.T.DISTANCETOSTART,r[0][1]])}(e,r,t,i),new y.Z(r,t,g.MX.Line)}function b(e,t,r,n){var i="polygon"===e.type?h.ZI.CCW_IS_HOLE:h.ZI.NONE,a="polygon"===e.type?e.rings:e.paths,o=(0,h.Mk)(a,e.hasZ,i),s=o.position,l=o.outlines,u=new Float64Array(s.length),c=(0,v.rR)(s,e.spatialReference,0,u,0,s,0,s.length/3,t,r,n),d=null!=c;return{lines:d?O(l,s,u):[],projectionSuccess:d,sampledElevation:c}}function O(e,t,r){var n,a=new Array,o=(0,i.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,l=s.index,u=s.count;if(!(u<=1)){var c=3*l,d=c+3*u;a.push({position:t.subarray(c,d),mapPosition:r?r.subarray(c,d):void 0})}}}catch(h){o.e(h)}finally{o.f()}return a}function S(e,t){for(var r="polygon"===e.type?h.ZI.CCW_IS_HOLE:h.ZI.NONE,n="polygon"===e.type?e.rings:e.paths,i=(0,h.Mk)(n,!1,r),a=i.position,o=i.outlines,s=(0,c.CM)(a,e.spatialReference,0,a,t,0,a.length/3),l=2;l<a.length;l+=3)a[l]=m.Rn;return{lines:s?O(o,a):[],projectionSuccess:s}}!function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"}(n||(n={}));var C=(0,u.c)(),E=(0,u.c)();function A(e){switch(e){case"butt":return T.C.BUTT;case"square":return T.C.SQUARE;case"round":return T.C.ROUND;default:return null}}},36759:function(e,t,r){r.d(t,{S_:function(){return m},VP:function(){return g},dO:function(){return v},km:function(){return p}});var n=r(92026),i=r(81949),a=r(71353),o=r(79803),s=r(41414),l=r(69662),u=r(65618),c=r(69691),d=r(96387),h=r(59887),f=(0,a.c)();function p(e,t,r,a,l,u,d,p){var v=r?r.length:0,m=e.clippingExtent;if((0,o.KC)(t,f,e.elevationProvider.spatialReference),(0,n.pC)(m)&&!(0,s.BD)(m,f))return null;(0,o.KC)(t,f,e.renderCoordsHelper.spatialReference);for(var g=e.localOriginFactory.getOrigin(f),y=new h.T({castShadow:!1,metadata:{layerUid:u,graphicUid:d,usesVerticalDistanceToGround:!0}}),_=0;_<v;_++){var T=i.I;y.addGeometry(r[_],a[_],T,g,p)}return{object:y,sampledElevation:(0,c.bD)(y,t,e.elevationProvider,e.renderCoordsHelper,l)}}function v(e,t,r){var n=e.elevationContext,i=r.spatialReference;(0,o.KC)(t,f,i),n.centerPointInElevationSR=(0,u.Tx)(f[0],f[1],t.hasZ?f[2]:0,i)}function m(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,d.zE)(e);case"polyline":var t=e.paths[0];if(!t||0===t.length)return null;var r=(0,l.n8)(t,(0,l.ok)(t)/2);return(0,u.Tx)(r[0],r[1],r[2],e.spatialReference);case"mesh":return e.origin}return null}function g(e,t,r,n,i){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=(0,c.rR)(a,t,0,o,0,a,0,a.length/3,r,n,i),l=null!=s;return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:l,sampledElevation:s}}},55360:function(e,t,r){r.d(t,{Ns:function(){return s},Ph:function(){return o},cU:function(){return l}});r(93169);var n=r(46228),i=r(76873),a=r(8548),o=128,s=.5;function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=u(e,t,r,n);return new i.x(l,{mipmap:!1,wrap:{s:a.e8.CLAMP_TO_EDGE,t:a.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*s,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return c(t,r);case"square":return d(t,r);case"cross":return f(t,r,n);case"x":return p(t,r,n);case"kite":return h(t,r);case"triangle":return v(t,r);case"arrow":return m(t,r)}}function c(e,t){var r=e/2-.5;return x(e,_(r,r,t/2))}function d(e,t){return g(e,t,!1)}function h(e,t){return g(e,t,!0)}function f(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(e,t,!1,r)}function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return y(e,t,!0,r)}function v(e,t){return x(e,T(e/2,t,t/2))}function m(e,t){var r=t,n=t/2,i=e/2,a=.8*r,o=_(i,(e-t)/2-a,Math.sqrt(a*a+n*n)),s=T(i,r,n);return x(e,(function(e,t){return Math.max(s(e,t),-o(e,t))}))}function g(e,t,r){return r&&(t/=Math.SQRT2),x(e,(function(n,i){var a=n-.5*e+.25,o=.5*e-i-.75;if(r){var s=(a+o)/Math.SQRT2;o=(o-a)/Math.SQRT2,a=s}return Math.max(Math.abs(a),Math.abs(o))-.5*t}))}function y(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=n,r&&(t*=Math.SQRT2);var i=.5*t;return x(e,(function(t,a){var o,s=t-.5*e,l=.5*e-a-1;if(r){var u=(s+l)/Math.SQRT2;l=(l-s)/Math.SQRT2,s=u}return o=(s=Math.abs(s))>(l=Math.abs(l))?s>i?Math.sqrt((s-i)*(s-i)+l*l):l:l>i?Math.sqrt(s*s+(l-i)*(l-i)):s,o-=n/2}))}function _(e,t,r){return function(n,i){var a=n-e,o=i-t;return Math.sqrt(a*a+o*o)-r}}function T(e,t,r){var n=Math.sqrt(t*t+r*r);return function(i,a){var o=Math.abs(i-e)-r,s=a-e+t/2+.75,l=(t*o+r*s)/n,u=-s;return Math.max(l,u)}}function x(e,t){for(var r=new Uint8Array(4*e*e),i=0;i<e;i++)for(var a=0;a<e;a++){var o=a+e*i,s=t(a,i);s=s/e+.5,(0,n.I)(s,r,4*o)}return r}},26279:function(e,t,r){var n,i,a;r.d(t,{Lw:function(){return n},al:function(){return i}}),function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(i||(i={})),function(e){e[e.LAYER_VIEW=0]="LAYER_VIEW",e[e.EXTERNAL=1]="EXTERNAL"}(a||(a={}))},77648:function(e,t,r){r.d(t,{Fb:function(){return l},KO:function(){return u},sb:function(){return s}});var n=r(43144),i=r(15671),a=r(92026),o=r(81020),s=(0,n.Z)((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,i.Z)(this,e),this.array=t,this.spatialReference=r,this.offset=n}));function l(e){return"array"in e}function u(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,o.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,r);if(l(t)){var n=t.offset;return e.getElevation(t.array[n++],t.array[n++],t.array[n]||0,(0,a.Pt)(t.spatialReference,e.spatialReference),r)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,r)}},50256:function(e,t,r){r.d(t,{K:function(){return a}});var n=r(8548),i=r(61109);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.stride;return e.fieldNames.filter((function(t){var r=e.fields.get(t).optional;return!(r&&r.glPadding)})).map((function(n){var a=e.fields.get(n),s=a.constructor.ElementCount,l=o(a.constructor.ElementType),u=a.offset,c=!(!a.optional||!a.optional.glNormalized);return new i.G(n,s,l,u,r,c,t)}))}function o(e){var t=s[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}var s={u8:n.g.UNSIGNED_BYTE,u16:n.g.UNSIGNED_SHORT,u32:n.g.UNSIGNED_INT,i8:n.g.BYTE,i16:n.g.SHORT,i32:n.g.INT,f32:n.g.FLOAT}},94463:function(e,t,r){r.d(t,{Z:function(){return h}});var n=r(43144),i=r(15671),a=r(60136),o=r(54062),s=r(27366),l=r(85015),u=r(49861),c=(r(63780),r(93169),r(25243),r(69912)),d=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,e.SCENEVIEW_LOCKING_LOG=!1,e.HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED=!0,e.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1,e.DECONFLICTOR_SHOW_VISIBLE=!1,e.DECONFLICTOR_SHOW_INVISIBLE=!1,e.DECONFLICTOR_SHOW_GRID=!1,e.LABELS_SHOW_BORDER=!1,e.TEXT_SHOW_BASELINE=!1,e.TEXT_SHOW_BORDER=!1,e.OVERLAY_DRAW_DEBUG_TEXTURE=!1,e.OVERLAY_SHOW_CENTER=!1,e.SHOW_POI=!1,e.TESTS_DISABLE_OPTIMIZATIONS=!1,e.TESTS_DISABLE_FAST_UPDATES=!1,e.DRAW_MESH_GEOMETRY_NORMALS=!1,e.FEATURE_TILE_FETCH_SHOW_TILES=!1,e.FEATURE_TILE_TREE_SHOW_TILES=!1,e.TERRAIN_TILE_TREE_SHOW_TILES=!1,e.I3S_TREE_SHOW_TILES=!1,e.I3S_SHOW_MODIFICATIONS=!1,e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,e.LINE_WIREFRAMES=!1,e}return(0,n.Z)(r)}(l.Z);(0,s._)([(0,u.Cb)()],d.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"SCENEVIEW_LOCKING_LOG",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_ENABLED",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LABELS_SHOW_BORDER",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TEXT_SHOW_BASELINE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TEXT_SHOW_BORDER",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"SHOW_POI",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"LINE_WIREFRAMES",void 0);var h=new(d=(0,s._)([(0,c.j)("esri.views.3d.support.DebugFlags")],d))},38967:function(e,t,r){r.d(t,{Rn:function(){return yr}});var n,i,a,o,s,l=r(74165),u=r(15861),c=r(29439),d=r(37762),h=r(15671),f=r(43144),p=r(60136),v=r(54062),m=r(27366),g=r(85015),y=r(91505),_=r(100),T=r(32718),x=r(77427),b=r(92026),O=r(27546),S=r(92377),C=r(8537),E=r(49861),A=(r(63780),r(93169),r(25243),r(69912)),R=r(14226),w=r(6394),P=r(71353),I=r(81949),D=r(50951),M=r(26279),H=r(94463);!function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(n||(n={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(i||(i={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(a||(a={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(o||(o={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(s||(s={}));var N,Z=r(16889),L=r(65156),F=r(68401),k=r(61403);!function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"}(N||(N={}));var U=function(){function e(t,r){(0,h.Z)(this,e),this.index=t,this.renderTargets=r,this.extent=(0,L.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,k.al)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new z,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(r.renderTargets.length).fill(!1)}return(0,f.Z)(e,[{key:"getValidTarget",value:function(e){return this.validTargets[e]?this.renderTargets.getTarget(e):null}},{key:"needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}},{key:"getColorTexture",value:function(e){var t=e===N.ColorAndWater?this.renderTargets.getTarget(o.Color):e===N.Highlight?this.renderTargets.getTarget(o.Highlight):this.renderTargets.getTarget(o.Occluded);return t?t.getTexture():null}},{key:"getNormalTexture",value:function(e){var t=e===N.ColorAndWater?this.renderTargets.getTarget(o.Water):null;return t?t.getTexture():null}},{key:"draw",value:function(e,t){var r,n=this.computeRenderTargetValidityBitfield(),i=this.needsColorWithoutRasterImage,a=(0,d.Z)(this.renderTargets.renderTargets);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.type===o.ColorNoRasterImage&&!1===i?this.validTargets[s.type]=!1:this.validTargets[s.type]=e.drawTarget(this,s,t)}}catch(l){a.e(l)}finally{a.f()}return n^this.computeRenderTargetValidityBitfield()?F.Yg.CHANGED:F.Yg.UNCHANGED}},{key:"computeRenderTargetValidityBitfield",value:function(){var e=this.validTargets;return+e[o.Color]|+e[o.ColorNoRasterImage]<<1|+e[o.Highlight]<<2|+e[o.Water]<<3|+e[o.Occluded]<<4}},{key:"setupGeometryViewsCyclical",value:function(e){this.setupGeometryViewsDirect();var t=.001*e.range;if(this.extent[0]-t<=e.min){var r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,L.cv)(this.extent,e.range,0,r)}if(this.extent[2]+t>=e.max){var n=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,L.cv)(this.extent,-e.range,0,n)}}},{key:"setupGeometryViewsDirect",value:function(){this.canvasGeometries.numViews=1,(0,L.JG)(this.canvasGeometries.extents[0],this.extent)}},{key:"hasSomeSizedView",value:function(){for(var e=0;e<this.canvasGeometries.numViews;e++){var t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}},{key:"applyViewport",value:function(e){e.setViewport(this.index===n.INNER?0:this.resolution,0,this.resolution,this.resolution)}}]),e}();var z=(0,f.Z)((function e(){(0,h.Z)(this,e),this.extents=[(0,L.Ue)(),(0,L.Ue)(),(0,L.Ue)()],this.numViews=0})),V=r(15245),j=r(8548),G=r(53634),B=function(){function e(t,r){(0,h.Z)(this,e),this.size=(0,V.c)(),this._fbo=null,this._fbo=new G.X(t,{colorTarget:j.Lm.TEXTURE,depthStencilTarget:j.OU.NONE},{target:j.No.TEXTURE_2D,pixelFormat:j.VI.RGBA,dataType:j.Br.UNSIGNED_BYTE,wrapMode:j.e8.CLAMP_TO_EDGE,samplingMode:j.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:r,maxAnisotropy:8,width:0,height:0})}return(0,f.Z)(e,[{key:"dispose",value:function(){this._fbo=(0,b.O3)(this._fbo)}},{key:"getTexture",value:function(){return this._fbo?this._fbo.colorTexture:null}},{key:"isValid",value:function(){return null!==this._fbo}},{key:"resize",value:function(e,t){this.size[0]=e,this.size[1]=t,this._fbo.resize(this.size[0],this.size[1])}},{key:"bind",value:function(e){e.bindFramebuffer(this._fbo)}},{key:"generateMipMap",value:function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}},{key:"disposeRenderTargetMemory",value:function(){var e;null==(e=this._fbo)||e.resize(0,0)}},{key:"gpuMemoryUsage",get:function(){var e,t;return null!=(e=null==(t=this._fbo)?void 0:t.gpuMemoryUsage)?e:0}}]),e}(),W=r(68198),q=function(){function e(t){(0,h.Z)(this,e);var r=function(e,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return{type:r,fbo:new B(t,n),renderPass:e,valid:!1,lastUsed:1/0}};this.renderTargets=[r(W.C.MATERIAL,o.Color),r(W.C.MATERIAL,o.ColorNoRasterImage),r(W.C.MATERIAL_HIGHLIGHT,o.Highlight,!1),r(W.C.MATERIAL_NORMAL,o.Water),r(W.C.MATERIAL,o.Occluded)]}return(0,f.Z)(e,[{key:"getTarget",value:function(e){return this.renderTargets[e].fbo}},{key:"dispose",value:function(){var e,t=(0,d.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.dispose()}}catch(r){t.e(r)}finally{t.f()}}},{key:"disposeRenderTargetMemory",value:function(){var e,t=(0,d.Z)(this.renderTargets);try{for(t.s();!(e=t.n()).done;){e.value.fbo.disposeRenderTargetMemory()}}catch(r){t.e(r)}finally{t.f()}}},{key:"validateUsageForTarget",value:function(e,t,r){if(e)t.lastUsed=r;else if(r-t.lastUsed>J)t.fbo.disposeRenderTargetMemory(),t.lastUsed=1/0;else if(t.lastUsed<1/0)return!0;return!1}},{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((function(e,t){return e+t.fbo.gpuMemoryUsage}),0)}}]),e}(),J=1e3,X=r(59447),Y=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.technique=t,this.refCount=0,this.refZeroFrame=0})),K=function(){function e(t){(0,h.Z)(this,e),this._context=t,this._perConstructorInstances=new X.r,this._frameCounter=0,this._keepAliveFrameCount=$}return(0,f.Z)(e,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}},{key:"dispose",value:function(){this._perConstructorInstances.forEach((function(e){return e.forEach((function(e){return e.technique.destroy()}))})),this._perConstructorInstances.clear()}},{key:"acquire",value:function(e,t){var r=this,n=t.key,i=this._perConstructorInstances.get(e,n);if((0,b.Wi)(i)){var a=new e(this._context,t,(function(){return r.release(a)}));i=new Y(a),this._perConstructorInstances.set(e,n,i)}return++i.refCount,i.technique}},{key:"releaseAndAcquire",value:function(e,t,r){if((0,b.pC)(r)){if(t.key===r.key)return r;this.release(r)}return this.acquire(e,t)}},{key:"release",value:function(e){if(!(0,b.Wi)(e)&&!this._perConstructorInstances.empty){var t=this._perConstructorInstances.get(e.constructor,e.key);(0,b.Wi)(t)||(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}}},{key:"frameUpdate",value:function(){var e=this;this._frameCounter++,this._keepAliveFrameCount!==$&&this._perConstructorInstances.forEach((function(t,r){t.forEach((function(t,n){0===t.refCount&&t.refZeroFrame+e._keepAliveFrameCount<e._frameCounter&&(t.technique.destroy(),e._perConstructorInstances.delete(r,n))}))}))}},{key:"reloadAll",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(){var t,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Array,this._perConstructorInstances.forEach((function(e,n){var i=function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,n){var i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.shader,e.t0=i,!e.t0){e.next=6;break}return e.next=5,i.reload();case 5:t.forEach((function(e){e.technique.reload(r._context)}));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.push(i(e,n))})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),$=-1,Q=function(e){var t=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments))._isDisposed=!1,e}return(0,f.Z)(r,[{key:"dispose",value:function(){var e,t=(0,d.Z)(null!=(r=this._managedDisposables)?r:[]);try{for(t.s();!(e=t.n()).done;){var r,n=e.value,i=this[n];this[n]=null,i&&"function"==typeof i.dispose&&i.dispose()}}catch(a){t.e(a)}finally{t.f()}this._isDisposed=!0}},{key:"isDisposed",get:function(){return this._isDisposed}}]),r}(e);return t};Q(function(){return(0,f.Z)((function e(){(0,h.Z)(this,e)}))}());var ee=r(30425),te=r(11752),re=r(61120),ne=(r(75366),r(32534)),ie=function(){function e(){(0,h.Z)(this,e),this.adds=new O.Z,this.removes=new O.Z,this.updates=new O.Z({allocator:function(e){return e||new ae},deallocator:function(e){return e.renderGeometry=null,e}})}return(0,f.Z)(e,[{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.updates.clear()}},{key:"prune",value:function(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}]),e}(),ae=(0,f.Z)((function e(){(0,h.Z)(this,e)})),oe=(0,f.Z)((function e(){(0,h.Z)(this,e),this.adds=new Array,this.removes=new Array,this.updates=new Array}));function se(e){return e.data.indexCount>=1}var le=r(50256),ue=r(94425),ce=r(56529),de=r(78289),he=r(97731),fe=r(82694),pe=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.first=t.from,this.count=t.to-t.from})),ve=(0,f.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,h.Z)(this,e),this.from=t,this.to=r})),me=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(e,n,i,a,o,s){var l;return(0,h.Z)(this,r),(l=t.call(this,n,i)).id=e,l.isVisible=a,l.hasHighlights=o,l.hasOccludees=s,l}return(0,f.Z)(r)}(ve);function ge(e){return Array.from(e.values()).sort(ye)}function ye(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function _e(e,t){if(0!==e.length){var r=e[e.length-1];if(function(e,t){return e.first+e.count>=t.from}(r,t)){var n=t.from-r.first+t.to-t.from;r.count=n}else e.push(new pe(t))}else e.push(new pe(t))}var Te=function(){function e(t,r){(0,h.Z)(this,e),this._pool=t,this._size=0,this._buffer=t.newBuffer(xe(r))}return(0,f.Z)(e,[{key:"dispose",value:function(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}},{key:"release",value:function(){this.erase(0,this._size),this.dispose()}},{key:"vao",get:function(){return this._buffer.vao}},{key:"array",get:function(){return this._buffer.array}},{key:"size",get:function(){return this._size}},{key:"grow",value:function(e){this._resize(this._size+e,!0).dispose()}},{key:"alloc",value:function(e){return this._resize(e,!1)}},{key:"_resize",value:function(e,t){var r,n=this,i=function(e,t,r){return t<=r?e>=r?e:xe(Math.max(2*e,r)):e<=2*r?e:xe(r)}(this._buffer.length,this._size,e);if(this._buffer.length!==i){var a=this._pool.newBuffer(i);t&&(a.array.set(this._buffer.array.subarray(0,Math.min(this._size,i))),a.vao.vertexBuffers.geometry.setSubData(a.array,0,0,a.array.byteLength)),r=this._buffer,this._buffer=a}var o=this._size;return this._size=e,r?{dispose:function(){r.array.fill(0,0,o),n._pool.deleteBuffer(r)},copy:function(e,t,i){return n._buffer.array.set(r.array.subarray(t,i),e)},hasNewBuffer:!0}:{dispose:function(){},copy:function(e,t,r){e!==t&&n._buffer.array.copyWithin(e,t,r)},hasNewBuffer:!1}}},{key:"erase",value:function(e,t){this._buffer.array.fill(0,e,t)}}]),e}();function xe(e){return 65536*Math.ceil(e/65536)}var be=r(18759),Oe=r(95439),Se=r(44070),Ce=r(45412),Ee=function(){function e(t,r,n,i){(0,h.Z)(this,e),this.vao=new Ce.U(t,r,{geometry:n},{geometry:Se.f.createVertex(t,j.l1.STATIC_DRAW)}),this.array=new Float32Array(i),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}return(0,f.Z)(e,[{key:"dispose",value:function(){this.vao.dispose(!0)}},{key:"length",get:function(){return this.array.length}}]),e}(),Ae=be.an+1,Re=function(){function e(t,r,n){(0,h.Z)(this,e),this._rctx=t,this._locations=r,this._layout=n,this._cache=t.newCache("MergedRenderer pool ".concat((0,Oe.D)()),we)}return(0,f.Z)(e,[{key:"dispose",value:function(){this._cache.destroy()}},{key:"newBuffer",value:function(e){var t=e.toString(),r=this._cache.pop(t);if((0,b.pC)(r)){var n=r.pop();return r.length>0&&this._cache.put(t,r,n.array.byteLength*r.length,Ae),n}return new Ee(this._rctx,this._locations,this._layout,e)}},{key:"deleteBuffer",value:function(e){var t=e.array.byteLength,r=e.array.length.toString(),n=this._cache.pop(r);return(0,b.pC)(n)?(n.push(e),this._cache.put(r,n,t*n.length,-1)):this._cache.put(r,[e],t,-1),null}}]),e}();function we(e,t){if(t!==be.lN.ALL){var r=e.pop(),n=e.length*r.array.byteLength;return r.dispose(),n}e.forEach((function(e){return e.dispose()}))}var Pe=r(32683),Ie=function(){function e(t,r,n){(0,h.Z)(this,e),this._rctx=t,this._materialRepository=r,this._material=n,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new O.Z,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new ue.p(this._material,this._materialRepository),this._bufferWriter=n.createBufferWriter(),this._bufferPool=new Re(t,n.vertexAttributeLocations,(0,le.K)(this._bufferWriter.vertexBufferLayout))}return(0,f.Z)(e,[{key:"dispose",value:function(){this._glMaterials.destroy(),this._dataByOrigin.forEach((function(e){return e.buffer.dispose()})),this._dataByOrigin.clear(),this._bufferPool.dispose()}},{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof fe.H}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this._material.renderOccluded!==ce.yD.Occlude}},{key:"modify",value:function(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateRenderCommands()}},{key:"_addAndRemoveGeometries",value:function(e,t){var r=this,n=this._bufferWriter,i=n.vertexBufferLayout.stride/4,a=this._dataByOrigin,o=function(e,t){var r,n=new Map,i=(0,d.Z)(e);try{for(i.s();!(r=i.n()).done;){Me(n,r.value,!0)}}catch(s){i.e(s)}finally{i.f()}var a,o=(0,d.Z)(t);try{for(o.s();!(a=o.n()).done;){Me(n,a.value,!1)}}catch(s){o.e(s)}finally{o.f()}return n}(e,t);o.forEach((function(e,t){o.delete(t);var s=e.toAdd.reduce((function(e,t){return e+n.elementCount(t.data)}),0),l=a.get(t);if(null==l)(0,he.hu)(0===e.toRemove.length),l=new Le(e.origin,new Te(r._bufferPool,s*i)),a.set(t,l);else if(0===e.toAdd.length&&l.instances.size===e.toRemove.length)return l.buffer.dispose(),void a.delete(t);var u=0;l.instances.forEach((function(e){return u+=e.to-e.from}));var c=e.toRemove.reduce((function(e,t){return e+n.elementCount(t.data)}),0),d=l.buffer.size,h=(u+s-c)*i,f=ke;if(h<d/2?r._removeAndRebuild(l,e.toRemove,i,h,f):e.toRemove.length>0&&r._remove(l,e.toRemove,i,f),e.toAdd.length>0){var p=Ue;(0,he.u_)(p,-e.origin[0],-e.origin[1],-e.origin[2]),r._add(l,e.toAdd,i,p,f)}var v=l.buffer.vao.vertexBuffers.geometry;Ze(f),f.forAll((function(e){var t=e.from,r=e.to;if(t<r){var n=l.buffer.array,i=4*t,a=4*r;v.setSubData(n,i,i,a)}})),f.clear(),l.drawCommandsDirty=!0}))}},{key:"_updateGeometries",value:function(e){var t,r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,i=(0,d.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.renderGeometry,s=this._dataByOrigin.get(o.origin.id),l=s&&s.instances.get(o.id);if(!l)return;var u=a.updateType;if(u&de.$.State.VISIBILITIES&&(l.isVisible=o.instanceParameters.visible),u&(de.$.State.HIGHLIGHTS|de.$.State.VISIBILITIES)){var c=o.instanceParameters.visible;l.hasHighlights=!!o.instanceParameters.highlights&&c}if(u&de.$.State.OCCLUDEES&&(l.hasOccludees=!!o.instanceParameters.occludees),u&(de.$.State.VERTEXATTRS|de.$.State.TRANSFORMATION)){var h=s.buffer,f=h.array,p=h.vao;(0,Pe.bZ)(o,ze,Ve),r.write({transformation:ze,invTranspTransformation:Ve},o.data,r.vertexBufferLayout.createView(f.buffer),l.from),(0,he.hu)(l.from+r.elementCount(o.data)===l.to,"material VBO layout has changed"),p.vertexBuffers.geometry.setSubData(f,l.from*n*4,l.from*n*4,l.to*n*4)}s.drawCommandsDirty=!0}}catch(v){i.e(v)}finally{i.f()}}},{key:"_updateRenderCommands",value:function(){var e=this;this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((function(t){t.hasHiddenInstances=!1,t.hasHighlights=!1,t.hasOccludees=!1,(0,x.oE)(t.instances,(function(r){return r.isVisible?(r.hasHighlights&&(e._hasHighlights=!0,t.hasHighlights=!0),r.hasOccludees&&(e._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0,t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees}))}));this._dataByOrigin.forEach((function(t){t.drawCommandsDirty&&(function(t){if(t.drawCommandsDefault=null,t.drawCommandsHighlight=null,t.drawCommandsOccludees=null,t.drawCommandsShadowHighlightRest=null,0!==t.instances.size)if(He(t)){var r=ge(t.instances);t.drawCommandsDefault=[],t.drawCommandsHighlight=[],t.drawCommandsOccludees=[],t.drawCommandsShadowHighlightRest=[];var n,i=(0,d.Z)(r);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.isVisible&&(a.hasOccludees?_e(t.drawCommandsOccludees,a):_e(t.drawCommandsDefault,a),a.hasHighlights?_e(t.drawCommandsHighlight,a):_e(t.drawCommandsShadowHighlightRest,a))}}catch(l){i.e(l)}finally{i.f()}}else{var o=e._bufferWriter.vertexBufferLayout.stride,s=4*t.buffer.size/o;t.drawCommandsDefault=[{first:0,count:s}]}}(t),t.drawCommandsDirty=!1)}))}},{key:"updateAnimation",value:function(e){return this._material.update(e)}},{key:"requiresSlot",value:function(e,t){return null==e||this._material.requiresSlot(e,t)}},{key:"render",value:function(e,t,r){var n=this;if(!this.requiresSlot(e,t))return!1;var i=t===W.C.MATERIAL_HIGHLIGHT||t===W.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(i&&!this._hasHighlights)return!1;var a=t===W.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,o=!(i||a);if(this._dataByOrigin.forEach((function(e){if(!i||e.hasHighlights){var t=(i?e.drawCommandsHighlight:a&&He(e)?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,r=o&&e.drawCommandsOccludees||null;((0,b.pC)(t)||(0,b.pC)(r))&&n._renderCommandData.push(new Fe(e.origin,e.buffer,t,r))}})),0===this._renderCommandData.length)return!1;var s=this._rctx,l=this._glMaterials.load(s,t);if((0,b.Wi)(l))return this._renderCommandData.clear(),!1;var u=l.beginSlot(r);return s.useTechnique(u,e,!1),l.bind(r,u),this._renderCommandData.forAll((function(t){var i=t.origin,a=t.buffer,o=t.renderCommands,l=t.occludeeCommands;r.origin=i,u.bindDraw(r),u.ensureAttributeLocations(a.vao),s.bindVAO(a.vao);var c=u.primitiveType;(0,b.pC)(o)&&n._renderCommands(s,c,o),(0,b.pC)(l)&&(u.bindPipelineState(s,e,!0),n._renderCommands(s,c,l),u.bindPipelineState(s,e,!1))})),this._renderCommandData.clear(),!0}},{key:"_renderCommands",value:function(e,t,r){for(var n=0;n<r.length;n++)e.drawArrays(t,r[n].first,r[n].count)}},{key:"_removeAndRebuild",value:function(e,t,r,n,i){var a,o=(0,d.Z)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;e.instances.delete(s.id)}}catch(y){o.e(y)}finally{o.f()}var l=ge(e.instances);e.instances.clear();var u,c=e.buffer.size,h=e.buffer.alloc(n),f=0,p=(0,d.Z)(l);try{for(p.s();!(u=p.n()).done;){var v=u.value,m=v.from*r,g=v.to*r;h.copy(f,m,g),v.from=f/r,f+=g-m,v.to=f/r,e.instances.set(v.id,v)}}catch(y){p.e(y)}finally{p.f()}i.push(new ve(0,h.hasNewBuffer?e.buffer.array.length:c)),h.dispose(),e.buffer.erase(f,i.back().to),e.holes.clear()}},{key:"_remove",value:function(e,t,r,n){var i,a=(0,d.Z)(t);try{for(a.s();!(i=a.n()).done;){var o=i.value.id,s=e.instances.get(o),l=s.from*r,u=s.to*r;e.buffer.erase(l,u),e.holes.push(new ve(s.from,s.to)),e.instances.delete(o),n.push(new ve(l,u))}}catch(c){a.e(c)}finally{a.f()}Ze(e.holes)}},{key:"_add",value:function(e,t,r,n,i){if(0!==t.length){var a,o=this._bufferWriter,s=o.vertexBufferLayout.createView(e.buffer.array.buffer),l=e.holes.length>0,u=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,h=(0,d.Z)(t);try{for(h.s();!(a=h.n()).done;){var f=a.value,p=(0,b.pC)(f.transformation)?(0,R.m)(ze,n,f.transformation):n;(0,R.a)(Ve,p);var v=(0,R.t)(Ve,Ve),m=o.elementCount(f.data),g=m*r,y=Ne(e.holes,m);(0,b.Wi)(y)&&(y=e.buffer.size/r,e.buffer.grow(g),s=o.vertexBufferLayout.createView(e.buffer.array.buffer)),o.write({transformation:p,invTranspTransformation:v},f.data,s,y);var _=f.instanceParameters.visible,T=!!f.instanceParameters.highlights&&_,x=!!f.instanceParameters.occludees,O=new me(f.id,y,y+m,_,T,x);(0,he.hu)(null==e.instances.get(f.id)),e.instances.set(f.id,O),l?i.push(new ve(O.from*r,O.to*r)):(u=Math.min(O.from,u),c=Math.max(O.to,c))}}catch(S){h.e(S)}finally{h.f()}l||i.push(new ve(u*r,c*r))}}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]),e}(),De=(0,f.Z)((function e(t){(0,h.Z)(this,e),this.origin=t,this.toAdd=new Array,this.toRemove=new Array}));function Me(e,t,r){var n=t.origin;if(!(0,b.Wi)(n)){var i=e.get(n.id);null==i&&(i=new De(n.vec3),e.set(n.id,i)),r?i.toAdd.push(t):i.toRemove.push(t)}}function He(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Ne(e,t){var r;if(!e.some((function(e){return!(e.to-e.from<t)&&(r=e,!0)})))return null;var n=r.from;return r.from+=t,r.from>=r.to&&e.removeUnordered(r),n}function Ze(e){var t=new Map;e.forAll((function(e){return t.set(e.from,e)}));for(var r=!0;r;)r=!1,e.forEach((function(n){var i=t.get(n.to);i&&(n.to=i.to,t.delete(i.from),e.removeUnordered(i),r=!0)}))}var Le=(0,f.Z)((function e(t,r){(0,h.Z)(this,e),this.origin=t,this.buffer=r,this.instances=new Map,this.holes=new O.Z({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1})),Fe=(0,f.Z)((function e(t,r,n,i){(0,h.Z)(this,e),this.origin=t,this.buffer=r,this.renderCommands=n,this.occludeeCommands=i})),ke=new O.Z({deallocator:null}),Ue=(0,I.c)(),ze=(0,I.c)(),Ve=(0,I.c)(),je=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments))._pending=new Be,e._changes=new ie,e._materialRenderers=new Map,e._sortedMaterialRenderers=new O.Z,e._hasHighlights=!1,e._hasWater=!1,e}return(0,f.Z)(r,[{key:"destroy",value:function(){this._changes.prune(),this._materialRenderers.forEach((function(e){return e.dispose()})),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear()}},{key:"updating",get:function(){return!this._pending.empty||this._changes.updates.length>0}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return(0,x.oE)(this._materialRenderers,(function(e){return e.rendersOccluded}))}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"commitChanges",value:function(){var e=this;if(!this.updating)return!1;this._processAddsRemoves();var t=function(e){var t=new Map,r=function(e){var r=t.get(e);return r||(r=new oe,t.set(e,r)),r};return e.removes.forAll((function(e){se(e)&&r(e.material).removes.push(e)})),e.adds.forAll((function(e){se(e)&&r(e.material).adds.push(e)})),e.updates.forAll((function(e){se(e.renderGeometry)&&r(e.renderGeometry.material).updates.push(e)})),t}(this._changes),r=!1,n=!1,i=!1;return t.forEach((function(t,a){var o=e._materialRenderers.get(a);if(!o&&t.adds.length>0&&(o=new Ie(e.rctx,e.materialRepository,a),e._materialRenderers.set(a,o),r=!0,n=!0,i=!0),o){var s=n||o.hasHighlights,l=i||o.hasWater;o.modify(t),n=n||s!==o.hasHighlights,i=i||l!==o.hasWater,o.isEmpty&&(e._materialRenderers.delete(a),o.dispose(),r=!0)}})),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),n&&(this._hasHighlights=(0,x.oE)(this._materialRenderers,(function(e){return e.hasHighlights}))),i&&(this._hasWater=(0,x.oE)(this._materialRenderers,(function(e){return e.hasWater}))),this.notifyChange("updating"),!0}},{key:"add",value:function(e){if(0!==e.length){var t,r=this._pending.empty,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._pending.adds.add(i)}}catch(a){n.e(a)}finally{n.f()}r&&this.notifyChange("updating")}}},{key:"remove",value:function(e){var t,r=this._pending.empty,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._pending.adds.has(i)?(this._pending.removed.add(i),this._pending.adds.delete(i)):this._pending.removed.has(i)||this._pending.removes.add(i)}}catch(a){n.e(a)}finally{n.f()}r&&!this._pending.empty&&this.notifyChange("updating")}},{key:"modify",value:function(e,t){var r,n=0===this._changes.updates.length,i=(0,d.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this._changes.updates.pushNew();o.renderGeometry=a,o.updateType=t}}catch(s){i.e(s)}finally{i.f()}n&&this._changes.updates.length>0&&this.notifyChange("updating")}},{key:"updateAnimation",value:function(e){var t=!1;return this._sortedMaterialRenderers.forAll((function(r){var n=r.materialRenderer;return t=n.updateAnimation(e)||t})),t}},{key:"render",value:function(e,t){for(var r=0;r<this._sortedMaterialRenderers.length;r++){var n=this._sortedMaterialRenderers.data[r];n.material.shouldRender(e)&&n.materialRenderer.render(t.slot,e.pass,t)}}},{key:"_updateSortedMaterialRenderers",value:function(){var e=this;this._sortedMaterialRenderers.clear();var t=0;this._materialRenderers.forEach((function(r,n){n.insertOrder=t++,e._sortedMaterialRenderers.push({material:n,materialRenderer:r})})),this._sortedMaterialRenderers.sort((function(e,t){var r=t.material.renderPriority-e.material.renderPriority;return 0!==r?r:e.material.insertOrder-t.material.insertOrder}))}},{key:"_processAddsRemoves",value:function(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(var e=0;e<this._changes.updates.length;){var t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]),r}(g.Z);(0,m._)([(0,E.Cb)()],je.prototype,"rctx",void 0),(0,m._)([(0,E.Cb)()],je.prototype,"materialRepository",void 0),(0,m._)([(0,E.Cb)()],je.prototype,"updating",null),je=(0,m._)([(0,A.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],je);var Ge,Be=function(){function e(){(0,h.Z)(this,e),this.adds=new Set,this.removes=new Set,this.removed=new Set}return(0,f.Z)(e,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}},{key:"has",value:function(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}},{key:"clear",value:function(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}]),e}(),We=r(1413),qe=r(55158),Je=r(23620),Xe=r(93822),Ye=r(4760),Ke=r(33236),$e=r(27811),Qe=r(41012),et=r(82144),tt=r(31132),rt=r(33559),nt=r(7566),it=r(27627),at=r(65322),ot=r(36207),st=r(51378);!function(e){e[e.Screen=0]="Screen",e[e.World=1]="World"}(Ge||(Ge={}));var lt=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(e,n,i){var a;(0,h.Z)(this,r),(a=t.call(this,e,n,i))._kernelBlurRadius=1;var o=e.rctx.capabilities.textureFloat,s=o.R32F,l=o.textureFloatLinear,u=null!=s;a._kernelTextureChannels=u?1:4,a._floatInterpolationDisabled=!l;var c={target:j.No.TEXTURE_2D,pixelFormat:u?j.VI.RED:j.VI.RGBA,internalFormat:u?j.lP.R32F:j.VI.RGBA,dataType:j.Br.FLOAT,samplingMode:j.cw.NEAREST,wrapMode:j.e8.CLAMP_TO_EDGE,width:1,height:1};return a._kernel=new st.x(e.rctx,c),a}return(0,f.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build({isAttributeDriven:this.configuration.isAttributeDriven,mode:this.configuration.mode});return new it.$(e.rctx,t,nt.i)}},{key:"initializePipeline",value:function(){return(0,ot.sm)({blending:(0,ot.if)(j.zi.ONE,j.zi.ONE,j.db.ADD),colorWrite:ot.BK,depthTest:null,depthWrite:null})}},{key:"bindPass",value:function(e,t){var r=t.camera,n=this.configuration.mode;switch((0,Qe.II)(this.program,r.projectionMatrix),n){case at.H.KernelDensity:this._bindKernelDensityPass(e,t);break;case at.H.GaussianBlur:this._bindGaussianBlurPass(e,t)}}},{key:"bindDraw",value:function(e){(0,Qe.id)(this.program,e)}},{key:"_bindKernelDensityPass",value:function(e,t){var r=e.searchRadius,n=e.resolutionForScale,i=t.camera,a=t.screenToWorldRatio;0!==n&&(r/=a/n),this.program.setUniform1f("radius",r*i.pixelRatio/i.fullViewport[2])}},{key:"_bindGaussianBlurPass",value:function(e,t){var r=e.searchRadius,n=e.resolutionForScale,i=t.camera,a=t.screenToWorldRatio,o=Math.round(r),s=3*(0===n?o:o*n/a);0===n||this._floatInterpolationDisabled?this._kernel.setSamplingMode(j.cw.NEAREST):this._kernel.setSamplingMode(j.cw.LINEAR),this._kernelBlurRadius!==o&&this._recomputeKernel(o),this.program.setUniform1f("radius",2*s*i.pixelRatio/i.fullViewport[2]),this.program.bindTexture(this._kernel,"kernel")}},{key:"_recomputeKernel",value:function(e){for(var t=(0,$e.cR)(e),r=Math.ceil(t.length/2),n=this._kernelTextureChannels,i=new Float32Array(r*n),a=0;a<r;++a)for(var o=t[r-1-a],s=0;s<n;++s)i[a*n+s]=o;this._kernel.resize(r,1),this._kernel.setData(i),this._kernelBlurRadius=e}},{key:"destroy",value:function(){this._kernel=(0,b.O3)(this._kernel),(0,te.Z)((0,re.Z)(r.prototype),"destroy",this).call(this)}}]),r}(tt.A);lt.shader=new et.J(at.a,(function(){return r.e(7682).then(r.bind(r,7682))}));var ut=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments)).isAttributeDriven=!1,e.mode=at.H.GaussianBlur,e}return(0,f.Z)(r)}(rt.m);(0,m._)([(0,rt.o)()],ut.prototype,"isAttributeDriven",void 0),(0,m._)([(0,rt.o)()],ut.prototype,"mode",void 0);var ct=(0,We.Z)({searchRadius:128,resolutionForScale:0,colorRampData:null,isAttributeDriven:!1,minDensity:0,maxDensity:100,fieldTotal:0,pixelRatio:1},ce.mo),dt=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(e){var n;return(0,h.Z)(this,r),(n=t.call(this,e,ct))._techniqueConfig=new ut,n}return(0,f.Z)(r,[{key:"requiresSlot",value:function(e,t){return e===Xe.r.DRAPED_MATERIAL&&t===W.C.MATERIAL}},{key:"getTechniqueConfig",value:function(){return this._techniqueConfig.isAttributeDriven=this.parameters.isAttributeDriven,this._techniqueConfig}},{key:"createGLMaterial",value:function(e){return new ht(e)}},{key:"intersect",value:function(){}},{key:"createBufferWriter",value:function(){return new ft(this.parameters.isAttributeDriven?vt:pt)}}]),r}(ce.F5),ht=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(e){return(0,h.Z)(this,r),t.call(this,e)}return(0,f.Z)(r,[{key:"beginSlot",value:function(e){return this.updateParameters(e)}},{key:"updateParameters",value:function(e){return this.ensureTechnique(lt,e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.parameters,e)}}]),r}(Je.Z),ft=function(){function e(t){(0,h.Z)(this,e),this.vertexBufferLayout=t}return(0,f.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(Ye.T.POSITION).length*mt}},{key:"write",value:function(e,t,r,n){(0,Ke.ho)(t.indices.get(Ye.T.POSITION),t.vertexAttributes.get(Ye.T.POSITION).data,e.transformation,r.position,n,mt);for(var i=t.indices.get(Ye.T.POSITION).length,a=r.uv0,o=n,s=0;s<i;++s)a.setValues(o++,-1,-1),a.setValues(o++,1,-1),a.setValues(o++,1,1),a.setValues(o++,1,1),a.setValues(o++,-1,1),a.setValues(o++,-1,-1);var l="featureAttribute"in r?r.featureAttribute:null;l&&(0,Ke.XW)(t.indices.get(Ye.T.FEATUREATTRIBUTE),t.vertexAttributes.get(Ye.T.FEATUREATTRIBUTE).data,l,n,mt)}}]),e}(),pt=(0,qe.U$)().vec3f(Ye.T.POSITION).vec2f(Ye.T.UV0),vt=pt.clone().f32(Ye.T.FEATUREATTRIBUTE),mt=6;var gt=r(78041),yt=r(23819),_t=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(e,n){var i;return(0,h.Z)(this,r),i=t.call(this,e,n,(function(){return i.destroy()}))}return(0,f.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build({mode:this.configuration.mode});return new it.$(e.rctx,t,nt.i)}},{key:"initializePipeline",value:function(e){return(0,ot.sm)({blending:gt.wu,colorWrite:ot.BK,depthTest:null,depthWrite:null})}},{key:"bindPass",value:function(e,t){var r=e.densityMap,n=e.colorRamp,i=e.maxDensity,a=e.minDensity,o=e.searchRadius;this.program.bindTexture(r,"densityMap"),this.program.bindTexture(n,"tex"),this.configuration.mode===at.H.KernelDensity&&this.program.setUniform1f("densityMultiplier",3/(o*o*Math.PI)),this.program.setUniform1f("densityNormalizer",1/(i-a)),this.program.setUniform1f("minDensity",a)}},{key:"primitiveType",get:function(){return j.MX.TRIANGLE_STRIP}}]),r}(tt.A);_t.shader=new et.J(yt.H,(function(){return r.e(8259).then(r.bind(r,28259))}));var Tt=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments)).mode=at.H.GaussianBlur,e}return(0,f.Z)(r)}(rt.m);(0,m._)([(0,rt.o)()],Tt.prototype,"mode",void 0);var xt=r(3384),bt=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments)).type="draped-heatmap",e}return(0,f.Z)(r,[{key:"initialize",value:function(){(0,te.Z)((0,re.Z)(r.prototype),"initialize",this).call(this);var e={colorTarget:j.Lm.TEXTURE,depthStencilTarget:j.OU.NONE,width:0,height:0},t=this.rctx.capabilities,n=t.colorBufferFloat.R32F,i=t.textureFloat.textureFloatLinear,a=null!=n,o={target:j.No.TEXTURE_2D,pixelFormat:a?j.VI.RED:j.VI.RGBA,internalFormat:a?j.lP.R32F:j.VI.RGBA,dataType:j.Br.FLOAT,samplingMode:i?j.cw.LINEAR:j.cw.NEAREST,wrapMode:j.e8.CLAMP_TO_EDGE,width:0,height:0};this._densityMap=new G.X(this.rctx,e,o),this._quad=(0,ne.ow)(this.rctx);var s={target:j.No.TEXTURE_2D,pixelFormat:j.VI.RGBA,dataType:j.Br.UNSIGNED_BYTE,samplingMode:j.cw.LINEAR,wrapMode:j.e8.CLAMP_TO_EDGE,width:1,height:1},l=new st.x(this.rctx,s,new Uint8ClampedArray(4));this._colorRamp=l,this._technique=new _t({rctx:this.rctx,viewingMode:D.JY.Local},new Tt),this._heatmapParameters={colorRamp:l,densityMap:this._densityMap.colorTexture,searchRadius:1,minDensity:0,maxDensity:100,fieldTotal:0}}},{key:"destroy",value:function(){this._technique=(0,b.RY)(this._technique),this._densityMap=(0,b.O3)(this._densityMap),this._quad=(0,b.O3)(this._quad),this._colorRamp=(0,b.O3)(this._colorRamp)}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}},{key:"_heatmapDensityMaterialRenderers",get:function(){return this._sortedMaterialRenderers.filter(Ot)}},{key:"add",value:function(e){(0,te.Z)((0,re.Z)(r.prototype),"add",this).call(this,e)}},{key:"remove",value:function(e){(0,te.Z)((0,re.Z)(r.prototype),"remove",this).call(this,e)}},{key:"render",value:function(e,t){var r=this._heatmapDensityMaterialRenderers,n=r.length;if(!(n<1)){var i=this.rctx.getBoundFramebufferObject(),a=this.rctx.getViewport(),o=r[0].material.parameters,s=o.pixelRatio,l=Math.ceil(a.width*s),u=Math.ceil(a.height*s);this._densityMap.resize(l,u),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,l,u),this.rctx.clear(j.lk.COLOR_BUFFER_BIT);for(var c=!1,d=0;d<n;d++){var h=r[d];h.material.shouldRender(e)&&(c=c||h.materialRenderer.render(t.slot,e.pass,t))}if(this.rctx.bindFramebuffer(i),this.rctx.setViewport(a.x,a.y,a.width,a.height),c){var f=o.searchRadius,p=o.minDensity,v=o.maxDensity,m=o.fieldTotal,g=o.colorRampData,y=this._heatmapParameters;if(y.searchRadius=f,y.fieldTotal=m,y.searchRadius=f,y.minDensity=p,y.maxDensity=v,(0,b.pC)(g)&&g!==this._colorRampData){var _=y.colorRamp,T=_.descriptor.width,x=g.length/4;x!==T&&_.resize(x,1),_.setData(g),this._colorRampData=g}this.rctx.bindVAO(this._quad),this.rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this.rctx),this._technique.bindPass(y,t),this.rctx.drawArrays(this._technique.primitiveType,0,(0,xt._V)(this._quad,"geometry"))}}}}]),r}(je);function Ot(e){return function(e){return e instanceof dt}(e.material)}bt=(0,m._)([(0,A.j)("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],bt);var St=T.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository"),Ct=function(){function e(t){(0,h.Z)(this,e),this._glMaterial=t,this.refCnt=0,this._glMaterial=t}return(0,f.Z)(e,[{key:"incRefCnt",value:function(){++this.refCnt}},{key:"decRefCnt",value:function(){--this.refCnt,(0,he.hu)(this.refCnt>=0)}},{key:"getRefCnt",value:function(){return this.refCnt}},{key:"glMaterial",get:function(){return this._glMaterial}}]),e}(),Et=function(){function e(t,r,n,i){(0,h.Z)(this,e),this._textureRepository=t,this._techniqueRepository=r,this.materialChanged=n,this.requestRender=i,this._id2glMaterialRef=new X.r}return(0,f.Z)(e,[{key:"dispose",value:function(){this._textureRepository.dispose()}},{key:"acquire",value:function(e,t){this._ownMaterial(e);var r=this._id2glMaterialRef.get(t,e.id);if((0,b.Wi)(r)){var n=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:t});r=new Ct(n),this._id2glMaterialRef.set(t,e.id,r)}return r.incRefCnt(),r.glMaterial}},{key:"release",value:function(e,t){var r=this._id2glMaterialRef.get(t,e.id);(0,b.pC)(r)&&(r.decRefCnt(),0===r.getRefCnt()&&((0,b.O3)(r.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}},{key:"_ownMaterial",value:function(e){(0,b.pC)(e.repository)&&e.repository!==this&&St.error("Material is already owned by a different material repository"),e.repository=this}}]),e}(),At=r(19962),Rt=r(81268),wt=r(54463),Pt=function(){function e(t){(0,h.Z)(this,e),this.rctx=t,this.camera=null,this.lastFrameCamera=new ee.Z,this.pass=W.C.MATERIAL,this.slot=Xe.r.OPAQUE_MATERIAL,this.highlightDepthTexture=null,this.renderOccludedMask=It,this.hasOccludees=!1,this.hasFillLights=!0}return(0,f.Z)(e,[{key:"resetRenderOccludedMask",value:function(){this.renderOccludedMask=It}},{key:"isHighlightPass",get:function(){return this.pass===W.C.MATERIAL_HIGHLIGHT}}]),e}(),It=ce.yD.Occlude|ce.yD.OccludeAndTransparent|ce.yD.OccludeAndTransparentStencil,Dt=r(61863),Mt=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,h.Z)(this,r),t.apply(this,arguments)}return(0,f.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build();return new it.$(e.rctx,t,nt.i)}},{key:"initializePipeline",value:function(){return this.configuration.hasAlpha?(0,ot.sm)({blending:(0,ot.wK)(j.zi.SRC_ALPHA,j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA,j.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ot.BK}):(0,ot.sm)({colorWrite:ot.BK})}}]),r}(tt.A);Mt.shader=new et.J(Dt.T,(function(){return r.e(7026).then(r.bind(r,77026))}));var Ht=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments)).hasAlpha=!1,e}return(0,f.Z)(r)}(rt.m);(0,m._)([(0,rt.o)()],Ht.prototype,"hasAlpha",void 0);var Nt=(0,f.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.c)();(0,h.Z)(this,e),this.intensity=t})),Zt=(0,f.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.c)(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,P.f)(.57735,.57735,.57735);(0,h.Z)(this,e),this.intensity=t,this.direction=r})),Lt=(0,f.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,P.c)(),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,P.f)(.57735,.57735,.57735),n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;(0,h.Z)(this,e),this.intensity=t,this.direction=r,this.castShadows=n,this.specularStrength=i,this.environmentStrength=a})),Ft=(0,f.Z)((function e(){(0,h.Z)(this,e),this.r=[0],this.g=[0],this.b=[0]})),kt=r(11186);function Ut(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t[n];return r}function zt(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]*t;return r}function Vt(e,t,r){(r=r||e).length=e.length;for(var n=0;n<e.length;n++)r[n]=e[n]+t[n];return r}function jt(e){return(e+1)*(e+1)}function Gt(e,t,r){var n=e[0],i=e[1],a=e[2],o=r||[];return o.length=jt(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*n,o[2]=.4886025119*a,o[3]=.4886025119*i),t>=2&&(o[4]=1.09254843059*n*i,o[5]=1.09254843059*i*a,o[6]=.31539156525*(3*a*a-1),o[7]=1.09254843059*n*a,o[8]=.54627421529*(n*n-i*i)),o}function Bt(e,t){var r,n=function(e){return(0,Z.uZ)(Math.floor(Math.sqrt(e)-1),0,2)}(t.r.length),i=(0,d.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;(0,kt.o)($t,a.direction),Gt($t,n,Yt),Ut(Yt,Qt),zt(Yt,a.intensity[0],Kt),Vt(t.r,Kt),zt(Yt,a.intensity[1],Kt),Vt(t.g,Kt),zt(Yt,a.intensity[2],Kt),Vt(t.b,Kt)}}catch(o){i.e(o)}finally{i.f()}return t}function Wt(e,t,r,n){(function(e,t){var r=jt(e),n=t||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=r;for(var i=0;i<r;i++)n.r[i]=n.g[i]=n.b[i]=0})(t,n),(0,kt.s)(r.intensity,0,0,0);var i=!1,a=qt,o=Jt,s=Xt;a.length=0,o.length=0,s.length=0;var l,u=(0,d.Z)(e);try{for(u.s();!(l=u.n()).done;){var c=l.value;c instanceof Lt&&!i?((0,kt.g)(r.direction,c.direction),(0,kt.g)(r.intensity,c.intensity),r.specularStrength=c.specularStrength,r.environmentStrength=c.environmentStrength,r.castShadows=c.castShadows,i=!0):c instanceof Lt||c instanceof Zt?a.push(c):c instanceof Nt?o.push(c):c instanceof Ft&&s.push(c)}}catch(v){u.e(v)}finally{u.f()}Bt(a,n),function(e,t){Gt($t,0,Yt);var r,n=(0,d.Z)(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;t.r[0]+=Yt[0]*Qt[0]*i.intensity[0]*4*Math.PI,t.g[0]+=Yt[0]*Qt[0]*i.intensity[1]*4*Math.PI,t.b[0]+=Yt[0]*Qt[0]*i.intensity[2]*4*Math.PI}}catch(v){n.e(v)}finally{n.f()}}(o,n);var h,f=(0,d.Z)(s);try{for(f.s();!(h=f.n()).done;){var p=h.value;Vt(n.r,p.r),Vt(n.g,p.g),Vt(n.b,p.b)}}catch(v){f.e(v)}finally{f.f()}}var qt=[],Jt=[],Xt=[],Yt=[0],Kt=[0],$t=(0,P.c)(),Qt=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],er=function(){function e(){(0,h.Z)(this,e),this._shOrder=2,this._ambientBoost=.4,this._oldSunlight={direction:(0,P.c)(),ambient:{color:(0,P.c)(),intensity:1},diffuse:{color:(0,P.c)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new Ft,this._mainLight={intensity:(0,P.c)(),direction:(0,P.f)(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}return(0,f.Z)(e,[{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"setLightDirectionUniform",value:function(e){e.setUniform3fv("lightingMainDirection",this._mainLight.direction)}},{key:"setUniforms",value:function(e,t,r){var n=t?(1-this.groundLightingFactor)*(1-this.globalFactor):0;e.setUniform1f("lightingFixedFactor",n),e.setUniform1f("lightingGlobalFactor",this.globalFactor),this.setLightDirectionUniform(e),e.setUniform3fv("lightingMainIntensity",this._mainLight.intensity),e.setUniform1f("lightingSpecularStrength",this._mainLight.specularStrength),e.setUniform1f("lightingEnvironmentStrength",this._mainLight.environmentStrength),e.setUniform1f("ambientBoostFactor",this._ambientBoost),e.setUniform1b("hasFillLights",r);var i=this._sphericalHarmonics;0===this._shOrder?e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]):1===this._shOrder?(e.setUniform4f("lightingAmbientSH_R",i.r[0],i.r[1],i.r[2],i.r[3]),e.setUniform4f("lightingAmbientSH_G",i.g[0],i.g[1],i.g[2],i.g[3]),e.setUniform4f("lightingAmbientSH_B",i.b[0],i.b[1],i.b[2],i.b[3])):2===this._shOrder&&(e.setUniform3f("lightingAmbientSH0",i.r[0],i.g[0],i.b[0]),e.setUniform4f("lightingAmbientSH_R1",i.r[1],i.r[2],i.r[3],i.r[4]),e.setUniform4f("lightingAmbientSH_G1",i.g[1],i.g[2],i.g[3],i.g[4]),e.setUniform4f("lightingAmbientSH_B1",i.b[1],i.b[2],i.b[3],i.b[4]),e.setUniform4f("lightingAmbientSH_R2",i.r[5],i.r[6],i.r[7],i.r[8]),e.setUniform4f("lightingAmbientSH_G2",i.g[5],i.g[6],i.g[7],i.g[8]),e.setUniform4f("lightingAmbientSH_B2",i.b[5],i.b[6],i.b[7],i.b[8]))}},{key:"set",value:function(e){Wt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,kt.g)(this._oldSunlight.direction,this._mainLight.direction);var t=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,kt.a)(this._oldSunlight.diffuse.color,this._mainLight.intensity,t),(0,kt.g)(tr,this._oldSunlight.diffuse.color),(0,kt.a)(tr,tr,this._ambientBoost*this.globalFactor),(0,kt.b)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,tr)}},{key:"old",get:function(){return this._oldSunlight}}]),e}(),tr=(0,P.c)(),rr=r(93433),nr=r(46228),ir=function(){function e(t){(0,h.Z)(this,e),this._rctx=t,this.cache=new Map}return(0,f.Z)(e,[{key:"dispose",value:function(){this.cache.forEach((function(e){return e.texture=(0,b.O3)(e.texture)})),this.cache.clear()}},{key:"_acquire",value:function(e){var t=this;if((0,b.Wi)(e))return null;var r=this._patternId(e),n=this.cache.get(r);if(n)return n.refCount++,n.bind;var i=e.pixelRatio,a=function(e,t){var r,n=e.map((function(e){return Math.round(e*t)})),i=1/t,a=Math.floor(n.reduce((function(e,t){return e+t}))),o=n.reduce((function(e,t){return Math.max(e,t)})),s=(Math.floor(.5*(o-1))+.5)*i,l=[],u=1,c=(0,d.Z)(n);try{for(c.s();!(r=c.n()).done;){for(var h=r.value,f=0;f<h;f++){var p=u*(Math.min(f,h-1-f)+.5)*i/s*.5+.5;l.push(p)}u=-u}}catch(O){c.e(O)}finally{c.f()}var v,m=Math.round(n[0]/2),g=[].concat((0,rr.Z)(l.slice(m)),(0,rr.Z)(l.slice(0,m))),y=a+2,_=new Uint8Array(4*y),T=4,x=(0,d.Z)(g);try{for(x.s();!(v=x.n()).done;){var b=v.value;(0,nr.I)(b,_,T),T+=4}}catch(O){x.e(O)}finally{x.f()}return _.copyWithin(0,T-4,T),_.copyWithin(T,4,8),{encodedData:_,sdfNormalizer:s,paddedPixels:y,pixels:a}}(e.pattern,i),o=a.encodedData,s=a.sdfNormalizer,l=a.pixels,u=a.paddedPixels,c=l/i,h={refCount:1,texture:null,bind:function(e){return(0,b.Wi)(h.texture)&&(h.texture=new st.x(t._rctx,{width:u,height:1,internalFormat:j.VI.RGBA,pixelFormat:j.VI.RGBA,dataType:j.Br.UNSIGNED_BYTE,wrapMode:j.e8.CLAMP_TO_EDGE},o)),e.bindTexture(h.texture,"stipplePatternTexture"),{pixelSize:c,sdfNormalizer:s,pixels:l}}};return this.cache.set(r,h),h.bind}},{key:"release",value:function(e){if(!(0,b.Wi)(e)){var t=this._patternId(e),r=this.cache.get(t);r&&(r.refCount--,0===r.refCount&&((0,b.pC)(r.texture)&&r.texture.dispose(),this.cache.delete(t)))}}},{key:"swap",value:function(e,t){var r=this._acquire(t);return this.release(e),r}},{key:"_patternId",value:function(e){return"".concat(e.pattern.join(","),"-r").concat(e.pixelRatio)}}]),e}();var ar,or=r(4170);!function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(ar||(ar={}));var sr=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,h.Z)(this,r),t.apply(this,arguments)}return(0,f.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build(this.configuration);return new it.$(e.rctx,t,nt.i)}},{key:"initializePipeline",value:function(){if(this.configuration.function===or.C.TransparentToHUDVisibility)return(0,ot.sm)({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case ar.None:return(0,ot.sm)({colorWrite:ot.BK});case ar.Alpha:return(0,ot.sm)({blending:(0,ot.wK)(j.zi.SRC_ALPHA,j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA,j.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ot.BK});default:return(0,ot.sm)({blending:(0,ot.if)(j.zi.ONE,j.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ot.BK})}}}]),r}(tt.A);sr.shader=new et.J(or.a,(function(){return r.e(4016).then(r.bind(r,44016))}));var lr=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,h.Z)(this,r),(e=t.apply(this,arguments)).function=or.C.Standard,e.alphaMode=ar.None,e.hasOpacityFactor=!1,e}return(0,f.Z)(r)}(rt.m);(0,m._)([(0,rt.o)({count:or.C.COUNT})],lr.prototype,"function",void 0),(0,m._)([(0,rt.o)({count:ar.COUNT})],lr.prototype,"alphaMode",void 0),(0,m._)([(0,rt.o)()],lr.prototype,"hasOpacityFactor",void 0);var ur,cr=r(99912),dr=T.Z.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer"),hr=function(e){(0,p.Z)(r,e);var t=(0,v.Z)(r);function r(e){var n;return(0,h.Z)(this,r),(n=t.call(this,e))._overlays=null,n._overlayRenderTarget=null,n._hasHighlights=!1,n._rendersOccluded=!1,n._hasWater=!1,n._lighting=new er,n._handles=new _.Z,n._frameTask=cr.sq,n._layerRenderers=new Map,n._sortedLayerRenderersDirty=!1,n._sortedLayerRenderers=new O.Z,n._geometries=new Map,n.worldToPCSRatio=1,n.events=new y.Z,n.longitudeCyclical=null,n}return(0,f.Z)(r,[{key:"initialize",value:function(){var e=this,t=this.view._stage.renderView;this._rctx=t.renderingContext,this._renderContext=new Pt(this._rctx);var r=t.waterTextureRepository;this._stippleTextureRepository=new ir(t.renderingContext),this._shaderTechniqueRepository=new K({rctx:this._rctx,viewingMode:D.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:r}),this._handles.add([(0,C.S1)(r,"loadingState",(function(){return e.events.emit("content-changed")})),(0,C.S1)(this,"spatialReference",(function(t){return e._localOrigins=new At.C1(t)}))]),this._materialRepository=new Et(t.textureRepository,this._shaderTechniqueRepository,(function(t){(t.renderOccluded&_r)>0!==e._rendersOccluded&&e._updateRendersOccluded(),e.events.emit("content-changed"),e.notifyChange("updating")}),(function(){return e.events.emit("content-changed")})),this._lighting.groundLightingFactor=1,this._lighting.globalFactor=0,this._lighting.set([new Nt((0,P.f)(1,1,1))]),this._bindParameters={slot:Xe.r.DRAPED_MATERIAL,highlightDepthTexture:(0,ne.hf)(this._rctx),camera:vr,inverseViewport:(0,w.a)(),origin:null,screenToWorldRatio:null,screenToPCSRatio:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,lastFrameColorTexture:null,reprojectionMatrix:I.I,ssrEnabled:!1,lighting:this._lighting,transparencyPassType:F.Am.NONE,terrainLinearDepthTexture:null,geometryLinearDepthTexture:null,multipassTerrainEnabled:!1,cullAboveGround:!1,multipassGeometryEnabled:!1,highlightColorTexture:null,cloudsCompositionParams:null,hasFillLights:!0},this._frameTask=this.view.resourceController.scheduler.registerTask(cr.T8.STAGE,this),this._handles.add(this._frameTask)}},{key:"dispose",value:function(){this._handles.destroy(),this._layerRenderers.forEach((function(e){return e.destroy()})),this._layerRenderers.clear(),this._debugTextureTechnique=(0,b.RY)(this._debugTextureTechnique),this._debugPatternTexture=(0,b.O3)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=(0,b.O3)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,b.O3)(this._shaderTechniqueRepository),this._temporaryFBO=(0,b.O3)(this._temporaryFBO),this._quadVAO=(0,b.O3)(this._quadVAO),this.disposeOverlays()}},{key:"updating",get:function(){return this._sortedLayerRenderersDirty||this._frameTask.updating||(0,x.oE)(this._layerRenderers,(function(e){return e.updating}))}},{key:"hasOverlays",get:function(){return(0,b.pC)(this._overlays)&&(0,b.pC)(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return(0,b.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"collectUnusedRenderTargetMemory",value:function(e){var t=!1;if((0,b.pC)(this._overlayRenderTarget)){var r,n=(0,d.Z)(this._overlayRenderTarget.renderTargets);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(a,i,e)||t}}catch(o){n.e(o)}finally{n.f()}}return t}},{key:"overlays",get:function(){return(0,b.Pt)(this._overlays,[])}},{key:"ensureDrapeTargets",value:function(e){(0,b.pC)(this._overlays)&&this._overlays.forEach((function(t){t.hasTargetWithoutRasterImage=(0,S.f)(e,(function(e){return e.drapeTargetType===M.al.WithoutRasterImage}))}))}},{key:"ensureDrapeSources",value:function(e){(0,b.pC)(this._overlays)&&this._overlays.forEach((function(t){t.hasDrapedFeatureSource=(0,x.oE)(e,(function(e,t){return t.drapeSourceType===M.Lw.Features})),t.hasDrapedRasterSource=(0,x.oE)(e,(function(e,t){return t.drapeSourceType===M.Lw.RasterImage}))}))}},{key:"ensureOverlays",value:function(e,t){(0,b.Wi)(this._overlays)&&(this._overlayRenderTarget=new q(this._rctx),this._overlays=[new U(n.INNER,this._overlayRenderTarget),new U(n.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}},{key:"disposeOverlays",value:function(){this._overlays=null,this._overlayRenderTarget=(0,b.O3)(this._overlayRenderTarget),this.events.emit("textures-disposed")}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};this._frameTask.processQueue(e),e.done||this._processLayers(e,t)}},{key:"_processLayers",value:function(e,t){var r,n=!1,i=(0,d.Z)(this._layerRenderers);try{for(i.s();!(r=i.n()).done;){var a=(0,c.Z)(r.value,2),o=a[0],s=a[1];if(e.done)break;(o.destroyed||t(o))&&(s.commitChanges()&&(n=!0,e.madeProgress()),s.isEmpty&&(n=!0,this._sortedLayerRenderersDirty=!0,this._layerRenderers.delete(o),this._handles.remove(o),s.destroy()))}}catch(l){i.e(l)}finally{i.f()}this._updateSortedLayerRenderers(),n&&((0,b.pC)(this._overlays)&&0===this._layerRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}},{key:"processSyncLayers",value:function(){this._processLayers(cr.G5,(function(e){return e.updatePolicy===F.jq.SYNC}))}},{key:"addGeometries",value:function(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=(0,d.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;(0,b.Wi)(o.origin)&&(o.origin=this._localOrigins.getOrigin(o.boundingSphere)),this._geometries.set(o.id,o)}}catch(s){a.e(s)}finally{a.f()}this._ensureLayerRenderer(t,i).add(e),r===de.$.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e,t)}},{key:"removeGeometries",value:function(e,t,r){var n,i=(0,d.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._geometries.delete((0,b.Wg)(a.id))}}catch(s){i.e(s)}finally{i.f()}var o=this._layerRenderers.get(t);o&&(o.remove(e),r===de.$.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e,t))}},{key:"updateGeometries",value:function(e,t,r){var n=this._layerRenderers.get(t);if(n)switch(n.modify(e,r),r){case de.$.State.TRANSFORMATION:case de.$.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e,t);case de.$.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e,t)}else dr.warn("Attempted to update geometry for nonexistent layer")}},{key:"_notifyGraphicGeometryChanged",value:function(e,t){if(!(0,b.Wi)(t.notifyGraphicGeometryChanged)){var r,n,i=(0,d.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.graphicUid;(0,b.pC)(a)&&a!==r&&(t.notifyGraphicGeometryChanged(a),r=a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_notifyGraphicVisibilityChanged",value:function(e,t){if(!(0,b.Wi)(t.notifyGraphicVisibilityChanged)){var r,n,i=(0,d.Z)(e);try{for(i.s();!(n=i.n()).done;){var a=n.value.graphicUid;(0,b.pC)(a)&&a!==r&&(t.notifyGraphicVisibilityChanged(a),r=a)}}catch(o){i.e(o)}finally{i.f()}}}},{key:"updateHighlights",value:function(e,t){var r=this._layerRenderers.get(t);r?r.modify(e,de.$.State.HIGHLIGHTS):dr.warn("Attempted to update highlights for nonexistent layer")}},{key:"isEmpty",value:function(){return 0===this._geometries.size&&!H.Z.OVERLAY_DRAW_DEBUG_TEXTURE}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"updateAnimation",value:function(e){var t=!1;return this._layerRenderers.forEach((function(r){return t=r.updateAnimation(e)||t})),t}},{key:"updateLayerOrder",value:function(){this._sortedLayerRenderersDirty=!0}},{key:"drawTarget",value:function(e,t,r){var i=this,a=e.canvasGeometries;if(0===a.numViews)return!1;this._screenToWorldRatio=r*e.mapUnitsPerPixel;var s=t.renderPass;if(this.isEmpty()||s===W.C.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===W.C.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;var l=t.fbo;if(!l.isValid())return!1;var u=2*e.resolution,c=e.resolution;l.resize(u,c);var d=this._rctx;vr.pixelRatio=e.pixelRatio*r,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===W.C.MATERIAL_NORMAL?Xe.r.DRAPED_WATER:Xe.r.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(d),e.index===n.INNER&&(d.setClearColor(0,0,0,0),d.clearSafe(j.lk.COLOR_BUFFER_BIT));var h=t.type===o.ColorNoRasterImage?ur.ExcludeRasterImage:t.type===o.Occluded?ur.OccludedOnly:ur.Normal;if(h===ur.OccludedOnly&&(this._renderContext.renderOccludedMask=_r),H.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&h!==ur.OccludedOnly)for(var f=0;f<a.numViews;f++)this._setViewParameters(a.extents[f],e,vr),this._drawDebugTexture(e.resolution,pr[e.index]);return this._layerRenderers.size>0&&this._sortedLayerRenderers.forAll((function(t){var r=t.overlayLayer,n=t.renderer;if(h!==ur.ExcludeRasterImage||r.drapeSourceType!==M.Lw.RasterImage){var o=r.fullOpacity,f=(0,b.pC)(o)&&o<1&&s===W.C.MATERIAL;f&&(i.bindTemporaryFramebuffer(i._rctx,u,c),d.clearSafe(j.lk.COLOR_BUFFER_BIT));for(var p=0;p<a.numViews;p++)i._setViewParameters(a.extents[p],e,vr),n.render(i._renderContext,i._bindParameters);f&&(0,b.pC)(i._temporaryFBO)&&(l.bind(d),i.view._stage.renderView.compositingHelper.composite(i._temporaryFBO.getTexture(),ar.PremultipliedAlpha,o,or.C.OverlayWithTransparency,e.index))}})),d.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}},{key:"bindTemporaryFramebuffer",value:function(e,t,r){(0,b.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new B(e,!1)),this._temporaryFBO.resize(t,r),this._temporaryFBO.bind(e)}},{key:"reloadShaders",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._shaderTechniqueRepository.reloadAll();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"intersect",value:function(e,t,r,n){var i=this,a=0;this._geometries.forEach((function(o){if(!n||n(o)){i._intersectRenderGeometry(o,r,t,0,e,a);var s=i.longitudeCyclical;s&&(o.boundingSphere[0]-o.boundingSphere[3]<s.min&&i._intersectRenderGeometry(o,r,t,s.range,e,a),o.boundingSphere[0]+o.boundingSphere[3]>s.max&&i._intersectRenderGeometry(o,r,t,-s.range,e,a)),a++}}))}},{key:"_intersectRenderGeometry",value:function(e,t,r,n,i,a){if(e.instanceParameters.visible){var o=0;(0,b.pC)(e.transformation)&&(n+=e.transformation[12],o=e.transformation[13]),mr[0]=r[0]-n,mr[1]=r[1]-o,mr[2]=1,gr[0]=r[0]-n,gr[1]=r[1]-o,gr[2]=0,e.screenToWorldRatio=this._screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),i,mr,gr,(function(r,n,o){!function(e,t,r,n,i,a,o){var s={layerUid:a,graphicUid:o,triangleNr:t},l=function(t){t.set(wt.q7.OVERLAY,s,e.dist,e.normal,e.transformation,r,n)};if((null==i.results.min.drapedLayerOrder||r>=i.results.min.drapedLayerOrder)&&(null==i.results.min.dist||i.results.ground.dist<=i.results.min.dist)&&l(i.results.min),i.options.store!==wt.eC.MIN&&(null==i.results.max.drapedLayerOrder||r<i.results.max.drapedLayerOrder)&&(null==i.results.max.dist||i.results.ground.dist>i.results.max.dist)&&l(i.results.max),i.options.store===wt.eC.ALL){var u=(0,Rt.LP)(i.ray);l(u),i.results.all.push(u)}}(t,o,e.material.renderPriority,a,i,e.layerUid,e.graphicUid)}),e.calculateShaderTransformation,t)}}},{key:"_ensureLayerRenderer",value:function(e,t){var r=this,n=this._layerRenderers.get(e);return n&&t===n instanceof bt||(n=t?new bt({rctx:this._rctx,materialRepository:this._materialRepository}):new je({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(e,n),this._sortedLayerRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(e.watch("fullOpacity",(function(){return r.events.emit("content-changed")})),e),this._handles.add((0,C.S1)(n,"updating",(function(){return r.notifyChange("updating")})),e)),n}},{key:"_updateSortedLayerRenderers",value:function(){var e=this;if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var t=this.view.map.allLayers;this._layerRenderers.forEach((function(r,n){var i=t.indexOf(n.layer);e._sortedLayerRenderers.push(new fr(n,r,i<0?1/0:i))})),this._sortedLayerRenderers.sort((function(e,t){return e.index-t.index}))}}},{key:"_setViewParameters",value:function(e,t,r){r.viewport[0]=r.viewport[1]=0,r.viewport[2]=r.viewport[3]=t.resolution,(0,R.q)(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),(0,R.f)(r.viewMatrix,[-e[0],-e[1],0]),this._renderContext.camera=r,this._bindParameters.camera=r,this._bindParameters.inverseViewport[0]=1/r.fullViewport[2],this._bindParameters.inverseViewport[1]=1/r.fullViewport[3]}},{key:"_updateHasWater",value:function(){var e=(0,x.oE)(this._layerRenderers,(function(e){return e.hasWater}));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}},{key:"_updateHasHighlights",value:function(){var e=(0,x.oE)(this._layerRenderers,(function(e){return e.hasHighlights}));e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}},{key:"_updateRendersOccluded",value:function(){var e=(0,x.oE)(this._layerRenderers,(function(e){return e.rendersOccluded}));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}},{key:"_drawDebugTexture",value:function(e,t){this._ensureDebugPatternResources(e,e);var r=this._rctx,n=r.useTechnique(this._debugTextureTechnique);n.setUniform4f("uColor",t[0],t[1],t[2],1),n.bindTexture(this._debugPatternTexture,"tex"),r.bindVAO(this._quadVAO),r.drawArrays(j.MX.TRIANGLE_STRIP,0,(0,xt._V)(this._quadVAO,"geometry"))}},{key:"_ensureDebugPatternResources",value:function(e,t){if(!this._debugPatternTexture){for(var r=new Uint8Array(e*t*4),n=0,i=0;i<t;i++)for(var a=0;a<e;a++){var o=Math.floor(a/10),s=Math.floor(i/10);o<2||s<2||10*o>e-20||10*s>t-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&o&&1&s?1&a^1&i?0:255:1&o^1&s?0:128)}this._debugPatternTexture=new st.x(this._rctx,{target:j.No.TEXTURE_2D,pixelFormat:j.VI.RGBA,dataType:j.Br.UNSIGNED_BYTE,samplingMode:j.cw.NEAREST,width:e,height:t},r);var l=new Ht;l.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Mt,l),this._quadVAO=(0,ne.ow)(this._rctx)}}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]),r}(Q(g.Z));(0,m._)([(0,E.Cb)()],hr.prototype,"_frameTask",void 0),(0,m._)([(0,E.Cb)()],hr.prototype,"_sortedLayerRenderersDirty",void 0),(0,m._)([function(e,t){var r,n;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(r=null==(n=e._managedDisposables)?void 0:n.slice())?r:[]),e._managedDisposables.unshift(t)}],hr.prototype,"_shaderTechniqueRepository",void 0),(0,m._)([function(e,t){var r,n;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=null!=(r=null==(n=e._managedDisposables)?void 0:n.slice())?r:[]),e._managedDisposables.unshift(t)}],hr.prototype,"_stippleTextureRepository",void 0),(0,m._)([(0,E.Cb)({constructOnly:!0})],hr.prototype,"view",void 0),(0,m._)([(0,E.Cb)()],hr.prototype,"worldToPCSRatio",void 0),(0,m._)([(0,E.Cb)()],hr.prototype,"spatialReference",void 0),(0,m._)([(0,E.Cb)({type:Boolean,readOnly:!0})],hr.prototype,"updating",null),hr=(0,m._)([(0,A.j)("esri.views.3d.terrain.OverlayRenderer")],hr),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(ur||(ur={}));var fr=(0,f.Z)((function e(t,r,n){(0,h.Z)(this,e),this.overlayLayer=t,this.renderer=r,this.index=n})),pr=[[1,.5,.5],[.5,.5,1]];var vr=new ee.Z;vr.near=1,vr.far=1e4,vr.relativeElevation=null;var mr=(0,P.c)(),gr=(0,P.c)(),yr=-2,_r=ce.yD.OccludeAndTransparent},74321:function(e,t,r){r.d(t,{k:function(){return l}});var n,i,a=r(30168),o=r(98634),s=r(4760);function l(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.attributes.add(s.T.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add((0,o.H)(n||(n=(0,a.Z)(["\n    void main(void) {\n      gl_Position = vec4(position, 0.0, 1.0);\n      ","\n    }\n  "])),t?(0,o.H)(i||(i=(0,a.Z)(["uv = position * 0.5 + vec2(0.5);"]))):""))}},48353:function(e,t,r){r.d(t,{U:function(){return h}});var n,i,a,o,s,l,u=r(30168),c=r(98634),d=r(4760);function h(e,t){e.vertex.uniforms.add("intrinsicWidth","float"),t.vvSize?(e.attributes.add(d.T.SIZEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add("vvSizeMinSize","vec3"),e.vertex.uniforms.add("vvSizeMaxSize","vec3"),e.vertex.uniforms.add("vvSizeOffset","vec3"),e.vertex.uniforms.add("vvSizeFactor","vec3"),e.vertex.code.add((0,c.H)(n||(n=(0,u.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(d.T.SIZE,"float"),e.vertex.code.add((0,c.H)(i||(i=(0,u.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(d.T.OPACITYFEATUREATTRIBUTE,"float"),e.vertex.constants.add("vvOpacityNumber","int",8),e.vertex.code.add((0,c.H)(a||(a=(0,u.Z)(["uniform float vvOpacityValues[vvOpacityNumber];\nuniform float vvOpacityOpacities[vvOpacityNumber];\nfloat interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):e.vertex.code.add((0,c.H)(o||(o=(0,u.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.attributes.add(d.T.COLORFEATUREATTRIBUTE,"float"),e.vertex.constants.add("vvColorNumber","int",8),e.vertex.code.add((0,c.H)(s||(s=(0,u.Z)(["uniform float vvColorValues[vvColorNumber];\nuniform vec4 vvColorColors[vvColorNumber];\nvec4 interpolateColor( float value ) {\nif (value <= vvColorValues[0]) {\nreturn vvColorColors[0];\n}\nfor (int i = 1; i < vvColorNumber; ++i) {\nif (vvColorValues[i] >= value) {\nfloat f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\nreturn mix(vvColorColors[i-1], vvColorColors[i], f);\n}\n}\nreturn vvColorColors[vvColorNumber - 1];\n}\nvec4 getColor(){\nreturn applyOpacity(interpolateColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(d.T.COLOR,"vec4"),e.vertex.code.add((0,c.H)(l||(l=(0,u.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},28156:function(e,t,r){r.d(t,{H:function(){return s}});var n,i,a=r(30168),o=r(98634);function s(e){var t=(0,o.H)(n||(n=(0,a.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))),r=(0,o.H)(i||(i=(0,a.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])));e.vertex.code.add(t),e.vertex.code.add(r),e.fragment.code.add(t),e.fragment.code.add(r)}},50600:function(e,t,r){r.d(t,{RL:function(){return m},d9:function(){return h},HG:function(){return g}});var n,i=r(30168);!function(e){e[e.OCCLUDED=0]="OCCLUDED",e[e.NOTOCCLUDED=1]="NOTOCCLUDED",e[e.BOTH=2]="BOTH",e[e.COUNT=3]="COUNT"}(n||(n={}));var a,o,s,l,u,c,d,h,f=r(62993),p=r(98634),v=r(4760);function m(e,t){var r=e;r.include(f.c),r.attributes.add(v.T.POSITION,"vec3"),r.attributes.add(v.T.NORMAL,"vec3"),r.attributes.add(v.T.AUXPOS1,"vec4"),r.vertex.uniforms.add("proj","mat4"),r.vertex.uniforms.add("view","mat4"),r.vertex.uniforms.add("viewNormal","mat4"),r.vertex.uniforms.add("viewport","vec4"),r.vertex.uniforms.add("cameraPosition","vec3"),r.vertex.uniforms.add("polygonOffset","float"),r.vertex.uniforms.add("cameraGroundRelative","float"),r.vertex.uniforms.add("pixelRatio","float"),r.vertex.uniforms.add("perDistancePixelRatio","float"),r.vertex.uniforms.add("renderTransparentlyOccludedHUD","float"),t.verticalOffsetEnabled&&r.vertex.uniforms.add("verticalOffset","vec4"),t.screenSizePerspectiveEnabled&&r.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4"),r.vertex.uniforms.add("hudVisibilityTexture","sampler2D"),r.vertex.constants.add("smallOffsetAngle","float",.984807753012208),r.vertex.code.add((0,p.H)(a||(a=(0,i.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),r.vertex.code.add((0,p.H)(o||(o=(0,i.Z)(["float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\nfloat pointGroundSign = sign(pointGroundDistance);\nif (pointGroundSign == 0.0) {\npointGroundSign = cameraGroundRelative;\n}\nfloat groundRelative = cameraGroundRelative * pointGroundSign;\nif (polygonOffset > .0) {\nfloat cosAlpha = clamp(absCosAngle, 0.01, 1.0);\nfloat tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\nfloat factor = (1.0 - tanAlpha / viewport[2]);\nif (groundRelative > 0.0) {\nposView *= factor;\n}\nelse {\nposView /= factor;\n}\n}\nreturn groundRelative;\n}"])))),t.isDraped||r.vertex.code.add((0,p.H)(s||(s=(0,i.Z)(["void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\nfloat distanceToCamera = length(posView);\nfloat pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;\nvec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\nvec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\nposModel += modelOffset;\nposView += viewOffset;\n}"])))),r.vertex.code.add((0,p.H)(l||(l=(0,i.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.screenSizePerspectiveEnabled&&(t.verticalOffsetEnabled||t.screenCenterOffsetUnitsEnabled===h.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.verticalOffsetEnabled?t.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.verticalOffsetEnabled?(0,p.H)(u||(u=(0,i.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled!==h.Screen?(0,p.H)(c||(c=(0,i.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",t.screenCenterOffsetUnitsEnabled===h.Screen?t.screenSizePerspectiveEnabled?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled===h.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":"")),r.vertex.code.add((0,p.H)(d||(d=(0,i.Z)(["bool testVisibilityHUD(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}function g(e,t){e.setUniform1f("renderTransparentlyOccludedHUD",t.renderTransparentlyOccludedHUD===n.OCCLUDED?1:t.renderTransparentlyOccludedHUD===n.NOTOCCLUDED?0:.75)}!function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"}(h||(h={}))},50913:function(e,t,r){r.d(t,{R:function(){return h}});var n,i,a,o,s=r(30168),l=r(21002),u=r(43565),c=r(78980),d=r(98634);function h(e,t){t.multipassGeometryEnabled&&e.vertex.include(u.S),t.multipassTerrainEnabled&&e.varyings.add("depth","float"),e.vertex.code.add((0,d.H)(n||(n=(0,s.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassGeometryEnabled?(0,d.H)(i||(i=(0,s.Z)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassTerrainEnabled?"depth = projectAux.posView.z;":"")),t.multipassTerrainEnabled&&e.fragment.include(l.S),e.fragment.uniforms.add("terrainDepthTexture","sampler2D"),e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("inverseViewport","vec2"),e.fragment.include(c.n),e.fragment.code.add((0,d.H)(a||(a=(0,s.Z)(["\n  void main() {\n    gl_FragColor = vec4(1, 1, 1, 1);\n    ","\n  }\n  "])),t.multipassTerrainEnabled?(0,d.H)(o||(o=(0,s.Z)(["\n\n          vec2 uv = gl_FragCoord.xy * inverseViewport;\n\n          //Read the rgba data from the texture linear depth\n          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);\n\n          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);\n\n          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)\n          //Mark the HUD vertex as occluded by transparent terrain\n          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){\n            gl_FragColor.g = 0.5;\n          }"]))):""))}},7683:function(e,t,r){r.d(t,{E:function(){return l},K:function(){return s}});var n,i,a=r(30168),o=r(98634);function s(e){e.fragment.code.add((0,o.H)(n||(n=(0,a.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,o.H)(i||(i=(0,a.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},29202:function(e,t,r){r.d(t,{D:function(){return o}});var n,i=r(30168),a=r(98634);function o(e){e.fragment.code.add((0,a.H)(n||(n=(0,i.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}},37248:function(e,t,r){r.d(t,{q:function(){return S}});var n,i,a,o,s,l,u,c,d,h,f,p,v,m,g,y,_,T,x=r(30168),b=r(78980),O=r(98634);function S(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){var r=!(t.draped&&t.stipplePreferContinuous);e.fragment.include(b.n),e.vertex.uniforms.add("stipplePatternPixelSize","float"),e.vertex.uniforms.add("pixelRatio","float"),t.draped?e.vertex.uniforms.add("worldToScreenRatio","float"):(e.vertex.uniforms.add("worldToScreenPerDistanceRatio","float"),e.vertex.uniforms.add("cameraPosition","vec3"),e.vertex.code.add((0,O.H)(n||(n=(0,x.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),e.vertex.code.add((0,O.H)(i||(i=(0,x.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),C)),e.vertex.code.add((0,O.H)(a||(a=(0,x.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),e.vertex.code.add((0,O.H)(o||(o=(0,x.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),r?"patternLength":"1e4")),e.vertex.code.add((0,O.H)(s||(s=(0,x.Z)(["\n        // Round the screen length to get an integer number of pattern repetitions (minimum 1).\n        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\n        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));\n        float segmentLengthScreenRounded = flooredRepetitions * patternLength;\n\n        ","\n\n        return vec2(0.0, segmentLengthScreenRounded);\n      }\n      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n    }\n  "])),t.stippleRequiresStretchMeasure?(0,O.H)(l||(l=(0,x.Z)(["\n              float stretch = repetitions / flooredRepetitions;\n\n              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.\n              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.\n              vStipplePatternStretch = max(0.75, stretch);"]))):"")),e.fragment.uniforms.add("stipplePatternTexture","sampler2D"),e.fragment.uniforms.add("stipplePatternSDFNormalizer","float"),e.fragment.uniforms.add("stipplePatternTextureSize","float"),e.fragment.uniforms.add("stipplePatternPixelSizeInv","float"),t.stippleOffColorEnabled&&e.fragment.uniforms.add("stippleOffColor","vec4"),e.fragment.code.add((0,O.H)(u||(u=(0,x.Z)(["float padTexture(float u) {\nreturn (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);\n}"])))),e.fragment.code.add((0,O.H)(c||(c=(0,x.Z)(["\n    float getStippleSDF(out bool isClamped) {\n      ","\n\n      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;\n      ","\n      u = padTexture(fract(u));\n\n      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));\n      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\n\n      ","\n    }\n\n    float getStippleSDF() {\n      bool ignored;\n      return getStippleSDF(ignored);\n    }\n\n    float getStippleAlpha() {\n      bool isClamped;\n      float stippleSDF = getStippleSDF(isClamped);\n\n      float antiAliasedResult = ","\n\n      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n    }\n  "])),t.stippleRequiresClamp?(0,O.H)(d||(d=(0,x.Z)(["\n          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\n          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\n          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;"]))):(0,O.H)(h||(h=(0,x.Z)(["\n          float stippleDistanceClamped = vStippleDistance;\n          isClamped = false;"]))),t.stippleScaleWithLineWidth?(0,O.H)(f||(f=(0,x.Z)(["u *= vLineSizeInv;"]))):"",t.stippleRequiresStretchMeasure?(0,O.H)(p||(p=(0,x.Z)(["return (sdf - 0.5) * vStipplePatternStretch + 0.5;"]))):(0,O.H)(v||(v=(0,x.Z)(["return sdf;"]))),t.stippleScaleWithLineWidth?(0,O.H)(m||(m=(0,x.Z)(["clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);"]))):(0,O.H)(g||(g=(0,x.Z)(["clamp(stippleSDF + 0.5, 0.0, 1.0);"]))))),t.stippleOffColorEnabled?e.fragment.code.add((0,O.H)(y||(y=(0,x.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"])))):e.fragment.code.add((0,O.H)(_||(_=(0,x.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,O.H)(T||(T=(0,x.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}var C=O.H.float(.4)},43565:function(e,t,r){r.d(t,{S:function(){return s},l:function(){return l}});var n,i=r(30168),a=r(21002),o=r(98634);function s(e){e.include(a.S),e.uniforms.add("geometryDepthTexture","sampler2D"),e.uniforms.add("nearFar","vec2"),e.code.add((0,o.H)(n||(n=(0,i.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}function l(e,t){t.multipassGeometryEnabled&&t.geometryLinearDepthTexture&&e.bindTexture(t.geometryLinearDepthTexture,"geometryDepthTexture")}},8555:function(e,t,r){r.d(t,{n:function(){return c}});var n,i,a,o,s=r(30168),l=r(50951),u=r(98634);function c(e,t){t.viewingMode===l.JY.Global?e.vertex.code.add((0,u.H)(n||(n=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,u.H)(i||(i=(0,s.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),t.viewingMode===l.JY.Global?e.vertex.code.add((0,u.H)(a||(a=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,u.H)(o||(o=(0,s.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},70755:function(e,t,r){r.d(t,{P:function(){return u},O:function(){return c}});var n,i,a=r(30168),o=r(21002),s=r(98634);function l(e){e.fragment.uniforms.add("lastFrameColorMap","sampler2D"),e.fragment.uniforms.add("reprojectionMatrix","mat4"),e.fragment.uniforms.add("proj","mat4"),e.fragment.code.add((0,s.H)(n||(n=(0,a.Z)(["vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n{\nvec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\nvec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\nreprojectedCoord.xy /= reprojectedCoord.w;\nreturn reprojectedCoord.xy * 0.5 + 0.5;\n}"]))))}function u(e,t){e.fragment.uniforms.add("nearFar","vec2"),e.fragment.uniforms.add("depthMapView","sampler2D"),e.fragment.uniforms.add("view","mat4"),e.fragment.uniforms.add("invResolutionHeight","float"),e.fragment.include(o.S),e.include(l),e.fragment.code.add((0,s.H)(i||(i=(0,a.Z)(["\n  const int maxSteps = ","\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n          return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P += dP;\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150;":"75;"))}function c(e,t){t.ssrEnabled&&(e.bindTexture(t.linearDepthTexture,"depthMapView"),e.setUniform2fv("nearFar",t.camera.nearFar),e.setUniformMatrix4fv("view",t.camera.viewMatrix),e.setUniform1f("invResolutionHeight",1/t.camera.height),function(e,t){e.bindTexture(t.lastFrameColorTexture,"lastFrameColorMap"),e.setUniformMatrix4fv("reprojectionMatrix",t.reprojectionMatrix),e.setUniformMatrix4fv("proj",t.camera.projectionMatrix)}(e,t))}},68618:function(e,t,r){r.d(t,{B:function(){return y}});var n,i,a,o,s,l,u,c,d=r(30168),h=r(7683),f=r(29202),p=r(2116),v=r(70755),m=r(8973),g=r(98634);function y(e,t){e.include(p.T,t),e.include(f.D),e.include(h.E),t.cloudsReflectionsEnabled&&e.include(m.j),t.ssrEnabled&&e.include(v.P,t),e.fragment.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),e.fragment.code.add((0,g.H)(n||(n=(0,d.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),e.fragment.code.add((0,g.H)(i||(i=(0,d.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.cloudsReflectionsEnabled&&e.fragment.code.add((0,g.H)(a||(a=(0,d.Z)(["vec4 cloudsColor = crossFade == 0 ? renderCloud(reflectedWorld, position) : renderCloudCrossFade(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * (1.0 - totalFadeInOut);"])))),t.ssrEnabled?e.fragment.code.add((0,g.H)(o||(o=(0,d.Z)(["vec4 viewPosition = vec4(positionView.xyz, 1.0);\nvec3 viewDir = normalize(viewPosition.xyz);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view *vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);\nreflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);"])))):e.fragment.code.add((0,g.H)(s||(s=(0,d.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.cloudsReflectionsEnabled?t.ssrEnabled?e.fragment.code.add((0,g.H)(l||(l=(0,d.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):e.fragment.code.add((0,g.H)(u||(u=(0,d.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):e.fragment.code.add((0,g.H)(c||(c=(0,d.Z)(["return waterRenderedColor;\n}"]))))}},79246:function(e,t,r){r.d(t,{M:function(){return s},b:function(){return l}});var n,i=r(30168),a=r(7683),o=r(98634);function s(e){e.fragment.uniforms.add("texWaveNormal","sampler2D"),e.fragment.uniforms.add("texWavePerturbation","sampler2D"),e.fragment.uniforms.add("waveParams","vec4"),e.fragment.uniforms.add("waveDirection","vec2"),e.include(a.K),e.fragment.code.add((0,o.H)(n||(n=(0,i.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture2D(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}function l(e,t){e.setUniform4f("waveParams",t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset),e.setUniform2f("waveDirection",t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity)}},8973:function(e,t,r){r.d(t,{j:function(){return h}});var n,i,a,o,s,l,u,c=r(30168),d=r(98634);function h(e){e.fragment.uniforms.add("anchorPosition","vec3").add("anchorPositionCrossFade","vec3").add("fadeInOutFactor","float").add("cloudsHeight","float").add("rotationMatrixClouds","mat4").add("rotationMatrixCloudsCrossFade","mat4").add("radiusCurvatureCorrectionFactor","float").add("radius","float").add("cameraPosition","vec3").add("totalFadeInOut","float").add("crossFade","int").add("crossFadeAnchorFactor","float").add("cloudVariables","vec2").add("cubeMap","samplerCube"),e.fragment.code.add((0,d.H)(n||(n=(0,c.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos, float radiusReduction)\n{\nvec3 dirAnchor = normalize(spherePos);\nvec3 sphereOriginOffset = dirAnchor * radiusReduction;\nfloat radiusClouds = radius + cloudsHeight - radiusReduction;\nfloat B = 2.0 * dot(cameraPosition - sphereOriginOffset, dir);\nfloat C = dot(cameraPosition - sphereOriginOffset, cameraPosition - sphereOriginOffset) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),e.fragment.code.add((0,d.H)(i||(i=(0,c.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),e.fragment.code.add((0,d.H)(a||(a=(0,c.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),e.fragment.code.add((0,d.H)(o||(o=(0,c.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),e.fragment.code.add((0,d.H)(s||(s=(0,c.Z)(["vec4 getCloudData(vec3 rayDir)\n{\nvec4 cloudData = textureCube(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nreturn mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));\n}"])))),e.fragment.code.add((0,d.H)(l||(l=(0,c.Z)(["vec4 renderCloud(vec3 worldRay, vec3 position)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),e.fragment.code.add((0,d.H)(u||(u=(0,c.Z)(["vec4 renderCloudCrossFade(vec3 worldRay, vec3 position)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPosition, 0.0);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected);\nvec4 cloudColor = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), position, anchorPositionCrossFade, 0.0);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"]))))}},30425:function(e,t,r){r.d(t,{Z:function(){return S}});var n,i=r(15671),a=r(43144),o=r(32718),s=r(16889),l=r(92026),u=r(17842),c=r(14226),d=r(81949),h=r(88396),f=r(6394),p=r(11186),v=r(71353),m=r(90045),g=r(67077),y=r(95773),_=r(40885),T=r(40927),x=r(50951),b=r(97731),O=o.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera"),S=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,i.Z)(this,e),this._viewUp=(0,v.c)(),this._viewForward=(0,v.c)(),this._viewRight=(0,v.c)(),this._ray=(0,_.Ue)(),this._viewport=(0,g.f)(0,0,1,1),this._padding=(0,g.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,d.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,d.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,d.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,d.c)(),this._frustumDirty=!0,this._frustum=(0,y.Ue)(),this._fullViewport=(0,g.c)(),this.pixelRatio=1,this.relativeElevation=0,(0,l.pC)(t)&&(0,p.g)(this._ray.origin,t),this._center=(0,l.pC)(r)?(0,v.a)(r):(0,v.c)(),this._up=(0,l.pC)(n)?(0,v.a)(n):(0,v.f)(0,0,1)}return(0,a.Z)(e,[{key:"eye",get:function(){return this._ray.origin},set:function(e){this._compareAndSetView(e,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(e){this._compareAndSetView(e,this._center)}},{key:"ray",get:function(){return(0,p.f)(this._ray.direction,this.center,this.eye),this._ray}},{key:"up",get:function(){return this._up},set:function(e){this._compareAndSetView(e,this._up)}},{key:"viewMatrix",get:function(){return this._ensureViewClean(),this._viewMatrix},set:function(e){(0,c.c)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"viewForward",get:function(){return this._ensureViewClean(),this._viewForward}},{key:"viewUp",get:function(){return this._ensureViewClean(),this._viewUp}},{key:"viewRight",get:function(){return this._ensureViewClean(),this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(e){e+=this._padding[n.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(e){e+=this._padding[n.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[n.RIGHT]+this._padding[n.LEFT]},set:function(e){this.width=e-(this._padding[n.RIGHT]+this._padding[n.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[n.TOP]+this._padding[n.BOTTOM]},set:function(e){this.height=e-(this._padding[n.TOP]+this._padding[n.BOTTOM])}},{key:"fullViewport",get:function(){return this._fullViewport[0]=this._viewport[0]-this._padding[n.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[n.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(e){this._padding[n.TOP]===e[n.TOP]&&this._padding[n.RIGHT]===e[n.RIGHT]&&this._padding[n.BOTTOM]===e[n.BOTTOM]&&this._padding[n.LEFT]===e[n.LEFT]||(this._viewport[0]+=e[n.LEFT]-this._padding[n.LEFT],this._viewport[1]+=e[n.BOTTOM]-this._padding[n.BOTTOM],this._viewport[2]-=e[n.RIGHT]+e[n.LEFT]-(this._padding[n.RIGHT]+this._padding[n.LEFT]),this._viewport[3]-=e[n.TOP]+e[n.BOTTOM]-(this._padding[n.TOP]+this._padding[n.BOTTOM]),(0,m.c)(this._padding,e),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}},{key:"viewProjectionMatrix",get:function(){return this._viewProjectionDirty&&((0,c.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){var e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this.aspect;(0,c.l)(this._projectionMatrix,-i*(1+2*this._padding[n.LEFT]/e),i*(1+2*this._padding[n.RIGHT]/e),-r*(1+2*this._padding[n.BOTTOM]/t),r*(1+2*this._padding[n.TOP]/t),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix},set:function(e){(0,c.c)(this._projectionMatrix,e),this._projectionDirty=!1,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(e){this._fov=e,this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovX",get:function(){return(0,b.tM)(this._fov,this.width,this.height)},set:function(e){this._fov=(0,b.Kj)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"fovY",get:function(){return(0,b.RQ)(this._fov,this.width,this.height)},set:function(e){this._fov=(0,b.zF)(e,this.width,this.height),this._projectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}},{key:"distance",get:function(){return(0,p.i)(this._center,this.eye)}},{key:"frustum",get:function(){return this._recomputeFrustum(),this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,c.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,c.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}},{key:"depthNDCToWorld",value:function(e){var t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&this.relativeElevation>=0}},{key:"copyFrom",value:function(e){(0,p.g)(this._ray.origin,e.eye),(0,p.g)(this._center,e.center),(0,p.g)(this._up,e.up),(0,m.c)(this._viewport,e.viewport),(0,m.c)(this._padding,e.padding),(0,h.c)(this._nearFar,e.nearFar),this._fov=e.fov,this.relativeElevation=e.relativeElevation;var t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,c.c)(this._viewMatrix,e.viewMatrix),(0,p.g)(this._viewRight,e.viewRight),(0,p.g)(this._viewUp,e.viewUp),(0,p.g)(this._viewForward,e.viewForward)),t._projectionDirty?this._projectionDirty=!0:((0,c.c)(this._projectionMatrix,e.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,c.c)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,m.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}},{key:"copyViewFrom",value:function(e){this.eye=e.eye,this.center=e.center,this.up=e.up}},{key:"clone",value:function(){return(new e).copyFrom(this)}},{key:"equals",value:function(e){return(0,p.k)(this.eye,e.eye)&&(0,p.k)(this._center,e.center)&&(0,p.k)(this._up,e.up)&&(0,m.g)(this._viewport,e.viewport)&&(0,m.g)(this._padding,e.padding)&&(0,h.e)(this._nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}},{key:"almostEquals",value:function(e){if(this.pixelRatio!==e.pixelRatio||Math.abs(e.fov-this._fov)>=.001)return!1;var t=5e-4;(0,p.v)(A,e.eye,e.center),(0,p.v)(R,this.eye,this._center);var r=(0,p.d)(A,R),n=(0,p.w)(A),i=(0,p.w)(R);return r*r>=(1-1e-10)*n*i&&(0,p.x)(e.eye,this.eye)<Math.max(n,i)*t*t&&(0,m.i)(e.padding,this._padding)<.5&&(0,m.i)(e.viewport,this._viewport)<.5}},{key:"computeRenderPixelSizeAt",value:function(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"computeRenderPixelSizeAtDist",value:function(e){return e*this.perRenderPixelRatio}},{key:"computeScreenPixelSizeAt",value:function(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}},{key:"_viewDirectionDistance",value:function(e){return Math.abs((0,T.SR)(this.viewForward,(0,p.f)(A,e,this.eye)))}},{key:"computeScreenPixelSizeAtDist",value:function(e){return e*this.perScreenPixelRatio}},{key:"computeDistanceFromRadius",value:function(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}},{key:"getScreenCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,u.s1)();return e[0]=(this.padding[n.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[n.TOP]+this.height/2)/this.pixelRatio,e}},{key:"getRenderCenter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[n.LEFT]+this.width*t,e[1]=this.padding[n.BOTTOM]+this.height*r,e[2]=.5,e}},{key:"setGLViewport",value:function(e){var t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}},{key:"applyProjection",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e!==C&&(0,p.g)(C,e),C[3]=1,r&&(t[2]=-C[2]),(0,m.t)(C,C,this.projectionMatrix),(0,p.a)(C,C,1/Math.abs(C[3]));var n=this.fullViewport;return t[0]=(0,s.t7)(0,n[0]+n[2],.5+.5*C[0]),t[1]=(0,s.t7)(0,n[1]+n[3],.5+.5*C[1]),r||(t[2]=.5*(C[2]+1)),t}},{key:"projectToScreen",value:function(e,t){this.projectToRenderScreen(e,w),this.renderToScreen(w,t)}},{key:"projectToRenderScreen",value:function(e,t){if(C[0]=e[0],C[1]=e[1],C[2]=e[2],C[3]=1,(0,m.t)(C,C,this.viewProjectionMatrix),0===C[3])return null;(0,p.a)(C,C,1/Math.abs(C[3]));var r=this.fullViewport;return"x"in t?(t.x=(0,s.t7)(0,r[0]+r[2],.5+.5*C[0]),t.y=(0,s.t7)(0,r[1]+r[3],.5+.5*C[1])):(t[0]=(0,s.t7)(0,r[0]+r[2],.5+.5*C[0]),t[1]=(0,s.t7)(0,r[1]+r[3],.5+.5*C[1]),t.length>2&&(t[2]=.5*(C[2]+1))),t}},{key:"unprojectFromScreen",value:function(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,w),t)}},{key:"unprojectFromRenderScreen",value:function(e,t){if((0,c.m)(E,this.projectionMatrix,this.viewMatrix),!(0,c.a)(E,E))return null;var r=this.fullViewport;return C[0]=2*(e[0]-r[0])/r[2]-1,C[1]=2*(e[1]-r[1])/r[3]-1,C[2]=2*e[2]-1,C[3]=1,(0,m.t)(C,C,E),0===C[3]?null:(t[0]=C[0]/C[3],t[1]=C[1]/C[3],t[2]=C[2]/C[3],t)}},{key:"constrainWindowSize",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r,i=e*this.pixelRatio,a=t*this.pixelRatio,o=Math.max(i-r/2,0),s=Math.max(this.fullHeight-a-n/2,0),l=-Math.min(i-r/2,0),u=-Math.min(this.fullHeight-a-n/2,0);return[o,s,r-l- -Math.min(this.fullWidth-i-r/2,0),n-u- -Math.min(a-n/2,0)]}},{key:"computeUp",value:function(e){e===x.JY.Global?this._computeUpGlobal():this._computeUpLocal()}},{key:"screenToRender",value:function(e,t){var r=e[0]*this.pixelRatio,n=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=n,t}},{key:"renderToScreen",value:function(e,t){var r=e[0]/this.pixelRatio,n=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=n}},{key:"_computeUpGlobal",value:function(){(0,p.f)(A,this.center,this.eye);var e=(0,p.l)(this.center);e<1?((0,p.s)(this._up,0,0,1),this._markViewDirty()):Math.abs((0,p.d)(A,this.center))>.9999*(0,p.l)(A)*e||((0,p.c)(this._up,A,this.center),(0,p.c)(this._up,this._up,A),(0,p.n)(this._up,this._up),this._markViewDirty())}},{key:"_computeUpLocal",value:function(){(0,p.r)(A,this.eye,this.center),Math.abs(A[2])<=.9999&&((0,p.a)(A,A,A[2]),(0,p.s)(this._up,-A[0],-A[1],1-A[2]),(0,p.n)(this._up,this._up),this._markViewDirty())}},{key:"_compareAndSetView",value:function(e,t){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,p.k)(e,t)||((0,p.g)(t,e),this._markViewDirty()):O.warn("Camera vector contains invalid number, ignoring value")}},{key:"_markViewDirty",value:function(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}},{key:"_recomputeFrustum",value:function(){this._frustumDirty&&((0,y.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}},{key:"_ensureViewClean",value:function(){this._viewDirty&&((0,c.n)(this._viewMatrix,this.eye,this._center,this._up),(0,p.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,p.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,p.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}]),e}(),C=(0,g.c)(),E=(0,d.c)(),A=(0,v.c)(),R=(0,v.c)(),w=(0,u.J$)();!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(n||(n={}))},94425:function(e,t,r){r.d(t,{S:function(){return c},p:function(){return u}});var n=r(15671),i=r(43144),a=r(92026),o=r(71011),s=r(68401),l=r(68198),u=function(){function e(t,r){(0,n.Z)(this,e),this._material=t,this._repository=r,this._map=new Map}return(0,i.Z)(e,[{key:"destroy",value:function(){var e=this;this._map.forEach((function(t,r){(0,a.pC)(t)&&e._repository.release(e._material,c(r))}))}},{key:"load",value:function(e,t){this._map.has(t)||this._map.set(t,this._repository.acquire(this._material,c(t)));var r=this._map.get(t);if((0,a.pC)(r)){if(r.ensureResources(e)===s.Rw.LOADED)return r;this._repository.requestRender()}return null}}]),e}();function c(e){switch(e){default:case l.C.MATERIAL:return o.H.Color;case l.C.MATERIAL_ALPHA:return o.H.Alpha;case l.C.MATERIAL_DEPTH_SHADOWMAP_ALL:return o.H.Shadow;case l.C.MATERIAL_NORMAL:return o.H.Normal;case l.C.MATERIAL_DEPTH:return o.H.Depth;case l.C.MATERIAL_HIGHLIGHT:return o.H.Highlight;case l.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case l.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return o.H.Shadow}}},70619:function(e,t,r){r.d(t,{Z:function(){return x}});var n,i=r(11186),a=r(8229),o=r(71353),s=r(55652),l=r(40885),u=r(68401);!function(e){e.length=function(e,t){var r=e[t],n=e[t+1],i=e[t+2];return Math.sqrt(r*r+n*n+i*i)},e.normalize=function(e,t){var r=e[t],n=e[t+1],i=e[t+2],a=1/Math.sqrt(r*r+n*n+i*i);e[t]*=a,e[t+1]*=a,e[t+2]*=a},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.add=function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]+r[n],i[a+1]=e[t+1]+r[n+1],i[a+2]=e[t+2]+r[n+2]},e.subtract=function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(i=i||e)[a]=e[t]-r[n],i[a+1]=e[t+1]-r[n+1],i[a+2]=e[t+2]-r[n+2]}}(n||(n={}));var c,d,h,f,p=r(74894),v=r(81935),m=r(97731),g=r(4760),y=n;!function(e){for(var t=.5,r=[[-t,-t,t],[t,-t,t],[t,t,t],[-t,t,t],[-t,-t,-t],[t,-t,-t],[t,t,-t],[-t,t,-t]],n=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],i=[0,0,1,0,1,1,0,1],a=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36),s=0;s<6;s++)for(var l=0;l<6;l++)o[6*s+l]=s;for(var u=new Uint16Array(36),c=0;c<6;c++)u[6*c+0]=0,u[6*c+1]=1,u[6*c+2]=2,u[6*c+3]=2,u[6*c+4]=3,u[6*c+5]=0;e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(24),s=0;s<8;s++)t[3*s]=r[s][0]*e[0],t[3*s+1]=r[s][1]*e[1],t[3*s+2]=r[s][2]*e[2];return new p.Z([[g.T.POSITION,{size:3,data:t,exclusive:!0}],[g.T.NORMAL,{size:3,data:n}],[g.T.UV0,{size:2,data:i}]],[[g.T.POSITION,a],[g.T.NORMAL,o],[g.T.UV0,u]])}}(c||(c={})),function(e){var t=.5,r=[[-t,0,-t],[t,0,-t],[t,0,t],[-t,0,t],[0,-t,0],[0,t,0]],n=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],i=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),a=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(18),o=0;o<6;o++)t[3*o]=r[o][0]*e[0],t[3*o+1]=r[o][1]*e[1],t[3*o+2]=r[o][2]*e[2];return new p.Z([[g.T.POSITION,{size:3,data:t,exclusive:!0}],[g.T.NORMAL,{size:3,data:n}]],[[g.T.POSITION,i],[g.T.NORMAL,a]])}}(d||(d={})),function(e){var t=.5,r=(0,a.f)(-t,0,-t),n=(0,a.f)(t,0,-t),o=(0,a.f)(0,0,t),s=(0,a.f)(0,.5,0),l=(0,a.c)(),u=(0,a.c)(),c=(0,a.c)(),d=(0,a.c)(),h=(0,a.c)();(0,i.f)(l,r,s),(0,i.f)(u,r,n),(0,i.c)(c,l,u),(0,i.n)(c,c),(0,i.f)(l,n,s),(0,i.f)(u,n,o),(0,i.c)(d,l,u),(0,i.n)(d,d),(0,i.f)(l,o,s),(0,i.f)(u,o,r),(0,i.c)(h,l,u),(0,i.n)(h,h);var f=[r,n,o,s],v=[0,-1,0,c[0],c[1],c[2],d[0],d[1],d[2],h[0],h[1],h[2]],m=[0,1,2,3,1,0,3,2,1,3,0,2],y=[0,0,0,1,1,1,2,2,2,3,3,3];e.createGeometry=function(e){Array.isArray(e)||(e=[e,e,e]);for(var t=new Array(12),r=0;r<4;r++)t[3*r]=f[r][0]*e[0],t[3*r+1]=f[r][1]*e[1],t[3*r+2]=f[r][2]*e[2];return new p.Z([[g.T.POSITION,{size:3,data:t,exclusive:!0}],[g.T.NORMAL,{size:3,data:v}]],[[g.T.POSITION,new Uint16Array(m)],[g.T.NORMAL,new Uint16Array(y)]])}}(h||(h={})),function(e){e.createBoxGeometry=c.createGeometry,e.createDiamondGeometry=d.createGeometry,e.createTetrahedronGeometry=h.createGeometry,e.createSphereGeometry=function(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{uv:!0},i=-Math.PI,a=2*Math.PI,o=-Math.PI/2,s=Math.PI,l=Math.max(3,Math.floor(t)),u=Math.max(2,Math.floor(r)),c=(l+1)*(u+1),d=new Float32Array(3*c),h=new Float32Array(3*c),f=new Float32Array(2*c),v=[],m=0,y=0;y<=u;y++){for(var _=[],T=y/u,x=o+T*s,b=Math.cos(x),O=0;O<=l;O++){var S=O/l,C=i+S*a,E=Math.cos(C)*b,A=Math.sin(x),R=-Math.sin(C)*b;d[3*m]=E*e,d[3*m+1]=A*e,d[3*m+2]=R*e,h[3*m]=E,h[3*m+1]=A,h[3*m+2]=R,f[2*m]=S,f[2*m+1]=T,_.push(m),++m}v.push(_)}var w=new Uint32Array(2*l*(u-1)*3);m=0;for(var P=0;P<u;P++)for(var I=0;I<l;I++){var D=v[P][I],M=v[P][I+1],H=v[P+1][I+1],N=v[P+1][I];0===P?(w[m++]=D,w[m++]=H,w[m++]=N):P===u-1?(w[m++]=D,w[m++]=M,w[m++]=H):(w[m++]=D,w[m++]=M,w[m++]=H,w[m++]=H,w[m++]=N,w[m++]=D)}var Z=[[g.T.POSITION,w],[g.T.NORMAL,w]],L=[[g.T.POSITION,{size:3,data:d,exclusive:!0}],[g.T.NORMAL,{size:3,data:h,exclusive:!0}]];return n.uv&&(L.push([g.T.UV0,{size:2,data:f,exclusive:!0}]),Z.push([g.T.UV0,w])),n.offset&&(Z[0][0]=g.T.OFFSET,L[0][0]=g.T.OFFSET,Z.push([g.T.POSITION,new Uint32Array(w.length)]),L.push([g.T.POSITION,{size:3,data:Float64Array.from(n.offset),exclusive:!0}])),new p.Z(L,Z)},e.createPolySphereGeometry=function(e,t,r){var n,i,a=e;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],i=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{var o=a*(1+Math.sqrt(5))/2;n=[-a,o,0,a,o,0,-a,-o,0,a,-o,0,0,-a,o,0,a,o,0,-a,-o,0,a,-o,o,0,-a,o,0,a,-o,0,-a,-o,0,a],i=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(var s=0;s<n.length;s+=3)y.scale(n,s,e/y.length(n,s));var l={};function u(t,r){var i;t>r&&(t=(i=[r,t])[0],r=i[1]);var a=t.toString()+"."+r.toString();if(l[a])return l[a];var o=n.length;return n.length+=3,y.add(n,3*t,n,3*r,n,o),y.scale(n,o,e/y.length(n,o)),o/=3,l[a]=o,o}for(var c=0;c<t;c++){for(var d=i.length,h=new Uint32Array(4*d),f=0;f<d;f+=3){var v=i[f],m=i[f+1],_=i[f+2],T=u(v,m),x=u(m,_),b=u(_,v),O=4*f;h[O]=v,h[O+1]=T,h[O+2]=b,h[O+3]=m,h[O+4]=x,h[O+5]=T,h[O+6]=_,h[O+7]=b,h[O+8]=x,h[O+9]=T,h[O+10]=x,h[O+11]=b}i=h,l={}}for(var S=new Float32Array(n),C=0;C<S.length;C+=3)y.normalize(S,C);var E=[[g.T.POSITION,i],[g.T.NORMAL,i]],A=[[g.T.POSITION,{size:3,data:new Float32Array(n),exclusive:!0}],[g.T.NORMAL,{size:3,data:S,exclusive:!0}]];return new p.Z(A,E)},e.createPointGeometry=function(e,t,r,n,i,a,o){var s=t?[t[0],t[1],t[2]]:[0,0,0],l=e?[e[0],e[1],e[2]]:[0,0,1];a=a||[0,0];var c=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],d=null!=n&&2===n.length?n:[1,1],h=[[g.T.POSITION,{size:3,data:s,exclusive:!0}],[g.T.NORMAL,{size:3,data:l,exclusive:!0}],[g.T.UV0,{size:a.length,data:a}],[g.T.COLOR,{size:4,data:c,exclusive:!0}],[g.T.SIZE,{size:2,data:d}]];if(null!=i){var f=new Float32Array([i[0],i[1],i[2],i[3]]);h.push([g.T.AUXPOS1,{size:4,data:f}])}if(null!=o){var v=new Float32Array([o[0],o[1],o[2],o[3]]);h.push([g.T.AUXPOS2,{size:4,data:v}])}return new p.Z(h,null,u.MX.Point)},e.updatePointGeometry=function(e,t,r,n,i,a,o,s){if(null!=e){var l=s.getMutableAttribute(g.T.NORMAL).data;l[0]=e[0],l[1]=e[1],l[2]=e[2]}if(null!=t){var u=s.getMutableAttribute(g.T.POSITION).data;u[0]=t[0],u[1]=t[1],u[2]=t[2]}if(null!=r){var c=s.getMutableAttribute(g.T.COLOR).data;c[0]=r[0],c[1]=r[1],c[2]=r[2],c[3]=r[3]}if(null!=n){var d=s.getMutableAttribute(g.T.SIZE).data;d[0]=n[0],d[1]=n[1]}if(null!=i){var h=s.getMutableAttribute(g.T.AUXPOS1).data;h[0]=i[0],h[1]=i[1],h[2]=i[2],h[3]=i[3]}if(null!=a){var f=s.getMutableAttribute(g.T.UV0).data;f[0]=a[0],f[1]=a[1]}if(null!=o){var p=s.getMutableAttribute(g.T.AUXPOS2).data;p[0]=o[0],p[1]=o[1],p[2]=o[2],p[3]=o[3]}},e.createPointArrayGeometry=function(e,t){for(var r=new Float32Array(3*e.length),n=new Float32Array(t?3*e.length:3),i=new Uint32Array(e.length),a=new Uint32Array(e.length),o=0;o<e.length;o++)r[3*o]=e[o][0],r[3*o+1]=e[o][1],r[3*o+2]=e[o][2],t&&(n[3*o]=t[o][0],n[3*o+1]=t[o][1],n[3*o+2]=t[o][2]),i[o]=o,a[o]=0;t||(n[0]=0,n[1]=1,n[2]=0);var s=[[g.T.POSITION,i],[g.T.NORMAL,t?i:a],[g.T.UV0,a]],l=[[g.T.POSITION,{size:3,data:r,exclusive:!0}],[g.T.NORMAL,{size:3,data:n,exclusive:!0}],[g.T.UV0,{size:2,data:[0,0],exclusive:!0}]];return new p.Z(l,s,u.MX.Point)},e.createTriangleGeometry=function(){var e=new Uint16Array([0,1,2]),t=new Uint16Array([0,0,0]),r=new Uint16Array([0,0,0]),n=[[g.T.POSITION,e],[g.T.NORMAL,t],[g.T.UV0,r]],i=[[g.T.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[g.T.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[g.T.UV0,{size:2,data:[0,0],exclusive:!0}]];return new p.Z(i,n)};var t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function r(e,t,r,n,a){return!(Math.abs((0,i.d)(t,e))>a)&&((0,i.c)(r,e,t),(0,i.n)(r,r),(0,i.c)(n,r,e),(0,i.n)(n,n),!0)}function n(e,t,n,i,a,o,s){return r(e,t,a,o,s)||r(e,n,a,o,s)||r(e,i,a,o,s)}e.createSquareGeometry=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,r=new Array(12),n=0;n<4;n++)for(var i=0;i<3;i++)r[3*n+i]=e[n][i];var a=new Uint32Array([0,1,2,2,3,0]),o=[0,0,1],s=new Uint32Array([0,0,0,0,0,0]),l=[0,0,1,0,1,1,0,1],u=[255,255,255,255],c=[[g.T.POSITION,a],[g.T.NORMAL,s],[g.T.UV0,a],[g.T.COLOR,s]],d=[[g.T.POSITION,{size:3,data:r,exclusive:!0}],[g.T.NORMAL,{size:3,data:o,exclusive:!0}],[g.T.UV0,{size:2,data:l,exclusive:!0}],[g.T.COLOR,{size:4,data:u,exclusive:!0}]];return new p.Z(d,c)},e.createConeGeometry=function(e,t,r,n){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=0,l=t,u=e,c=(0,a.f)(0,s,0),d=(0,a.f)(0,s+u,0),h=(0,a.f)(0,-1,0),f=(0,a.f)(0,1,0);n&&(s=u,d=(0,a.f)(0,0,0),c=(0,a.f)(0,s,0),h=(0,a.f)(0,1,0),f=(0,a.f)(0,-1,0));var v=[d,c],m=[h,f],y=r+2,_=Math.sqrt(u*u+l*l);if(n)for(var T=r-1;T>=0;T--){var x=T*(2*Math.PI/r),b=(0,a.f)(Math.cos(x)*l,s,Math.sin(x)*l);v.push(b);var O=(0,a.f)(u*Math.cos(x)/_,-l/_,u*Math.sin(x)/_);m.push(O)}else for(var S=0;S<r;S++){var C=S*(2*Math.PI/r),E=(0,a.f)(Math.cos(C)*l,s,Math.sin(C)*l);v.push(E);var A=(0,a.f)(u*Math.cos(C)/_,l/_,u*Math.sin(C)/_);m.push(A)}var R=new Uint32Array(2*(r+2)*3),w=new Uint32Array(2*(r+2)*3),P=0,I=0;if(i){for(var D=3;D<v.length;D++)R[P++]=1,R[P++]=D-1,R[P++]=D,w[I++]=0,w[I++]=0,w[I++]=0;R[P++]=v.length-1,R[P++]=2,R[P++]=1,w[I++]=0,w[I++]=0,w[I++]=0}if(o){for(var M=3;M<v.length;M++)R[P++]=M,R[P++]=M-1,R[P++]=0,w[I++]=M,w[I++]=M-1,w[I++]=1;R[P++]=0,R[P++]=2,R[P++]=v.length-1,w[I++]=1,w[I++]=2,w[I++]=m.length-1}for(var H=new Float32Array(3*y),N=0;N<y;N++)H[3*N]=v[N][0],H[3*N+1]=v[N][1],H[3*N+2]=v[N][2];for(var Z=new Float32Array(3*y),L=0;L<y;L++)Z[3*L]=m[L][0],Z[3*L+1]=m[L][1],Z[3*L+2]=m[L][2];var F=[[g.T.POSITION,R],[g.T.NORMAL,w]],k=[[g.T.POSITION,{size:3,data:H,exclusive:!0}],[g.T.NORMAL,{size:3,data:Z,exclusive:!0}]];return new p.Z(k,F)},e.createCylinderGeometry=function(e,t,r,n,o,s){var l=n?(0,a.a)(n):(0,a.f)(1,0,0),u=o?(0,a.a)(o):(0,a.f)(0,0,0);s=null==s||s;var c=(0,a.c)();(0,i.n)(c,l);var d=(0,a.c)();(0,i.a)(d,c,Math.abs(e));var h=(0,a.c)();(0,i.a)(h,d,-.5),(0,i.b)(h,h,u);var f=(0,a.f)(0,1,0);Math.abs(1-(0,i.d)(c,f))<.2&&(0,i.s)(f,0,0,1);var v=(0,a.c)();(0,i.c)(v,c,f),(0,i.n)(v,v),(0,i.c)(f,v,c);var m=2*r+(s?2:0),y=r+(s?2:0),_=new Float32Array(3*m),T=new Float32Array(3*y),x=new Float32Array(2*m),b=new Uint32Array(3*r*(s?4:2)),O=new Uint32Array(3*r*(s?4:2));s&&(_[3*(m-2)+0]=h[0],_[3*(m-2)+1]=h[1],_[3*(m-2)+2]=h[2],x[2*(m-2)]=0,x[2*(m-2)+1]=0,_[3*(m-1)+0]=_[3*(m-2)+0]+d[0],_[3*(m-1)+1]=_[3*(m-2)+1]+d[1],_[3*(m-1)+2]=_[3*(m-2)+2]+d[2],x[2*(m-1)]=1,x[2*(m-1)+1]=1,T[3*(y-2)+0]=-c[0],T[3*(y-2)+1]=-c[1],T[3*(y-2)+2]=-c[2],T[3*(y-1)+0]=c[0],T[3*(y-1)+1]=c[1],T[3*(y-1)+2]=c[2]);for(var S=function(e,t,r){b[e]=t,O[e]=r},C=0,E=(0,a.c)(),A=(0,a.c)(),R=0;R<r;R++){var w=R*(2*Math.PI/r);(0,i.a)(E,f,Math.sin(w)),(0,i.a)(A,v,Math.cos(w)),(0,i.b)(E,E,A),T[3*R+0]=E[0],T[3*R+1]=E[1],T[3*R+2]=E[2],(0,i.a)(E,E,t),(0,i.b)(E,E,h),_[3*R+0]=E[0],_[3*R+1]=E[1],_[3*R+2]=E[2],x[2*R+0]=R/r,x[2*R+1]=0,_[3*(R+r)+0]=_[3*R+0]+d[0],_[3*(R+r)+1]=_[3*R+1]+d[1],_[3*(R+r)+2]=_[3*R+2]+d[2],x[2*(R+r)+0]=R/r,x[2*R+1]=1;var P=(R+1)%r;S(C++,R,R),S(C++,R+r,R),S(C++,P,P),S(C++,P,P),S(C++,R+r,R),S(C++,P+r,P)}if(s){for(var I=0;I<r;I++){var D=(I+1)%r;S(C++,m-2,y-2),S(C++,I,y-2),S(C++,D,y-2)}for(var M=0;M<r;M++){var H=(M+1)%r;S(C++,M+r,y-1),S(C++,m-1,y-1),S(C++,H+r,y-1)}}var N=[[g.T.POSITION,b],[g.T.NORMAL,O],[g.T.UV0,b]],Z=[[g.T.POSITION,{size:3,data:_,exclusive:!0}],[g.T.NORMAL,{size:3,data:T,exclusive:!0}],[g.T.UV0,{size:2,data:x,exclusive:!0}]];return new p.Z(Z,N)},e.createTubeGeometry=function(t,r,n,i,a){n=n||10,i=null==i||i,(0,m.hu)(t.length>1);for(var o=[],s=[],l=0;l<n;l++){o.push([0,-l-1,-(l+1)%n-1]);var u=l/n*2*Math.PI;s.push([Math.cos(u)*r,Math.sin(u)*r])}return e.createPathExtrusionGeometry(s,t,[[0,0,0]],o,i,a)},e.createPathExtrusionGeometry=function(e,t,r,u,c){var d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,a.f)(0,0,0),h=e.length,f=new Float32Array(t.length*h*3+(6*r.length||0)),v=new Float32Array(t.length*h*3+(r?6:0)),m=(t.length-1)*h*6+3*u.length*2,y=new Uint32Array(m),T=new Uint32Array(m),x=0,b=0,O=0,S=0,C=(0,a.c)(),E=(0,a.c)(),A=(0,a.c)(),R=(0,a.c)(),w=(0,a.c)(),P=(0,a.c)(),I=(0,a.c)(),D=(0,o.c)(),M=(0,a.c)(),H=(0,a.c)(),N=(0,a.c)(),Z=(0,a.c)(),L=(0,a.c)(),F=(0,s.Ue)();(0,i.s)(M,0,1,0),(0,i.f)(E,t[1],t[0]),(0,i.n)(E,E),c?((0,i.b)(D,t[0],d),(0,i.n)(A,D)):(0,i.s)(A,0,0,1),n(E,A,M,M,w,A,_),(0,i.g)(R,A),(0,i.g)(Z,w);for(var k=0;k<r.length;k++)(0,i.a)(P,w,r[k][0]),(0,i.a)(D,A,r[k][2]),(0,i.b)(P,P,D),(0,i.b)(P,P,t[0]),f[x++]=P[0],f[x++]=P[1],f[x++]=P[2];v[b++]=-E[0],v[b++]=-E[1],v[b++]=-E[2];for(var U=0;U<u.length;U++)y[O++]=u[U][0]>0?u[U][0]:-u[U][0]-1+r.length,y[O++]=u[U][1]>0?u[U][1]:-u[U][1]-1+r.length,y[O++]=u[U][2]>0?u[U][2]:-u[U][2]-1+r.length,T[S++]=0,T[S++]=0,T[S++]=0;for(var z=r.length,V=r.length-1,j=0;j<t.length;j++){var G=!1;j>0&&((0,i.g)(C,E),j<t.length-1?((0,i.f)(E,t[j+1],t[j]),(0,i.n)(E,E)):G=!0,(0,i.b)(H,C,E),(0,i.n)(H,H),(0,i.b)(N,t[j-1],R),(0,s.Yq)(t[j],H,F),(0,s.BR)(F,(0,l.re)(N,C),D)?((0,i.f)(D,D,t[j]),(0,i.n)(A,D),(0,i.c)(w,H,A),(0,i.n)(w,w)):n(H,R,Z,M,w,A,_),(0,i.g)(R,A),(0,i.g)(Z,w)),c&&((0,i.b)(D,t[j],d),(0,i.n)(L,D));for(var B=0;B<h;B++)if((0,i.a)(P,w,e[B][0]),(0,i.a)(D,A,e[B][1]),(0,i.b)(P,P,D),(0,i.n)(I,P),v[b++]=I[0],v[b++]=I[1],v[b++]=I[2],(0,i.b)(P,P,t[j]),f[x++]=P[0],f[x++]=P[1],f[x++]=P[2],!G){var W=(B+1)%h;y[O++]=z+B,y[O++]=z+h+B,y[O++]=z+W,y[O++]=z+W,y[O++]=z+h+B,y[O++]=z+h+W;for(var q=0;q<6;q++)T[S++]=y[O-6+q]-V}z+=h}for(var J=t[t.length-1],X=0;X<r.length;X++)(0,i.a)(P,w,r[X][0]),(0,i.a)(D,A,r[X][1]),(0,i.b)(P,P,D),(0,i.b)(P,P,J),f[x++]=P[0],f[x++]=P[1],f[x++]=P[2];var Y=b/3;v[b++]=E[0],v[b++]=E[1],v[b++]=E[2];for(var K=z-h,$=0;$<u.length;$++)y[O++]=u[$][0]>=0?z+u[$][0]:-u[$][0]-1+K,y[O++]=u[$][2]>=0?z+u[$][2]:-u[$][2]-1+K,y[O++]=u[$][1]>=0?z+u[$][1]:-u[$][1]-1+K,T[S++]=Y,T[S++]=Y,T[S++]=Y;var Q=[[g.T.POSITION,y],[g.T.NORMAL,T]],ee=[[g.T.POSITION,{size:3,data:f,exclusive:!0}],[g.T.NORMAL,{size:3,data:v,exclusive:!0}]];return new p.Z(ee,Q)},e.createPolylineGeometry=function(e,t,r){(0,m.hu)(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,m.hu)(3===e[0].length,"createPolylineGeometry(): malformed vertex"),(0,m.hu)(null==t||t.length===e.length,"createPolylineGeometry: need same number of points and normals"),(0,m.hu)(null==t||3===t[0].length,"createPolylineGeometry(): malformed normal");for(var n=new Float64Array(3*e.length),i=new Uint32Array(2*(e.length-1)),a=0,o=0,s=0;s<e.length;s++){for(var l=0;l<3;l++)n[a++]=e[s][l];s>0&&(i[o++]=s-1,i[o++]=s)}var c=[],d=[];if(c.push([g.T.POSITION,i]),d.push([g.T.POSITION,{size:3,data:n,exclusive:!0}]),t){for(var h=new Float32Array(3*t.length),f=0,y=0;y<e.length;y++)for(var _=0;_<3;_++)h[f++]=t[y][_];c.push([g.T.NORMAL,i]),d.push([g.T.NORMAL,{size:3,data:h,exclusive:!0}])}return r&&(d.push([g.T.COLOR,{size:4,data:r}]),c.push([g.T.COLOR,(0,v.p)(r.length/4)])),new p.Z(d,c,u.MX.Line)},e.createExtrudedTriangle=function(e,t,r,n){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=new Array(18),o=[[-t,i,n/2],[r,i,n/2],[0,e+i,n/2],[-t,i,-n/2],[r,i,-n/2],[0,e+i,-n/2]],s=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),l=0;l<6;l++)a[3*l]=o[l][0],a[3*l+1]=o[l][1],a[3*l+2]=o[l][2];return new p.Z([[g.T.POSITION,{size:3,data:a,exclusive:!0}]],[[g.T.POSITION,s]])},e.transformInPlace=function(e,t){for(var r=e.getMutableAttribute(g.T.POSITION).data,n=0;n<r.length;n+=3){var a=r[n],o=r[n+1],s=r[n+2];(0,i.s)(T,a,o,s),(0,i.m)(T,T,t),r[n]=T[0],r[n+1]=T[1],r[n+2]=T[2]}},e.cgToGIS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,r=e.vertexAttributes,n=r.get(g.T.POSITION).data,i=r.get(g.T.NORMAL).data;if(i)for(var a=t.getMutableAttribute(g.T.NORMAL).data,o=0;o<i.length;o+=3){var s=i[o+1];a[o+1]=-i[o+2],a[o+2]=s}if(n)for(var l=t.getMutableAttribute(g.T.POSITION).data,u=0;u<n.length;u+=3){var c=n[u+1];l[u+1]=-n[u+2],l[u+2]=c}return t},e.makeOrthoBasisDirUp=r,e.makeOrthoBasisDirUpFallback=n}(f||(f={}));var _=.99619469809,T=(0,a.c)(),x=f},19962:function(e,t,r){r.d(t,{C1:function(){return _}});var n=r(93433),i=r(15671),a=r(43144),o=r(92026),s=r(95439),l=r(81949),u=r(11186),c=r(71353),d=r(79803),h=r(68401),f=r(74894),p=r(61403),v=r(59887),m=r(4760),g=r(97882),y=r(58901),_=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:125e4;(0,i.Z)(this,e),this._originSR=t,this._gridSize=r,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+(0,s.D)()}return(0,a.Z)(e,[{key:"getOrigin",value:function(e){var t=this._origins.get(this._rootOriginId);if(null==t){if((0,o.pC)(T))return this._origins.set(this._rootOriginId,(0,p.al)(T[0],T[1],T[2],this._rootOriginId)),this.getOrigin(e);var r=(0,p.al)(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}var i=this._gridSize,a=Math.round(e[0]/i),s=Math.round(e[1]/i),l=Math.round(e[2]/i),c="".concat(a,"/").concat(s,"/").concat(l),d=this._origins.get(c),h=.5*i;if((0,u.f)(x,e,t.vec3),x[0]=Math.abs(x[0]),x[1]=Math.abs(x[1]),x[2]=Math.abs(x[2]),x[0]<h&&x[1]<h&&x[2]<h){if(d){var f=Math.max.apply(Math,(0,n.Z)(x));if((0,u.f)(x,e,d.vec3),x[0]=Math.abs(x[0]),x[1]=Math.abs(x[1]),x[2]=Math.abs(x[2]),Math.max.apply(Math,(0,n.Z)(x))<f)return d}return t}return d||(d=(0,p.al)(a*i,s*i,l*i,c),this._origins.set(c,d)),d}},{key:"_drawOriginBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,0,1],r=window.view,n=r._stage,i=t.toString();if(!this._objects.has(i)){this._material=new y.U({width:2,color:t}),n.add(this._material);var a=new g.F({isPickable:!1}),o=new v.T({castShadow:!1});n.add(o),a.add(o),n.add(a),this._objects.set(i,o)}for(var s=this._objects.get(i),u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],c=u.length,p=new Array(3*c),_=new Uint16Array(2*(c-1)),T=.5*this._gridSize,x=0;x<c;x++)p[3*x+0]=e[0]+(1&u[x]?T:-T),p[3*x+1]=e[1]+(2&u[x]?T:-T),p[3*x+2]=e[2]+(4&u[x]?T:-T),x>0&&(_[2*x+0]=x-1,_[2*x+1]=x);(0,d.CM)(p,this._originSR,0,p,r.renderSpatialReference,0,c);var b=new f.Z([[m.T.POSITION,{size:3,data:p,exclusive:!0}]],[[m.T.POSITION,_]],h.MX.Line);n.add(b),s.addGeometry(b,this._material,l.I)}}]),e}(),T=null;var x=(0,c.c)()},81268:function(e,t,r){r.d(t,{Z8:function(){return x},LP:function(){return S}});var n=r(37762),i=r(15671),a=r(43144),o=r(92026),s=r(14226),l=r(81949),u=r(11186),c=r(71353),d=r(90045),h=r(67077),f=r(40885),p=r(50951),v=r(54463);r(82218);function m(e){return(0,o.pC)(e)&&(0,o.pC)(e.dist)}(0,c.c)();var g=r(76783),y=r(32683),_=1e-5,T=function(){function e(t){(0,i.Z)(this,e),this.options=new v.om,this._results=new b,this.transform=new g.yn,this.tolerance=_,this.verticalOffset=null,this._ray=(0,f.Ue)(),this._rayEnd=(0,c.c)(),this._rayBeginTransformed=(0,c.c)(),this._rayEndTransformed=(0,c.c)(),this.viewingMode=null==t?p.JY.Global:t}return(0,a.Z)(e,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}},{key:"reset",value:function(e,t,r){this.resetWithRay((0,f.zk)(e,t,this._ray),r)}},{key:"resetWithRay",value:function(e,t){this.camera=t,e!==this._ray&&(0,f.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===p.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,u.b)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}},{key:"intersect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;this.point=r,this.filterPredicate=a,this.tolerance=null==i?_:i;var l=(0,g.W9)(this.verticalOffset);(0,o.pC)(t)&&t.length>0&&function(){var r,i=s?function(t){s(t)&&e.intersectObject(t)}:function(t){e.intersectObject(t)},a=(0,n.Z)(t);try{for(a.s();!(r=a.n()).done;){var u=r.value,c=u.getSpatialQueryAccelerator&&u.getSpatialQueryAccelerator();(0,o.pC)(c)?((0,o.pC)(l)?c.forEachAlongRayWithVerticalOffset(e._ray.origin,e._ray.direction,i,l):c.forEachAlongRay(e._ray.origin,e._ray.direction,i),e.options.selectionMode&&e.options.hud&&c.forEachDegenerateObject(i)):u.objects.forAll((function(e){return i(e)}))}}catch(d){a.e(d)}finally{a.f()}}(),this.sortResults()}},{key:"intersectObject",value:function(e){var t=this,r=e.geometryRecords;if(r){var i,a=e.transformation,s=(0,g.W9)(this.verticalOffset),c=(0,n.Z)(r);try{var d=function(){var r=i.value,n=r.geometry,c=r.material,d=r.instanceParameters;if((0,y.PD)(d))return"continue";var h=n.id;t.transform.setAndInvalidateLazyTransforms(a,r.getShaderTransformation()),(0,u.m)(t._rayBeginTransformed,t.rayBegin,t.transform.inverse),(0,u.m)(t._rayEndTransformed,t.rayEnd,t.transform.inverse);var f=t.transform.transform;(0,o.pC)(s)&&(s.objectTransform=t.transform),c.intersect(n,d,t.transform.transform,t,t._rayBeginTransformed,t._rayEndTransformed,(function(r,n,i,a,s,u){if(r>=0){if((0,o.pC)(t.filterPredicate)&&!t.filterPredicate(t._ray.origin,t._rayEnd,r))return;if(a){if(null==t._results.hud.dist||r<t._results.hud.dist){var c={object:e,geometryId:h,triangleNr:i,center:u};t._results.hud.set(v.q7.HUD,c,r,n,l.I,s)}return}var d=function(t){return t.set(v.q7.OBJECT,{object:e,geometryId:h,triangleNr:i},r,n,f,s)};if((null==t._results.min.drapedLayerOrder||s>=t._results.min.drapedLayerOrder)&&(null==t._results.min.dist||r<t._results.min.dist)&&d(t._results.min),t.options.store!==v.eC.MIN&&(null==t._results.max.drapedLayerOrder||s<t._results.max.drapedLayerOrder)&&(null==t._results.max.dist||r>t._results.max.dist)&&d(t._results.max),t.options.store===v.eC.ALL){var p=S(t._ray);p.set(v.q7.OBJECT,{object:e,geometryId:h,triangleNr:i},r,n,f),t._results.all.push(p)}}}),r.shaderTransformation)};for(c.s();!(i=c.n()).done;)d()}catch(h){c.e(h)}finally{c.f()}}}},{key:"sortResults",value:function(){this._results.all.sort((function(e,t){return e.dist!==t.dist?(0,o.Pt)(e.dist,0)-(0,o.Pt)(t.dist,0):e.drapedLayerOrder!==t.drapedLayerOrder?(0,o.Pt)(e.drapedLayerOrder,Number.MAX_VALUE)-(0,o.Pt)(t.drapedLayerOrder,Number.MAX_VALUE):(0,o.Pt)(t.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,o.Pt)(e.drapedLayerGraphicOrder,Number.MIN_VALUE)}))}}]),e}();function x(e){return new T(e)}var b=function(){function e(){(0,i.Z)(this,e),this._min=new O((0,f.Ue)()),this._max=new O((0,f.Ue)()),this._hud=new O((0,f.Ue)()),this._ground=new O((0,f.Ue)())}return(0,a.Z)(e,[{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}},{key:"hud",get:function(){return this._hud}},{key:"ground",get:function(){return this._ground}},{key:"init",value:function(e){this._min.init(e),this._max.init(e),this._hud.init(e),this._ground.init(e),this.all=[]}}]),e}(),O=function(){function e(t){(0,i.Z)(this,e),this.intersector=v.q7.OBJECT,this.normal=(0,c.c)(),this.transformation=(0,l.c)(),this._ray=(0,f.Ue)(),this.init(t)}return(0,a.Z)(e,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return(0,o.pC)(this.dist)?((0,u.a)(C,this.ray.direction,this.dist),(0,u.l)(C)):null}},{key:"getIntersectionPoint",value:function(e){return!!m(this)&&((0,u.a)(C,this.ray.direction,this.dist),(0,u.b)(e,this.ray.origin,C),!0)}},{key:"getTransformedNormal",value:function(e){return(0,u.g)(E,this.normal),E[3]=0,(0,d.t)(E,E,this.transformation),(0,u.g)(e,E),(0,u.n)(e,e)}},{key:"init",value:function(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=v.q7.OBJECT,(0,f.JG)(e,this._ray)}},{key:"set",value:function(e,t,r,n,i,a,d){this.intersector=e,this.dist=r,(0,u.g)(this.normal,(0,o.Pt)(n,c.U)),(0,s.c)(this.transformation,(0,o.Pt)(i,l.I)),this.target=t,this.drapedLayerOrder=a,this.drapedLayerGraphicOrder=d}},{key:"copy",value:function(e){(0,f.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,u.g)(this.normal,e.normal),(0,s.c)(this.transformation,e.transformation)}}]),e}();function S(e){return new O(e)}var C=(0,c.c)(),E=(0,h.c)()},54463:function(e,t,r){r.d(t,{eC:function(){return i},om:function(){return s},q7:function(){return n}});var n,i,a=r(43144),o=r(15671);!function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(n||(n={}));var s=(0,a.Z)((function e(){(0,o.Z)(this,e),this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=i.ALL}));!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(i||(i={}))},61403:function(e,t,r){r.d(t,{al:function(){return s}});var n=r(43144),i=r(15671),a=r(71353),o=(0,n.Z)((function e(t,r){(0,i.Z)(this,e),this.vec3=t,this.id=r}));function s(e,t,r,n){return new o((0,a.f)(e,t,r),n)}},78289:function(e,t,r){var n;r.d(t,{$:function(){return n}}),function(e){var t,r;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(r=e.State||(e.State={}))[r.VISIBILITIES=1]="VISIBILITIES",r[r.VERTEXATTRS=2]="VERTEXATTRS",r[r.TRANSFORMATION=4]="TRANSFORMATION",r[r.HIGHLIGHTS=8]="HIGHLIGHTS",r[r.OCCLUDEES=16]="OCCLUDEES"}(n||(n={}))},59887:function(e,t,r){r.d(t,{T:function(){return S}});var n=r(37762),i=r(15671),a=r(43144),o=r(60136),s=r(54062),l=r(92026),u=r(14226),c=r(81949),d=r(11186),h=r(71353),f=r(23470),p=r(80064),v=r(68401),m=r(1395),g=r(79100),y=r(13005),_=r(95439),T=function(){function e(){(0,i.Z)(this,e),this._disposed=!1}return(0,a.Z)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}},{key:"acquire",value:function(e,t,r,n,i,a){this.id=(0,_.D)(),this.geometry=e,this.material=t,this.transformation=r,this.instanceParameters=n,this.origin=i,this._shaderTransformation=a,this._disposed=!1}},{key:"release",value:function(){this._disposed=!1}},{key:"dispose",value:function(){this._disposed=!0}},{key:"getStaticTransformation",value:function(){return this.transformation}},{key:"getShaderTransformation",value:function(){return(0,l.pC)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}},{key:"computeAttachmentOrigin",value:function(e){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,e):this.geometry.computeAttachmentOrigin(e))&&((0,d.m)(e,e,this.getStaticTransformation()),!0)}}]),e}();T.pool=new y.Z(T);var x=r(47669),b=r(97731),O=r(32683),S=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.Z)(this,r),(e=t.call(this)).type=g.U.Object,e._geometryRecords=new Array,e._geometries=new Array,e._objectTransformation=(0,c.c)(),e._bvObjectSpace=new E,e._bvWorldSpace=new E,e._bvDirty=!0,e._hasVolatileTransformation=!1,e._visible=!0,e.castShadow=null==n.castShadow||n.castShadow,e.metadata=n.metadata,e.metadata&&e.metadata.isElevationSource&&(e.metadata.lastValidElevationBB=new C),e.transformation=(0,c.c)();var a=n.geometries,o=n.materials,s=n.transformations,l=n.origins;if(Array.isArray(a)){(0,b.hu)(o.length===a.length,"Object3D: materials don't match geometries"),(0,b.hu)(s.length===a.length,"Object3D: transformations don't match geometries"),e._geometryRecords.length=a.length,e._geometries.length=a.length;for(var u=0;u<a.length;u++)e._geometries[u]=a[u],e._geometryRecords[u]=T.pool.acquire(a[u],o[u],(0,c.b)(s[u]),{highlights:null,occludees:null,visible:e._visible},l&&l[u])}return e}return(0,a.Z)(r,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._objectTransformation},set:function(e){(0,u.c)(this._objectTransformation,e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}},{key:"dispose",value:function(){this._geometryRecords.length=0,this._geometries.length=0}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(e){(0,b.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}},{key:"addGeometry",value:function(e,t,r,n,i){r=r||c.I,this._geometries.push(e);var a=T.pool.acquire(e,t,r,{highlights:null,occludees:null,visible:this._visible},n,i);return this._geometryRecords.push(a),this._hasVolatileTransformation=this._hasVolatileTransformation||(0,l.pC)(a.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:a}),this._invalidateBoundingVolume(),a}},{key:"removeGeometry",value:function(e){var t=this._geometryRecords.splice(e,1)[0];return this._hasVolatileTransformation=(0,l.pC)(t.shaderTransformation)?this._geometryRecords.some((function(e){return(0,l.pC)(e.shaderTransformation)})):this._hasVolatileTransformation,t.dispose(),this._geometries.splice(e,1),this._emit("objectGeometryRemoved",{object:this,record:t}),this._invalidateBoundingVolume(),t}},{key:"removeAllGeometries",value:function(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}},{key:"geometryVertexAttrsUpdated",value:function(e){this._emit("vertexAttrsUpdated",{object:this,record:e}),this._invalidateBoundingVolume()}},{key:"isVisible",get:function(){return this._visible}},{key:"setVisible",value:function(e){if(this._visible!==e){this._visible=e;var t,r=(0,n.Z)(this._geometryRecords);try{for(r.s();!(t=r.n()).done;){t.value.instanceParameters.visible=this._visible}}catch(i){r.e(i)}finally{r.f()}this._emit("visibilityChanged",this)}}},{key:"maskOccludee",value:function(){var e,t=new x.O(v.V_.MaskOccludee),r=(0,n.Z)(this._geometryRecords);try{for(r.s();!(e=r.n()).done;){var i=e.value;i.instanceParameters.occludees=(0,O.lr)(i.instanceParameters.occludees,t)}}catch(a){r.e(a)}finally{r.f()}return this._emit("occlusionChanged",this),t}},{key:"removeOcclude",value:function(e){var t,r=(0,n.Z)(this._geometryRecords);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.instanceParameters.occludees=(0,O.U_)(i.instanceParameters.occludees,e)}}catch(a){r.e(a)}finally{r.f()}this._emit("occlusionChanged",this)}},{key:"highlight",value:function(){var e,t=new x.O(v.V_.Highlight),r=(0,n.Z)(this._geometryRecords);try{for(r.s();!(e=r.n()).done;){var i=e.value;i.instanceParameters.highlights=(0,O.lr)(i.instanceParameters.highlights,t)}}catch(a){r.e(a)}finally{r.f()}return this._emit("highlightChanged",this),t}},{key:"removeHighlight",value:function(e){var t,r=(0,n.Z)(this._geometryRecords);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.instanceParameters.highlights=(0,O.U_)(i.instanceParameters.highlights,e)}}catch(a){r.e(a)}finally{r.f()}this._emit("highlightChanged",this)}},{key:"getCombinedStaticTransformation",value:function(e,t){return(0,u.m)((0,l.Pt)(t,(0,c.c)()),this.transformation,e.getStaticTransformation())}},{key:"_getCombinedShaderTransformation",value:function(e,t){return t=t||(0,c.c)(),(0,u.m)(t,this.transformation,e.getShaderTransformation()),t}},{key:"hasVolativeTransformation",value:function(){return this._hasVolatileTransformation}},{key:"boundingVolumeWorldSpace",get:function(){return this._validateBoundingVolume(),this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){return this._validateBoundingVolume(),this._bvObjectSpace}},{key:"_validateBoundingVolume",value:function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init(),this._bvWorldSpace.init();for(var e=0;e<this._geometryRecords.length;++e){var t=this._geometries[e],r=this._geometryRecords[e],n=t.boundingInfo;(0,l.pC)(n)&&(this._calculateTransformedBoundingVolume(n,this._bvObjectSpace,r.getShaderTransformation()),this._calculateTransformedBoundingVolume(n,this._bvWorldSpace,this._getCombinedShaderTransformation(r)))}(0,d.e)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,d.e)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);for(var i=(0,h.c)(),a=(0,h.c)(),o=(0,p.u1)(this.transformation),s=0;s<this._geometryRecords.length;++s){var u=this._geometries[s].boundingInfo;if(!(0,l.Wi)(u)){var c=this._geometryRecords[s].getShaderTransformation(),f=(0,p.u1)(c);(0,d.m)(i,u.getCenter(),c);var v=(0,d.i)(i,this._bvObjectSpace.bounds),m=u.getBSRadius()*f;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],v+m),(0,d.m)(a,i,this.transformation);var g=(0,d.i)(a,this._bvWorldSpace.bounds),y=m*o;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],g+y)}}this._bvDirty=!1}}},{key:"_calculateTransformedBoundingVolume",value:function(e,t,r){var n=e.getBBMin(),i=e.getBBMax(),a=(0,h.a)(n),o=(0,h.a)(i);(0,d.m)(a,a,r),(0,d.m)(o,o,r);for(var s=0;s<3;++s)t.min[s]=Math.min(t.min[s],a[s],o[s]),t.max[s]=Math.max(t.max[s],a[s],o[s]);for(var l=0;l<3;++l){(0,d.g)(a,n),(0,d.g)(o,i),a[l]=i[l],o[l]=n[l],(0,d.m)(a,a,r),(0,d.m)(o,o,r);for(var u=0;u<3;++u)t.min[u]=Math.min(t.min[u],a[u],o[u]),t.max[u]=Math.max(t.max[u],a[u],o[u])}}},{key:"_invalidateBoundingVolume",value:function(){this._bvDirty=!0,(0,l.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}},{key:"_emit",value:function(e,t){(0,l.pC)(this._parentLayer)&&this._parentLayer.events.emit(e,t)}},{key:"test",get:function(){var e=this;return{hasGeometry:function(t){return e._geometries.indexOf(t)>-1},getGeometryIndex:function(t){return e._geometries.indexOf(t)}}}}]),r}(m.c),C=function(){function e(){(0,i.Z)(this,e),this.min=(0,h.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,h.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}return(0,a.Z)(e,[{key:"isEmpty",value:function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}]),e}(),E=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).bounds=(0,f.c)(),e}return(0,a.Z)(r,[{key:"init",value:function(){(0,d.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,d.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,f.a)(this.bounds)}}]),r}(C)},47669:function(e,t,r){r.d(t,{O:function(){return o}});var n=r(43144),i=r(15671),a=r(95439),o=(0,n.Z)((function e(t){(0,i.Z)(this,e),this.channel=t,this.id=(0,a.D)()}))},78329:function(e,t,r){r.d(t,{F:function(){return n},Z:function(){return m}});var n,i=r(37762),a=r(15671),o=r(43144),s=r(92026),l=r(13005),u=r(27546),c=r(11186),d=r(71353),h=r(95773),f=r(40885),p=r(23470),v=r(97731),m=function(){function e(t,r){(0,a.Z)(this,e),this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new g,this._objectCount=0,r&&(void 0!==r.maximumObjectsPerNode&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),void 0!==r.maximumDepth&&(this._maximumDepth=r.maximumDepth))}return(0,o.Z)(e,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}},{key:"destroy",value:function(){this._degenerateObjects.clear(),g.clearPool(),w[0]=null,H.prune(),U.prune()}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;this._objectCount+=t,this._grow(e,t);for(var r=g.acquire(),n=0;n<t;n++){var i=e[n];this._isDegenerate(i)?this._degenerateObjects.add(i):(r.init(this._root),this._add(i,r))}g.release(r)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._objectCount-=e.length;var r,n=g.acquire(),a=(0,i.Z)(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,l=(0,s.pC)(t)?t:(0,p.b)(this._objectToBoundingSphere(o),N);C(l[3])?(n.init(this._root),this._remove(o,l,n)):this._degenerateObjects.delete(o)}}catch(u){a.e(u)}finally{a.f()}g.release(n),this._shrink()}},{key:"update",value:function(e,t){if(C(t[3])||!this._isDegenerate(e)){var r=function(e){return w[0]=e,w}(e);this.remove(r,t),this.add(r)}}},{key:"forEachAlongRay",value:function(e,t,r){var n=this,i=(0,f.re)(e,t);this._forEachNode(this._root,(function(e){if(!n._intersectsNode(i,e))return!1;var t=e.node;return t.terminals.forAll((function(e){n._intersectsObject(i,e)&&r(e)})),null!==t.residents&&t.residents.forAll((function(e){n._intersectsObject(i,e)&&r(e)})),!0}))}},{key:"forEachAlongRayWithVerticalOffset",value:function(e,t,r,n){var i=this,a=(0,f.re)(e,t);this._forEachNode(this._root,(function(e){if(!i._intersectsNodeWithOffset(a,e,n))return!1;var t=e.node;return t.terminals.forAll((function(e){i._intersectsObjectWithOffset(a,e,n)&&r(e)})),null!==t.residents&&t.residents.forAll((function(e){i._intersectsObjectWithOffset(a,e,n)&&r(e)})),!0}))}},{key:"forEach",value:function(e){this._forEachNode(this._root,(function(t){var r=t.node;return r.terminals.forAll(e),null!==r.residents&&r.residents.forAll(e),!0})),this._degenerateObjects.forEach(e)}},{key:"forEachDegenerateObject",value:function(e){this._degenerateObjects.forEach(e)}},{key:"findClosest",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return!0},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=1/0,s=1/0,l=null,u=O(e,t),d=function(u){if(--a,i(u)){var c=n._objectToBoundingSphere(u);if((0,h.hr)(r,c)){var d=S(e,t,(0,p.g)(c)),f=d-c[3],v=d+c[3];f<o&&(o=f,s=v,l=u)}}};return this._forEachNodeDepthOrdered(this._root,(function(n){if(a<=0||!(0,h.hr)(r,n.bounds))return!1;if((0,c.a)(I,u,n.halfSize),(0,c.b)(I,I,n.bounds),S(e,t,I)>s)return!1;var i=n.node;return i.terminals.forAll((function(e){return d(e)})),null!==i.residents&&i.residents.forAll((function(e){return d(e)})),!0}),e,t),l}},{key:"forEachInDepthRange",value:function(e,t,r,i,a,o,s){var l=this,u=-1/0,d=1/0,f={setRange:function(e){r===n.FRONT_TO_BACK?(u=Math.max(u,e.near),d=Math.min(d,e.far)):(u=Math.max(u,-e.far),d=Math.min(d,-e.near))}};f.setRange(i);var v=S(t,r,e),m=O(t,r),g=O(t,-r),y=function(e){if(s(e)){var n=l._objectToBoundingSphere(e),i=(0,p.g)(n),c=S(t,r,i)-v,m=c-n[3],g=c+n[3];m>d||g<u||!(0,h.hr)(o,n)||a(e,f)}};this._forEachNodeDepthOrdered(this._root,(function(e){if(!(0,h.hr)(o,e.bounds))return!1;if((0,c.a)(I,m,e.halfSize),(0,c.b)(I,I,e.bounds),S(t,r,I)-v>d)return!1;if((0,c.a)(I,g,e.halfSize),(0,c.b)(I,I,e.bounds),S(t,r,I)-v<u)return!1;var n=e.node;return n.terminals.forAll((function(e){return y(e)})),null!==n.residents&&n.residents.forAll((function(e){return y(e)})),!0}),t,r)}},{key:"forEachNode",value:function(e){this._forEachNode(this._root,(function(t){return e(t.node,t.bounds,t.halfSize)}))}},{key:"_intersectsNode",value:function(e,t){return T(t.bounds,2*-t.halfSize,D),T(t.bounds,2*t.halfSize,M),(0,v.yK)(e.origin,e.direction,D,M)}},{key:"_intersectsNodeWithOffset",value:function(e,t,r){return T(t.bounds,2*-t.halfSize,D),T(t.bounds,2*t.halfSize,M),r.applyToMinMax(D,M),(0,v.yK)(e.origin,e.direction,D,M)}},{key:"_intersectsObject",value:function(e,t){var r=this._objectToBoundingSphere(t);return!(r[3]>0)||(0,p.i)(r,e)}},{key:"_intersectsObjectWithOffset",value:function(e,t,r){var n=this._objectToBoundingSphere(t);return!(n[3]>0)||(0,p.i)(r.applyToBoundingSphere(n),e)}},{key:"_forEachNode",value:function(e,t){for(var r=g.acquire().init(e),n=[r];0!==n.length;){if(t(r=n.pop())&&!r.isLeaf())for(var i=0;i<r.node.children.length;i++)r.node.children[i]&&n.push(g.acquire().init(r).advance(i));g.release(r)}}},{key:"_forEachNodeDepthOrdered",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.FRONT_TO_BACK,a=g.acquire().init(e),o=[a];for(b(r,i,z);0!==o.length;){if(t(a=o.pop())&&!a.isLeaf())for(var s=7;s>=0;--s){var l=z[s];a.node.children[l]&&o.push(g.acquire().init(a).advance(l))}g.release(a)}}},{key:"_remove",value:function(e,t,r){H.clear();var n=r.advanceTo(t,(function(e,t){H.push(e.node),H.push(t)}))?r.node.terminals:r.node.residents;if(n.removeUnordered(e),0===n.length)for(var i=H.length-2;i>=0;i-=2){var a=H.data[i],o=H.data[i+1];if(!this._purge(a,o))break}}},{key:"_nodeIsEmpty",value:function(e){if(0!==e.terminals.length)return!1;if(null!==e.residents)return 0===e.residents.length;for(var t=0;t<e.children.length;t++)if(e.children[t])return!1;return!0}},{key:"_purge",value:function(e,t){return t>=0&&(e.children[t]=null),!!this._nodeIsEmpty(e)&&(null===e.residents&&(e.residents=new u.Z({shrink:!0})),!0)}},{key:"_add",value:function(e,t){t.advanceTo(this._objectToBoundingSphere(e))?t.node.terminals.push(e):(t.node.residents.push(e),t.node.residents.length>this._maximumObjectsPerNode&&t.depth<this._maximumDepth&&this._split(t))}},{key:"_split",value:function(e){var t=e.node.residents;e.node.residents=null;for(var r=0;r<t.length;r++){var n=g.acquire().init(e);this._add(t.getItemAt(r),n),g.release(n)}}},{key:"_grow",value:function(e,t){var r=this;if(0!==t&&(x(e,t,(function(e){return r._objectToBoundingSphere(e)}),Z),C(Z[3])&&!this._fitsInsideTree(Z)))if(this._nodeIsEmpty(this._root.node))(0,p.b)(Z,this._root.bounds),this._root.halfSize=1.25*Z[3];else{var n=this._rootBoundsForRootAsSubNode(Z);this._placingRootViolatesMaxDepth(n)?this._rebuildTree(Z,n):this._growRootAsSubNode(n),g.release(n)}}},{key:"_rebuildTree",value:function(e,t){var r=this;(0,c.g)(L,t.bounds),L[3]=t.halfSize,x([e,L],2,(function(e){return e}),F);var n=g.acquire().init(this._root);this._root.initFrom(null,F,1.25*F[3]),this._forEachNode(n,(function(e){return r.add(e.node.terminals.data,e.node.terminals.length),null!==e.node.residents&&r.add(e.node.residents.data,e.node.residents.length),!0})),g.release(n)}},{key:"_placingRootViolatesMaxDepth",value:function(e){var t=this,r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E,n=0;return this._forEachNode(this._root,(function(e){return(n=Math.max(n,e.depth))+r<=t._maximumDepth})),n+r>this._maximumDepth}},{key:"_rootBoundsForRootAsSubNode",value:function(e){for(var t=e[3],r=e,n=-1/0,i=this._root.bounds,a=this._root.halfSize,o=0;o<3;o++){var s=i[o]-a-(r[o]-t),l=r[o]+t-(i[o]+a),u=Math.max(0,Math.ceil(s/(2*a))),c=Math.max(0,Math.ceil(l/(2*a)))+1,d=Math.pow(2,Math.ceil(Math.log(u+c)*Math.LOG2E));n=Math.max(n,d),k[o].min=u,k[o].max=c}for(var h=0;h<3;h++){var f=k[h].min,p=k[h].max,v=(n-(f+p))/2;f+=Math.ceil(v),p+=Math.floor(v);var m=i[h]-a-f*a*2;P[h]=m+(p+f)*a}return P[3]=n*a*R,g.acquire().initFrom(null,P,n*a,0)}},{key:"_growRootAsSubNode",value:function(e){var t=this._root.node;(0,c.g)(Z,this._root.bounds),Z[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Z,null,!0),e.node.children=t.children,e.node.residents=t.residents,e.node.terminals=t.terminals}},{key:"_shrink",value:function(){for(;;){var e=this._findShrinkIndex();if(-1===e)break;this._root.advance(e),this._root.depth=0}}},{key:"_findShrinkIndex",value:function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var e=null,t=this._root.node.children,r=0,n=0;n<t.length&&null==e;)e=t[r=n++];for(;n<t.length;)if(t[n++])return-1;return r}},{key:"_isDegenerate",value:function(e){return!C(this._objectToBoundingSphere(e)[3])}},{key:"_fitsInsideTree",value:function(e){var t=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=t[0]-r&&e[0]<=t[0]+r&&e[1]>=t[1]-r&&e[1]<=t[1]+r&&e[2]>=t[2]-r&&e[2]<=t[2]+r}}]),e}(),g=function(){function e(){(0,a.Z)(this,e),this.bounds=(0,p.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}return(0,o.Z)(e,[{key:"init",value:function(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}},{key:"initFrom",value:function(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.depth;return this.node=(0,s.pC)(t)?t:e.createEmptyNode(),(0,s.pC)(r)&&(0,p.b)(r,this.bounds),this.halfSize=n,this.depth=i,this}},{key:"advance",value:function(t){var r=this.node.children[t];r||(r=e.createEmptyNode(),this.node.children[t]=r),this.node=r,this.halfSize/=2,this.depth++;var n=E[t];return this.bounds[0]+=n[0]*this.halfSize,this.bounds[1]+=n[1]*this.halfSize,this.bounds[2]+=n[2]*this.halfSize,this.bounds[3]=this.halfSize*R,this}},{key:"advanceTo",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];;){if(this.isTerminalFor(e))return t&&t(this,-1),!0;if(this.isLeaf()){if(!r)return t&&t(this,-1),!1;this.node.residents=null}var n=this._childIndex(e);t&&t(this,n),this.advance(n)}}},{key:"isLeaf",value:function(){return null!=this.node.residents}},{key:"isTerminalFor",value:function(e){return e[3]>this.halfSize/2}},{key:"_childIndex",value:function(e){var t=this.bounds;return(t[0]<e[0]?1:0)+(t[1]<e[1]?2:0)+(t[2]<e[2]?4:0)}}],[{key:"createEmptyNode",value:function(){return{children:[null,null,null,null,null,null,null,null],terminals:new u.Z({shrink:!0}),residents:new u.Z({shrink:!0})}}},{key:"acquire",value:function(){return e._pool.acquire()}},{key:"release",value:function(t){e._pool.release(t)}},{key:"clearPool",value:function(){e._pool.prune()}}]),e}();function y(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function _(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function T(e,t,r){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function x(e,t,r,n){if(1===t){var i=r(e[0]);(0,p.b)(i,n)}else{D[0]=1/0,D[1]=1/0,D[2]=1/0,M[0]=-1/0,M[1]=-1/0,M[2]=-1/0;for(var a=0;a<t;a++){var o=r(e[a]);C(o[3])&&(y(D,o),_(M,o))}(0,c.e)(n,D,M,.5),n[3]=Math.max(M[0]-D[0],M[1]-D[1],M[2]-D[2])/2}}function b(e,t,r){if(!U.length)for(var n=0;n<8;++n)U.push({index:0,distance:0});for(var i=0;i<8;++i){var a=E[i];U.data[i].index=i,U.data[i].distance=S(e,t,a)}U.sort((function(e,t){return e.distance-t.distance}));for(var o=0;o<8;++o)r[o]=U.data[o].index}function O(e,t){for(var r=1/0,n=null,i=0;i<8;++i){var a=S(e,t,A[i]);a<r&&(r=a,n=A[i])}return n}function S(e,t,r){return t*(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])}function C(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}g._pool=new l.Z(g),function(e){e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(n||(n={}));var E=[(0,d.f)(-1,-1,-1),(0,d.f)(1,-1,-1),(0,d.f)(-1,1,-1),(0,d.f)(1,1,-1),(0,d.f)(-1,-1,1),(0,d.f)(1,-1,1),(0,d.f)(-1,1,1),(0,d.f)(1,1,1)],A=[(0,d.f)(-1,-1,-1),(0,d.f)(-1,-1,1),(0,d.f)(-1,1,-1),(0,d.f)(-1,1,1),(0,d.f)(1,-1,-1),(0,d.f)(1,-1,1),(0,d.f)(1,1,-1),(0,d.f)(1,1,1)],R=Math.sqrt(3),w=[null];var P=(0,p.c)(),I=(0,d.c)(),D=(0,d.c)(),M=(0,d.c)(),H=new u.Z,N=(0,p.c)(),Z=(0,p.c)(),L=(0,p.c)(),F=(0,p.c)(),k=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],U=new u.Z,z=[0,0,0,0,0,0,0,0]},69831:function(e,t,r){r.d(t,{z:function(){return y}});var n=r(15671),i=r(43144),a=r(92026),o=r(95439),s=r(14226),l=r(81949),u=r(11186),c=r(67077),d=r(80064),h=r(68401),f=r(81935),p=(0,i.Z)((function e(){(0,n.Z)(this,e),this.visible=!0})),v=r(47669),m=r(4760),g=r(32683),y=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,n.Z)(this,e),this.data=t,this.material=r,this.boundingSphere=(0,c.c)(),this.instanceParameters=new p,this._transformation=(0,l.c)(),this._shaderTransformationDirty=!0,this.layerUid=(0,a.Pt)(i.layerUid,null),this.graphicUid=(0,a.Pt)(i.graphicUid,null),this.id=i.id?i.id:(0,o.D)(),this.boundingInfo=(0,a.Pt)(i.boundingInfo,null),this.calculateShaderTransformation=(0,a.Pt)(this.calculateShaderTransformation,null),this.castShadow=!!i.castShadow&&i.castShadow}return(0,i.Z)(e,[{key:"transformation",get:function(){return this._transformation}},{key:"updateTransformation",value:function(e){e(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}},{key:"shaderTransformationChanged",value:function(){this._shaderTransformationDirty=!0}},{key:"computeBoundingSphere",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,d.u1)(e);(0,a.Wi)(this.boundingInfo)||((0,u.m)(t,this.boundingInfo.getCenter(),e),t[3]=this.boundingInfo.getBSRadius()*r)}},{key:"hasShaderTransformation",get:function(){return(0,a.pC)(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"getShaderTransformation",value:function(){return(0,a.Wi)(this.calculateShaderTransformation)?(0,a.Pt)(this.transformation,l.I):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,l.c)()),(0,s.c)(this._shaderTransformation,this.calculateShaderTransformation((0,a.Pt)(this.transformation,l.I))),this._shaderTransformationDirty=!1),this._shaderTransformation)}},{key:"computeAttachmentOrigin",value:function(e){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,e)&&((0,a.pC)(this._transformation)&&(0,u.m)(e,e,this._transformation),!0);var t=this.indices.get(m.T.POSITION),r=this.vertexAttributes.get(m.T.POSITION);return!!(0,f.cM)(r,t,e)&&((0,a.pC)(this._transformation)&&(0,u.m)(e,e,this._transformation),!0)}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}},{key:"addHighlight",value:function(){var e=new v.O(h.V_.Highlight),t=this.instanceParameters;return t.highlights=(0,g.lr)(t.highlights,e),e}},{key:"removeHighlight",value:function(e){var t=this.instanceParameters;t.highlights=(0,g.U_)(t.highlights,e)}}]),e}()},97882:function(e,t,r){r.d(t,{F:function(){return g}});var n=r(37762),i=r(15671),a=r(43144),o=r(60136),s=r(54062),l=r(91505),u=r(100),c=r(92026),d=r(27546),h=r(68401),f=r(1395),p=r(79100),v=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"],m=r(78329),g=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n,a,o,s,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,i.Z)(this,r),(n=t.call(this)).apiLayerUid=c,n.type=p.U.Layer,n.events=new l.Z,n.isSliceable=!1,n._objects=new d.Z,n._stageHandles=new u.Z,n.apiLayerUid=c,n.isVisible=null==(a=null==e?void 0:e.isVisible)||a,n.isPickable=null==(o=null==e?void 0:e.isPickable)||o,n.updatePolicy=null!=(s=null==e?void 0:e.updatePolicy)?s:h.jq.ASYNC,n}return(0,a.Z)(r,[{key:"objects",get:function(){return this._objects}},{key:"destroy",value:function(){this.detachStage(),this._stage=null}},{key:"attachStage",value:function(e){var t=this;this.detachStage(),this._stage=e;var r,i=(0,n.Z)(v);try{var a=function(){var n=r.value;t._stageHandles.add(t.events.on(n,(function(t){return e.handleEvent(n,t)})))};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}}},{key:"detachStage",value:function(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}},{key:"add",value:function(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),(0,c.pC)(this._octree)&&this._octree.add([e])}},{key:"remove",value:function(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),(0,c.pC)(this._octree)&&this._octree.remove([e]))}},{key:"addMany",value:function(e){this._objects.pushArray(e);var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){t.value.parentLayer=this}}catch(i){r.e(i)}finally{r.f()}this.events.emit("layerObjectsAdded",{layer:this,objects:e}),(0,c.pC)(this._octree)&&this._octree.add(e)}},{key:"removeMany",value:function(e){var t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){var r,i=(0,n.Z)(t);try{for(i.s();!(r=i.n()).done;){r.value.parentLayer=null}}catch(a){i.e(a)}finally{i.f()}this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),(0,c.pC)(this._octree)&&this._octree.remove(t)}}},{key:"sync",value:function(){(0,c.pC)(this._stage)&&this.updatePolicy!==h.jq.SYNC&&this._stage.syncLayer(this.id)}},{key:"notifyObjectBBChanged",value:function(e,t){(0,c.pC)(this._octree)&&this._octree.update(e,t)}},{key:"getSpatialQueryAccelerator",value:function(){return(0,c.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}},{key:"shaderTransformationChanged",value:function(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}},{key:"invalidateSpatialQueryAccelerator",value:function(){this._octree=(0,c.SC)(this._octree)}},{key:"_createOctree",value:function(){this._octree=new m.Z((function(e){return e.boundingVolumeWorldSpace.bounds})),this._octree.add(this._objects.data,this._objects.length)}}]),r}(f.c)},74818:function(e,t,r){r.d(t,{E:function(){return N}});var n=r(1413),i=r(15671),a=r(43144),o=r(60136),s=r(54062),l=r(71011),u=r(68401),c=r(23620),d=r(94425),h=r(56529),f=r(78041),p=r(93822),v=r(64226),m=r(22909),g=r(11752),y=r(61120),_=r(27366),T=r(33280),x=r(137),b=r(15226),O=r(41012),S=r(82144),C=r(31132),E=r(33559),A=r(7566),R=r(27627),w=r(50411),P=r(45028),I=r(36207),D=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,i=t.build({output:n.output,oitEnabled:n.transparencyPassType===u.Am.Color,attributeColor:n.vertexColors,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new R.$(e.rctx,i,A.i)}},{key:"bindPass",value:function(e,t){(0,O.II)(this.program,t.camera.projectionMatrix),this.program.setUniform4fv("eColor",e.color),this.configuration.output===l.H.Highlight&&(0,x.wW)(this.program,t),(this.configuration.output===l.H.Depth||t.multipassTerrainEnabled)&&this.program.setUniform2fv("nearFar",t.camera.nearFar),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,b.p)(this.program,t))}},{key:"bindDraw",value:function(e){(0,O.id)(this.program,e),this.program.rebindTextures(),(0,T.DA)(this.program,this.configuration,e)}},{key:"_createPipeline",value:function(e,t){var r=this.configuration,n=e===u.Am.NONE,i=e===u.Am.FrontFace;return(0,I.sm)({blending:r.output!==l.H.Color&&r.output!==l.H.Alpha||!r.transparent?null:n?f.wu:(0,f.j7)(e),culling:(0,I.zp)(r.cullFace),depthTest:{func:(0,f.Bh)(e)},depthWrite:n||i?r.writeDepth&&I.LZ:null,colorWrite:I.BK,stencilWrite:r.sceneHasOcludees?w.s3:null,stencilTest:r.sceneHasOcludees?t?w.eD:w.RY:null,polygonOffset:n||i?r.polygonOffset&&M:(0,f.je)(r.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,g.Z)((0,y.Z)(r.prototype),"getPipelineState",this).call(this,e,t)}}]),r}(C.A);D.shader=new S.J(P.C,(function(){return r.e(3173).then(r.bind(r,23173))}));var M={factor:1,units:1},H=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).output=l.H.Color,e.cullFace=u.Vr.None,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.polygonOffset=!1,e.enableOffset=!0,e.writeDepth=!0,e.sceneHasOcludees=!1,e.transparencyPassType=u.Am.NONE,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,a.Z)(r)}(E.m);(0,_._)([(0,E.o)({count:l.H.COUNT})],H.prototype,"output",void 0),(0,_._)([(0,E.o)({count:u.Vr.COUNT})],H.prototype,"cullFace",void 0),(0,_._)([(0,E.o)()],H.prototype,"slicePlaneEnabled",void 0),(0,_._)([(0,E.o)()],H.prototype,"vertexColors",void 0),(0,_._)([(0,E.o)()],H.prototype,"transparent",void 0),(0,_._)([(0,E.o)()],H.prototype,"polygonOffset",void 0),(0,_._)([(0,E.o)()],H.prototype,"enableOffset",void 0),(0,_._)([(0,E.o)()],H.prototype,"writeDepth",void 0),(0,_._)([(0,E.o)()],H.prototype,"sceneHasOcludees",void 0),(0,_._)([(0,E.o)({count:u.Am.COUNT})],H.prototype,"transparencyPassType",void 0),(0,_._)([(0,E.o)()],H.prototype,"multipassTerrainEnabled",void 0),(0,_._)([(0,E.o)()],H.prototype,"cullAboveGround",void 0);var N=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e,L)).supportsEdges=!0,n.techniqueConfig=new H,n}return(0,a.Z)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.vertexColors=this.parameters.vertexColors,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<f.ve,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"intersect",value:function(e,t,r,n,i,a,o){(0,m.Bw)(e,t,n,i,a,void 0,o)}},{key:"requiresSlot",value:function(e,t){return e===p.r.DRAPED_MATERIAL||((0,d.S)(t)===l.H.Highlight?e===p.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:p.r.OPAQUE_MATERIAL))}},{key:"createGLMaterial",value:function(e){return e.output===l.H.Color||e.output===l.H.Alpha||e.output===l.H.Highlight||e.output===l.H.Depth&&this.parameters.writeLinearDepth?new Z(e):null}},{key:"createBufferWriter",value:function(){return new v.G_(v.IM)}}]),r}(h.F5),Z=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"updateParameters",value:function(e){return this.ensureTechnique(D,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==l.H.Color&&this._output!==l.H.Alpha||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),r}(c.Z),L=(0,n.Z)({color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:u.Vr.None,sceneHasOcludees:!1},h.mo)},9992:function(e,t,r){r.d(t,{A:function(){return ne}});var n=r(1413),i=r(15671),a=r(43144),o=r(60136),s=r(54062),l=r(16889),u=r(92026),c=r(17842),d=r(22753),h=r(11873),f=r(14226),p=r(81949),v=r(88396),m=r(6394),g=r(11186),y=r(71353);function _(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var T=r(65156),x=r(55158),b=r(71011),O=r(50600),S=r(81935),C=r(40485),E=r(56529),A=r(93822),R=r(65216),w=r(97731),P=r(4760),I=r(33236),D=r(22909),M=r(32683),H=r(18442),N=r(27366),Z=r(33280),L=r(49223),F=r(137),k=r(43565),U=r(15226),z=r(18607),V=r(62993),j=r(41012),G=r(82144),B=r(31132),W=r(33559),q=r(68401),J=r(7566),X=r(78041),Y=r(27627),K=r(8548),$=r(36207),Q=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,i=t.build({output:n.output,frontFacePass:n.transparencyPassType===q.Am.FrontFace,viewingMode:e.viewingMode,occlusionTestEnabled:n.occlusionTestEnabled,signedDistanceFieldEnabled:n.sdf,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawLabelBorder:n.debugDrawLabelBorder,binaryHighlightOcclusionEnabled:n.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:n.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:n.screenSizePerspective,verticalOffsetEnabled:n.verticalOffset,pixelSnappingEnabled:n.pixelSnappingEnabled,vvSize:n.vvSize,vvColor:n.vvColor,vvInstancingEnabled:!1,isDraped:n.isDraped,multipassGeometryEnabled:n.multipassGeometryEnabled,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Y.$(e.rctx,i,J.i)}},{key:"bindPass",value:function(e,t){(0,j.II)(this.program,t.camera.projectionMatrix),this.program.setUniform1f("cameraGroundRelative",t.camera.aboveGround?1:-1),this.program.setUniform1f("perDistancePixelRatio",Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)),this.program.setUniformMatrix4fv("viewNormal",t.camera.viewInverseTransposeMatrix),this.program.setUniform1f("polygonOffset",e.shaderPolygonOffset),(0,L.Mo)(this.program,e,t),(0,V.y)(this.program,e),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio||1),(0,j.yJ)(this.program,t),this.configuration.output===b.H.Occlusion?(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,k.l)(this.program,t),(0,U.p)(this.program,t)):((0,O.HG)(this.program,t),(0,H.b)(this.program,e,t.camera.pixelRatio||1),(0,z.kz)(this.program,e),this.configuration.occlusionTestEnabled&&this.program.bindTexture(t.hudVisibilityTexture,"hudVisibilityTexture")),this.configuration.output===b.H.Highlight&&(0,F.wW)(this.program,t)}},{key:"bindDraw",value:function(e){(0,j.id)(this.program,e),(0,j.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,Z.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"_setPipelineState",value:function(e){var t=this.configuration,r=e===q.Am.NONE,n=e===q.Am.FrontFace,i=K.wb.LEQUAL,a=this.configuration.polygonOffsetEnabled&&ee,o=(r||n)&&t.output!==b.H.Highlight?(t.depthEnabled||t.output===b.H.Occlusion)&&$.LZ:null;return(0,$.sm)({blending:t.output===b.H.Color||t.output===b.H.Alpha||t.output===b.H.Highlight?r?te:(0,X.j7)(e):null,depthTest:{func:i},depthWrite:o,colorWrite:$.BK,polygonOffset:a})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return this.configuration.output===b.H.Occlusion?K.MX.POINTS:K.MX.TRIANGLES}}]),r}(B.A);Q.shader=new G.J(H.H,(function(){return r.e(6823).then(r.bind(r,16823))}));var ee={factor:0,units:-4},te=(0,$.if)(K.zi.ONE,K.zi.ONE_MINUS_SRC_ALPHA),re=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).output=b.H.Color,e.occlusionTestEnabled=!0,e.sdf=!1,e.vvSize=!1,e.vvColor=!1,e.verticalOffset=!1,e.screenSizePerspective=!1,e.screenCenterOffsetUnitsEnabled=O.d9.World,e.debugDrawLabelBorder=!1,e.binaryHighlightOcclusion=!0,e.slicePlaneEnabled=!1,e.polygonOffsetEnabled=!1,e.depthEnabled=!0,e.transparencyPassType=q.Am.NONE,e.pixelSnappingEnabled=!0,e.isDraped=!1,e.multipassGeometryEnabled=!1,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,a.Z)(r)}(W.m);(0,N._)([(0,W.o)({count:b.H.COUNT})],re.prototype,"output",void 0),(0,N._)([(0,W.o)()],re.prototype,"occlusionTestEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"sdf",void 0),(0,N._)([(0,W.o)()],re.prototype,"vvSize",void 0),(0,N._)([(0,W.o)()],re.prototype,"vvColor",void 0),(0,N._)([(0,W.o)()],re.prototype,"verticalOffset",void 0),(0,N._)([(0,W.o)()],re.prototype,"screenSizePerspective",void 0),(0,N._)([(0,W.o)({count:O.d9.COUNT})],re.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"debugDrawLabelBorder",void 0),(0,N._)([(0,W.o)()],re.prototype,"binaryHighlightOcclusion",void 0),(0,N._)([(0,W.o)()],re.prototype,"slicePlaneEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"polygonOffsetEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"depthEnabled",void 0),(0,N._)([(0,W.o)({count:q.Am.COUNT})],re.prototype,"transparencyPassType",void 0),(0,N._)([(0,W.o)()],re.prototype,"pixelSnappingEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"isDraped",void 0),(0,N._)([(0,W.o)()],re.prototype,"multipassGeometryEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"multipassTerrainEnabled",void 0),(0,N._)([(0,W.o)()],re.prototype,"cullAboveGround",void 0);var ne=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e,Ce)).techniqueConfig=new re,n}return(0,a.Z)(r,[{key:"getTechniqueConfig",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.verticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.screenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?O.d9.Screen:O.d9.World,this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.sdf=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,e===b.H.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),e===b.H.Highlight&&(this.techniqueConfig.binaryHighlightOcclusion=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassGeometryEnabled=t.multipassGeometryEnabled,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,r,n,i,a,o,s,l){(0,u.pC)(l)?this._intersectDrapedHudGeometry(e,a,o,s,l):this._intersectHudGeometry(e,t,r,n,o,s)}},{key:"_intersectDrapedHudGeometry",value:function(e,t,r,n,i){var a=e.vertexAttributes.get(P.T.POSITION),o=e.vertexAttributes.get(P.T.SIZE),s=this.parameters,l=(0,H.c)(s),c=1,d=1;if((0,u.pC)(n)){var h=n(Te);c=h[0],d=h[5]}c*=e.screenToWorldRatio,d*=e.screenToWorldRatio;for(var f=be*e.screenToWorldRatio,p=0;p<a.data.length/a.size;p++){var v=p*a.size,m=a.data[v],g=a.data[v+1],y=p*o.size,_=void 0;Oe[0]=o.data[y]*c,Oe[1]=o.data[y+1]*d,s.textureIsSignedDistanceField&&(_=s.outlineSize*e.screenToWorldRatio/2),se(t,m,g,Oe,f,_,s,l)&&r(i.dist,i.normal,-1,!0)}}},{key:"_intersectHudGeometry",value:function(e,t,r,n,i,a){if(n.options.selectionMode&&n.options.hud&&!(0,M.PD)(t)){var o=this.parameters,s=1,l=1;if((0,d.f)(ve,r),(0,u.pC)(a)){var c=a(Te);s=c[0],l=c[5],function(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=1/Math.sqrt(t*t+r*r+n*n),d=1/Math.sqrt(i*i+a*a+o*o),h=1/Math.sqrt(s*s+l*l+u*u);e[0]=t*c,e[1]=r*c,e[2]=n*c,e[3]=i*d,e[4]=a*d,e[5]=o*d,e[6]=s*h,e[7]=l*h,e[8]=u*h}(ve)}var h=e.vertexAttributes.get(P.T.POSITION),p=e.vertexAttributes.get(P.T.SIZE),v=e.vertexAttributes.get(P.T.NORMAL),m=e.vertexAttributes.get(P.T.AUXPOS1);(0,w.hu)(h.size>=3);var _=n.point,T=n.camera,x=(0,H.c)(o);s*=T.pixelRatio,l*=T.pixelRatio;for(var b="screen"===this.parameters.centerOffsetUnits,O=0;O<h.data.length/h.size;O++){var S=O*h.size;(0,g.s)(ce,h.data[S],h.data[S+1],h.data[S+2]),(0,g.m)(ce,ce,r);var C=O*p.size;Oe[0]=p.data[C]*s,Oe[1]=p.data[C+1]*l,(0,g.m)(ce,ce,T.viewMatrix);var E=O*m.size;if((0,g.s)(ye,m.data[E+0],m.data[E+1],m.data[E+2]),!b&&(ce[0]+=ye[0],ce[1]+=ye[1],0!==ye[2])){var A=ye[2];(0,g.n)(ye,ce),(0,g.f)(ce,ce,(0,g.a)(ye,ye,A))}var I=O*v.size;if((0,g.s)(de,v.data[I],v.data[I+1],v.data[I+2]),this._normalAndViewAngle(de,ve,T,_e),this._applyVerticalOffsetTransformationView(ce,_e,T,le),T.applyProjection(ce,he),he[0]>-1){var D=Math.floor(he[0])+this.parameters.screenOffset[0],N=Math.floor(he[1])+this.parameters.screenOffset[1];b&&(D+=ye[0],0!==ye[1]&&(N+=(0,R.sX)(ye[1],le.factorAlignment))),(0,R.TU)(Oe,le.factor,Oe);var Z=xe*T.pixelRatio,L=void 0;if(o.textureIsSignedDistanceField&&(L=o.outlineSize*T.pixelRatio/2),se(_,D,N,Oe,Z,L,o,x)){var F=n.ray;if((0,g.m)(pe,ce,(0,f.a)(ge,T.viewMatrix)),he[0]=_[0],he[1]=_[1],T.unprojectFromRenderScreen(he,ce)){var k=(0,y.c)();(0,g.g)(k,F.direction);var U=1/(0,g.l)(k);(0,g.a)(k,k,U),i((0,g.i)(F.origin,ce)*U,k,-1,!0,1,pe)}}}}}}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return!1;var n=r.get(P.T.POSITION),i=e.indices.get(P.T.POSITION);return(0,S.NO)(n,i,t)}},{key:"createBufferWriter",value:function(){return new Ae(this)}},{key:"_normalAndViewAngle",value:function(e,t,r,n){return _(t)&&(t=(0,d.f)(me,t)),(0,g.t)(n.normal,e,t),(0,g.m)(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=(0,g.d)(fe,Se),n}},{key:"_updateScaleInfo",value:function(e,t,r){var n=this.parameters;n.screenSizePerspective?(0,R.PV)(r,t,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment?(0,R.PV)(r,t,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}},{key:"applyShaderOffsetsView",value:function(e,t,r,n,i,a,o){var s=this._normalAndViewAngle(t,r,i,_e);return this._applyVerticalGroundOffsetView(e,s,i,o),this._applyVerticalOffsetTransformationView(o,s,i,a),this._applyPolygonOffsetView(o,s,n[3],i,o),this._applyCenterOffsetView(o,n,o),o}},{key:"applyShaderOffsetsNDC",value:function(e,t,r,n,i){return this._applyCenterOffsetNDC(e,t,r,n),(0,u.pC)(i)&&(0,g.g)(i,n),this._applyPolygonOffsetNDC(n,t,r,n),n}},{key:"_applyPolygonOffsetView",value:function(e,t,r,n,i){var a=n.aboveGround?1:-1,o=Math.sign(r);0===o&&(o=a);var s=a*o;if(this.parameters.shaderPolygonOffset<=0)return(0,g.g)(i,e);var u=(0,l.uZ)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-u*u)/u/n.viewport[2];return(0,g.a)(i,e,s>0?c:1/c),i}},{key:"_applyVerticalGroundOffsetView",value:function(e,t,r,n){var i=(0,g.l)(e),a=r.aboveGround?1:-1,o=.5*r.computeRenderPixelSizeAtDist(i),s=(0,g.a)(ce,t.normal,a*o);return(0,g.b)(n,e,s),n}},{key:"_applyVerticalOffsetTransformationView",value:function(e,t,r,n){var i=this.parameters;if(!i.verticalOffset||!i.verticalOffset.screenLength){if(i.screenSizePerspective||i.screenSizePerspectiveAlignment){var a=(0,g.l)(e);this._updateScaleInfo(n,a,t.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}var o=(0,g.l)(e),s=i.screenSizePerspectiveAlignment||i.screenSizePerspective,l=(0,D.Hx)(r,o,i.verticalOffset,t.cosAngle,s);return this._updateScaleInfo(n,o,t.cosAngle),(0,g.a)(t.normal,t.normal,l),(0,g.b)(e,e,t.normal)}},{key:"_applyCenterOffsetView",value:function(e,t,r){var n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,g.g)(r,e),n&&(r[0]+=t[0],r[1]+=t[1],t[2]&&((0,g.n)(de,r),(0,g.b)(r,r,(0,g.a)(de,de,t[2])))),r}},{key:"_applyCenterOffsetNDC",value:function(e,t,r,n){var i="screen"!==this.parameters.centerOffsetUnits;return n!==e&&(0,g.g)(n,e),i||(n[0]+=t[0]/r.fullWidth*2,n[1]+=t[1]/r.fullHeight*2),n}},{key:"_applyPolygonOffsetNDC",value:function(e,t,r,n){var i=this.parameters.shaderPolygonOffset;if(e!==n&&(0,g.g)(n,e),i){var a=r.aboveGround?1:-1,o=a*Math.sign(t[3]);n[2]-=(o||a)*i}return n}},{key:"requiresSlot",value:function(e){if(e===A.r.DRAPED_MATERIAL)return!0;var t=this.parameters,r=t.drawInSecondSlot,n=t.occlusionTest;return e===(r?A.r.LABEL_MATERIAL:A.r.HUD_MATERIAL)||n&&e===A.r.OCCLUSION_PIXELS}},{key:"createGLMaterial",value:function(e){return e.output===b.H.Color||e.output===b.H.Alpha?new ae(e):e.output===b.H.Highlight?new ie(e):null}},{key:"calculateRelativeScreenBounds",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,T.Ue)();return oe(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}]),r}(E.F5),ie=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){return(0,i.Z)(this,r),t.call(this,(0,n.Z)((0,n.Z)({},e),e.material.parameters))}return(0,a.Z)(r,[{key:"updateParameters",value:function(e){return this.updateTexture(this._material.parameters.textureId),this.selectProgram(e)}},{key:"selectProgram",value:function(e){return this.ensureTechnique(Q,e)}},{key:"beginSlot",value:function(e){return this.updateParameters(e)}},{key:"bind",value:function(e,t){this.bindTextures(t.program),this.bindTextureScale(t.program),t.bindPass(this._material.parameters,e)}}]),r}(C.Z),ae=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"_isOcclusionSlot",value:function(e){return e.slot===A.r.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===b.H.Color||this._output===b.H.Alpha)}},{key:"selectProgram",value:function(e){return this.ensureTechnique(Q,e,this._isOcclusionSlot(e)?b.H.Occlusion:this._output)}},{key:"bind",value:function(e,t){this._isOcclusionSlot(e)||(this.bindTextures(t.program),this.bindTextureScale(t.program)),t.bindPass(this._material.parameters,e)}}]),r}(ie);function oe(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ue;return(0,v.c)(n,e.anchorPos),n[0]*=-t[0],n[1]*=-t[1],n[0]+=e.screenOffset[0]*r,n[1]+=e.screenOffset[1]*r,n}function se(e,t,r,n,i,a,o,s){var l=t-i-(s[0]>0?n[0]*s[0]:0),u=l+n[0]+2*i,c=r-i-(s[1]>0?n[1]*s[1]:0),d=c+n[1]+2*i;if(o.textureIsSignedDistanceField){var h=o.distanceFieldBoundingBox;l+=n[0]*h[0],c+=n[1]*h[1],u-=n[0]*(1-h[2]),d-=n[1]*(1-h[3]),l-=a,u+=a,c-=a,d+=a}return e[0]>l&&e[0]<u&&e[1]>c&&e[1]<d}var le={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},ue=(0,m.a)(),ce=(0,y.c)(),de=(0,y.c)(),he=(0,c.J$)(),fe=(0,y.c)(),pe=(0,y.c)(),ve=(0,h.c)(),me=(0,h.c)(),ge=(0,p.c)(),ye=(0,y.c)(),_e={normal:fe,cosAngle:0},Te=(0,p.c)(),xe=1,be=2,Oe=[0,0],Se=(0,y.f)(0,0,1),Ce=(0,n.Z)({texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:(0,m.f)(.5,.5),shaderPolygonOffset:1e-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawLabelBorder:!1,isDraped:!1},E.mo),Ee=(0,x.U$)().vec3f(P.T.POSITION).vec3f(P.T.NORMAL).vec2f(P.T.UV0).vec4u8(P.T.COLOR).vec2f(P.T.SIZE).vec4f(P.T.AUXPOS1).vec4f(P.T.AUXPOS2),Ae=function(){function e(t){(0,i.Z)(this,e),this.material=t,this.vertexBufferLayout=Ee}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 6*e.indices.get(P.T.POSITION).length}},{key:"write",value:function(e,t,r,n){(0,I.ho)(t.indices.get(P.T.POSITION),t.vertexAttributes.get(P.T.POSITION).data,e.transformation,r.position,n,6),(0,I.s5)(t.indices.get(P.T.NORMAL),t.vertexAttributes.get(P.T.NORMAL).data,e.invTranspTransformation,r.normal,n,6);var i,a,o,s,l=t.vertexAttributes.get(P.T.UV0).data;if(null==l||l.length<4){var u=this.material.parameters;i=0,a=0,o=u.texCoordScale[0],s=u.texCoordScale[1]}else i=l[0],a=l[1],o=l[2],s=l[3];o=Math.min(1.99999,o+1),s=Math.min(1.99999,s+1);for(var c=t.indices.get(P.T.POSITION).length,d=r.uv0,h=n,f=0;f<c;++f)d.set(h,0,i),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,a),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,o),d.set(h,1,s),h+=1,d.set(h,0,i),d.set(h,1,s),h+=1,d.set(h,0,i),d.set(h,1,a),h+=1;(0,I.Vs)(t.indices.get(P.T.COLOR),t.vertexAttributes.get(P.T.COLOR).data,4,r.color,n,6);for(var p=t.indices.get(P.T.SIZE),v=t.vertexAttributes.get(P.T.SIZE).data,m=p.length,g=r.size,y=n,_=0;_<m;++_)for(var T=v[2*p[_]],x=v[2*p[_]+1],b=0;b<6;++b)g.set(y,0,T),g.set(y,1,x),y+=1;t.indices.get(P.T.AUXPOS1)&&t.vertexAttributes.get(P.T.AUXPOS1)&&(0,I.SW)(t.indices.get(P.T.AUXPOS1),t.vertexAttributes.get(P.T.AUXPOS1).data,r.auxpos1,n,6),t.indices.get(P.T.AUXPOS2)&&t.vertexAttributes.get(P.T.AUXPOS2)&&(0,I.SW)(t.indices.get(P.T.AUXPOS2),t.vertexAttributes.get(P.T.AUXPOS2).data,r.auxpos2,n,6)}}]),e}()},99196:function(e,t,r){r.d(t,{Y:function(){return J}});var n=r(1413),i=r(15671),a=r(43144),o=r(60136),s=r(54062),l=r(32718),u=r(92026),c=r(17842),d=r(88396),h=r(11186),f=r(71353),p=r(95773),v=r(85981),m=r(55652),g=r(25158),y=r(71011),_=r(81935),T=r(23620),x=r(56529),b=r(93822),O=r(97731),S=r(4760),C=r(33236),E=r(64226),A=r(22909),R=r(32683),w=r(11752),P=r(61120),I=r(27366),D=r(33280),M=r(137),H=r(41012),N=r(82144),Z=r(31132),L=r(33559),F=r(7566),k=r(27627),U=r(50411),z=r(99337),V=r(8548),j=r(36207),G=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e,n,a){var o;return(0,i.Z)(this,r),(o=t.call(this,e,n,a)).stipplePattern=null,o.stippleTextureBind=null,o.stippleTextureRepository=e.stippleTextureRepository,o}return(0,a.Z)(r,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==y.H.Highlight}},{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,i=t.build({output:n.output,attributeColor:n.vertexColors,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:n.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:n.stippleOffColorEnabled,stippleRequiresClamp:!1,stippleScaleWithLineWidth:!1,stipplePreferContinuous:n.stipplePreferContinuous});return new k.$(e.rctx,i,F.i)}},{key:"destroy",value:function(){(0,w.Z)((0,P.Z)(r.prototype),"destroy",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if((0,H.II)(this.program,t.camera.projectionMatrix),this.stipplePattern!==e.stipplePattern){var r=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){var n=(0,u.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1},i=n.pixelSize,a=n.sdfNormalizer,o=n.pixels;this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.program.setUniform1f("stipplePatternTextureSize",o),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.program.setUniform2f("ndcToPixel",t.camera.fullViewport[2]/2,t.camera.fullViewport[3]/2)}if(this.program.setUniform4fv("constantColor",e.color),this.program.setUniform1f("alphaCoverage",Math.min(1,e.width*t.camera.pixelRatio)),this.configuration.stippleOffColorEnabled){var s=(0,u.Wg)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}this.configuration.output===y.H.Highlight&&(0,M.wW)(this.program,t)}},{key:"bindDraw",value:function(e){(0,H.id)(this.program,e),this.stippleEnabled&&!this.configuration.draped&&(0,H.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,D.DA)(this.program,this.configuration,e),this.program.rebindTextures()}},{key:"initializePipeline",value:function(){var e=this.configuration,t=(0,j.wK)(V.zi.SRC_ALPHA,V.zi.ONE,V.zi.ONE_MINUS_SRC_ALPHA,V.zi.ONE_MINUS_SRC_ALPHA),r=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,j.sm)({blending:r,depthTest:U.JN,depthWrite:n,colorWrite:j.BK,stencilWrite:e.sceneHasOcludees?U.s3:null,stencilTest:e.sceneHasOcludees?t?U.eD:U.RY:null})};return e.output===y.H.Color?(this._occludeePipelineState=r(!0,e.transparent||this.stippleEnabled?t:null,j.LZ),r(!1,e.transparent||this.stippleEnabled?t:null,j.LZ)):r(!1)}},{key:"primitiveType",get:function(){return V.MX.LINES}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,w.Z)((0,P.Z)(r.prototype),"getPipelineState",this).call(this,e,t)}}]),r}(Z.A);G.shader=new N.J(z.N,(function(){return r.e(8569).then(r.bind(r,78569))}));var B=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).output=y.H.Color,e.slicePlaneEnabled=!1,e.vertexColors=!1,e.transparent=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stipplePreferContinuous=!0,e.sceneHasOcludees=!1,e}return(0,a.Z)(r)}(L.m);(0,I._)([(0,L.o)({count:y.H.COUNT})],B.prototype,"output",void 0),(0,I._)([(0,L.o)()],B.prototype,"slicePlaneEnabled",void 0),(0,I._)([(0,L.o)()],B.prototype,"vertexColors",void 0),(0,I._)([(0,L.o)()],B.prototype,"transparent",void 0),(0,I._)([(0,L.o)()],B.prototype,"draped",void 0),(0,I._)([(0,L.o)()],B.prototype,"stippleEnabled",void 0),(0,I._)([(0,L.o)()],B.prototype,"stippleOffColorEnabled",void 0),(0,I._)([(0,L.o)()],B.prototype,"stipplePreferContinuous",void 0),(0,I._)([(0,L.o)()],B.prototype,"sceneHasOcludees",void 0);var W,q=l.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");!function(e){e[e.START=0]="START",e[e.END=1]="END"}(W||(W={}));var J=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e,K))._techniqueConfig=new B,n}return(0,a.Z)(r,[{key:"getTechniqueConfig",value:function(e,t){this._techniqueConfig.output=e,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.vertexColors=this.parameters.vertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=t.slot===b.r.DRAPED_MATERIAL;var r=(0,u.pC)(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&(0,u.pC)(this.parameters.stippleOffColor),this._techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"intersect",value:function(e,t,r,n,i,a,o,s,l){(0,u.pC)(l)?(0,A.TT)(e,n,l,a,1,o):this._intersectLineGeometry(e,t,r,n,o)}},{key:"_intersectLineGeometry",value:function(e,t,r,n,i){if(n.options.selectionMode&&!(0,R.PD)(t))if((0,O.kG)(r)){var a=e.vertexAttributes.get(S.T.POSITION).data,o=n.camera,s=le;(0,d.c)(s,n.point);(0,h.s)(ue[0],s[0]-2,s[1]+2,0),(0,h.s)(ue[1],s[0]+2,s[1]+2,0),(0,h.s)(ue[2],s[0]+2,s[1]-2,0),(0,h.s)(ue[3],s[0]-2,s[1]-2,0);for(var l=0;l<4;l++)if(!o.unprojectFromRenderScreen(ue[l],ce[l]))return;(0,m.zk)(o.eye,ce[0],ce[1],de),(0,m.zk)(o.eye,ce[1],ce[2],he),(0,m.zk)(o.eye,ce[2],ce[3],fe),(0,m.zk)(o.eye,ce[3],ce[0],pe);for(var u=Number.MAX_VALUE,c=0,f=0;f<a.length-5;f+=3)if($[0]=a[f]+r[12],$[1]=a[f+1]+r[13],$[2]=a[f+2]+r[14],Q[0]=a[f+3]+r[12],Q[1]=a[f+4]+r[13],Q[2]=a[f+5]+r[14],!((0,m.jH)(de,$)<0&&(0,m.jH)(de,Q)<0||(0,m.jH)(he,$)<0&&(0,m.jH)(he,Q)<0||(0,m.jH)(fe,$)<0&&(0,m.jH)(fe,Q)<0||(0,m.jH)(pe,$)<0&&(0,m.jH)(pe,Q)<0)){if(o.projectToRenderScreen($,re),o.projectToRenderScreen(Q,ne),re[2]<0&&ne[2]>0){(0,h.f)(ee,$,Q);var g=o.frustum,y=-(0,m.jH)(g[p.Nu.NEAR],$)/(0,h.d)(ee,(0,m.mJ)(g[p.Nu.NEAR]));(0,h.a)(ee,ee,y),(0,h.b)($,$,ee),o.projectToRenderScreen($,re)}else if(re[2]>0&&ne[2]<0){(0,h.f)(ee,Q,$);var _=o.frustum,T=-(0,m.jH)(_[p.Nu.NEAR],Q)/(0,h.d)(ee,(0,m.mJ)(_[p.Nu.NEAR]));(0,h.a)(ee,ee,T),(0,h.b)(Q,Q,ee),o.projectToRenderScreen(Q,ne)}else if(re[2]<0&&ne[2]<0)continue;re[2]=0,ne[2]=0;var x=(0,v.Jk)((0,v.zk)(re,ne,oe),s);x<u&&(u=x,(0,h.g)(ie,$),(0,h.g)(ae,Q),c=f/3)}var b=n.rayBegin,C=n.rayEnd;if(u<4){var E=Number.MAX_VALUE;if((0,v.AR)((0,v.zk)(ie,ae,oe),(0,v.zk)(b,C,se),te)){(0,h.f)(te,te,b);var A=(0,h.l)(te);(0,h.a)(te,te,1/A),E=A/(0,h.i)(b,C)}i(E,te,c,!1)}}else q.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return!1;var n=r.get(S.T.POSITION);return(0,_.qZ)(n,null,!1,t)}},{key:"requiresSlot",value:function(e){return e===b.r.OPAQUE_MATERIAL||e===b.r.DRAPED_MATERIAL}},{key:"createGLMaterial",value:function(e){return e.output===y.H.Color||e.output===y.H.Highlight?new X(e):null}},{key:"createBufferWriter",value:function(){var e=this.parameters.vertexColors?E.IM:E.wp;return(0,u.Wi)(this.parameters.stipplePattern)?new E.G_(e):new Y(e.clone().vec3f(S.T.AUXPOS1).vec2f(S.T.UV0))}}]),r}(x.F5),X=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"updateParameters",value:function(e){return this.ensureTechnique(G,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output===y.H.Color&&this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),r}(T.Z),Y=function(){function e(t){(0,i.Z)(this,e),this.vertexBufferLayout=t}return(0,a.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(S.T.POSITION).length}},{key:"write",value:function(e,t,r,n){(0,C.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n),this._writeAuxpos1(e,t,r,n),this._writeUV0(e,t,r,n)}},{key:"_writeAuxpos1",value:function(e,t,r,n){var i=r.getField(S.T.AUXPOS1,g.ct),a=t.indices.get(S.T.POSITION),o=t.vertexAttributes.get(S.T.POSITION).data,s=e.transformation,l=i.typedBufferStride,u=i.typedBuffer;n*=l;for(var c=0;c<a.length-1;c+=2)for(var d=0,h=[1,0];d<h.length;d++){var f=3*a[c+h[d]],p=o[f],v=o[f+1],m=o[f+2],y=s[0]*p+s[4]*v+s[8]*m+s[12],_=s[1]*p+s[5]*v+s[9]*m+s[13],T=s[2]*p+s[6]*v+s[10]*m+s[14];u[n]=y,u[n+1]=_,u[n+2]=T,n+=l}}},{key:"_writeUV0",value:function(e,t,r,n){var i,a=r.getField(S.T.UV0,g.Eu),o=t.indices.get(S.T.POSITION),s=t.vertexAttributes.get(S.T.POSITION).data,l=null==(i=t.vertexAttributes.get(S.T.DISTANCETOSTART))?void 0:i.data,u=e.transformation,c=a.typedBufferStride,d=a.typedBuffer,f=0;d[n*=c]=W.START,d[n+1]=f,n+=c;var p=3*o[0],v=(0,h.s)($,s[p],s[p+1],s[p+2]);u&&(0,h.m)(v,v,u);for(var m=Q,y=o.length-1,_=1,T=l?function(e,t,r){return f=l[r]}:function(e,t,r){return f+=(0,h.i)(e,t)},x=1;x<y;x+=2){var b=3*o[x];(0,h.s)(m,s[b],s[b+1],s[b+2]),u&&(0,h.m)(m,m,u),T(v,m,_++);for(var O=0;O<2;++O)d[n]=1-O,d[n+1]=f,n+=c;(0,h.g)(v,m)}var C=3*o[y];(0,h.s)(m,s[C],s[C+1],s[C+2]),u&&(0,h.m)(m,m,u),T(v,m,_),d[n]=W.END,d[n+1]=f}}]),e}(),K=(0,n.Z)({color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleOffColor:null,stipplePreferContinuous:!0,sceneHasOcludees:!1},x.mo),$=(0,f.c)(),Q=(0,f.c)(),ee=(0,f.c)(),te=(0,f.c)(),re=(0,c.J$)(),ne=(0,c.J$)(),ie=(0,f.c)(),ae=(0,f.c)(),oe=(0,v.Ue)(),se=(0,v.Ue)(),le=(0,f.c)(),ue=[(0,c.J$)(),(0,c.J$)(),(0,c.J$)(),(0,c.J$)()],ce=[(0,f.c)(),(0,f.c)(),(0,f.c)(),(0,f.c)()],de=(0,m.Ue)(),he=(0,m.Ue)(),fe=(0,m.Ue)(),pe=(0,m.Ue)()},58901:function(e,t,r){r.d(t,{U:function(){return te}});var n=r(1413),i=r(15671),a=r(43144),o=r(60136),s=r(54062),l=r(32718),u=r(16889),c=r(92026),d=r(17842),h=r(88396),f=r(11186),p=r(71353),v=r(95773),m=r(85981),g=r(55652),y=r(55158),_=r(71011),T=r(81935),x=r(23620),b=r(94425),O=r(56529),S=r(93822),C=r(97731),E=r(4760),A=r(62930),R=r(32683),w=r(98186),P=r(11752),I=r(61120),D=r(27366),M=r(14226),H=r(11185),N=r(33280),Z=r(137),L=r(15226),F=r(18607),k=r(41012),U=r(82144),z=r(31132),V=r(33559),j=r(68401),G=r(78041),B=r(27627),W=r(50411),q=r(8548),J=r(36207),X=new Map([[E.T.POSITION,0],[E.T.SUBDIVISIONFACTOR,1],[E.T.UV0,2],[E.T.AUXPOS1,3],[E.T.AUXPOS2,4],[E.T.SIZE,6],[E.T.SIZEFEATUREATTRIBUTE,6],[E.T.COLOR,5],[E.T.COLORFEATUREATTRIBUTE,5],[E.T.OPACITYFEATUREATTRIBUTE,7]]),Y=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e,n,a){var o;return(0,i.Z)(this,r),(o=t.call(this,e,n,a)).stippleTextureRepository=e.stippleTextureRepository,o}return(0,a.Z)(r,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==_.H.Highlight}},{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,i=t.build({oitEnabled:n.transparencyPassType===j.Am.Color,output:n.output,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,draped:n.draped,stippleEnabled:this.stippleEnabled,stippleOffColorEnabled:n.stippleOffColorEnabled,stippleRequiresClamp:!0,stippleScaleWithLineWidth:n.stippleScaleWithLineWidth,stipplePreferContinuous:n.stipplePreferContinuous,capType:n.capType,roundJoins:n.roundJoins,vvColor:n.vvColor,vvSize:n.vvSize,vvInstancingEnabled:!0,vvOpacity:n.vvOpacity,falloffEnabled:n.falloffEnabled,innerColorEnabled:n.innerColorEnabled,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround,wireframe:n.wireframe});return new B.$(e.rctx,i,X)}},{key:"destroy",value:function(){(0,P.Z)((0,I.Z)(r.prototype),"destroy",this).call(this),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}},{key:"bindPass",value:function(e,t){if((0,k.II)(this.program,t.camera.projectionMatrix),this.configuration.output===_.H.Highlight&&(0,Z.wW)(this.program,t),t.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,L.p)(this.program,t)),this.program.setUniform1f("intrinsicWidth",e.width),this.program.setUniform4fv("intrinsicColor",e.color),this.program.setUniform1f("miterLimit","miter"!==e.join?0:e.miterLimit),this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform1f("pixelRatio",t.camera.pixelRatio),this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]),(0,F.s0)(this.program,e),this.stipplePattern!==e.stipplePattern){var r=e.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){var n=(0,c.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1},i=n.pixelSize,a=n.sdfNormalizer,o=n.pixels;if(this.program.setUniform1f("stipplePatternSDFNormalizer",a),this.program.setUniform1f("stipplePatternTextureSize",o),this.program.setUniform1f("stipplePatternPixelSize",i),this.program.setUniform1f("stipplePatternPixelSizeInv",1/i),this.configuration.draped?this.program.setUniform1f("worldToScreenRatio",1/t.screenToPCSRatio):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/t.camera.perScreenPixelRatio),this.configuration.stippleOffColorEnabled){var s=(0,c.Wg)(e.stippleOffColor);this.program.setUniform4f("stippleOffColor",s[0],s[1],s[2],s.length>3?s[3]:1)}}this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",e.falloff),this.configuration.innerColorEnabled&&(this.program.setUniform4fv("innerColor",(0,c.Pt)(e.innerColor,e.color)),this.program.setUniform1f("innerWidth",e.innerWidth*t.camera.pixelRatio))}},{key:"bindDraw",value:function(e){(0,k.id)(this.program,e),this.stippleEnabled&&!this.configuration.draped&&(0,k.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),(0,N.Vv)(this.program,this.configuration,e.slicePlane,{origin:e.origin,view:e.camera.viewMatrix}),this.program.setUniformMatrix4fv("inverseProjectionMatrix",(0,M.a)(H.MP.get(),e.camera.projectionMatrix)),this.program.rebindTextures()}},{key:"_makePipelineState",value:function(e,t){var r=this.configuration,n=e===j.Am.NONE,i=e===j.Am.FrontFace;return(0,J.sm)({blending:r.output===_.H.Color||r.output===_.H.Alpha?n?G.wu:(0,G.j7)(e):null,depthTest:{func:(0,G.Bh)(e)},depthWrite:n?r.writeDepth&&J.LZ:(0,G.K5)(e),colorWrite:J.BK,stencilWrite:r.sceneHasOcludees?W.s3:null,stencilTest:r.sceneHasOcludees?t?W.eD:W.RY:null,polygonOffset:n||i?r.polygonOffset&&K:G.E0})}},{key:"initializePipeline",value:function(){var e=this.configuration,t=e.polygonOffset&&K;return e.occluder&&(this._occluderPipelineTransparent=(0,J.sm)({blending:G.wu,polygonOffset:t,depthTest:W.zV,depthWrite:null,colorWrite:J.BK,stencilWrite:null,stencilTest:W.YD}),this._occluderPipelineOpaque=(0,J.sm)({blending:G.wu,polygonOffset:t,depthTest:W.zV,depthWrite:null,colorWrite:J.BK,stencilWrite:W.P7,stencilTest:W.ii}),this._occluderPipelineMaskWrite=(0,J.sm)({blending:null,polygonOffset:t,depthTest:W.JN,depthWrite:null,colorWrite:null,stencilWrite:W.s3,stencilTest:W.eD})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}},{key:"primitiveType",get:function(){return this.configuration.wireframe?q.MX.LINES:q.MX.TRIANGLE_STRIP}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:this.configuration.occluder?e===S.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===S.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:(0,P.Z)((0,I.Z)(r.prototype),"getPipelineState",this).call(this,e,t)}}]),r}(z.A);Y.shader=new U.J(w.R,(function(){return r.e(6279).then(r.bind(r,56279))}));var K={factor:0,units:-4},$=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).output=_.H.Color,e.occluder=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.polygonOffset=!1,e.writeDepth=!1,e.draped=!1,e.stippleEnabled=!1,e.stippleOffColorEnabled=!1,e.stippleScaleWithLineWidth=!1,e.stipplePreferContinuous=!0,e.capType=w.C.BUTT,e.roundJoins=!1,e.vvSize=!1,e.vvColor=!1,e.vvOpacity=!1,e.falloffEnabled=!1,e.innerColorEnabled=!1,e.sceneHasOcludees=!1,e.transparencyPassType=j.Am.NONE,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e.wireframe=!1,e}return(0,a.Z)(r)}(V.m);(0,D._)([(0,V.o)({count:_.H.COUNT})],$.prototype,"output",void 0),(0,D._)([(0,V.o)()],$.prototype,"occluder",void 0),(0,D._)([(0,V.o)()],$.prototype,"slicePlaneEnabled",void 0),(0,D._)([(0,V.o)()],$.prototype,"transparent",void 0),(0,D._)([(0,V.o)()],$.prototype,"polygonOffset",void 0),(0,D._)([(0,V.o)()],$.prototype,"writeDepth",void 0),(0,D._)([(0,V.o)()],$.prototype,"draped",void 0),(0,D._)([(0,V.o)()],$.prototype,"stippleEnabled",void 0),(0,D._)([(0,V.o)()],$.prototype,"stippleOffColorEnabled",void 0),(0,D._)([(0,V.o)()],$.prototype,"stippleScaleWithLineWidth",void 0),(0,D._)([(0,V.o)()],$.prototype,"stipplePreferContinuous",void 0),(0,D._)([(0,V.o)({count:w.C.COUNT})],$.prototype,"capType",void 0),(0,D._)([(0,V.o)()],$.prototype,"roundJoins",void 0),(0,D._)([(0,V.o)()],$.prototype,"vvSize",void 0),(0,D._)([(0,V.o)()],$.prototype,"vvColor",void 0),(0,D._)([(0,V.o)()],$.prototype,"vvOpacity",void 0),(0,D._)([(0,V.o)()],$.prototype,"falloffEnabled",void 0),(0,D._)([(0,V.o)()],$.prototype,"innerColorEnabled",void 0),(0,D._)([(0,V.o)()],$.prototype,"sceneHasOcludees",void 0),(0,D._)([(0,V.o)({count:j.Am.COUNT})],$.prototype,"transparencyPassType",void 0),(0,D._)([(0,V.o)()],$.prototype,"multipassTerrainEnabled",void 0),(0,D._)([(0,V.o)()],$.prototype,"cullAboveGround",void 0),(0,D._)([(0,V.o)()],$.prototype,"wireframe",void 0);var Q,ee=l.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(Q||(Q={}));var te=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e,ne))._vertexAttributeLocations=X,n.techniqueConfig=new $,n.layout=n.createLayout(),n}return(0,a.Z)(r,[{key:"isClosed",value:function(e,t){return se(this.parameters,e,t)}},{key:"dispose",value:function(){}},{key:"getPassParameters",value:function(){return this.parameters}},{key:"getTechniqueConfig",value:function(e,t){this.techniqueConfig.output=e,this.techniqueConfig.draped=t.slot===S.r.DRAPED_MATERIAL;var r=(0,c.pC)(this.parameters.stipplePattern);return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&(0,c.pC)(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this.techniqueConfig.sceneHasOcludees=this.parameters.sceneHasOcludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&(0,c.pC)(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===O.yD.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=t.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}},{key:"intersect",value:function(e,t,r,n,i,a,o,s,l){(0,c.pC)(l)?this._intersectDrapedLineGeometry(e,n,l,a,o):this._intersectLineGeometry(e,t,r,n,o)}},{key:"_intersectDrapedLineGeometry",value:function(e,t,r,n,i){if(t.options.selectionMode){var a=e.vertexAttributes.get(E.T.POSITION).data,o=e.vertexAttributes.get(E.T.SIZE),s=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=e.vertexAttributes.get(E.T.SIZEFEATUREATTRIBUTE).data[0];s*=(0,u.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o&&(s*=o.data[0]);for(var c=n[0],d=n[1],h=(s/2+4)*e.screenToWorldRatio,f=Number.MAX_VALUE,p=0,v=0;v<a.length-5;v+=3){var m=a[v],g=a[v+1],y=c-m,_=d-g,T=a[v+3]-m,x=a[v+4]-g,b=(0,u.uZ)((T*y+x*_)/(T*T+x*x),0,1),O=T*b-y,S=x*b-_,C=O*O+S*S;C<f&&(f=C,p=v/3)}f<h*h&&i(r.dist,r.normal,p,!1)}}},{key:"_intersectLineGeometry",value:function(e,t,r,n,i){if(n.options.selectionMode&&!(0,R.PD)(t))if((0,C.kG)(r)){var a=e.vertexAttributes,o=a.get(E.T.POSITION).data,s=this.parameters.width;if(this.parameters.vvSizeEnabled){var l=a.get(E.T.SIZEFEATUREATTRIBUTE).data[0];s*=(0,u.uZ)(this.parameters.vvSizeOffset[0]+l*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a.has(E.T.SIZE)&&(s*=a.get(E.T.SIZE).data[0]);var c=n.camera,d=he;(0,h.c)(d,n.point);var p=s*c.pixelRatio/2+4*c.pixelRatio;(0,f.s)(be[0],d[0]-p,d[1]+p,0),(0,f.s)(be[1],d[0]+p,d[1]+p,0),(0,f.s)(be[2],d[0]+p,d[1]-p,0),(0,f.s)(be[3],d[0]-p,d[1]-p,0);for(var y=0;y<4;y++)if(!c.unprojectFromRenderScreen(be[y],Oe[y]))return;(0,g.zk)(c.eye,Oe[0],Oe[1],Se),(0,g.zk)(c.eye,Oe[1],Oe[2],Ce),(0,g.zk)(c.eye,Oe[2],Oe[3],Ee),(0,g.zk)(c.eye,Oe[3],Oe[0],Ae);for(var _=Number.MAX_VALUE,T=0,x=oe(this.parameters,a,e.indices)?o.length-2:o.length-5,b=0;b<x;b+=3){le[0]=o[b]+r[12],le[1]=o[b+1]+r[13],le[2]=o[b+2]+r[14];var O=(b+3)%o.length;if(ue[0]=o[O]+r[12],ue[1]=o[O+1]+r[13],ue[2]=o[O+2]+r[14],!((0,g.jH)(Se,le)<0&&(0,g.jH)(Se,ue)<0||(0,g.jH)(Ce,le)<0&&(0,g.jH)(Ce,ue)<0||(0,g.jH)(Ee,le)<0&&(0,g.jH)(Ee,ue)<0||(0,g.jH)(Ae,le)<0&&(0,g.jH)(Ae,ue)<0)){if(c.projectToRenderScreen(le,fe),c.projectToRenderScreen(ue,pe),fe[2]<0&&pe[2]>0){(0,f.f)(ce,le,ue);var S=c.frustum,A=-(0,g.jH)(S[v.Nu.NEAR],le)/(0,f.d)(ce,(0,g.mJ)(S[v.Nu.NEAR]));(0,f.a)(ce,ce,A),(0,f.b)(le,le,ce),c.projectToRenderScreen(le,fe)}else if(fe[2]>0&&pe[2]<0){(0,f.f)(ce,ue,le);var w=c.frustum,P=-(0,g.jH)(w[v.Nu.NEAR],ue)/(0,f.d)(ce,(0,g.mJ)(w[v.Nu.NEAR]));(0,f.a)(ce,ce,P),(0,f.b)(ue,ue,ce),c.projectToRenderScreen(ue,pe)}else if(fe[2]<0&&pe[2]<0)continue;fe[2]=0,pe[2]=0;var I=(0,m.Jk)((0,m.zk)(fe,pe,ge),d);I<_&&(_=I,(0,f.g)(ve,le),(0,f.g)(me,ue),T=b/3)}}var D=n.rayBegin,M=n.rayEnd;if(_<p*p){var H=Number.MAX_VALUE;if((0,m.AR)((0,m.zk)(ve,me,ge),(0,m.zk)(D,M,ye),de)){(0,f.f)(de,de,D);var N=(0,f.l)(de);(0,f.a)(de,de,1/N),H=N/(0,f.i)(D,M)}i(H,de,T,!1)}}else ee.error("intersection assumes a translation-only matrix")}},{key:"computeAttachmentOrigin",value:function(e,t){var r=e.vertexAttributes;if(!r)return null;var n=e.indices,i=r.get(E.T.POSITION);return(0,T.qZ)(i,n?n.get(E.T.POSITION):null,n&&oe(this.parameters,r,n),t)}},{key:"createLayout",value:function(){var e=(0,y.U$)().vec3f(E.T.POSITION).f32(E.T.SUBDIVISIONFACTOR).vec2f(E.T.UV0).vec3f(E.T.AUXPOS1).vec3f(E.T.AUXPOS2);return this.parameters.vvSizeEnabled?e.f32(E.T.SIZEFEATUREATTRIBUTE):e.f32(E.T.SIZE),this.parameters.vvColorEnabled?e.f32(E.T.COLORFEATUREATTRIBUTE):e.vec4f(E.T.COLOR),this.parameters.vvOpacityEnabled&&e.f32(E.T.OPACITYFEATUREATTRIBUTE),e}},{key:"createBufferWriter",value:function(){return new ie(this.layout,this.parameters)}},{key:"requiresSlot",value:function(e,t){if(e===S.r.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===O.yD.OccludeAndTransparentStencil)return e===S.r.OPAQUE_MATERIAL||e===S.r.OCCLUDER_MATERIAL||e===S.r.TRANSPARENT_OCCLUDER_MATERIAL;var r=(0,b.S)(t);return r===_.H.Color||r===_.H.Alpha?e===(this.parameters.writeDepth?S.r.TRANSPARENT_MATERIAL:S.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===S.r.OPAQUE_MATERIAL}},{key:"createGLMaterial",value:function(e){return e.output===_.H.Color||e.output===_.H.Alpha||e.output===_.H.Highlight||e.output===_.H.Depth?new re(e):null}},{key:"validateParameters",value:function(e){"miter"!==e.join&&(e.miterLimit=0),this._requiresTransparent(e)&&(e.transparent=!0)}},{key:"_requiresTransparent",value:function(e){return!!((e.color&&e.color[3])<1||e.innerWidth>0&&this._colorRequiresTransparent(e.innerColor)||e.stipplePattern&&this._colorRequiresTransparent(e.stippleOffColor)||e.falloff>0)}},{key:"_colorRequiresTransparent",value:function(e){return(0,c.pC)(e)&&e[3]<1&&e[3]>0}}]),r}(O.F5),re=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"updateParameters",value:function(e){return this.ensureTechnique(Y,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.sceneHasOcludees&&this._material.setParameters({sceneHasOcludees:e.hasOccludees})}},{key:"beginSlot",value:function(e){return this._output!==_.H.Color&&this._output!==_.H.Alpha||this._updateOccludeeState(e),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.getPassParameters(),e)}}]),r}(x.Z),ne=(0,n.Z)((0,n.Z)({width:0,color:[1,1,1,1],join:"miter",cap:w.C.BUTT,miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleOffColor:null,stippleScaleWithLineWidth:!1,stipplePreferContinuous:!0,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,wireframe:!1},O.mo),A.S),ie=function(){function e(t,r){(0,i.Z)(this,e),this.parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;var n=r.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=n;break;case"round":this.numJoinSubdivisions=w.N+n}}return(0,a.Z)(e,[{key:"_isClosed",value:function(e){return oe(this.parameters,e.vertexAttributes,e.indices)}},{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){var t=e.indices.get(E.T.POSITION).length/2+1,r=this._isClosed(e),n=r?2:4;return n+=((r?t:t-1)-(r?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}},{key:"write",value:function(e,t,r,n){var i,a=this,o=_e,s=Te,l=xe,u=t.vertexAttributes.get(E.T.POSITION).data,c=t.indices&&t.indices.get(E.T.POSITION),d=null==(i=t.vertexAttributes.get(E.T.DISTANCETOSTART))?void 0:i.data;c&&c.length!==2*(u.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");var h=1,p=0;this.parameters.vvSizeEnabled?p=t.vertexAttributes.get(E.T.SIZEFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(E.T.SIZE)&&(h=t.vertexAttributes.get(E.T.SIZE).data[0]);var v=[1,1,1,1],m=0;this.parameters.vvColorEnabled?m=t.vertexAttributes.get(E.T.COLORFEATUREATTRIBUTE).data[0]:t.vertexAttributes.has(E.T.COLOR)&&(v=t.vertexAttributes.get(E.T.COLOR).data);var g=0;this.parameters.vvOpacityEnabled&&(g=t.vertexAttributes.get(E.T.OPACITYFEATUREATTRIBUTE).data[0]);var y=u.length/3,_=e.transformation,T=new Float32Array(r.buffer),x=this.vertexBufferLayout.stride/4,b=n*x,O=b,S=0,C=d?function(e,t,r){return S=d[r]}:function(e,t,r){return S+=(0,f.i)(e,t)},A=function(e,t,r,n,i,o,s){if(T[b++]=t[0],T[b++]=t[1],T[b++]=t[2],T[b++]=n,T[b++]=s,T[b++]=i,T[b++]=e[0],T[b++]=e[1],T[b++]=e[2],T[b++]=r[0],T[b++]=r[1],T[b++]=r[2],a.parameters.vvSizeEnabled?T[b++]=p:T[b++]=h,a.parameters.vvColorEnabled)T[b++]=m;else{var l=Math.min(4*o,v.length-4);T[b++]=v[l+0],T[b++]=v[l+1],T[b++]=v[l+2],T[b++]=v[l+3]}a.parameters.vvOpacityEnabled&&(T[b++]=g)};b+=x,(0,f.s)(s,u[0],u[1],u[2]),_&&(0,f.m)(s,s,_);var R=this._isClosed(t);if(R){var w=u.length-3;(0,f.s)(o,u[w],u[w+1],u[w+2]),_&&(0,f.m)(o,o,_)}else(0,f.s)(l,u[3],u[4],u[5]),_&&(0,f.m)(l,l,_),A(s,s,l,1,Q.LEFT_CAP_START,0,0),A(s,s,l,1,Q.RIGHT_CAP_START,0,0),(0,f.g)(o,s),(0,f.g)(s,l);for(var P=R?0:1,I=R?y:y-1,D=P;D<I;D++){var M=(D+1)%y*3;(0,f.s)(l,u[M+0],u[M+1],u[M+2]),_&&(0,f.m)(l,l,_),C(o,s,D),A(o,s,l,0,Q.LEFT_JOIN_END,D,S),A(o,s,l,0,Q.RIGHT_JOIN_END,D,S);for(var H=this.numJoinSubdivisions,N=0;N<H;++N){var Z=(N+1)/(H+1);A(o,s,l,Z,Q.LEFT_JOIN_END,D,S),A(o,s,l,Z,Q.RIGHT_JOIN_END,D,S)}A(o,s,l,1,Q.LEFT_JOIN_START,D,S),A(o,s,l,1,Q.RIGHT_JOIN_START,D,S),(0,f.g)(o,s),(0,f.g)(s,l)}R?((0,f.s)(l,u[3],u[4],u[5]),_&&(0,f.m)(l,l,_),S=C(o,s,I),A(o,s,l,0,Q.LEFT_JOIN_END,P,S),A(o,s,l,0,Q.RIGHT_JOIN_END,P,S)):(S=C(o,s,I),A(o,s,s,0,Q.LEFT_CAP_END,I,S),A(o,s,s,0,Q.RIGHT_CAP_END,I,S)),ae(T,O+x,T,O,x),b=ae(T,b-x,T,b,x),this.parameters.wireframe&&this._addWireframeVertices(r,O,b,x)}},{key:"_addWireframeVertices",value:function(e,t,r,n){for(var i=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),a=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,r-t),o=0,s=function(e){return o=ae(a,e,i,o,n)},l=0;l<a.length-1;l+=2*n)s(l),s(l+2*n),s(l+1*n),s(l+2*n),s(l+1*n),s(l+3*n)}}]),e}();function ae(e,t,r,n,i){for(var a=0;a<i;a++)r[n++]=e[t++];return n}function oe(e,t,r){return se(e,t.get(E.T.POSITION).data,r?r.get(E.T.POSITION):null)}function se(e,t,r){return!!e.isClosed&&(r?r.length>2:t.length>6)}var le=(0,p.c)(),ue=(0,p.c)(),ce=(0,p.c)(),de=(0,p.c)(),he=(0,p.c)(),fe=(0,d.J$)(),pe=(0,d.J$)(),ve=(0,p.c)(),me=(0,p.c)(),ge=(0,m.Ue)(),ye=(0,m.Ue)(),_e=(0,p.c)(),Te=(0,p.c)(),xe=(0,p.c)(),be=[(0,d.J$)(),(0,d.J$)(),(0,d.J$)(),(0,d.J$)()],Oe=[(0,p.c)(),(0,p.c)(),(0,p.c)(),(0,p.c)()],Se=(0,g.Ue)(),Ce=(0,g.Ue)(),Ee=(0,g.Ue)(),Ae=(0,g.Ue)()},62930:function(e,t,r){r.d(t,{S:function(){return a}});var n=r(11873),i=r(8229),a={vvSizeEnabled:!1,vvSizeMinSize:(0,i.f)(1,1,1),vvSizeMaxSize:(0,i.f)(100,100,100),vvSizeOffset:(0,i.f)(0,0,0),vvSizeFactor:(0,i.f)(1,1,1),vvSizeValue:(0,i.f)(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:(0,n.c)()}},82694:function(e,t,r){r.d(t,{H:function(){return Ie}});var n=r(15671),i=r(43144),a=r(60136),o=r(54062),s=r(71011),l=r(92026),u=r(38499),c=function(){function e(){(0,n.Z)(this,e),this.enabled=!0,this._time=0}return(0,i.Z)(e,[{key:"time",get:function(){return(0,u.HA)(this._time)}},{key:"advance",value:function(e){return(0,l.pC)(e.forcedTime)?this._time!==e.forcedTime&&(this._time=e.forcedTime,!0):!(!this.enabled||0===e.dt)&&(this._time+=e.dt,!0)}}]),e}(),d=r(94425),h=r(56529),f=r(78041),p=r(93822),v=r(68401),m=r(23620),g=r(27366),y=r(93169),_=r(85015),T=r(16889),x=r(49861),b=(r(63780),r(25243),r(69912)),O=r(14226),S=r(81949),C=r(11186),E=r(71353),A=(r(48976),r(98131)),R=r(40927);r(11185);function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return[e[0],e[1],e[2],e[3]]}function P(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w();return(0,C.c)(r,e,t),(0,C.n)(r,r),r[3]=(0,R.EU)(e,t),r}var I=[0,0,1,0],D=((0,A.a)(),(0,A.a)(),r(4685)),M=r(82144),H=r(31132),N=r(7566),Z=r(27627),L=r(8548),F=r(36207),k=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),i=t.call(this,e,null,(function(){return i.destroy()}))}return(0,i.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build();return new Z.$(e.rctx,t,N.i)}},{key:"initializePipeline",value:function(){return(0,F.sm)({blending:(0,F.if)(L.zi.ONE,L.zi.SRC_ALPHA),depthTest:{func:L.wb.LEQUAL},colorWrite:F.BK})}}]),r}(H.A);k.shader=new M.J(D.C,(function(){return r.e(3359).then(r.bind(r,43359))}));var U,z=r(46784),V=r(27135),j=U=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).type="cloudy",i.cloudCover=.5,i}return(0,i.Z)(r,[{key:"clone",value:function(){return new U({cloudCover:this.cloudCover})}}]),r}(z.wq);(0,g._)([(0,V.J)({cloudy:"cloudy"})],j.prototype,"type",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],j.prototype,"cloudCover",void 0);var G,B=j=U=(0,g._)([(0,b.j)("esri.views.3d.environment.CloudyWeather")],j),W=G=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).type="foggy",i.fogStrength=.5,i}return(0,i.Z)(r,[{key:"clone",value:function(){return new G({fogStrength:this.fogStrength})}}]),r}(z.wq);(0,g._)([(0,V.J)({foggy:"foggy"})],W.prototype,"type",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],W.prototype,"fogStrength",void 0);var q,J=W=G=(0,g._)([(0,b.j)("esri.views.3d.environment.FoggyWeather")],W),X=q=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).type="rainy",i.cloudCover=.5,i.precipitation=.5,i}return(0,i.Z)(r,[{key:"clone",value:function(){return new q({cloudCover:this.cloudCover,precipitation:this.precipitation})}}]),r}(z.wq);(0,g._)([(0,V.J)({rainy:"rainy"})],X.prototype,"type",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],X.prototype,"cloudCover",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],X.prototype,"precipitation",void 0);var Y,K=X=q=(0,g._)([(0,b.j)("esri.views.3d.environment.RainyWeather")],X),$=Y=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).type="snowy",i.cloudCover=.5,i.precipitation=.5,i}return(0,i.Z)(r,[{key:"clone",value:function(){return new Y({cloudCover:this.cloudCover,precipitation:this.precipitation})}}]),r}(_.Z);(0,g._)([(0,V.J)({snowy:"snowy"})],$.prototype,"type",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],$.prototype,"cloudCover",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],$.prototype,"precipitation",void 0);var Q,ee=$=Y=(0,g._)([(0,b.j)("esri.views.3d.environment.SnowyWeather")],$),te=Q=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).type="sunny",i.cloudCover=.5,i}return(0,i.Z)(r,[{key:"clone",value:function(){return new Q({cloudCover:this.cloudCover})}}]),r}(z.wq);(0,g._)([(0,V.J)({sunny:"sunny"})],te.prototype,"type",void 0),(0,g._)([(0,x.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1}})],te.prototype,"cloudCover",void 0);var re={key:"type",base:null,typeMap:{sunny:te=Q=(0,g._)([(0,b.j)("esri.views.3d.environment.SunnyWeather")],te),cloudy:B,rainy:K,snowy:ee,foggy:J}};Object.keys(re.typeMap);var ne=1e4;var ie,ae,oe,se,le=r(32534),ue=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e))._inverseProjectionMatrix=(0,S.c)(),i._inverseViewMatrix=(0,S.c)(),i._technique=new k(e),i._vao=(0,le.ow)(e.rctx),i._setDefaultParallax(e.radius),i}return(0,i.Z)(r,[{key:"destroy",value:function(){this._technique=(0,l.RY)(this._technique),this._vao=(0,l.O3)(this._vao)}},{key:"render",value:function(e,t,r){this._parameters.clouds=t;var n=e.camera;if(!(0,l.Wi)(this._vao)&&!(0,l.Wi)(n)){var i=e.rctx,a=i.useTechnique(this._technique);e.scenelightingData.setLightDirectionUniform(a),e.scenelightingData.setUniforms(a,!1,!1),(0,O.a)(this._inverseProjectionMatrix,n.projectionMatrix),(0,O.a)(this._inverseViewMatrix,n.viewMatrix),a.setUniformMatrix4fv("inverseProjectionMatrix",this._inverseProjectionMatrix),a.setUniformMatrix4fv("inverseViewMatrix",this._inverseViewMatrix),a.setUniform2f("cloudVariables",this._parameters.clouds.coverage,this._parameters.clouds.absorption),this._setParallaxParams(n.eye,r),e.cloudsCompositionParams=this._parameters,ce(a,n,this._parameters),i.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(L.MX.TRIANGLE_STRIP,0,4)}}},{key:"isFading",get:function(){return this._parameters.crossFade.stage!==oe.FINISHED||this._parameters.fadeInOut.stage!==ae.FINISHED||this._parameters.fadeIn.stage!==ie.FINISHED||this._parameters.fadeInOutHeight.stage!==se.FINISHED}},{key:"_setDefaultParallax",value:function(e){this._parameters={parallax:{anchorPointClouds:(0,E.c)(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:(0,S.c)()},parallaxNew:{anchorPointClouds:(0,E.c)(),radius:e,cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:(0,S.c)()},crossFade:{stage:oe.FINISHED,factor:0,distanceThresholdFactor:.3},fadeInOut:{stage:ae.FINISHED,factor:0,distanceThresholdFactor:.6},fadeIn:{stage:ie.FINISHED,factor:0,distanceThresholdFactor:2},fadeInOutHeight:{stage:se.FINISHED,factor:-1},cameraPositionLastFrame:(0,E.c)(),startTime:0,startTimeHeightFade:0,clouds:null}}},{key:"_isCameraPositionFinal",value:function(e){return(0,C.y)(this._parameters.cameraPositionLastFrame,e)}},{key:"_setFadeInStage",value:function(e){var t=this._isCameraPositionFinal(e);this._parameters.fadeIn.stage===ie.FINISHED&&(this._parameters.fadeIn.factor=1,(0,C.g)(this._parameters.parallax.anchorPointClouds,fe),this._parameters.fadeIn.stage=ie.CHANGE_ANCHOR,this._parameters.crossFade.stage=oe.FINISHED,this._parameters.fadeInOut.stage=ae.FINISHED),this._parameters.fadeIn.stage===ie.CHANGE_ANCHOR&&t&&((0,C.g)(this._parameters.parallax.anchorPointClouds,fe),this._parameters.fadeIn.stage=ie.FADE_IN,this._parameters.startTime=performance.now()),this._parameters.fadeIn.factor>0&&this._parameters.fadeIn.stage===ie.FADE_IN&&(this._parameters.fadeIn.factor=1-(performance.now()-this._parameters.startTime)/500),this._parameters.fadeIn.factor<=0&&this._parameters.fadeIn.stage===ie.FADE_IN&&(this._parameters.fadeIn.stage=ie.FINISHED,this._parameters.fadeIn.factor=0)}},{key:"_setCrossFadingStage",value:function(){this._parameters.crossFade.stage===oe.FINISHED&&((0,C.g)(this._parameters.parallaxNew.anchorPointClouds,fe),this._parameters.startTime=performance.now(),this._parameters.crossFade.factor=0,this._parameters.crossFade.stage=oe.CROSS_FADE),this._parameters.crossFade.factor<1&&this._parameters.crossFade.stage===oe.CROSS_FADE&&(this._parameters.crossFade.factor=(performance.now()-this._parameters.startTime)/500),this._parameters.crossFade.factor>=1&&this._parameters.crossFade.stage===oe.CROSS_FADE&&(this._parameters.crossFade.stage=oe.FINISHED,this._parameters.crossFade.factor=1,(0,C.g)(this._parameters.parallax.anchorPointClouds,this._parameters.parallaxNew.anchorPointClouds))}},{key:"_setFadeInOutStage",value:function(e){this._parameters.fadeInOut.stage===ae.FINISHED&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=0,this._parameters.fadeInOut.stage=ae.FADE_OUT),this._parameters.fadeInOut.factor<1&&this._parameters.fadeInOut.stage===ae.FADE_OUT&&(this._parameters.fadeInOut.factor=(performance.now()-this._parameters.startTime)/250),this._parameters.fadeInOut.factor>=1&&this._parameters.fadeInOut.stage===ae.FADE_OUT&&(this._parameters.fadeInOut.factor=1,(0,C.g)(this._parameters.parallax.anchorPointClouds,fe)),this._parameters.fadeInOut.factor>=1&&this._parameters.fadeInOut.stage===ae.FADE_OUT&&this._isCameraPositionFinal(e)&&(this._parameters.startTime=performance.now(),this._parameters.fadeInOut.factor=1,this._parameters.fadeInOut.stage=ae.FADE_IN,this._parameters.crossFade.stage=oe.FINISHED,this._parameters.crossFade.factor=0),this._parameters.fadeInOut.factor>0&&this._parameters.fadeInOut.stage===ae.FADE_IN&&(this._parameters.fadeInOut.factor=1-(performance.now()-this._parameters.startTime)/500),this._parameters.fadeInOut.factor<=0&&this._parameters.fadeInOut.stage===ae.FADE_IN&&(this._parameters.fadeInOut.stage=ae.FINISHED,this._parameters.fadeInOut.factor=0)}},{key:"_setFadeInOutHeight",value:function(e){var t=performance.now();this._parameters.startTimeHeightFade=this._parameters.fadeInOutHeight.stage===se.FINISHED?t:this._parameters.startTimeHeightFade,e?this._parameters.fadeInOutHeight.factor+=(t-this._parameters.startTimeHeightFade)/500:this._parameters.fadeInOutHeight.factor-=(t-this._parameters.startTimeHeightFade)/500,this._parameters.startTimeHeightFade=t,this._parameters.fadeInOutHeight.factor=(0,T.uZ)(this._parameters.fadeInOutHeight.factor,0,1),this._parameters.fadeInOutHeight.stage=se.HEIGHT_FADE}},{key:"_setParallaxParams",value:function(e,t){this._parameters.fadeInOutHeight.factor<0&&(this._parameters.fadeInOutHeight.factor=(0,C.l)(e)-this._parameters.parallax.radius>ne?1:0),(0,C.n)(fe,e),(0,C.a)(fe,fe,this._parameters.parallax.radius),0===this._parameters.parallax.anchorPointClouds[0]&&0===this._parameters.parallax.anchorPointClouds[1]&&0===this._parameters.parallax.anchorPointClouds[2]&&(0,C.g)(this._parameters.parallax.anchorPointClouds,fe);var r=(0,C.l)((0,C.f)(pe,this._parameters.parallax.anchorPointClouds,fe)),n=!0;r>this._parameters.fadeIn.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeIn.stage!==ie.FINISHED?this._setFadeInStage(e):r>this._parameters.fadeInOut.distanceThresholdFactor*this._parameters.parallax.cloudsHeight||this._parameters.fadeInOut.stage!==ae.FINISHED?this._setFadeInOutStage(e):r>this._parameters.crossFade.distanceThresholdFactor*this._parameters.parallax.cloudsHeight&&!t||this._parameters.crossFade.stage!==oe.FINISHED?this._setCrossFadingStage():n=!1;var i=(0,C.l)(e),a=i-this._parameters.parallax.radius;(a>17e3||a<-1e4)&&this._parameters.fadeInOutHeight.factor<1?this._parameters.fadeInOutHeight.factor=1:(a>ne||a<-3500)&&this._parameters.fadeInOutHeight.factor<1?this._setFadeInOutHeight(!0):a<ne&&a>-3500&&this._parameters.fadeInOutHeight.factor>0?this._setFadeInOutHeight(!1):this._parameters.fadeInOutHeight.stage=se.FINISHED,this._parameters.parallax.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-this._parameters.parallax.radius*this._parameters.parallax.radius,0))/i,P(de,this._parameters.parallax.anchorPointClouds,he),this._parameters.parallax.transform=(0,S.c)(),(0,O.e)(this._parameters.parallax.transform,this._parameters.parallax.transform,he[3],he),n&&(P(de,this._parameters.parallaxNew.anchorPointClouds,he),this._parameters.parallaxNew.transform=(0,S.c)(),(0,O.e)(this._parameters.parallaxNew.transform,this._parameters.parallaxNew.transform,he[3],he)),(0,C.g)(this._parameters.cameraPositionLastFrame,e)}}]),r}(_.Z);function ce(e,t,r){e.bindTexture(r.clouds.cubeMap.colorTexture,"cubeMap"),e.setUniform1f("cloudsHeight",r.parallax.cloudsHeight),e.setUniformMatrix4fv("rotationMatrixClouds",r.parallax.transform),e.setUniformMatrix4fv("rotationMatrixCloudsCrossFade",r.parallaxNew.transform),e.setUniform3fv("anchorPosition",r.parallax.anchorPointClouds),e.setUniform3fv("anchorPositionCrossFade",r.parallaxNew.anchorPointClouds),r.fadeInOut.stage!==ae.FINISHED?e.setUniform1f("totalFadeInOut",r.fadeInOutHeight.factor+Math.max((0,T.uZ)(r.fadeInOut.factor,0,1))):e.setUniform1f("totalFadeInOut",r.fadeInOutHeight.factor+Math.max((0,T.uZ)(r.fadeIn.factor,0,1))),e.setUniform1f("radiusCurvatureCorrectionFactor",r.parallax.radiusCurvatureCorrectionFactor),e.setUniform1i("crossFade",r.crossFade.stage),e.setUniform1f("crossFadeAnchorFactor",(0,T.uZ)(r.crossFade.factor,0,1)),e.setUniform1f("radius",r.parallax.radius),e.setUniform3fv("cameraPosition",t.eye)}(0,g._)([(0,x.Cb)({constructOnly:!0})],ue.prototype,"rctx",void 0),(0,g._)([(0,x.Cb)({constructOnly:!0})],ue.prototype,"viewingMode",void 0),(0,g._)([(0,x.Cb)({constructOnly:!0})],ue.prototype,"radius",void 0),ue=(0,g._)([(0,b.j)("esri.views.3d.environment.CloudsComposition")],ue),function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"}(ie||(ie={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.FADE_IN=2]="FADE_IN"}(ae||(ae={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.CROSS_FADE=1]="CROSS_FADE"}(oe||(oe={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(se||(se={}));var de=(0,E.f)(0,0,1),he=w(),fe=(0,E.c)(),pe=(0,E.c)(),ve=r(33280),me=r(137),ge=r(15226),ye=r(41481),_e=r(23235),Te=r(70755),xe=r(79246),be=r(41012),Oe=r(33559),Se=r(49810),Ce=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e,i,a){var o;return(0,n.Z)(this,r),(o=t.call(this,e,i,a))._textureRepository=e.waterTextureRepository,o}return(0,i.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get(),n=this.configuration,i=t.build({oitEnabled:n.transparencyPassType===v.Am.Color,output:n.output,viewingMode:e.viewingMode,slicePlaneEnabled:n.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:n.receiveShadows,pbrMode:ye.f7.Water,useCustomDTRExponentForWater:!0,ssrEnabled:n.useSSR,cloudsReflectionsEnabled:(0,y.Z)("enable-feature:clouds-reflections"),highStepCount:!0,multipassTerrainEnabled:n.multipassTerrainEnabled,cullAboveGround:n.cullAboveGround});return new Z.$(e.rctx,i,N.i)}},{key:"bindPass",value:function(e,t){(0,be.II)(this.program,t.camera.projectionMatrix),t.multipassTerrainEnabled&&(this.program.setUniform2fv("nearFar",t.camera.nearFar),this.program.setUniform2fv("inverseViewport",t.inverseViewport),(0,ge.p)(this.program,t)),this.configuration.output===s.H.Color&&(t.lighting.setUniforms(this.program,!1,!1),(0,Te.O)(this.program,t),(0,y.Z)("enable-feature:clouds-reflections")&&(0,l.pC)(t.cloudsCompositionParams)&&ce(this.program,t.camera,t.cloudsCompositionParams)),this.configuration.output!==s.H.Color&&this.configuration.output!==s.H.Normal||((0,xe.b)(this.program,e),this._textureRepository.bind(this.program)),this.program.setUniform4fv("waterColor",e.color),this.configuration.output===s.H.Highlight&&(0,me.wW)(this.program,t)}},{key:"bindDraw",value:function(e){(0,be.id)(this.program,e),this.program.rebindTextures(),this.configuration.output!==s.H.Color&&this.configuration.output!==s.H.Alpha||(0,be.fb)(this.program,e.origin,e.camera.viewInverseTransposeMatrix),this.configuration.output===s.H.Color&&(0,_e.O2)(this.program,e),this.configuration.output!==s.H.Color&&this.configuration.output!==s.H.Alpha&&this.configuration.output!==s.H.Highlight||(0,ve.DA)(this.program,this.configuration,e)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,r=e===v.Am.NONE,n=e===v.Am.FrontFace;return(0,F.sm)({blending:t.output!==s.H.Normal&&t.output!==s.H.Highlight&&t.transparent?r?f.wu:(0,f.j7)(e):null,depthTest:{func:(0,f.Bh)(e)},depthWrite:r?t.writeDepth&&F.LZ:(0,f.K5)(e),colorWrite:F.BK,polygonOffset:r||n?null:(0,f.je)(t.enableOffset)})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}}]),r}(H.A);Ce.shader=new M.J(Se.W,(function(){return r.e(9106).then(r.bind(r,19106))}));var Ee=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).output=s.H.Color,e.receiveShadows=!1,e.slicePlaneEnabled=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!1,e.useSSR=!1,e.isDraped=!1,e.transparencyPassType=v.Am.NONE,e.multipassTerrainEnabled=!1,e.cullAboveGround=!1,e}return(0,i.Z)(r)}(Oe.m);(0,g._)([(0,Oe.o)({count:s.H.COUNT})],Ee.prototype,"output",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"receiveShadows",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"slicePlaneEnabled",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"transparent",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"enableOffset",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"writeDepth",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"useSSR",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"isDraped",void 0),(0,g._)([(0,Oe.o)({count:v.Am.COUNT})],Ee.prototype,"transparencyPassType",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"multipassTerrainEnabled",void 0),(0,g._)([(0,Oe.o)()],Ee.prototype,"cullAboveGround",void 0);var Ae=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"updateParameters",value:function(e){return this.ensureTechnique(Ce,e)}},{key:"setElapsedTimeUniform",value:function(e){var t=.001*this._material.animation.time;e.setUniform1f("timeElapsed",t*this._material.parameters.animationSpeed)}},{key:"_updateShadowState",value:function(e){e.shadowMappingEnabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMappingEnabled})}},{key:"_updateSSRState",value:function(e){e.ssrEnabled!==this._material.parameters.ssrEnabled&&this._material.setParameters({ssrEnabled:e.ssrEnabled})}},{key:"ensureResources",value:function(e){var t=this._techniqueRep.constructionContext.waterTextureRepository;return t.ready||t.updating||t.loadTextures(e),t.ready?v.Rw.LOADED:v.Rw.LOADING}},{key:"beginSlot",value:function(e){return this._output===s.H.Color&&(this._updateShadowState(e),this._updateSSRState(e)),this.updateParameters(e)}},{key:"bind",value:function(e,t){t.bindPass(this._material.parameters,e),this._output!==s.H.Normal&&this._output!==s.H.Color||this.setElapsedTimeUniform(t.program)}}]),r}(m.Z),Re=r(64226),we=r(22909),Pe=r(30895),Ie=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e,Pe.a))._techniqueConfig=new Ee,i.animation=new c,i}return(0,i.Z)(r,[{key:"getTechniqueConfig",value:function(e,t){return this._techniqueConfig.output=e,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.slicePlaneEnabled=this.parameters.slicePlaneEnabled,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.useSSR=this.parameters.ssrEnabled,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=t.transparencyPassType,this._techniqueConfig.enableOffset=t.camera.relativeElevation<f.ve,this._techniqueConfig.multipassTerrainEnabled=t.multipassTerrainEnabled,this._techniqueConfig.cullAboveGround=t.cullAboveGround,this._techniqueConfig}},{key:"update",value:function(e){var t=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<De;var r=this.animation.advance(e);return this.animation.enabled&&r}},{key:"intersect",value:function(e,t,r,n,i,a,o){(0,we.Bw)(e,t,n,i,a,void 0,o)}},{key:"requiresSlot",value:function(e,t){switch((0,d.S)(t)){case s.H.Normal:return e===p.r.DRAPED_WATER;case s.H.Color:if(this.parameters.isDraped)return e===p.r.DRAPED_MATERIAL;break;case s.H.Highlight:return e===p.r.OPAQUE_MATERIAL||e===p.r.DRAPED_MATERIAL}var r=p.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?p.r.TRANSPARENT_MATERIAL:p.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}},{key:"createGLMaterial",value:function(e){if(e.output===s.H.Color&&this.parameters.isDraped)return e.output=s.H.Draped,new Ae(e);switch(e.output){case s.H.Color:case s.H.Normal:case s.H.Highlight:case s.H.Alpha:return new Ae(e)}return null}},{key:"createBufferWriter",value:function(){return new Re.G_(Re.W1)}}]),r}(h.F5),De=35e3},64226:function(e,t,r){r.d(t,{G_:function(){return d},IM:function(){return c},W1:function(){return u},wp:function(){return l}});var n=r(15671),i=r(43144),a=r(55158),o=r(4760),s=r(33236),l=(0,a.U$)().vec3f(o.T.POSITION),u=(0,a.U$)().vec3f(o.T.POSITION).vec2f(o.T.UV0),c=(0,a.U$)().vec3f(o.T.POSITION).vec4u8(o.T.COLOR),d=function(){function e(t){(0,n.Z)(this,e),this.vertexBufferLayout=t}return(0,i.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(o.T.POSITION).length}},{key:"write",value:function(e,t,r,n){(0,s.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,r,n)}}]),e}()},30895:function(e,t,r){r.d(t,{Z:function(){return s},a:function(){return o}});var n=r(1413),i=r(6394),a=r(56529),o=(0,n.Z)({waveStrength:.06,waveTextureRepeat:32,waveDirection:(0,i.f)(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1},a.mo),s={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}}},86700:function(e,t,r){r.d(t,{Dp:function(){return l},z5:function(){return s}});var n=r(93433),i=r(92026),a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},o={dash:a.dash,"dash-dot":[].concat((0,n.Z)(a.dash),(0,n.Z)(a.dot)),dot:a.dot,"long-dash":a["long-dash"],"long-dash-dot":[].concat((0,n.Z)(a["long-dash"]),(0,n.Z)(a.dot)),"long-dash-dot-dot":[].concat((0,n.Z)(a["long-dash"]),(0,n.Z)(a.dot),(0,n.Z)(a.dot)),none:null,"short-dash":a["short-dash"],"short-dash-dot":[].concat((0,n.Z)(a["short-dash"]),(0,n.Z)(a["short-dot"])),"short-dash-dot-dot":[].concat((0,n.Z)(a["short-dash"]),(0,n.Z)(a["short-dot"]),(0,n.Z)(a["short-dot"])),"short-dot":a["short-dot"],solid:null};function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return{pattern:[e,e],pixelRatio:t}}function l(e){return(0,i.pC)(e)&&"style"===e.type?function(e){return(0,i.pC)(e)?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return(0,i.Wi)(e)?e:{pattern:e.slice(),pixelRatio:t}}(o[e],8):null}(e.style):null}}}]);
//# sourceMappingURL=1221.07450c83.chunk.js.map