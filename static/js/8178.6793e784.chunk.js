"use strict";(globalThis.webpackChunkfield_sustainability_helper=globalThis.webpackChunkfield_sustainability_helper||[]).push([[8178],{58178:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var s=n(10064),r=n(32718),i=n(92026),a=n(66978),o=n(92975),u=n(83406),l=n(68928),h=n(19995),c=n(14e3),y=n(47615),d=n(68808),p=n(12622),g=n(52410);class _{constructor(){this._queryEngine=null,this._customParameters=null,this._snapshotFeatures=async e=>{const{objectIdField:t}=this._queryEngine,n=await(0,p.Bm)(this._getFeatureUrl,this._featureType.typeName,this._getFeatureOutputFormat,{customParameters:this._customParameters,dateFields:this._queryEngine.fieldsIndex.dateFields.map((e=>e.name)),signal:e});await(0,y.O3)(n),(0,a.k_)(e);const s=(0,y.lG)(n,{geometryType:this._queryEngine.geometryType,hasZ:!1,objectIdField:t});if(!(0,o.fS)(this._queryEngine.spatialReference,o.Zn))for(const a of s)(0,i.pC)(a.geometry)&&(a.geometry=(0,u.GH)((0,h.iV)((0,u.di)(a.geometry,this._queryEngine.geometryType,!1,!1),o.Zn,this._queryEngine.spatialReference)));let r=1;for(const i of s){const e={};(0,d.O0)(this._fieldsIndex,e,i.attributes,!0),i.attributes=e,null==i.attributes[t]&&(i.objectId=i.attributes[t]=r++)}return s}}destroy(){var e;null==(e=this._queryEngine)||e.destroy(),this._queryEngine=null}async load(e,t){const{getFeatureUrl:n,getFeatureOutputFormat:s,spatialReference:r,fields:o,geometryType:u,featureType:h,objectIdField:y,customParameters:d}=e;this._featureType=h,this._customParameters=d,this._getFeatureUrl=n,this._getFeatureOutputFormat=s,this._fieldsIndex=new g.Z(o),await this._checkProjection(r),(0,a.k_)(t),this._queryEngine=new c.Z({fields:o,geometryType:u,hasM:!1,hasZ:!1,objectIdField:y,spatialReference:r,timeInfo:null,featureStore:new l.Z({geometryType:u,hasM:!1,hasZ:!1})});const p=await this._snapshotFeatures((0,i.Wg)(t.signal));return this._queryEngine.featureStore.addMany(p),{extent:this._queryEngine.fullExtent}}async applyEdits(){throw new s.Z("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForIds(e,t.signal)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForSnapping(e,t.signal)}async refresh(e){var t;return this._customParameters=e,null==(t=this._snapshotTask)||t.abort(),this._snapshotTask=(0,a.vr)(this._snapshotFeatures),this._snapshotTask.promise.then((e=>{this._queryEngine.featureStore.clear(),e&&this._queryEngine.featureStore.addMany(e)}),(e=>{this._queryEngine.featureStore.clear(),(0,a.D_)(e)||r.Z.getLogger("esri.layers.WFSLayer").error(new s.Z("wfs-layer:getfeature-error","An error occurred during the GetFeature request",{error:e}))})),await this._waitSnapshotComplete(),{extent:this._queryEngine.fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _checkProjection(e){try{await(0,h._W)(o.Zn,e)}catch{throw new s.Z("unsupported-projection","Projection not supported",{spatialReference:e})}}}},68808:(e,t,n)=>{n.d(t,{O0:()=>c,av:()=>o,b:()=>g,d1:()=>l,og:()=>p});var s=n(92975),r=n(80031);class i{constructor(){this.code=null,this.description=null}}class a{constructor(e){this.error=new i,this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error.description=e}}function o(e){return new a(e)}class u{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}function l(e){return new u(e)}const h=new Set;function c(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;h.clear();for(const a in n){const u=e.get(a);if(!u)continue;const l=n[a],c=y(u,l);if(c!==l&&i&&i.push({name:"invalid-value-type",message:"attribute value was converted to match the field type",details:{field:u,originalValue:l,sanitizedValue:c}}),h.add(u.name),u&&(s||u.editable)){const e=(0,r.Qc)(u,c);if(e)return o((0,r.vP)(e,u,c));t[u.name]=c}}for(const r of e.requiredFields)if(!h.has(r.name))return o(`missing required field "${r.name}"`);return null}function y(e,t){let n=t;return"string"==typeof t&&(0,r.H7)(e)?n=parseFloat(t):null!=t&&(0,r.qN)(e)&&"string"!=typeof t&&(n=String(t)),(0,r.Pz)(n)}let d;function p(e,t){if(!e||!(0,s.JY)(t))return e;if("rings"in e||"paths"in e){if(!d)throw new TypeError("geometry engine not loaded");return d.simplify(t,e)}return e}async function g(e,t){!(0,s.JY)(e)||"esriGeometryPolygon"!==t&&"esriGeometryPolyline"!==t||await async function(){return d||(d=await n.e(309).then(n.bind(n,50309)),d)}()}}}]);
//# sourceMappingURL=8178.6793e784.chunk.js.map