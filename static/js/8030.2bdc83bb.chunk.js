"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[8030],{55635:function(e,t,i){i.d(t,{OE:function(){return d},Gc:function(){return m},Qg:function(){return v},Rq:function(){return h},gX:function(){return p},z2:function(){return f},ET:function(){return y},Vx:function(){return b}});i(59486);var r=i(92026),n=i(15671),a=i(43144),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;(0,n.Z)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,i)}return(0,a.Z)(e,[{key:"decreaseRefCount",value:function(e,t){var i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){var n=r.get(i);return n.refCount--,n.refCount<=0&&(r.delete(i),n.controller&&n.controller.abort()),n.refCount}return 0}},{key:"getBlock",value:function(e,t){var i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){var n=r.get(i);return n.ts=Date.now(),n.refCount++,r.delete(i),r.set(i,n),n.block}return null}},{key:"putBlock",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=this._cachedBlocks,a=e+"/"+t;if(n.has(a)){var s=n.get(a);s.ts=Date.now(),s.refCount++}else n.set(a,{block:i,ts:Date.now(),refCount:1,controller:r});this.trim(),this.updateTimer()}},{key:"deleteBlock",value:function(e,t){var i=this._cachedBlocks,r=e+"/"+t;i.has(r)&&i.delete(r)}},{key:"updateMaxSize",value:function(e){this._size=e,this.trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this.clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var i=Array.from(t),r=Date.now(),n=0;n<i.length&&i[n][1].ts<=r-e._duration;n++)t.delete(i[n][0]);0===t.size&&e.clearTimer()}),this._interval)}}},{key:"trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),i=0;i<t.length-this._size;i++)e.delete(t[i][0])}},{key:"clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),l=i(80394),o=i(7882),u=new Map,c=new s;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var i={extent:null,rasterInfo:t,cache:new Map};if(u.has(e)){var r=u.get(e);return r.push(i),r.length-1}return u.set(e,[i]),0}function y(e,t){if(u.has(e)){var i=u.get(e);i[t]=null,i.some((function(e){return null!=e}))||u.delete(e)}}function d(e,t,i){if(!u.has(e))return null==t?c.decreaseRefCount(e,i):0;var r=u.get(e);if(null==r[t])return c.decreaseRefCount(e,i);var n=r[t].cache;if(n.has(i)){var a=n.get(i);if(a.refCount--,0===a.refCount){n.delete(i);for(var s=0;s<r.length;s++)r[s]&&r[s].cache.has(i)&&r[s].cache.delete(i);a.controller&&a.controller.abort()}return a.refCount}return 0}function v(e,t,i){if(!u.has(e))return null==t?c.getBlock(e,i):null;var r=u.get(e);if(null==r[t]){for(var n=0;n<r.length;n++)if(r[n]&&r[n].cache.has(i)){var a=r[n].cache.get(i);return a.refCount++,a.block}return c.getBlock(e,i)}var s=r[t].cache;if(s.has(i)){var l=s.get(i);return l.refCount++,l.block}for(var o=0;o<r.length;o++)if(o!==t&&r[o]&&r[o]&&r[o].cache.has(i)){var h=r[o].cache.get(i);return h.refCount++,s.set(i,h),h.block}return null}function p(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u.has(e)){var a=u.get(e);if(null!=a[t]){var s={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:n};r.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),a[t].cache.set(i,s)}else c.putBlock(e,i,r,n)}else null==t&&c.putBlock(e,i,r,n)}function m(e,t,i){if(u.has(e)){var r=u.get(e);null!=r[t]?r[t].cache.delete(i):c.deleteBlock(e,i)}else null==t&&c.deleteBlock(e,i)}function g(e,t){if(!u.has(e))return null;var i=u.get(e);return null==i[t]?null:i[t]}function b(e,t,i,n,a,s){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=g(e,t),h=c.extent,f=c.cache,y=c.rasterInfo;if(!h||h.xmin!==i.xmin||h.xmax!==i.xmax||h.ymin!==i.ymin||h.ymax!==i.ymax){for(var d=i.clone().normalize(),v=y.spatialReference,p=y.transform,m=new Set,b=0;b<d.length;b++){var _=d[b];if(!(_.xmax-_.xmin<=n||_.ymax-_.ymin<=n)){var w=(0,l.tB)(_,v,u);(0,r.pC)(p)&&(w=p.inverseTransform(w));var k=new o.Z({x:n,y:n,spatialReference:_.spatialReference});if(null==a&&!(a=(0,l.VO)(k,v,_,u)))return;var x=(0,l.kr)(a,y,s||"closest"),P=x.pyramidLevel,C=x.pyramidResolution,T=x.excessiveReading;if(T)return;for(var Z=y.storageInfo,I=Z.origin,R={x:Math.max(0,Math.floor((w.xmin-I.x)/C.x)),y:Math.max(0,Math.floor((I.y-w.ymax)/C.y))},V=Math.ceil((w.xmax-w.xmin)/C.x-.1),S=Math.ceil((w.ymax-w.ymin)/C.y-.1),z=P>0?Z.pyramidBlockWidth:Z.blockWidth,D=P>0?Z.pyramidBlockHeight:Z.blockHeight,F=1,U=Math.max(0,Math.floor(R.x/z)-F),B=Math.max(0,Math.floor(R.y/D)-F),L=Math.floor((R.x+V-1)/z)+F,E=Math.floor((R.y+S-1)/D)+F,G=B;G<=E;G++)for(var M=U;M<=L;M++)m.add("".concat(P,"/").concat(G,"/").concat(M))}}f.forEach((function(e,t){if(!m.has(t)){var i=f.get(t);(null==i||i.isResolved||i.isRejected)&&f.delete(t)}})),c.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}}},55067:function(e,t,i){i.d(t,{Z:function(){return p}});var r=i(37762),n=i(15671),a=i(43144),s=i(11752),l=i(61120),o=i(60136),u=i(29388),c=i(93169),h=i(80613),f=i(64510),y=i(60418),d=i(40655),v=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},p=function(e){(0,o.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this))._tileInfoView=e,r}return(0,a.Z)(i,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(v),this.setStencilReference(),(0,s.Z)((0,l.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=(0,s.Z)((0,l.Z)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=(0,s.Z)((0,l.Z)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[d.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,c.Z)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[y.Z],drawPhase:h.jx.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t,i=(0,r.Z)(this.children);try{for(i.s();!(t=i.n()).done;){var n=t.value,a=this._tileInfoView.getTileResolution(n.key);n.setTransform(e,a)}}catch(s){i.e(s)}finally{i.f()}}},{key:"setStencilReference",value:function(){var e,t=1,i=(0,r.Z)(this.children);try{for(i.s();!(e=i.n()).done;){e.value.stencilRef=t++}}catch(n){i.e(n)}finally{i.f()}}}]),i}(f.Z)},72900:function(e,t,i){i.d(t,{I:function(){return h}});var r=i(29439),n=i(15671),a=i(43144),s=i(60136),l=i(29388),o=i(22753),u=i(87422),c=i(73828),h=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e,r,a,s,l){var o,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l;return(0,n.Z)(this,i),(o=t.call(this)).triangleCountReportedInDebug=0,o.triangleCount=0,o.texture=null,o.key=new c.Z(e),o.x=r,o.y=a,o.width=s,o.height=l,o.rangeX=u,o.rangeY=h,o}return(0,a.Z)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var i=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,a=e.toScreenNoRotation([0,0],[this.x,this.y]),s=(0,r.Z)(a,2),l=s[0],u=s[1],c=this.width/this.rangeX*i,h=this.height/this.rangeY*i;(0,o.s)(n,c,0,0,0,h,0,l,u,1),(0,o.m)(this.transforms.dvs,e.displayViewMat3,n)}}]),i}(u.s)},68030:function(e,t,i){i.r(t),i.d(t,{default:function(){return pe}});var r=i(15861),n=i(15671),a=i(43144),s=i(60136),l=i(29388),o=i(87757),u=i(27366),c=i(52639),h=i(32718),f=i(66978),y=i(8537),d=i(49861),v=(i(63780),i(93169),i(25243),i(69912)),p=i(2608),m=i(95986),g=i(29439),b=i(11752),_=i(61120),w=i(92026),k=i(93433),x=i(65156),P=i(86226),C=i(37826),T=i(23588),Z=i(37861),I=i(72900),R=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e,r,a,s,l){var o,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return(0,n.Z)(this,i),(o=t.call(this,e,r,a,s,l)).bitmap=new Z.br(u,null,null),o.bitmap.coordScale=[s,l],o.bitmap.once("isReady",(function(){return o.ready()})),o}return(0,a.Z)(i,[{key:"destroy",value:function(){(0,b.Z)((0,_.Z)(i.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e,t){(0,b.Z)((0,_.Z)(i.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"_createTransforms",value:function(){return{dvs:(0,T.c)(),tileMat3:(0,T.c)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),i}(I.I),V=i(80613),S=i(55067),z=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return(0,a.Z)(i,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),i=(0,g.Z)(this._tileInfoView.tileInfo.size,2),r=i[0],n=i[1];return new R(e,t[0],t[3],r,n)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"imagery (tile)",brushes:[C.U.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:V.jx.MAP});return[].concat((0,k.Z)((0,b.Z)((0,_.Z)(i.prototype),"prepareRenderPasses",this).call(this,e)),[r])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===V.jx.MAP&&(0,b.Z)((0,_.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds((0,x.Ue)(),e);if(this.isCustomTilingScheme&&e.world){var i=this._tileInfoView.tileInfo,r=(0,P.ut)(i.spatialReference);if(r){var n=i.lodAt(e.level).resolution,a=r/n%i.size[0],s=a?(i.size[0]-a)*n:0;t[0]-=s*e.world,t[2]-=s*e.world}}return t}}]),i}(S.Z),D=(i(59486),i(41691)),F=i(7882),U=i(99278),B=i(22824),L=i(55635),E=i(17314),G=i(80394),M=(i(5131),i(37995)),O=(i(73828),i(32344)),A=i(85269),q=i(90316),j=i(53866),W=[0,0],N=h.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),Q=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments))._emptyTilePixelBlock=null,e._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=null,e.previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._isCustomTilingScheme=!1,e._globalUpdateRequested=!1,e.container=null,e.layer=null,e.redrawOrRefetch=(0,f.Ds)((function(t,i){return!e.previousLOD||e.layerView.suspended?Promise.resolve():t?e.doRefresh():e._redrawImage(i)})),e}return(0,a.Z)(i,[{key:"useWebGLForProcessing",get:function(){var e;return null==(e=this._get("useWebGLForProcessing"))||e},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();var i=this._getCacheSize(e);this._tileStrategy=new A.Z({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:i,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,i=t.extent,r=t.resolution,n=t.scale,a=this._tileInfoView.getClosestInfoForScale(n);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var l=this._srcResolutions[a.level],o=i.toJSON?i:j.Z.fromJSON(i);(0,L.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,o,r,l,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this.previousLOD)?void 0:s.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}},{key:"moveEnd",value:function(){var e=this;!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.layerView.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.layerView.requestUpdate()}},{key:"updating",get:function(){return this._fetchQueue.length>0||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}},{key:"attach",value:function(){var e=this;(0,q.Z)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new M.Z(this.layerView.tileInfo,this.layerView.fullExtent);var t=this._computeFetchConcurrency();this._fetchQueue=new O.Z({tileInfoView:this._tileInfoView,concurrency:t,process:function(t,i){return e._fetchTile1(t,i)}});var i=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new A.Z({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:i,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}},{key:"acquireTile",value:function(e){var t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(function(){e.destroy(),t.layerView.requestUpdate()})),this.layerView.requestUpdate()}},{key:"uninstall",value:function(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,this.notifyChange("updating"),(0,L.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId)}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&(0,w.pC)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;var i=e=e||this._tileInfoView.tileInfo.size,r=(0,g.Z)(i,2),n=r[0],a=r[1],s=new U.Z({width:n,height:a,pixels:[new Uint8Array(n*a)],mask:new Uint8Array(n*a),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}},{key:"_fetchTile1",value:function(e,t){var i=!(0,w.Wi)(t)&&t.signal,r=this.canUseWebGLForProcessing(),n={allowPartialFill:!0,datumTransformation:this.layerView.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:r,signal:(0,w.Wg)(i),srcResolution:this._srcResolutions[e.level],timeExtent:this.layerView.timeExtent,tileInfo:this.layerView.tileInfo};return this.fetchTile(e,n)}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.layerView.view.spatialReference,t=new F.Z({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),i=(0,G.vF)(this.layer.rasterInfo,e),r=i.scales,n=i.srcResolutions,a=i.isCustomTilingScheme,s=B.Z.create({spatialReference:e,size:512,scales:r});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=a,this.layerView.set("tileInfo",s),this._srcResolutions=null!=n?n:[]}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(){var e=(0,r.Z)(o.mark((function e(t,i){var r,n,a,s,l,u=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=31;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(r=e.sent,this.notifyChange("updating"),n=this.layer.bandIds,a=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.layerView.moving||0!==this._fetchQueue.length){e.next=19;break}return a=!1,e.prev=10,e.next=13,this._redrawImage(this._abortController&&this._abortController.signal);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),(0,f.D_)(e.t0)&&N.error(e.t0);case 18:this._globalUpdateRequested=!1;case 19:return!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams(),s=this._tileInfoView.getTileCoords(W,t.key),l=this._tileInfoView.getTileResolution(t.key),e.next=23,this.updateTileSource(t,{source:r,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:a,bandIds:n,coords:s,resolution:l});case 23:t.once("attach",(function(){return u.layerView.requestUpdate()})),this.container.addChild(t),e.next=30;break;case 27:e.prev=27,e.t1=e.catch(1),(0,f.D_)(e.t1)||N.error(e.t1);case 30:this.layerView.requestUpdate();case 31:case"end":return e.stop()}}),e,this,[[1,27],[10,15]])})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=(0,r.Z)(o.mark((function e(t){var i,n=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.container.children.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.updatingHandles.addPromise(this.layer.updateRenderer());case 4:if(!this.layerView.hasTilingEffects){e.next=9;break}return e.next=7,this._updateGlobalSymbolizerParams(t);case 7:e.next=10;break;case 9:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 10:return i=this.container.children.map(function(){var e=(0,r.Z)(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.updateTileSymbolizerParameters(t,{local:n._symbolizerParams,global:n._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,(0,f.as)(i);case 13:this.container.requestRender();case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateGlobalSymbolizerParams",value:function(){var e=(0,r.Z)(o.mark((function e(t){var i,r,n;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,i);case 3:if((r=e.sent)&&r.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:n=this.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,E.qF)(r.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds}),!this.canUseWebGLForProcessing()&&n&&"stretch"===n.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(n.factor=n.factor.map((function(e){return 255*e})),n.outMin=Math.round(255*n.outMin),n.outMax=Math.round(255*n.outMax)),this._globalSymbolizerParams=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,i=t.url,r=t.rasterInfo,n=t.raster,a=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),s=a.multidimensionalDefinition,l=null!=r&&r.multidimensionalInfo?n.getSliceIndex(s):null,o=(0,L.Rq)(i,l);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,L.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,L.z2)(o,this.layer.raster.rasterInfo),e){var u=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),c=this._srcResolutions[u.level];(0,L.Vx)(o,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,c,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}},{key:"doRefresh",value:function(){var e=(0,r.Z)(o.mark((function e(){var t,i=this;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.layer.updateRenderer());case 2:return this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),this.notifyChange("updating"),t=[],this._tileStrategy.tiles.forEach((function(e){return t.push(i._enqueueTileFetch(e))})),e.next=10,(0,f.as)(t);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),i}(D.r);(0,u._)([(0,d.Cb)()],Q.prototype,"_globalUpdateRequested",void 0),(0,u._)([(0,d.Cb)()],Q.prototype,"container",void 0),(0,u._)([(0,d.Cb)()],Q.prototype,"layer",void 0),(0,u._)([(0,d.Cb)()],Q.prototype,"layerView",void 0),(0,u._)([(0,d.Cb)()],Q.prototype,"type",void 0),(0,u._)([(0,d.Cb)()],Q.prototype,"useWebGLForProcessing",null),(0,u._)([(0,d.Cb)()],Q.prototype,"useProgressiveUpdate",null),(0,u._)([(0,d.Cb)()],Q.prototype,"updating",null),Q=(0,u._)([(0,v.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],Q);var H=i(31666),J=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).container=null,e.layer=null,e.type="raster",e}return(0,a.Z)(i,[{key:"canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,H.JV)(this.layer))}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateTileSource",value:function(){var e=(0,r.Z)(o.mark((function e(t,i){var r,n,a,s,l,u,c,h,f,y,d,v,p,m,b;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.layer.bandIds,s=this._getLayerInterpolation(),l=this.canUseWebGLForProcessing(),u=i.source,c=i.symbolizerParams,h=i.globalSymbolizerParams,f=i.suspended,y=i.coords,d=i.resolution,v=t.bitmap,r=y,n=(0,g.Z)(r,2),v.x=n[0],v.y=n[1],v.resolution=d,!(u&&(0,w.pC)(u)&&(0,w.pC)(u.pixelBlock))){e.next=14;break}if(p={extent:u.extent,pixelBlock:u.pixelBlock},v.rawPixelData=p,!l){e.next=7;break}v.source=u.pixelBlock,v.isRendereredSource=!1,e.next=11;break;case 7:return e.next=9,this.layer.applyRenderer(p,"stretch"===(null==h?void 0:h.type)?h:null);case 9:m=e.sent,v.source=m,v.isRendereredSource=!0;case 11:v.symbolizerParameters=l?c:null,l?v.transformGrid||(v.transformGrid=u.transformGrid):v.transformGrid=null,e.next=16;break;case 14:b=this.createEmptyTilePixelBlock(),v.source=b,v.symbolizerParameters=l?c:null,v.transformGrid=null;case 16:v.bandIds=l?a:null,v.width=this._tileInfoView.tileInfo.size[0],v.height=this._tileInfoView.tileInfo.size[1],v.interpolation=s,v.suspended=f,v.invalidateTexture();case 17:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"updateTileSymbolizerParameters",value:function(){var e=(0,r.Z)(o.mark((function e(t,i){var r,n,a,s,l,u,c;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.local,n=i.global,a=this.layer.bandIds,s=this._getLayerInterpolation(),l=this.canUseWebGLForProcessing(),u=t.bitmap,c=u.rawPixelData,l||!(0,w.pC)(c)){e.next=8;break}return e.next=4,this.layer.applyRenderer(c,"stretch"===(null==n?void 0:n.type)?n:null);case 4:u.source=e.sent,u.isRendereredSource=!0,e.next=9;break;case 8:u.isRendereredSource&&(0,w.pC)(c)&&(u.source=c.pixelBlock),u.isRendereredSource=!1;case 9:u.symbolizerParameters=l?n||r:null,u.bandIds=l?a:null,u.interpolation=s,u.suspended=!1;case 13:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"install",value:function(e){this.container=new z(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,e.addChild(this.container)}},{key:"uninstall",value:function(){this.container.removeAllChildren(),this.container.remove(),(0,b.Z)((0,_.Z)(i.prototype),"uninstall",this).call(this)}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";var t=this.layer.interpolation,i=this.layer.renderer;return"raster-stretch"===i.type&&null!=i.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),i}(Q);(0,u._)([(0,d.Cb)()],J.prototype,"container",void 0),(0,u._)([(0,d.Cb)()],J.prototype,"layer",void 0),(0,u._)([(0,d.Cb)()],J.prototype,"type",void 0);var X=J=(0,u._)([(0,v.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],J),Y=i(64145),K=i(22753),$=i(44070),ee=(i(53634),i(37825),i(8548),i(3667),i(51378),i(45412)),te=i(87422),ie=i(46640),re=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(0,n.Z)(this,i),(e=t.call(this))._source=null,e._symbolizerParameters=null,e._vaoInvalidated=!0,e.coordScale=[1,1],e.height=null,e.stencilRef=0,e.rawPixelData=null,e.width=null,e.source=r,e}return(0,a.Z)(i,[{key:"destroy",value:function(){var e,t;(0,w.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateVAO()}},{key:"invalidateVAO",value:function(){var e,t;!this._vaoInvalidated&&(0,w.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}},{key:"updateVectorFieldVAO",value:function(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,w.pC)(this.source)&&!(0,w.pC)(this.vaoData))switch(this.symbolizerParameters.style){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":var t=(0,Y.wF)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i};break;case"simple_scalar":var r=(0,Y.K)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(e.context,r);this.vaoData={scalar:n};break;case"wind_speed":var a=(0,Y.wF)(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,a),l=(0,Y.K)(this.source,this.symbolizerParameters),o=this._createVectorFieldVAO(e.context,l);this.vaoData={magdir:s,scalar:o}}this.ready(),this.requestRender()}}},{key:"_createTransforms",value:function(){return{dvs:(0,T.c)()}}},{key:"onAttach",value:function(){this.invalidateVAO()}},{key:"onDetach",value:function(){this.invalidateVAO()}},{key:"_createVectorFieldVAO",value:function(e,t){var i=t.vertexData,r=t.indexData,n=$.Z.createVertex(e,35044,new Float32Array(i)),a=$.Z.createIndex(e,35044,new Uint32Array(r)),s=(0,ie.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:5126,normalized:!1},{location:1,name:"a_offset",count:2,type:5126,normalized:!1},{location:2,name:"a_vv",count:2,type:5126,normalized:!1}]});return{vao:new ee.Z(e,s.attributes,s.bufferLayouts,{geometry:n},a),elementCount:r.length}}}]),i}(te.s),ne=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(e,r,a,s,l){var o,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return(0,n.Z)(this,i),(o=t.call(this,e,r,a,s,l)).tileData=new re(u),o.tileData.coordScale=[s,l],o.tileData.once("isReady",(function(){return o.ready()})),o}return(0,a.Z)(i,[{key:"destroy",value:function(){(0,b.Z)((0,_.Z)(i.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{dvs:(0,T.c)(),tileMat3:(0,T.c)()}}},{key:"setTransform",value:function(e,t){(0,b.Z)((0,_.Z)(i.prototype),"setTransform",this).call(this,e,t);var r=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,a=(0,g.Z)(this.tileData.offset,2),s=a[0],l=a[1],o=[this.x+s*t,this.y-l*t],u=e.toScreenNoRotation([0,0],o),c=(0,g.Z)(u,2),h=c[0],f=c[1],y=this.tileData.symbolizerParameters.symbolTileSize,d=Math.round((this.width-this.tileData.offset[0])/y)*y,v=Math.round((this.height-this.tileData.offset[1])/y)*y,p=d/this.rangeX*r,m=v/this.rangeY*r;(0,K.s)(n,p,0,0,0,m,0,h,f,1),(0,K.m)(this.transforms.dvs,e.displayViewMat3,n),this.tileData.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),i}(I.I),ae=i(45717),se=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],e}return(0,a.Z)(i,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,x.Ue)(),e),i=(0,g.Z)(this._tileInfoView.tileInfo.size,2),r=i[0],n=i[1];return new ne(e,t[0],t[3],r,n)}},{key:"destroyTile",value:function(){}},{key:"prepareRenderPasses",value:function(e){var t=this,r=e.registerRenderPass({name:"imagery (vf tile)",brushes:[ae.Z],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:V.jx.MAP});return[].concat((0,k.Z)((0,b.Z)((0,_.Z)(i.prototype),"prepareRenderPasses",this).call(this,e)),[r])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===V.jx.MAP&&this.symbolTypes.forEach((function(r){e.renderPass=r,(0,b.Z)((0,_.Z)(i.prototype),"doRender",t).call(t,e)}))}}]),i}(S.Z),le=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments))._handle=null,e.container=null,e.layer=null,e.type="rasterVF",e}return(0,a.Z)(i,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:function(){var e=(0,r.Z)(o.mark((function e(t,i){var r;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.fetchTile(t.level,t.row,t.col,i);case 2:if(r=e.sent,e.t0="vector-magdir"===this.layer.rasterInfo.dataType&&null!=r&&r.pixelBlock,!e.t0){e.next=8;break}return e.next=7,this.layer.convertVectorFieldData(r.pixelBlock,i);case 7:r.pixelBlock=e.sent;case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"updateTileSource",value:function(e,t){var i=t.symbolizerParams,r=e.tileData;r.key=e.key,r.width=this._tileInfoView.tileInfo.size[0],r.height=this._tileInfoView.tileInfo.size[1];var n=i.symbolTileSize,a=t.source;if(r.offset=this._getTileSymbolOffset(r.key,n),(0,w.pC)(a)&&(0,w.pC)(a.pixelBlock)){var s={extent:a.extent,pixelBlock:a.pixelBlock};r.rawPixelData=s,r.source=this._sampleVectorFieldData(a.pixelBlock,i,r.offset),r.symbolizerParameters=i}else{var l=[Math.round((this._tileInfoView.tileInfo[0]-r.offset[0])/n),Math.round((this._tileInfoView.tileInfo[1]-r.offset[1])/n)],o=this.createEmptyTilePixelBlock(l);r.source=o,r.symbolizerParameters=i}return r.invalidateVAO(),Promise.resolve(null)}},{key:"updateTileSymbolizerParameters",value:function(e,t){var i,r=t.local,n=r.symbolTileSize,a=e.tileData;a.offset=this._getTileSymbolOffset(a.key,n);var s=a.symbolizerParameters.symbolTileSize;return a.symbolizerParameters=r,(0,w.pC)(null==(i=a.rawPixelData)?void 0:i.pixelBlock)&&s!==n&&(a.source=this._sampleVectorFieldData(a.rawPixelData.pixelBlock,a.symbolizerParameters,a.offset)),Promise.resolve(null)}},{key:"install",value:function(e){var t=this;this.container=new se(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=this.layer.watch("renderer",(function(e){return t._updateSymbolType(e)})),e.addChild(this.container)}},{key:"uninstall",value:function(){this.container.removeAllChildren(),this._handle.remove(),this._handle=null,this.container.remove(),(0,b.Z)((0,_.Z)(i.prototype),"uninstall",this).call(this)}},{key:"_getTileSymbolOffset",value:function(e,t){var i=e.col*this._tileInfoView.tileInfo.size[0]%t,r=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,r>t/2?t-r:-r]}},{key:"_sampleVectorFieldData",value:function(e,t,i){var r=t.symbolTileSize;return(0,Y.nb)(e,"vector-uv",r,i)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),i}(Q);(0,u._)([(0,d.Cb)()],le.prototype,"container",void 0),(0,u._)([(0,d.Cb)()],le.prototype,"layer",void 0),(0,u._)([(0,d.Cb)()],le.prototype,"type",void 0);var oe=le=(0,u._)([(0,v.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],le),ue=i(10064),ce=i(45948),he=i(24405),fe=i(67581),ye=i(13107),de=h.Z.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),ve=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments))._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,e}return(0,a.Z)(i,[{key:"initialize",value:function(){var e=this.updateFullExtent();this.addResolvingPromise(e)}},{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}},{key:"update",value:function(e){this.subview.update(e),this.notifyChange("updating")}},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([(0,y.YP)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(function(t,i,r){var n="multidimensionalDefinition"===r,a="interpolation"===r&&("majority"===t||"majority"===i)&&(0,H.JV)(e.layer),s="renderer"===r&&i.type!==t.type;s&&e._updateSubview();var l=n||a||s;e.subview.redrawOrRefetch(l).catch((function(e){(0,f.D_)(e)||de.error(e)})),e.notifyChange("updating")})),(0,y.S1)(this,["layer.blendMode"],(function(t){e.subview&&(e.subview.container.blendMode=t)}),!0),(0,y.S1)(this,["layer.effect"],(function(t){e.subview&&(e.subview.container.effect=t)}),!0),(0,y.S1)(this,"timeExtent",(function(){e.subview.redrawOrRefetch(!0).catch((function(e){(0,f.D_)(e)||de.error(e)}))}))],"attach")}},{key:"detach",value:function(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this.subview.uninstall()}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.subview.moveEnd()}},{key:"hitTest",value:function(){var e=(0,r.Z)(o.mark((function e(t,i){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new c.Z({attributes:{},geometry:t.clone()})]);case 1:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){return this.subview.doRefresh()}},{key:"_updateSubview",value:function(){var e="vector-field"===this.layer.renderer.type?"rasterVF":"animated-flow"===this.layer.renderer.type?"rasterAnimatedFlow":"raster";if(this.subview){if(this.subview.type===e)return;this.subview.uninstall()}var t,i=this.layer;"useWebGLForProcessing"in(t="rasterVF"===e?new oe({layer:i,layerView:this}):"rasterAnimatedFlow"===e?new p.Z({layer:i,layerView:this}):new X({layer:i,layerView:this}))&&(t.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in t&&(t.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in t&&(t.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),t.attach(),t.install(this.container),t.container.blendMode=i.blendMode,t.container.effect=i.effect,this.subview=t,this.requestUpdate()}}]),i}(function(e){var t=function(e){(0,s.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.fullExtent=null,e.tileInfo=null,e.datumTransformation=null,e}return(0,a.Z)(i,[{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"fetchPopupFeatures",value:function(){var e=(0,r.Z)(o.mark((function e(t,i){var r,n,a,s,l,u,h,f,y,d,v,p,m,g,b,_,k,x,P;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new ue.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:r})));case 3:if(n=r.popupEnabled,a=(0,he.V)(r,i),n&&(0,w.pC)(a)){e.next=6;break}throw new ue.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:n,popupTemplate:a});case 6:return s=[],e.next=9,r.identify(t,{timeExtent:this.timeExtent});case 9:if(l=e.sent,u=l.value,h=l.magdirValue,f="",u&&u.length){if(f="imagery-tile"===r.type&&r.hasStandardTime()&&null!=u[0]?u.map((function(e){return r.getStandardTimeValue(e)})).join(", "):u.join(", "),(v={ObjectId:0})[p="Raster.ServicePixelValue"]=this._formatAttributeValue(f,p),(m=null==(y=r.rasterInfo)||null==(d=y.attributeTable)?void 0:d.features)&&m.length>0&&(g=m.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===f})),g.length>0&&(b=g[0])))for(_ in b.attributes)b.attributes.hasOwnProperty(_)&&(k=this._rasterFieldPrefix+_,v[k]=this._formatAttributeValue(b.attributes[_],k));"vector-magdir"!==(x=r.rasterInfo.dataType)&&"vector-uv"!==x||(v["Raster.Magnitude"]=null==h?void 0:h[0],v["Raster.Direction"]=null==h?void 0:h[1]),(P=new c.Z(this.fullExtent.clone(),null,v)).layer=r,P.sourceLayer=P.layer,s.push(P)}return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"updateFullExtent",value:function(){var e=this.layer.tileInfo;if(!e||!e.spatialReference)return Promise.reject(new ue.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer}));if((0,w.Wi)(this.layer.fullExtent))return Promise.reject(new ue.Z("layerview:extent-missing","The layer doesn't provide a full extent.",{layer:this.layer}));var t=(0,G._D)(this.layer.fullExtent,this.view.spatialReference,!1),i=(0,G.tB)(this.layer.fullExtent,this.view.spatialReference,t);return null==i?Promise.reject(new ue.Z("layerview:projection-not-supported","The layer extent cannot be projected to the view's spatial reference",{layer:this.layer})):(this._set("fullExtent",i),this.datumTransformation||(this.datumTransformation=(0,G._D)(this.layer.fullExtent,this.view.spatialReference,!0)),Promise.resolve())}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var i,r,n=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,a=this._getFieldInfo(n,t),s=a&&a.format;if(s)return e.trim().indexOf(",")>-1?(r=(i=",")+" ",this._formatDelimitedString(e,i,r,s)):e.trim().indexOf(" ")>-1?(i=r=" ",this._formatDelimitedString(e,i,r,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var i,r=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==r&&e.fieldName.toLowerCase()!==r.replace(/ /g,"_"))&&(i=e,!0)})),i}}},{key:"_formatDelimitedString",value:function(e,t,i,r){var n=this;return e&&t&&i&&r?e.trim().split(t).map((function(e){return n._formatNumberFromString(e,r)})).join(i):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var i=Number(e);return isNaN(i)?e:t.format(i)}}]),i}(e);return(0,u._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,u._)([(0,d.Cb)(ce.qG)],t.prototype,"timeExtent",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"view",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"fullExtent",void 0),(0,u._)([(0,d.Cb)()],t.prototype,"tileInfo",void 0),(0,u._)([(0,d.Cb)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=(0,u._)([(0,v.j)("esri.views.layers.ImageryTileLayerView")],t)}((0,ye.y)((0,m.y)(fe.Z))));(0,u._)([(0,d.Cb)()],ve.prototype,"subview",void 0),(0,u._)([(0,d.Cb)()],ve.prototype,"useWebGLForProcessing",null),(0,u._)([(0,d.Cb)()],ve.prototype,"useProgressiveUpdate",null);var pe=ve=(0,u._)([(0,v.j)("esri.views.2d.layers.ImageryTileLayerView2D")],ve)},31666:function(e,t,i){i.d(t,{JV:function(){return a},oq:function(){return n}});var r=new(i(43404).Xn)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return r.toJSON(e)}function a(e){var t=e.rasterInfo,i=t.bandCount,r=t.attributeTable,n=t.colormap,a=t.pixelType;return 1===i&&(null!=r||null!=n||"u8"===a||"s8"===a)}}}]);
//# sourceMappingURL=8030.2bdc83bb.chunk.js.map