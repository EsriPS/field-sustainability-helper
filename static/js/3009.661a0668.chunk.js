"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[3009],{94304:function(e,t,r){r.r(t),r.d(t,{CIMSymbolRasterizer:function(){return k},GeometryStyle:function(){return a}});var a,n,i=r(37762),o=r(15861),s=r(15671),c=r(43144),u=r(87757),l=r(51995),f=r(76200),h=r(66978),m=r(17842),y=r(643),g=r(77981),v=r(79815),p=r(59001),d=r(16285),C=r(22532),M=r(31027),I=r(49729),x=r(83748);(n=a||(a={})).Legend="legend",n.Preview="preview";var z=function(e,t,r){if(e&&e.targetSize){var a;if(r){var n=Math.max(r.frame.xmax-r.frame.xmin,r.frame.ymax-r.frame.ymin);a=e.targetSize/(0,m.F2)(n)}else a=e.targetSize/t.referenceSize;return a}return e&&e.scaleFactor?e.scaleFactor:1},w={fill:{legend:{frame:{xmax:15,xmin:0,ymax:15,ymin:0},geometry:{rings:[[[0,15],[15,7.5],[15,0],[0,0],[0,15]]]},canvasPaths:{rings:[[[0,15],[0,0],[15,7.5],[15,15],[0,15]]]}},preview:{frame:{xmax:100,xmin:0,ymax:100,ymin:0},geometry:{rings:[[[0,100],[100,100],[100,0],[0,0],[0,100]]]},canvasPaths:{rings:[[[0,100],[0,0],[100,0],[100,100],[0,100]]]}}},stroke:{legend:{frame:{xmax:24,xmin:0,ymax:2,ymin:-2},geometry:{paths:[[[0,0],[12,0],[24,0]]]},canvasPaths:{paths:[[[0,2],[12,2],[24,2]]]}},preview:{frame:{xmax:100,xmin:0,ymax:2,ymin:-2},geometry:{paths:[[[0,0],[50,0],[100,0]]]},canvasPaths:{paths:[[[0,2],[50,2],[100,2]]]}}}},k=function(){function e(t,r){(0,s.Z)(this,e),this._spatialReference=t,this._avoidSDF=r,this._resourceCache=new Map,this._pictureMarkerCache=new Map,this._textRasterizer=new C.d,this._cimResourceManager=new p.Z,this._rasterizer=new d.Z(this._cimResourceManager)}return(0,c.Z)(e,[{key:"rasterizeCIMSymbolAsync",value:function(){var e=(0,o.Z)(u.mark((function e(t,r,a,n,i,o,s,c){var l;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=n||(r?null!=r.centroid?"esriGeometryPolygon":(0,g.Ji)(r.geometry):null)||_(t),e.next=3,this.analyzeCIMSymbol(t,r?P(r.attributes):null,a,n,c);case 3:return l=e.sent,e.abrupt("return",this.rasterizeCIMSymbol(l,r,n,i,o,s));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i,o,s,c){return e.apply(this,arguments)}}()},{key:"analyzeCIMSymbol",value:function(){var e=(0,o.Z)(u.mark((function e(t,r,a,n,i){var o,s,c,l,f,m;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],s=r?{geometryType:n,spatialReference:this._spatialReference,fields:r}:null,e.next=3,(0,v.c)(t.data,s,this._cimResourceManager,o,this._avoidSDF);case 3:for((0,h.k_)(i),l=0,f=o;l<f.length;l++)"CIMPictureMarker"!==(m=f[l]).cim.type&&"CIMPictureFill"!==m.cim.type&&"CIMPictureStroke"!==m.cim.type||(c||(c=[]),c.push(this.fetchPictureMarkerResource(m,i))),a&&"text"===m.type&&"string"==typeof m.text&&m.text.indexOf("[")>-1&&(m.text=(0,M.Qs)(a,m.text,m.cim.textCase));if(e.t0=c,!e.t0){e.next=9;break}return e.next=9,Promise.all(c);case 9:return e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,a,n,i){return e.apply(this,arguments)}}()},{key:"fetchPictureMarkerResource",value:function(){var e=(0,o.Z)(u.mark((function e(t,r){var a,n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.materialHash,this._pictureMarkerCache.get(a)){e.next=6;break}return e.next=4,(0,f.default)(t.cim.url,{responseType:"image",signal:r&&r.signal});case 4:n=e.sent.data,this._pictureMarkerCache.set(a,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"rasterizeCIMSymbol",value:function(e,t,r,a,n,o){var s,c=[],u=(0,i.Z)(e);try{for(u.s();!(s=u.n()).done;){var l=s.value;a&&"function"==typeof a.scaleFactor&&(a.scaleFactor=a.scaleFactor(t,n,o));var f=this._getRasterizedResource(l,t,r,a,n,o);if(f){var h=0,m=f.anchorX||0,y=f.anchorY||0,g=!1,v=0,p=0;if("esriGeometryPoint"===r){var d=z(a,l,null);if(v=(0,M.hf)(l.offsetX,t,n,o)*d||0,p=(0,M.hf)(l.offsetY,t,n,o)*d||0,"marker"===l.type)h=(0,M.hf)(l.rotation,t,n,o)||0,g=!!l.rotateClockwise&&l.rotateClockwise;else if("text"===l.type){if(h=(0,M.hf)(l.angle,t,n,o)||0,void 0!==l.horizontalAlignment)switch(l.horizontalAlignment){case"left":m=-.5;break;case"right":m=.5;break;default:m=0}if(void 0!==l.verticalAlignment)switch(l.verticalAlignment){case"top":y=.5;break;case"bottom":y=-.5;break;case"baseline":y=-.25;break;default:y=0}}}null!=f&&c.push({angle:h,rotateClockWise:g,anchorX:m,anchorY:y,offsetX:v,offsetY:p,rasterizedResource:f})}}}catch(C){u.e(C)}finally{u.f()}return this.getSymbolImage(c)}},{key:"getSymbolImage",value:function(e){for(var t=document.createElement("canvas"),r=t.getContext("2d"),a=0,n=0,i=0,o=0,s=[],c=0;c<e.length;c++){var u=e[c],l=u.rasterizedResource;if(l){var f=l.size,h=u.offsetX,y=u.offsetY,g=u.anchorX,v=u.anchorY,p=u.rotateClockWise||!1,d=u.angle,C=(0,m.F2)(h)-f[0]*(.5+g),M=(0,m.F2)(y)-f[1]*(.5+v),I=C+f[0],z=M+f[1];if(d){p&&(d=-d);var w=Math.sin(d*Math.PI/180),k=Math.cos(d*Math.PI/180),P=C*k-M*w,_=C*w+M*k,b=C*k-z*w,S=C*w+z*k,F=I*k-z*w,R=I*w+z*k,A=I*k-M*w,D=I*w+M*k;C=Math.min(P,b,F,A),M=Math.min(_,S,R,D),I=Math.max(P,b,F,A),z=Math.max(_,S,R,D)}a=C<a?C:a,n=M<n?M:n,i=I>i?I:i,o=z>o?z:o;var Z=r.createImageData(l.size[0],l.size[1]);Z.data.set(new Uint8ClampedArray(l.image.buffer));var X={offsetX:h,offsetY:y,rotateClockwise:p,angle:d,rasterizedImage:Z,anchorX:g,anchorY:v};s.push(X)}}t.width=i-a,t.height=o-n;for(var T=-a,U=o,Y=0;Y<s.length;Y++){var L=s[Y],G=this._imageDataToCanvas(L.rasterizedImage),J=L.rasterizedImage.width,H=L.rasterizedImage.height,O=T-J*(.5+L.anchorX),V=U-H*(.5-L.anchorY);if(L.angle){var N=(360-L.angle)*Math.PI/180;r.save(),r.translate((0,m.F2)(L.offsetX),-(0,m.F2)(L.offsetY)),r.translate(T,U),r.rotate(N),r.translate(-T,-U),r.drawImage(G,O,V),r.restore()}else r.drawImage(G,O+(0,m.F2)(L.offsetX),V-(0,m.F2)(L.offsetY))}var E=new x.Z({x:T/t.width-.5,y:U/t.height-.5});return{imageData:0!==t.width&&0!==t.height?r.getImageData(0,0,t.width,t.height):r.createImageData(1,1),anchorPosition:E}}},{key:"_imageDataToCanvas",value:function(e){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var t=this._imageDataCanvas,r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.putImageData(e,0,0),t}},{key:"_imageTo32Array",value:function(e,t,r,a){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var n=this._imageDataCanvas,i=n.getContext("2d");if(n.width=t,n.height=r,i.drawImage(e,0,0,t,r),a){i.save();var o=new l.Z(a);i.fillStyle=o.toHex(),i.globalCompositeOperation="multiply",i.fillRect(0,0,t,r),i.globalCompositeOperation="destination-atop",i.drawImage(e,0,0,t,r),i.restore()}return new Uint32Array(i.getImageData(0,0,t,r).data.buffer)}},{key:"_getRasterizedResource",value:function(e,t,r,n,i,o){var s,c,u,l,f=null,h=null;if("esriGeometryPolyline"===r||"esriGeometryPolygon"===r){var m=n&&n.style?n.style:a.Legend,g="esriGeometryPolyline"===r?w.stroke[m]:w.fill[m];if("line"===e.type){var v;if("CIMSolidStroke"!==e.cim.type){if("CIMPictureStroke"===e.cim.type){var p=(0,M.hf)(e.width,t,i,o),d=(0,M.hf)(e.color,t,i,o),C=this._getPictureResource(e,p,d),x=C.image,k=C.width,P=C.height;return this._rasterizePictureResource(e,x,k,P,g,p)}return null}s=(v=b(e,t,i,o)).analyzedCIM,u=v.hash,c=this._embedCIMLayerInVectorMarker(s,g)}else if("marker"===e.type){if("CIMPictureMarker"===e.cim.type)return null;if("CIMVectorMarker"!==e.cim.type)return null;e.cim.offsetX=(0,M.hf)(e.offsetX,t,i,o),e.cim.offsetY=(0,M.hf)(e.offsetY,t,i,o),e.cim.rotation=(0,M.hf)(e.rotation,t,i,o),e.cim.markerPlacement=e.markerPlacement,s=b(e,t,i,o).analyzedCIM,u=(0,y.hP)(JSON.stringify(s)).toString(),c=this._embedCIMLayerInVectorMarker(s,g),f=(0,M.hf)(e.size,t,i,o),h=e.path}else{if("text"===e.type)return null;if("fill"===e.type){var _;if("CIMHatchFill"===e.cim.type||"CIMVectorMarker"===e.cim.type||"CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){var S,F,R,A=e.cim.size||e.cim.height;if("CIMPictureMarker"===e.cim.type||"CIMPictureFill"===e.cim.type){var D=this._getPictureResource(e,A,(0,M.hf)(e.color,t,i,o));S=D.image,F=D.width,R=D.height}else{var Z=b(e,t,i,o);s=Z.analyzedCIM,u=Z.hash;var X=this._rasterizer.rasterizeJSONResource({cim:s,type:e.type,url:e.url,mosaicHash:u,size:A,path:h},1,this._avoidSDF);S=X.image,F=X.size[0],R=X.size[1]}return this._rasterizePictureResource(e,S,F,R,g,null)}if("CIMSolidFill"!==e.cim.type)return null;s=(_=b(e,t,i,o)).analyzedCIM,u=_.hash,c=this._embedCIMLayerInVectorMarker(s,g)}}}else{if("text"===e.type)return l=this._rasterizeTextResource(e,t,n,i,o);var T=b(e,t,i,o);s=T.analyzedCIM,u=T.hash;var U=z(n,e,null);if("CIMPictureMarker"===e.cim.type){var Y=(0,M.hf)(e.size,t,i,o)*U,L=this._getPictureResource(e,Y,(0,M.hf)(e.color,t,i,o));return l={image:L.image,size:[L.width,L.height],sdf:!1,simplePattern:!1,anchorX:e.anchorPoint?e.anchorPoint.x:0,anchorY:e.anchorPoint?e.anchorPoint.y:0}}(0,I.FW)(s,U,{preserveOutlineWidth:!1}),c=s}u+=r,n&&(u+=JSON.stringify(n));var G=this._resourceCache;return G.has(u)?G.get(u):(l=this._rasterizer.rasterizeJSONResource({cim:c,type:e.type,url:e.url,mosaicHash:u,size:f,path:h},window.devicePixelRatio||1,this._avoidSDF),G.set(u,l),l)}},{key:"_rasterizeTextResource",value:function(e,t,r,a,n){var i=z(r,e,null),o=(0,M.hf)(e.text,t,a,n);if(!o||0===o.length)return null;var s=(0,M.hf)(e.fontName,t,a,n),c=(0,M.hf)(e.style,t,a,n),u=(0,M.hf)(e.weight,t,a,n),l=(0,M.hf)(e.decoration,t,a,n),f=(0,M.hf)(e.size,t,a,n)*i,h=(0,M.hf)(e.horizontalAlignment,t,a,n),m=(0,M.hf)(e.verticalAlignment,t,a,n),y=(0,M.nn)((0,M.hf)(e.color,t,a,n)),g=(0,M.nn)((0,M.hf)(e.outlineColor,t,a,n)),v={color:y,size:f,horizontalAlignment:h,verticalAlignment:m,font:{family:s,style:c,weight:u,decoration:l},halo:{size:(0,M.hf)(e.outlineSize,t,a,n)||0,color:g,style:c},pixelRatio:1,premultiplyColors:!this._avoidSDF};return this._textRasterizer.rasterizeText(o,v)}},{key:"_rasterizePictureResource",value:function(e,t,r,a,n,o){var s=document.createElement("canvas"),c=s.getContext("2d");s.height=(0,m.F2)(Math.max(n.frame.ymax-n.frame.ymin,o)),s.width=(0,m.F2)(n.frame.xmax-n.frame.xmin);var u=c.createImageData(r,a);u.data.set(new Uint8ClampedArray(t.buffer));var l=this._imageDataToCanvas(u),f=c.createPattern(l,"repeat"),h=Math.cos((-e.cim.rotation||0)*Math.PI/180),y=Math.sin((-e.cim.rotation||0)*Math.PI/180);f.setTransform({m11:h,m12:y,m21:-y,m22:h,m41:(0,m.F2)(e.cim.offsetX)||0,m42:(0,m.F2)(e.cim.offsetY)||0});var v,p,d,C=n.canvasPaths;(0,g.oU)(C)?(v=C.rings,c.fillStyle=f,p=c.fill,d=["evenodd"]):(0,g.l9)(C)&&(v=C.paths,c.strokeStyle=f,c.lineWidth=o,p=c.stroke,v[0][0][1]=s.height/2,v[0][1][1]=s.height/2),c.beginPath();var M,I=(0,i.Z)(v);try{for(I.s();!(M=I.n()).done;){var x=M.value,z=x?x.length:0;if(z>1){var w=x[0];c.moveTo((0,m.F2)(w[0]),(0,m.F2)(w[1]));for(var k=1;k<z;++k)w=x[k],c.lineTo((0,m.F2)(w[0]),(0,m.F2)(w[1]));c.closePath()}}}catch(b){I.e(b)}finally{I.f()}p.apply(c,d);var P=c.getImageData(0,0,s.width,s.height),_=new Uint8Array(P.data);return{size:[s.width,s.height],image:new Uint32Array(_.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}},{key:"_getPictureResource",value:function(e,t,r){var a=this._pictureMarkerCache.get(e.materialHash);if(!a)return null;var n=a.height/a.width,i=t?n>1?(0,m.F2)(t):(0,m.F2)(t)/n:a.width,o=t?n>1?(0,m.F2)(t)*n:(0,m.F2)(t):a.height;return{image:this._imageTo32Array(a,i,o,r),width:i,height:o}}},{key:"_embedCIMLayerInVectorMarker",value:function(e,t){var r=(0,g.oU)(t.geometry)?"CIMPolygonSymbol":"CIMLineSymbol",a=t.frame;return{type:"CIMVectorMarker",frame:a,size:a.ymax-a.ymin,markerGraphics:[{type:"CIMMarkerGraphic",geometry:t.geometry,symbol:{type:r,symbolLayers:[e]}}]}}}]),e}();function P(e){return(e?Object.keys(e):[]).map((function(t){return{name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}}))}function _(e){if(!(e&&e.data&&e.data.symbol))return null;switch(e.data.symbol.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function b(e,t,r,a){var n,i;return"function"==typeof e.materialHash?(n=(0,e.materialHash)(t,r,a),i=(0,v.S)(e.cim,e.materialOverrides)):(n=e.materialHash,i=e.cim),{analyzedCIM:i,hash:n}}},16285:function(e,t,r){r.d(t,{Z:function(){return f}});var a=r(37762),n=r(29439),i=r(15671),o=r(43144),s=r(78915),c=r(691),u=r(6388),l=r(31027),f=function(){function e(t){(0,i.Z)(this,e),this._resourceManager=t}return(0,o.Z)(e,[{key:"dispose",value:function(){this._rasterizationCanvas=null}},{key:"rasterizeJSONResource",value:function(e,t,r){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){var a=s.fN.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t),i=(0,n.Z)(a,3),o=i[0];return{size:[i[1],i[2]],image:new Uint32Array(o.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type||"line"===e.type&&e.dashTemplate){var l,f;if("simple-line"===e.type||"esriSLS"===e.type)switch(l=(0,s.U1)(e.style,e.cap),e.cap){case"butt":f="Butt";break;case"square":f="Square";break;default:f="Round"}else l=e.dashTemplate,f=e.cim.capStyle;var h=s.fN.rasterizeSimpleLine(l,f),m=(0,n.Z)(h,3),y=m[0];return{size:[m[1],m[2]],image:new Uint32Array(y.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}var g,v,p;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(g=s.B$.fromSimpleMarker(e),p=(0,u.Fp)(g)):e.cim&&"CIMHatchFill"===e.cim.type?(g=s.B$.fromCIMHatchFill(e.cim),v=new c.Z(g.frame.xmin,-g.frame.ymax,g.frame.xmax-g.frame.xmin,g.frame.ymax-g.frame.ymin)):e.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.cim.markerPlacement.type?(g=s.B$.fromCIMInsidePolygon(e.cim),v=new c.Z(g.frame.xmin,-g.frame.ymax,g.frame.xmax-g.frame.xmin,g.frame.ymax-g.frame.ymin)):(g=e.cim,p=(0,u.Fp)(g)),p&&!r){var d=(0,u.RL)(p),C=(0,n.Z)(d,3),M=C[0],I=C[1],x=C[2];return M?{size:[I,x],image:new Uint32Array(M.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}var z=s.B$.rasterize(this._rasterizationCanvas,g,v,this._resourceManager,!r),w=(0,n.Z)(z,5),k=w[0],P=w[1],_=w[2],b=w[3],S=w[4];return k?{size:[P,_],image:new Uint32Array(k.buffer),sdf:!1,simplePattern:!1,anchorX:b,anchorY:S}:null}},{key:"rasterizeImageResource",value:function(e,t,r,i){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;var o=this._rasterizationCanvas.getContext("2d");r instanceof ImageData?o.putImageData(r,0,0):(r.setAttribute("width","".concat(e,"px")),r.setAttribute("height","".concat(t,"px")),o.drawImage(r,0,0,e,t));var s,c=o.getImageData(0,0,e,t),u=new Uint8Array(c.data);if(i){var f,h=(0,a.Z)(i);try{for(h.s();!(f=h.n()).done;){var m=f.value;if(m&&m.oldColor&&4===m.oldColor.length&&m.newColor&&4===m.newColor.length){var y=(0,n.Z)(m.oldColor,4),g=y[0],v=y[1],p=y[2],d=y[3],C=(0,n.Z)(m.newColor,4),M=C[0],I=C[1],x=C[2],z=C[3];if(g===M&&v===I&&p===x&&d===z)continue;for(var w=0;w<u.length;w+=4)g===u[w]&&v===u[w+1]&&p===u[w+2]&&d===u[w+3]&&(u[w]=M,u[w+1]=I,u[w+2]=x,u[w+3]=z)}}}catch(A){h.e(A)}finally{h.f()}}for(var k=0;k<u.length;k+=4)s=u[k+3]/255,u[k]=u[k]*s,u[k+1]=u[k+1]*s,u[k+2]=u[k+2]*s;var P=u,_=e,b=t,S=512;if(_>=S||b>=S){var F=_/b;F>1?(_=S,b=Math.round(S/F)):(b=S,_=Math.round(S*F)),P=new Uint8Array(4*_*b);var R=new Uint8ClampedArray(P.buffer);(0,l.TT)(u,e,t,R,_,b,!1)}return{size:[_,b],image:new Uint32Array(P.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}]),e}()},94109:function(e,t,r){r.d(t,{xl:function(){return x},aK:function(){return z},eF:function(){return l},Uh:function(){return U},_6:function(){return H},Tz:function(){return L},CQ:function(){return Y},oK:function(){return G},e0:function(){return J},SD:function(){return O},XJ:function(){return Z},$0:function(){return o},iV:function(){return _},Zd:function(){return P},Ex:function(){return c},uG:function(){return k},Jc:function(){return S},xm:function(){return s},m4:function(){return w},MI:function(){return T},AI:function(){return a},Ip:function(){return X},ru:function(){return n},fL:function(){return D},iJ:function(){return y},nM:function(){return g},Ij:function(){return v},f2:function(){return p},Ic:function(){return m},Al:function(){return h},QU:function(){return d},Jw:function(){return C},kF:function(){return M},yP:function(){return I},D3:function(){return f},Iw:function(){return u},tQ:function(){return b},I_:function(){return i},a:function(){return A},CU:function(){return R},V4:function(){return F}});var a=1e-30,n=4294967295,i=512,o=8,s=29,c=24,u=8,l={metrics:{width:15,height:17,left:0,top:-7,advance:14}},f=0,h=0,m=0,y=1,g=2,v=3,p=4,d=5,C=6,M=5,I=6,x=1,z=2,w=2,k=1,P=2,_=4,b=1.05,S=6,F=5,R=6,A=1.15,D=2,Z=8,X=500,T=10,U=2,Y=0,L=1,G=4,J=8,H=4,O=1},73271:function(e,t,r){r.d(t,{UJ:function(){return i},Jz:function(){return o},Au:function(){return n}});var a=new Float32Array(1);new Uint32Array(a.buffer);function n(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function i(e,t){return 65535&e|t<<16}function o(e,t,r,a){return 255&e|(255&t)<<8|(255&r)<<16|a<<24}}}]);
//# sourceMappingURL=3009.661a0668.chunk.js.map