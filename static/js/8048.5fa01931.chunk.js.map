{"version":3,"file":"static/js/8048.5fa01931.chunk.js","mappings":"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","sources":["../node_modules/@arcgis/core/views/2d/engine/Bitmap.js","../node_modules/@arcgis/core/views/2d/engine/BitmapContainer.js","../node_modules/@arcgis/core/views/2d/engine/ImageryBitmapSource.js","../node_modules/@arcgis/core/views/2d/viewStateUtils.js","../node_modules/@arcgis/core/views/2d/layers/support/ExportStrategy.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{b as e,c as i,r as s,j as r,m as h}from\"../../../chunks/mat3.js\";import{c as n}from\"../../../chunks/mat3f32.js\";import{f as u}from\"../../../chunks/vec2f32.js\";import{DisplayObject as o}from\"./DisplayObject.js\";import a from\"./ImageryBitmapSource.js\";import d from\"../../webgl/Texture.js\";function c(t){return t&&\"render\"in t}function l(t){return t&&!(\"render\"in t)}function x(t){const e=document.createElement(\"canvas\");return e.width=t.width,e.height=t.height,t.render(e.getContext(\"2d\")),e}function _(t,e,i){const s={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071};return e&&i&&(s.width=e,s.height=i),new d(t,s)}class g extends o{constructor(t=null,e,i=!0){super(),this.requestRenderOnSourceChangedEnabled=i,this._textureInvalidated=!0,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.blendFunction=e,this.source=t,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null)}get isSourceScaled(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}get height(){return void 0!==this._height?this._height:this.sourceHeight}set height(t){this._height=t}get source(){return this._source}set source(t){this._source=t,this.invalidateTexture()}get sourceHeight(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}get sourceWidth(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}get width(){return void 0!==this._width?this._width:this.sourceWidth}set width(t){this._width=t}beforeRender(t){super.beforeRender(t),this.updateTexture(t.context)}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}_createTransforms(){return{dvs:n()}}setTransform(t){const n=e(this.transforms.dvs),[o,a]=t.toScreenNoRotation([0,0],[this.x,this.y]),d=this.resolution/this.pixelRatio/t.resolution,c=d*this.width,l=d*this.height,x=Math.PI*this.rotation/180;i(n,n,u(o,a)),i(n,n,u(c/2,l/2)),s(n,n,-x),i(n,n,u(-c/2,-l/2)),r(n,n,u(c,l)),h(this.transforms.dvs,t.displayViewMat3,n)}setSamplingProfile(t){this._texture&&(t.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(t.samplingMode))}bind(t,e){this._texture&&t.bindTexture(this._texture,e)}updateTexture(e){var i;if(!this.stage)return null==(i=this._texture)||i.dispose(),void(this._texture=null);if(!this._textureInvalidated)return;this._textureInvalidated=!1,this._texture||(this.source?this._texture=_(e,this.sourceWidth,this.sourceHeight):this._texture=_(e));const s=this.source;if(s){if(this._texture.resize(this.sourceWidth,this.sourceHeight),c(s))if(s instanceof a){const e=s.getRenderedRasterPixels();this._texture.setData(t(e)?e.renderedRasterPixels:null)}else this._texture.setData(x(s));else l(s)&&this._texture.setData(s);this.ready()}else this._texture.setData(null)}onAttach(){this.invalidateTexture()}onDetach(){this.invalidateTexture()}}export{g as Bitmap,c as isImageSource,x as rasterize};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{brushes as e}from\"./brushes.js\";import{WGLDrawPhase as r}from\"./webgl/enums.js\";import s from\"./webgl/WGLContainer.js\";class t extends s{get requiresDedicatedFBO(){return this.children.some((e=>\"additive\"===e.blendFunction))}prepareRenderPasses(s){const t=s.registerRenderPass({name:\"bitmap\",brushes:[e.bitmap],target:()=>this.children,drawPhase:r.MAP});return[...super.prepareRenderPasses(s),t]}}export{t as BitmapContainer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../../core/maybe.js\";class i{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return e(this.pixelBlock)?this.pixelBlock.width:0}get height(){return e(this.pixelBlock)?this.pixelBlock.height:0}render(e){const i=this.pixelBlock;if(t(i))return;const l=this.filter({pixelBlock:i});if(t(l.pixelBlock))return;const r=l.pixelBlock.getAsRGBA(),o=e.createImageData(l.pixelBlock.width,l.pixelBlock.height);o.data.set(r),e.putImageData(o,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return t(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}export{i as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nconst t=Math.PI/180;function n(n){return n*t}function o(t,n,o){const{resolution:r,size:u}=o;return t[0]=r*(Math.round(n[0]/r)+u[0]%2*.5),t[1]=r*(Math.round(n[1]/r)+u[1]%2*.5),t}function r(t,o){const r=n(o.rotation),u=Math.abs(Math.cos(r)),a=Math.abs(Math.sin(r)),[s,c]=o.size;return t[0]=Math.round(c*a+s*u),t[1]=Math.round(c*u+s*a),t}function u(t,n,o,r){const[u,a]=n,[s,c]=r,i=.5*o;return t[0]=u-i*s,t[1]=a-i*c,t[2]=u+i*s,t[3]=a+i*c,t}function a(t,n){const[o,r,u,a]=t,[s,c,i,e]=n;return!(o>i||u<s||r>e||a<c)}export{a as bboxIntersects,u as getBBox,r as getOuterSize,o as snapToPixel};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.22/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../core/Accessor.js\";import{debounce as i}from\"../../../../core/promiseUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/arrayUtils.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as r}from\"../../../../core/accessorSupport/decorators/subclass.js\";import s from\"../../../../geometry/Extent.js\";import{create as a}from\"../../../../geometry/support/aaBoundingRect.js\";import{getInfo as p}from\"../../../../geometry/support/spatialReferenceUtils.js\";import n from\"../../../../layers/support/TileInfo.js\";import{getOuterSize as m,getBBox as l}from\"../../viewStateUtils.js\";import{Bitmap as d}from\"../../engine/Bitmap.js\";import h from\"../../tiling/TileInfoView.js\";import c from\"../../tiling/TileKey.js\";const u=a(),g=[0,0],f=new c(0,0,0,0),x={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};let y=class extends e{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=x.hidpi,this.imageMaxWidth=x.imageMaxWidth,this.imageMaxHeight=x.imageMaxHeight,this.imageRotationSupported=x.imageRotationSupported,this.imageNormalizationSupported=x.imageNormalizationSupported,this.update=i((async(t,e)=>{if(!t.stationary||this.destroyed)return null;const i=t.state,o=p(i.spatialReference),r=this.hidpi?t.pixelRatio:1,s=this.imageNormalizationSupported&&i.worldScreenWidth&&i.worldScreenWidth<i.size[0];s?(g[0]=i.worldScreenWidth,g[1]=i.size[1]):this.imageRotationSupported?(g[0]=i.size[0],g[1]=i.size[1]):m(g,i);const a=Math.floor(g[0]*r)>this.imageMaxWidth||Math.floor(g[1]*r)>this.imageMaxHeight,n=o&&(i.extent.xmin<o.valid[0]||i.extent.xmax>o.valid[1]),l=!this.imageNormalizationSupported&&n,d=!a&&!l,h=this.imageRotationSupported?i.rotation:0;if(d){const t=s?i.paddedViewState.center:i.center;this._imagePromise=this._singleExport(i,g,t,i.resolution,h,r,e)}else{let t=Math.min(this.imageMaxWidth,this.imageMaxHeight);l&&(t=Math.min(i.worldScreenWidth,t)),this._imagePromise=this._tiledExport(i,t,h,r,e)}return this._imagePromise.then((async t=>{if(this._imagePromise=null,!this.destroyed){this.bitmaps=null!=t?t:[];for(const e of this.container.children)t.includes(e)||e.fadeOut().then((()=>{e.remove()}));for(const e of t)this.container.addChild(e),e.fadeIn()}})).catch((t=>{throw this._imagePromise=null,t}))}),5e3)}destroy(){this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}updateExports(t){for(const e of this.container.children){if(!e.visible||!e.stage)return;t(e),e.invalidateTexture(),e.requestRender()}}async _export(t,e,i,o,r,s){const a=await this.fetchSource(t,Math.floor(e*r),Math.floor(i*r),{rotation:o,pixelRatio:r,signal:s}),p=new d(a,\"additive\");return p.x=t.xmin,p.y=t.ymax,p.resolution=t.width/e,p.rotation=o,p.pixelRatio=r,p}async _singleExport(t,e,i,o,r,a,p){l(u,i,o,e);const n=new s(u[0],u[1],u[2],u[3],t.spatialReference);return[await this._export(n,e[0],e[1],r,a,p)]}_tiledExport(t,e,i,o,r){const a=n.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),p=new h(a),m=p.getTileCoverage(t);if(!m)return null;const l=[];return m.forEach(((a,n,m,d)=>{f.set(a,n,m,d),p.getTileBounds(u,f);const h=new s(u[0],u[1],u[2],u[3],t.spatialReference);l.push(this._export(h,e,e,i,o,r))})),Promise.all(l)}};t([o()],y.prototype,\"_imagePromise\",void 0),t([o()],y.prototype,\"bitmaps\",void 0),t([o()],y.prototype,\"container\",void 0),t([o()],y.prototype,\"fetchSource\",void 0),t([o()],y.prototype,\"hidpi\",void 0),t([o()],y.prototype,\"imageMaxWidth\",void 0),t([o()],y.prototype,\"imageMaxHeight\",void 0),t([o()],y.prototype,\"imageRotationSupported\",void 0),t([o()],y.prototype,\"imageNormalizationSupported\",void 0),t([o()],y.prototype,\"requestUpdate\",void 0),t([o()],y.prototype,\"updating\",null),y=t([r(\"esri.views.2d.layers.support.ExportStrategy\")],y);const S=y;export{S as default};\n"],"names":["_","t","e","i","s","target","pixelFormat","internalFormat","dataType","wrapMode","width","height","d","g","requestRenderOnSourceChangedEnabled","_textureInvalidated","stencilRef","coordScale","_height","pixelRatio","resolution","rotation","_source","_width","x","y","blendFunction","source","requestRender","bind","this","_texture","dispose","sourceWidth","sourceHeight","invalidateTexture","HTMLImageElement","naturalHeight","naturalWidth","updateTexture","context","dvs","n","transforms","toScreenNoRotation","o","a","c","l","Math","PI","u","r","h","displayViewMat3","mips","descriptor","hasMipmap","generateMipmap","setSamplingMode","samplingMode","bindTexture","stage","resize","getRenderedRasterPixels","setData","renderedRasterPixels","document","createElement","render","getContext","ready","children","some","registerRenderPass","name","brushes","drawPhase","pixelBlock","extent","originalPixelBlock","filter","getAsRGBA","createImageData","data","set","putImageData","Uint8Array","buffer","abs","cos","sin","size","round","f","_imagePromise","bitmaps","hidpi","imageMaxWidth","imageMaxHeight","imageRotationSupported","imageNormalizationSupported","update","stationary","destroyed","state","p","spatialReference","worldScreenWidth","m","floor","xmin","valid","xmax","paddedViewState","center","_singleExport","min","_tiledExport","then","container","includes","fadeOut","remove","addChild","fadeIn","catch","visible","fetchSource","signal","ymax","_export","scales","scale","getTileCoverage","forEach","getTileBounds","push","Promise","all","prototype","S"],"sourceRoot":""}