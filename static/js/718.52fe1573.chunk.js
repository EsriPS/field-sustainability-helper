"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[718],{718:function(e,n,t){t.r(n),t.d(n,{registerFunctions:function(){return L}});var r=t(37762),a=t(72741),i=t(62357),l=t(5431),o=t(97879),s=t(31786),u=t(790),f=t(97246),c=t(44715),d=t(12829),y=t(67820),p=t(89066),m=t(45184),h=t(73954),v=t(84272),g=t(82279),F=t(29876),E=t(65247),I=t(93106),D=t(66978),w=t(48562),b=t(94990),N=t(83040);function x(e,n,t){var r=e.getVariables();if(r.length>0){for(var a=[],i=0;i<r.length;i++){var l={name:r[i]};a.push(n.evaluateIdentifier(t,l))}return(0,D.$6)(a).then((function(n){for(var t={},a=0;a<r.length;a++)t[r[a]]=n[a];return e.parameters=t,e}))}return(0,D.DB)(e)}function A(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var r in e)if(r.toLowerCase()===n.toLowerCase())return e[r];return t}function S(e){if(null===e)return null;var n={type:A(e,"type",""),name:A(e,"name","")};if("range"===n.type)n.range=A(e,"range",[]);else{n.codedValues=[];var t,a=(0,r.Z)(A(e,"codedValues",[]));try{for(a.s();!(t=a.n()).done;){var i=t.value;n.codedValues.push({name:A(i,"name",""),code:A(i,"code",null)})}}catch(l){a.e(l)}finally{a.f()}}return n}function Z(e){if(null===e)return null;var n={},t=A(e,"wkt",null);null!==t&&(n.wkt=t);var r=A(e,"wkid",null);return null!==r&&(n.wkid=r),n}function C(e){if(null===e)return null;var n={hasZ:A(e,"hasz",!1),hasM:A(e,"hasm",!1)},t=A(e,"spatialreference",null);t&&(n.spatialReference=Z(t));var r=A(e,"x",null);if(null!==r)return n.x=r,n.y=A(e,"y",null),n;var a=A(e,"rings",null);if(null!==a)return n.rings=a,n;var i=A(e,"paths",null);if(null!==i)return n.paths=i,n;var l=A(e,"points",null);if(null!==l)return n.points=l,n;for(var o=0,s=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];o<s.length;o++){var u=s[o],f=A(e,u,null);null!==f&&(n[u]=f)}return n}function T(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,n){var t,a=(0,r.Z)(n);try{for(a.s();!(t=a.n()).done;)if(t.value===e)return!0}catch(i){a.e(i)}finally{a.f()}return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==(0,c.a)(e.layerDefinition.fields)&&!1!==(0,c.a)(e.featureSet.features)}function L(e){"async"===e.mode&&(e.functions.getuser=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,c.p)(r,1,2);var l=(0,c.E)(r[1],""),o=!0===l;if(l=!0===l||!1===l?"":(0,c.d)(l),r[0]instanceof a.Z){var u=null;return n.services&&n.services.portal&&(u=n.services.portal),u=(0,s.getPortal)(r[0],u),(0,s.lookupUser)(u,l,o).then((function(e){if(e){for(var n=JSON.parse(JSON.stringify(e)),t=0,r=["lastLogin","created","modified"];t<r.length;t++){var a=r[t];void 0!==n[a]&&null!==n[a]&&(n[a]=new Date(n[a]))}return i.Z.convertObjectToArcadeDictionary(n)}return null}))}var f=null;if((0,c.o)(r[0])&&(f=r[0]),f)return o=!1,l?null:f.load().then((function(){return f.getOwningSystemUrl()})).then((function(e){if(!e)return l?null:f.getIdentityUser().then((function(e){return e?i.Z.convertObjectToArcadeDictionary({username:e}):null}));var t=null;return n.services&&n.services.portal&&(t=n.services.portal),t=(0,s.getPortal)(new a.Z(e),t),(0,s.lookupUser)(t,l,o).then((function(e){if(e){for(var n=JSON.parse(JSON.stringify(e)),t=0,r=["lastLogin","created","modified"];t<r.length;t++){var a=r[t];void 0!==n[a]&&null!==n[a]&&(n[a]=new Date(n[a]))}return i.Z.convertObjectToArcadeDictionary(n)}return null}))}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if((0,c.p)(t,2,4),t[0]instanceof o.Z){var r=(0,c.d)(t[1]),a=(0,c.E)(t[2],null),i=(0,c.y)((0,c.E)(t[3],!0));if(null===a&&(a=["*"]),!1===(0,c.a)(a))throw new Error("Invalid Parameter");return t[0].featureSetById(r,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){if((0,c.p)(r,1,2),r[0]instanceof l.Z){var a=(0,c.E)(r[1],"datasource");return null===a&&(a="datasource"),a=(0,c.d)(a).toLowerCase(),(0,s.convertToFeatureSet)(r[0]._layer,a,n.lrucache,n.interceptor,n.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){if((0,c.p)(r,2,5),null===r[0])throw new Error("Portal is required");if(r[0]instanceof a.Z){var i=(0,c.d)(r[1]),l=(0,c.d)(r[2]),o=(0,c.E)(r[3],null),u=(0,c.y)((0,c.E)(r[4],!0));if(null===o&&(o=["*"]),!1===(0,c.a)(o))throw new Error("Invalid Parameter");var f=null;return n.services&&n.services.portal&&(f=n.services.portal),f=(0,s.getPortal)(r[0],f),(0,s.constructFeatureSetFromPortalItem)(i,l,n.spatialReference,o,u,f,n.lrucache,n.interceptor)}if(!1===(0,c.f)(r[0]))throw new Error("Portal is required");var d=(0,c.d)(r[0]),y=(0,c.d)(r[1]),p=(0,c.E)(r[2],null),m=(0,c.y)((0,c.E)(r[3],!0));if(null===p&&(p=["*"]),!1===(0,c.a)(p))throw new Error("Invalid Parameter");if(n.services&&n.services.portal)return(0,s.constructFeatureSetFromPortalItem)(d,y,n.spatialReference,p,m,n.services.portal,n.lrucache,n.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){if((0,c.p)(t,2,4),t[0]instanceof o.Z){var r=(0,c.d)(t[1]),a=(0,c.E)(t[2],null),i=(0,c.y)((0,c.E)(t[3],!0));if(null===a&&(a=["*"]),!1===(0,c.a)(a))throw new Error("Invalid Parameter");return t[0].featureSetByName(r,i,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(n,t){return e.standardFunction(n,t,(function(e,t,a){(0,c.p)(a,1,1);var l=a[0],o={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,c.f)(l))void 0!==(l=JSON.parse(l)).layerDefinition?(o.layerDefinition=l.layerDefinition,o.featureSet=l.featureSet,l.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=l.layerDefinition.spatialReference)):(o.featureSet.features=l.features,o.featureSet.geometryType=l.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=l.objectIdFieldName,o.layerDefinition.typeIdField=l.typeIdFieldName,o.layerDefinition.globalIdField=l.globalIdFieldName,o.layerDefinition.fields=l.fields,l.spatialReference&&(o.layerDefinition.spatialReference=l.spatialReference));else{if(!(a[0]instanceof i.Z))throw new Error("Invalid Parameter");var s=A(l=JSON.parse(a[0].castToText()),"layerdefinition");if(null!==s){o.layerDefinition.geometryType=A(s,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.globalIdField=A(s,"globalidfield",""),o.layerDefinition.objectIdField=A(s,"objectidfield",""),o.layerDefinition.typeIdField=A(s,"typeidfield","");var u=A(s,"spatialreference",null);u&&(o.layerDefinition.spatialReference=Z(u));var f,d=(0,r.Z)(A(s,"fields",[]));try{for(d.s();!(f=d.n()).done;){var y=f.value,p={name:A(y,"name",""),alias:A(y,"alias",""),type:A(y,"type",""),nullable:A(y,"nullable",!0),editable:A(y,"editable",!0),length:A(y,"length",null),domain:S(A(y,"domain"))};o.layerDefinition.fields.push(p)}}catch(J){d.e(J)}finally{d.f()}var m=A(l,"featureset",null);if(m){var h,g={},F=(0,r.Z)(o.layerDefinition.fields);try{for(F.s();!(h=F.n()).done;){var E=h.value;g[E.name.toLowerCase()]=E.name}}catch(J){F.e(J)}finally{F.f()}var I,D=(0,r.Z)(A(m,"features",[]));try{for(D.s();!(I=D.n()).done;){var w=I.value,b={},N=A(w,"attributes",{});for(var x in N)b[g[x.toLowerCase()]]=N[x];o.featureSet.features.push({attributes:b,geometry:C(A(w,"geometry",null))})}}catch(J){D.e(J)}finally{D.f()}}}else{o.layerDefinition.geometryType=A(l,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=A(l,"objectidfieldname",""),o.layerDefinition.typeIdField=A(l,"typeidfieldname","");var L=A(l,"spatialreference",null);L&&(o.layerDefinition.spatialReference=Z(L));var P,O=(0,r.Z)(A(l,"fields",[]));try{for(O.s();!(P=O.n()).done;){var R=P.value,W={name:A(R,"name",""),alias:A(R,"alias",""),type:A(R,"type",""),nullable:A(R,"nullable",!0),editable:A(R,"editable",!0),length:A(R,"length",null),domain:S(A(R,"domain"))};o.layerDefinition.fields.push(W)}}catch(J){O.e(J)}finally{O.f()}var B,k={},M=(0,r.Z)(o.layerDefinition.fields);try{for(M.s();!(B=M.n()).done;){var G=B.value;k[G.name.toLowerCase()]=G.name}}catch(J){M.e(J)}finally{M.f()}var j,V=(0,r.Z)(A(l,"features",[]));try{for(V.s();!(j=V.n()).done;){var H=j.value,_={},X=A(H,"attributes",{});for(var z in X)_[k[z.toLowerCase()]]=X[z];o.featureSet.features.push({attributes:_,geometry:C(A(H,"geometry",null))})}}catch(J){V.e(J)}finally{V.f()}}}if(!1===T(o))throw new Error("Invalid Parameter");return v.Z.create(o,n.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(n,t){return e.standardFunctionAsync(n,t,(function(t,r,a){if((0,c.p)(a,2,2),(0,c.a)(a[0])||(0,c.b)(a[0])){var i=[],l=a[0];l instanceof f.Z&&(l=l.toArray());var o=null;if(a[1]instanceof u.Z)o=e.arcadeCustomFunctionHandler(a[1]);else if(a[1]instanceof c.N)o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return a[1].fn(n,{preparsed:!0,arguments:t})};else{if(!(a[1]instanceof c.S))throw new Error("Invalid Parameter");o=function(){var e;if(arguments.length!==a[1].paramCount)throw new Error("Invalid parameters");return(e=a[1]).fn.apply(e,arguments)}}return l.reduce((function(e,n,t){return e.then((function(e){t>0&&!0===e&&i.push(l[t-1]);var r=o(n);return(0,D.y8)(r)?r:(0,D.DB)(r)}))}),Promise.resolve(!1)).then((function(e){return!0===e&&l.length>0&&i.push(l[l.length-1]),i}))}return(0,c.o)(a[0])?a[0].load().then((function(t){var r=w.WhereClause.create(a[1],t.getFieldsIndex()),i=r.getVariables();if(i.length>0){for(var l=[],o=0;o<i.length;o++){var s={name:i[o]};l.push(e.evaluateIdentifier(n,s))}return(0,D.$6)(l).then((function(e){for(var n={},t=0;t<i.length;t++)n[i[t]]=e[t];return r.parameters=n,new y.Z({parentfeatureset:a[0],whereclause:r})}))}return(0,D.DB)(new y.Z({parentfeatureset:a[0],whereclause:r}))})):e.failDefferred("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(n,t){return e.standardFunctionAsync(n,t,(function(n,t,r){if((0,c.p)(r,2,2),(0,c.o)(r[0])){var a=new g.Z(r[1]);return(0,D.DB)(new p.Z({parentfeatureset:r[0],orderbyclause:a}))}return e.failDefferred("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(n,t){return e.standardFunctionAsync(n,t,(function(n,t,r){return(0,c.p)(r,2,2),(0,c.o)(r[0])?(0,D.DB)(new m.Z({parentfeatureset:r[0],topnum:r[1]})):(0,c.a)(r[0])?(0,c.t)(r[1])>=r[0].length?r[0].slice(0):r[0].slice(0,(0,c.t)(r[1])):(0,c.b)(r[0])?(0,c.t)(r[1])>=r[0].length()?r[0].slice(0):r[0].slice(0,(0,c.t)(r[1])):e.failDefferred("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(n,t){return e.standardFunctionAsync(n,t,(function(e,n,t){return(0,c.p)(t,1,1),(0,c.o)(t[0])?t[0].first(e.abortSignal).then((function(e){if(null!==e){var n=l.Z.createFromGraphicLikeObject(e.geometry,e.attributes,t[0]);n._underlyingGraphic=e,e=n}return e})):(0,c.a)(t[0])?0===t[0].length?(0,D.DB)(null):(0,D.DB)(t[0][0]):(0,c.b)(t[0])?0===t[0].length()?(0,D.DB)(null):(0,D.DB)(t[0].get(0)):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,c.p)(r,1,2);var a={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(r.length>1)if(r[1]instanceof i.Z){if(r[1].hasField("minsize")&&(a.minsize=(0,c.t)(r[1].field("minsize"))),r[1].hasField("metadata")&&(a.returnMetadata=(0,c.y)(r[1].field("metadata"))),r[1].hasField("maxsize")&&(a.maxsize=(0,c.t)(r[1].field("maxsize"))),r[1].hasField("types")){var o=(0,c.V)(r[1].field("types"),!1);o.length>0&&(a.types=o)}}else if(null!==r[1])throw new Error("Invalid Parameter");if(r[0]instanceof l.Z){var u=r[0]._layer;return u instanceof b.default&&(u=(0,s.constructFeatureSet)(u,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===u||!1===(0,c.o)(u)?[]:u.load().then((function(){return u.queryAttachments(r[0].field(u.objectIdField),a.minsize,a.maxsize,a.types,a.returnMetadata)}))}if(null===r[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,r){(0,c.p)(r,2,4);var a=r[0],i=(0,c.d)(r[1]),o=(0,c.E)(r[2],null),u=(0,c.y)((0,c.E)(r[3],!0));if(null===o&&(o=["*"]),!1===(0,c.a)(o))throw new Error("Invalid Parameter");if(null===r[0])return null;if(!(r[0]instanceof l.Z))throw new Error("Invalid Parameter");var f=a._layer;return f instanceof b.default&&(f=(0,s.constructFeatureSet)(f,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===f||!1===(0,c.o)(f)?null:f.load().then((function(e){var t=e.relationshipMetaData().filter((function(e){return e.name===i}));if(0===t.length)return null;if(void 0!==t[0].relationshipTableId&&null!==t[0].relationshipTableId&&t[0].relationshipTableId>-1)return(0,s.constructFeatureSetFromRelationship)(e,t[0],a.field(e.objectIdField),e.spatialReference,o,u,n.lrucache,n.interceptor);var r=e.serviceUrl();return r?(r="/"===r.charAt(r.length-1)?r+t[0].relatedTableId.toString():r+"/"+t[0].relatedTableId.toString(),(0,s.constructFeatureSetFromUrl)(r,e.spatialReference,o,u,n.lrucache,n.interceptor).then((function(n){return n.load().then((function(){return n.relationshipMetaData()})).then((function(r){if(r=r.filter((function(e){return e.id===t[0].id})),!1===a.hasField(t[0].keyField)||null===a.field(t[0].keyField))return e.getFeatureByObjectId(a.field(e.objectIdField),[t[0].keyField]).then((function(e){if(e){var a=w.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return a.parameters={id:e.attributes[t[0].keyField]},n.filter(a)}return new h.Z({parentfeatureset:n})}));var i=w.WhereClause.create(r[0].keyField+"= @id",n.getFieldsIndex());return i.parameters={id:a.field(t[0].keyField)},n.filter(i)}))}))):null}))}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(n,t){return e.standardFunctionAsync(n,t,(function(e,t,a){(0,c.p)(a,2,3);var i=a[0],o=(0,c.d)((0,c.E)(a[1],"")).toLowerCase(),u=(0,c.f)(a[2])?(0,c.d)(a[2]):null;if(null===a[0])return null;if(!(a[0]instanceof l.Z))throw new Error("Invalid Parameter");var f=i._layer;return f instanceof b.default&&(f=(0,s.constructFeatureSet)(f,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===f||!1===(0,c.o)(f)?null:f.load().then((function(){var e=f.serviceUrl();return(0,s.constructAssociationMetaDataFeatureSetFromUrl)(e,n.spatialReference)})).then((function(e){var n=null,t=null,a=!1;if(null!==u&&""!==u&&void 0!==u){var l,s=(0,r.Z)(e.terminals);try{for(s.s();!(l=s.n()).done;){var y=l.value;y.terminalName===u&&(t=y.terminalId)}}catch(_){s.e(_)}finally{s.f()}null===t&&(a=!0)}var p,m=e.associations.getFieldsIndex(),h=m.get("TOGLOBALID").name,v=m.get("FROMGLOBALID").name,g=m.get("TOTERMINALID").name,E=m.get("FROMTERMINALID").name,I=m.get("FROMNETWORKSOURCEID").name,D=m.get("TONETWORKSOURCEID").name,b=m.get("ASSOCIATIONTYPE").name,x=m.get("ISCONTENTVISIBLE").name,A=m.get("OBJECTID").name,S=(0,r.Z)(f.fields);try{for(S.s();!(p=S.n()).done;){var Z=p.value;if("global-id"===Z.type){n=i.field(Z.name);break}}}catch(_){S.e(_)}finally{S.f()}var C=null,T=new d.yN(new N.Z({name:"percentalong",alias:"percentalong",type:"double"}),w.WhereClause.create("0",e.associations.getFieldsIndex())),L=new d.yN(new N.Z({name:"side",alias:"side",type:"string"}),w.WhereClause.create("''",e.associations.getFieldsIndex())),P="globalid",O="globalId",R={};for(var W in e.lkp)R[W]=e.lkp[W].sourceId;var B=new d.TO(new N.Z({name:"classname",alias:"classname",type:"string"}),null,R),k="";switch(o){case"midspan":k="((".concat(h,"='").concat(n,"') OR ( ").concat(v,"='").concat(n,"')) AND (").concat(b," IN (5))"),B.codefield=w.WhereClause.create("CASE WHEN (".concat(h,"='").concat(n,"') THEN ").concat(I," ELSE ").concat(D," END"),e.associations.getFieldsIndex());var M=(0,F.JW)(d.Xx.findField(e.associations.fields,v));M.name=P,M.alias=P,C=new d.yN(M,w.WhereClause.create("CASE WHEN (".concat(v,"='").concat(n,"') THEN ").concat(h," ELSE ").concat(v," END"),e.associations.getFieldsIndex())),T=e.unVersion>=4?new d.$X(d.Xx.findField(e.associations.fields,m.get("PERCENTALONG").name)):new d.yN(new N.Z({name:"percentalong",alias:"percentalong",type:"double"}),w.WhereClause.create("0",e.associations.getFieldsIndex()));break;case"junctionedge":k="((".concat(h,"='").concat(n,"') OR ( ").concat(v,"='").concat(n,"')) AND (").concat(b," IN (4,6))"),B.codefield=w.WhereClause.create("CASE WHEN (".concat(h,"='").concat(n,"') THEN ").concat(I," ELSE ").concat(D," END"),e.associations.getFieldsIndex());var G=(0,F.JW)(d.Xx.findField(e.associations.fields,v));G.name=P,G.alias=P,C=new d.yN(G,w.WhereClause.create("CASE WHEN (".concat(v,"='").concat(n,"') THEN ").concat(h," ELSE ").concat(v," END"),e.associations.getFieldsIndex())),L=new d.yN(new N.Z({name:"side",alias:"side",type:"string"}),w.WhereClause.create("CASE WHEN (".concat(b,"=4) THEN 'from' ELSE 'to' END"),e.associations.getFieldsIndex()));break;case"connected":var j="".concat(h,"='@T'"),V="".concat(v,"='@T'");null!==t&&(j+=" AND ".concat(g,"=@A"),V+=" AND ".concat(E,"=@A")),k="(("+j+") OR ("+V+"))",k=(0,c.P)(k,"@T",n),j=(0,c.P)(j,"@T",n),null!==t&&(j=(0,c.P)(j,"@A",t.toString()),k=(0,c.P)(k,"@A",t.toString())),B.codefield=w.WhereClause.create("CASE WHEN "+j+" THEN ".concat(I," ELSE ").concat(D," END"),e.associations.getFieldsIndex());var H=(0,F.JW)(d.Xx.findField(e.associations.fields,v));H.name=P,H.alias=P,C=new d.yN(H,w.WhereClause.create("CASE WHEN "+j+" THEN ".concat(v," ELSE ").concat(h," END"),e.associations.getFieldsIndex()));break;case"container":k="".concat(h,"='").concat(n,"' AND ").concat(b," = 2"),null!==t&&(k+=" AND ".concat(g," = ")+t.toString()),B.codefield=I,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,v),P,P);case"content":k="(".concat(v,"='").concat(n,"' AND ").concat(b," = 2)"),null!==t&&(k+=" AND ".concat(E," = ")+t.toString()),B.codefield=D,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,h),P,P);break;case"structure":k="(".concat(h,"='").concat(n,"' AND ").concat(b," = 3)"),null!==t&&(k+=" AND ".concat(g," = ")+t.toString()),B.codefield=I,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,v),P,O);break;case"attached":k="(".concat(v,"='").concat(n,"' AND ").concat(b," = 3)"),null!==t&&(k+=" AND ".concat(E," = ")+t.toString()),B.codefield=D,k="( "+k+" )",C=new d.QP(d.Xx.findField(e.associations.fields,h),P,O);break;default:throw new Error("Invalid Parameter")}return a&&(k="1 <> 1"),new d.Xx({parentfeatureset:e.associations,adaptedFields:[new d.$X(d.Xx.findField(e.associations.fields,A)),new d.$X(d.Xx.findField(e.associations.fields,x)),C,L,B,T],extraFilter:k?w.WhereClause.create(k,e.associations.getFieldsIndex()):null})}))}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(n,t){return e.standardFunctionAsync(n,t,(function(t,a,l){return(0,c.p)(l,3,3),(0,c.o)(l[0])?l[0].load().then((function(t){var a=[],o=[],s=!1,u=[];if((0,c.f)(l[1]))u.push(l[1]);else if(l[1]instanceof i.Z)u.push(l[1]);else if((0,c.a)(l[1]))u=l[1];else{if(!(0,c.b)(l[1]))return e.failDefferred("Illegal Value: GroupBy");u=l[1].toArray()}var f,d=(0,r.Z)(u);try{for(d.s();!(f=d.n()).done;){var y=f.value;if((0,c.f)(y)){var p=w.WhereClause.create((0,c.d)(y),t.getFieldsIndex()),m=!0===(0,E.y5)(p)?(0,c.d)(y):"%%%%FIELDNAME";a.push({name:m,expression:p}),"%%%%FIELDNAME"===m&&(s=!0)}else{if(!(y instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");var h=y.hasField("name")?y.field("name"):"%%%%FIELDNAME",v=y.hasField("expression")?y.field("expression"):"";if("%%%%FIELDNAME"===h&&(s=!0),!h)return e.failDefferred("Illegal Value: GroupBy");a.push({name:h,expression:w.WhereClause.create(v||h,t.getFieldsIndex())})}}}catch(U){d.e(U)}finally{d.f()}if(u=[],(0,c.f)(l[2]))u.push(l[2]);else if((0,c.a)(l[2]))u=l[2];else if((0,c.b)(l[2]))u=l[2].toArray();else{if(!(l[2]instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");u.push(l[2])}var g,F=(0,r.Z)(u);try{for(F.s();!(g=F.n()).done;){var I=g.value;if(!(I instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");var b=I.hasField("name")?I.field("name"):"",N=I.hasField("statistic")?I.field("statistic"):"",A=I.hasField("expression")?I.field("expression"):"";if(!b||!N||!A)return e.failDefferred("Illegal Value: GroupBy");o.push({name:b,statistic:N.toLowerCase(),expression:w.WhereClause.create(A,t.getFieldsIndex())})}}catch(U){F.e(U)}finally{F.f()}if(s){var S,Z={},C=(0,r.Z)(t.fields);try{for(C.s();!(S=C.n()).done;){Z[S.value.name.toLowerCase()]=1}}catch(U){C.e(U)}finally{C.f()}var T,L=(0,r.Z)(a);try{for(L.s();!(T=L.n()).done;){var P=T.value;"%%%%FIELDNAME"!==P.name&&(Z[P.name.toLowerCase()]=1)}}catch(U){L.e(U)}finally{L.f()}var O,R=(0,r.Z)(o);try{for(R.s();!(O=R.n()).done;){var W=O.value;"%%%%FIELDNAME"!==W.name&&(Z[W.name.toLowerCase()]=1)}}catch(U){R.e(U)}finally{R.f()}var B,k=0,M=(0,r.Z)(a);try{for(M.s();!(B=M.n()).done;){var G=B.value;if("%%%%FIELDNAME"===G.name){for(;1===Z["field_"+k.toString()];)k++;Z["field_"+k.toString()]=1,G.name="FIELD_"+k.toString()}}}catch(U){M.e(U)}finally{M.f()}}for(var j=[],V=0,H=a;V<H.length;V++){var _=H[V];j.push(x(_.expression,e,n))}for(var X=0,z=o;X<z.length;X++){var J=z[X];j.push(x(J.expression,e,n))}return j.length>0?(0,D.$6)(j).then((function(){return(0,D.DB)(l[0].groupby(a,o))})):(0,D.DB)(l[0].groupby(a,o))})):e.failDefferred("Illegal Value: GroupBy")}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(n,t){return e.standardFunctionAsync(n,t,(function(t,a,l){return(0,c.o)(l[0])?((0,c.p)(l,2,2),l[0].load().then((function(t){var a=[],o=[];if((0,c.f)(l[1]))o.push(l[1]);else if(l[1]instanceof i.Z)o.push(l[1]);else if((0,c.a)(l[1]))o=l[1];else{if(!(0,c.b)(l[1]))return e.failDefferred("Illegal Value: GroupBy");o=l[1].toArray()}var s,u=!1,f=(0,r.Z)(o);try{for(f.s();!(s=f.n()).done;){var d=s.value;if((0,c.f)(d)){var y=w.WhereClause.create((0,c.d)(d),t.getFieldsIndex()),p=!0===(0,E.y5)(y)?(0,c.d)(d):"%%%%FIELDNAME";a.push({name:p,expression:y}),"%%%%FIELDNAME"===p&&(u=!0)}else{if(!(d instanceof i.Z))return e.failDefferred("Illegal Value: GroupBy");var m=d.hasField("name")?d.field("name"):"%%%%FIELDNAME",h=d.hasField("expression")?d.field("expression"):"";if("%%%%FIELDNAME"===m&&(u=!0),!m)return e.failDefferred("Illegal Value: GroupBy");a.push({name:m,expression:w.WhereClause.create(h||m,t.getFieldsIndex())})}}}catch(R){f.e(R)}finally{f.f()}if(u){var v,g={},F=(0,r.Z)(t.fields);try{for(F.s();!(v=F.n()).done;){g[v.value.name.toLowerCase()]=1}}catch(R){F.e(R)}finally{F.f()}var I,b=(0,r.Z)(a);try{for(b.s();!(I=b.n()).done;){var N=I.value;"%%%%FIELDNAME"!==N.name&&(g[N.name.toLowerCase()]=1)}}catch(R){b.e(R)}finally{b.f()}var A,S=0,Z=(0,r.Z)(a);try{for(Z.s();!(A=Z.n()).done;){var C=A.value;if("%%%%FIELDNAME"===C.name){for(;1===g["field_"+S.toString()];)S++;g["field_"+S.toString()]=1,C.name="FIELD_"+S.toString()}}}catch(R){Z.e(R)}finally{Z.f()}}for(var T=[],L=0,P=a;L<P.length;L++){var O=P[L];T.push(x(O.expression,e,n))}return T.length>0?(0,D.$6)(T).then((function(){return(0,D.DB)(l[0].groupby(a,[]))})):(0,D.DB)(l[0].groupby(a,[]))}))):function(e,n,t,r){if(1===r.length){if((0,c.a)(r[0]))return(0,I.t)(e,r[0],-1);if((0,c.b)(r[0]))return(0,I.t)(e,r[0].toArray(),-1)}return(0,I.t)(e,r,-1)}("distinct",0,0,l)}))})}}}]);
//# sourceMappingURL=718.52fe1573.chunk.js.map