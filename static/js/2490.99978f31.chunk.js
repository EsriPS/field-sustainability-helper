"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[2490],{77566:function(e,t,n){n.d(t,{T:function(){return j},I:function(){return K}});var i=n(1413),r=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(27366),u=n(52639),c=(n(93169),n(91505)),p=n(41691),h=n(42537),d=n(92026),v=n(49861),f=n(63780),y=(n(25243),n(69912)),m=n(93655),g=(n(59486),n(84652)),_=n(68860),x=n(1587),k=n(2170),w=n(69662),C=n(92975),b=n(22018),S=n(89494),T=n(48976),M=n(98131),V=n(11186),Z=n(71353),E=n(7882);function O(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,d.pC)(n)?[e,t,n]:[e,t]}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,d.pC)(n)?{x:e,y:t,z:n}:{x:e,y:t}}var R=function(){function e(t){(0,r.Z)(this,e),this.spatialReference=t}return(0,a.Z)(e,[{key:"mapToLocalMultiple",value:function(e){var t=this;return(0,d.lV)(e.map((function(e){return t.mapToLocal(e)})))}},{key:"doUnnormalization",get:function(){return!1}}]),e}(),P=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,r.Z)(this,n),(a=t.call(this,i)).defaultZ=o,a.transform=(0,S.c)(),a.transformInv=(0,S.c)(),a.transform=(0,S.a)(e),(0,b.a)(a.transformInv,a.transform),a}return(0,a.Z)(n,[{key:"makeMapPoint",value:function(e,t){return O(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){return I(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}},{key:"localToMap",value:function(e){return O(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this.defaultZ)}}]),n}(R),D=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e,i){var a;(0,r.Z)(this,n),(a=t.call(this,e.spatialReference)).view=e,a.defaultZ=null,a.pWS=(0,Z.c)(),a.tangentFrameUpWS=(0,Z.c)(),a.tangentFrameRightWS=(0,Z.c)(),a.tangentFrameForwardWS=(0,Z.c)(),a.localFrameRightWS=(0,Z.c)(),a.localFrameUpWS=(0,Z.c)(),a.worldToLocalTransform=(0,M.a)(),a.localToWorldTransform=(0,M.a)(),a.scale=1,a.scale=e.resolution,a.referenceMapPoint=i,a.defaultZ=i.hasZ?i.z:null;var o=e.state.camera.viewRight;a.view.renderCoordsHelper.toRenderCoords(a.referenceMapPoint,a.pWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,0,a.tangentFrameRightWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,1,a.tangentFrameUpWS),a.view.renderCoordsHelper.worldBasisAtPosition(a.pWS,2,a.tangentFrameForwardWS);var s=(0,Z.c)();return(0,V.a)(s,a.tangentFrameForwardWS,(0,V.d)(o,a.tangentFrameForwardWS)),(0,V.f)(a.localFrameRightWS,o,s),(0,V.n)(a.localFrameRightWS,a.localFrameRightWS),(0,V.c)(a.localFrameUpWS,a.tangentFrameForwardWS,a.localFrameRightWS),(0,T.r)(a.worldToLocalTransform,a.localFrameRightWS,a.tangentFrameRightWS),(0,T.i)(a.localToWorldTransform,a.worldToLocalTransform),a}return(0,a.Z)(n,[{key:"doUnnormalization",get:function(){return"global"===this.view.viewingMode}},{key:"makeMapPoint",value:function(e,t){return O(e,t,this.defaultZ)}},{key:"mapToLocal",value:function(e){var t=(0,Z.c)();this.view.renderCoordsHelper.toRenderCoords(new E.Z({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),(0,V.q)(t,t,this.worldToLocalTransform);var n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return(0,d.pC)(n)?I(n.x/this.scale,n.y/this.scale):null}},{key:"localToMap",value:function(e){var t=(0,Z.c)();this.view.renderCoordsHelper.toRenderCoords(new E.Z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),(0,V.q)(t,t,this.localToWorldTransform);var n=this.view.renderCoordsHelper.fromRenderCoords(t,this.view.spatialReference);return(0,d.pC)(n)?O(n.x,n.y,this.defaultZ):null}}]),n}(R);function W(e,t){if("2d"===e.type)return new P(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if("3d"===e.type){var n=t.length>2?new E.Z({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new E.Z({x:t[0],y:t[1],spatialReference:e.spatialReference});return new D(e,n)}return null}var G=n(77577),A=n(29909),F=n(80885);function z(e,t){var n=new E.Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function H(e,t){return new G.Z({points:e,spatialReference:t})}function U(e,t,n){var i=new A.Z({paths:e,spatialReference:t});return n&&(0,w.nc)(i),i}function L(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=(0,g.d9)(e);r.forEach((function(e){var t=e[0],n=e[e.length-1];(0,f.fS)(t,n)&&1!==e.length||e.push(e[0])}));var a=new F.Z({rings:r,spatialReference:t});return a.rings.forEach((function(e){(0,w.bu)(e,!1,!1)||e.reverse()})),n&&(0,w.nc)(a),i&&a.isSelfIntersecting&&(0,C.JY)(t)&&(a=(0,k.simplify)(a)),a}function q(e,t,n){var i=t.mapToLocalMultiple(e),r=[],a={x:i[0].x,y:i[0].y},o=i[1].x,s=i[1].y,l=Math.round(o-a.x),u=Math.round(s-a.y),c=Math.max(Math.abs(l),Math.abs(u));if(n){var p={x:a.x+c,y:a.y+c},h={x:a.x-c,y:a.y-c};r.push(I(p.x,h.y),I(h.x,h.y),I(h.x,p.y),I(p.x,p.y))}else{var v={x:l>0?a.x+c:a.x-c,y:u>0?a.y+c:a.y-c};r.push(I(a.x,a.y),I(v.x,a.y),I(v.x,v.y),I(a.x,v.y))}return L([(0,d.lV)(r.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function N(e,t,n){var i=t.mapToLocalMultiple(e);if(1===i.length){var r=48,a=i[0];i=[I(a.x-r,a.y+r),I(a.x+r,a.y-r),I(a.x+r,a.y-r),I(a.x-r,a.y+r)]}var o=[],s={x:i[0].x,y:i[0].y},l={x:i[1].x,y:i[1].y};if(n){var u=Math.round(l.x-s.x),c=Math.round(l.y-s.y);o.push(I(s.x-u,s.y-c),I(l.x,s.y-c),I(l.x,l.y),I(s.x-u,l.y))}else o.push(I(s.x,s.y),I(l.x,s.y),I(l.x,l.y),I(s.x,l.y));return L([(0,d.lV)(o.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!0)}function X(e,t,n,i){var r=t.mapToLocalMultiple(e),a=null,o=null;if(n)a=r[0],o=r[1];else{var s=r[0],l=r[1],u=Math.round(l.x-s.x),c=Math.round(l.y-s.y),p=Math.max(Math.abs(u),Math.abs(c));a=I(u>0?s.x+p/2:s.x-p/2,c>0?s.y+p/2:s.y-p/2),o=I(Math.abs(u)>Math.abs(c)?a.x-p/2:a.x,Math.abs(u)>Math.abs(c)?a.y:a.y-p/2)}var h=t.localToMap(a),v=t.localToMap(o);if((0,d.Wi)(h)||(0,d.Wi)(v))return null;t.doUnnormalization&&(0,w.Sq)([[h,v]],t.spatialReference);var f=z(h,t.spatialReference),y=z(v,t.spatialReference),m=(0,_.c9)(t.spatialReference),g=0;if((0,C.JY)(t.spatialReference))g=m*(0,k.distance)(f,y,null);else{var b=a.x-o.x,S=a.y-o.y;g=m*Math.sqrt(b*b+S*S)*(i||1)}var T=new x.Z({center:f,radius:g,radiusUnit:"meters",spatialReference:t.spatialReference});return L(T.rings,T.spatialReference,!1)}function B(e,t,n){for(var i=t.mapToLocalMultiple(e),r=i[0],a=i[1],o=Math.round(a.x-r.x),s=Math.round(a.y-r.y),l=I(n?r.x:r.x+o/2,n?r.y:r.y+s/2),u=n?o:o/2,c=n?s:s/2,p=[],h=2*Math.PI/60,v=0;v<60;v++){var f=Math.cos(v*h),y=Math.sin(v*h),m=I(u*f+l.x,c*y+l.y);p.push(m)}return p.push(p[0]),L([(0,d.lV)(p.map((function(e){return t.localToMap(e)})))],t.spatialReference,t.doUnnormalization,!1)}var Y=n(29919),j=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._graphic=null,i.defaultZ=0,i.geometryType=null,i.hasZ=!0,i.mode=null,i.snappingManager=null,i.snapToScene=!1,i}return(0,a.Z)(n,[{key:"initialize",value:function(){var e=this;this.internalGraphicsLayer=new m.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",(function(t){return e.onVertexAdd(t)})),this.drawOperation.on("vertex-remove",(function(t){return e.onVertexRemove(t)})),this.drawOperation.on("vertex-update",(function(t){return e.onVertexUpdate(t)})),this.drawOperation.on("cursor-update",(function(t){return e.onCursorUpdate(t)})),this.drawOperation.on("complete",(function(t){return e.onComplete(t)}))]),this.complete()}},{key:"destroy",value:function(){this.drawOperation=(0,d.SC)(this.drawOperation),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,d.SC)(this.internalGraphicsLayer),this._set("view",null)}},{key:"canRedo",get:function(){return this.drawOperation.canRedo}},{key:"canUndo",get:function(){return this.drawOperation.canUndo}},{key:"centered",set:function(e){this._set("centered",e),this._updateGraphic()}},{key:"enabled",set:function(e){this.drawOperation.interactive=e,this._set("enabled",e)}},{key:"forceUniformSize",set:function(e){this._set("forceUniformSize",e),this._updateGraphic()}},{key:"graphic",get:function(){return this._graphic}},{key:"graphicSymbol",set:function(e){this._set("graphicSymbol",e),(0,d.pC)(this._graphic)&&(this._graphic.symbol=e)}},{key:"updating",get:function(){var e,t;return null!=(e=null==(t=this.drawOperation)?void 0:t.updating)&&e}},{key:"completeCreateOperation",value:function(){this.drawOperation.complete()}},{key:"onInputEvent",value:function(e){this.drawOperation.onInputEvent(e)}},{key:"redo",value:function(){this.drawOperation.redo()}},{key:"reset",value:function(){}},{key:"undo",value:function(){this.drawOperation.undo()}},{key:"_createGraphic",value:function(e){var t=this;this._graphic=new u.Z({geometry:e,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,h.kB)((function(){(0,d.pC)(t._graphic)&&(t.internalGraphicsLayer.remove(t._graphic),t._graphic=(0,d.SC)(t._graphic))})),Q)}},{key:"_destroyAllVisualisations",value:function(){this.handles.remove(J.outline),this.handles.remove(J.regularVertices),this.handles.remove(J.activeVertex),this.handles.remove(Q)}},{key:"_getCreateOperationGeometry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;var t=this.drawOperation.stagedVertex,n=this.drawOperation.committedVertices,i=n.slice();(0,d.pC)(t)&&i.push(this.drawOperation.coordinateHelper.pointToArray(t));var r=(0,d.pC)(t)?this.drawOperation.coordinateHelper.pointToArray(t):n.splice(-1)[0],a={regularVertices:null,activeVertex:null,full:null,outline:null},o=i.length,s=this.drawOperation.spatialReference,l="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":a.regularVertices=n,a.activeVertex=r,a.full=this.drawOperation.coordinateHelper.arrayToPoint(i[0]);break;case"multipoint":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=H(i,s));break;case"polyline":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=U([i],s,l));break;case"polygon":a.regularVertices=n,a.activeVertex=r,o>0&&(a.full=L([i],s,l,!0));break;case"circle":if(o>0){var u=W(this.view,i[0]);if(1===o&&e.operationComplete){var c=i[0],p=u.makeMapPoint(c[0]+$*this.view.resolution,c[1]);a.full=X([c,p],u,!0)}else 2===o&&(a.full=this.forceUniformSize?X(i,u,this.centered):B(i,u,this.centered))}break;case"rectangle":if(o>0){var h=W(this.view,i[0]);if(1===o&&e.operationComplete){var v=i[0],f=h.makeMapPoint(v[0]+$*this.view.resolution,v[1]);a.full=q([v,f],h,!0)}else 2===o&&(a.full=this.forceUniformSize?q(i,h,this.centered):N(i,h,this.centered))}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":o>1&&(a.outline=U([i],s,l));break;case"circle":case"rectangle":(0,d.pC)(a.full)&&"polygon"===a.full.type&&(a.outline=L(a.full.rings,s,l))}return a}},{key:"initializeGraphic",value:function(e){return null}},{key:"onComplete",value:function(e){this._updateGraphic();var t=null;if(this.drawOperation.isCompleted){var n=this._getCreateOperationGeometry({operationComplete:!0});(0,d.pC)(n)&&(t=new u.Z((0,i.Z)({geometry:n.full,symbol:this.graphicSymbol,sourceLayer:this.internalGraphicsLayer},this.graphicProperties)))}this.emit("complete",(0,i.Z)({graphic:t},e))}},{key:"onCursorUpdate",value:function(e){this._updateGraphic(),this.emit("cursor-update",e)}},{key:"onDeactivate",value:function(){this.drawOperation.isCompleted||this.drawOperation.cancel()}},{key:"onVertexAdd",value:function(e){this._updateGraphic(),this.emit("vertex-add",e)}},{key:"onVertexRemove",value:function(e){this._updateGraphic(),this.emit("vertex-remove",e)}},{key:"onVertexUpdate",value:function(e){this._updateGraphic(),this.emit("vertex-update",e)}},{key:"_updateGraphic",value:function(){var e=this._getCreateOperationGeometry();(0,d.Wi)(e)?this._destroyAllVisualisations():((0,d.pC)(e.outline)?this.handles.add(this.onOutlineChanged(e.outline),J.outline):this.handles.remove(J.outline),(0,d.pC)(e.regularVertices)?this.handles.add(this.onRegularVerticesChanged(e.regularVertices),J.regularVertices):this.handles.remove(J.regularVertices),(0,d.pC)(e.activeVertex)?this.handles.add(this.onActiveVertexChanged(e.activeVertex),J.activeVertex):this.handles.remove(J.activeVertex),(0,d.pC)(e.full)?(0,d.Wi)(this._graphic)?this._createGraphic(e.full):this._graphic.geometry=e.full:this.handles.remove(Q))}}]),n}((0,p.p)(c.Z.EventedMixin(Y.m)));(0,l._)([(0,v.Cb)({value:!0})],j.prototype,"centered",null),(0,l._)([(0,v.Cb)({nonNullable:!0})],j.prototype,"defaultZ",void 0),(0,l._)([(0,v.Cb)()],j.prototype,"drawOperation",void 0),(0,l._)([(0,v.Cb)({value:!0})],j.prototype,"enabled",null),(0,l._)([(0,v.Cb)({value:!0})],j.prototype,"forceUniformSize",null),(0,l._)([(0,v.Cb)({constructOnly:!0})],j.prototype,"geometryType",void 0),(0,l._)([(0,v.Cb)()],j.prototype,"graphic",null),(0,l._)([(0,v.Cb)({constructOnly:!0})],j.prototype,"graphicProperties",void 0),(0,l._)([(0,v.Cb)()],j.prototype,"graphicSymbol",null),(0,l._)([(0,v.Cb)({constructOnly:!0})],j.prototype,"hasZ",void 0),(0,l._)([(0,v.Cb)({constructOnly:!0})],j.prototype,"mode",void 0),(0,l._)([(0,v.Cb)()],j.prototype,"snappingManager",void 0),(0,l._)([(0,v.Cb)()],j.prototype,"snapToScene",void 0),(0,l._)([(0,v.Cb)({readOnly:!0})],j.prototype,"type",void 0),(0,l._)([(0,v.Cb)({readOnly:!0})],j.prototype,"updating",null),(0,l._)([(0,v.Cb)({constructOnly:!0,nonNullable:!0})],j.prototype,"view",void 0),j=(0,l._)([(0,y.j)("esri.views.draw.DrawGraphicTool")],j);var Q="create-operation-graphic",J={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function K(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";default:return null}}var $=48},42046:function(e,t,n){n.d(t,{w:function(){return Z}});var i=n(15861),r=n(1413),a=n(15671),o=n(43144),s=n(60136),l=n(29388),u=n(87757),c=n(27366),p=n(91505),h=n(41691),d=n(84652),v=n(92026),f=n(66978),y=n(17842),m=n(49861),g=(n(25243),n(69912)),_=n(70178),x=function(){function e(t){var n=t.grabbableForEvent;(0,a.Z)(this,e),this.events=new p.Z,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=n}return(0,o.Z)(e,[{key:"intersectionDistance",value:function(e,t){return 0}},{key:"attach",value:function(){}},{key:"detach",value:function(){}}]),e}(),k="click",w=n(14813),C=n(74229),b=n(84954),S=n(87268),T=n(34019),M=n(80151),V=n(99912),Z=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e))._createOperationCompleted=!1,i._pointerDownStates=new Set,i._snappingPipeline=new M.n,i._snappingTask=null,i._stagedVertex=null,i.snapToSceneEnabled=null,(0,v.Wi)(e.elevationInfo)&&(i.elevationInfo={mode:e.hasZ?"absolute-height":"on-the-ground",offset:0}),i}return(0,o.Z)(n,[{key:"initialize",value:function(){var e,t,n=this;this.coordinateHelper=(0,w.Y6)(this.hasZ,this.hasM,this.view.spatialReference);var i="3d"===this.view.type?null==(e=this.view)||null==(t=e.resourceController)?void 0:t.scheduler:null;this._frameTask=i?i.registerTask(V.T8.SNAPPING):V.sq;var a="viewingMode"in this.view.state?this.view.state.viewingMode:2,o="segment"===this.geometryType||"multipoint"===this.geometryType?"polyline":this.geometryType;this._editGeometryOperations=new S.c(new b.XE(o,this.coordinateHelper,a)),this._activeComponent=new b.wA(this.spatialReference,a),this._editGeometryOperations.data.components.push(this._activeComponent),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],(function(e){var t=e.vertices.map((function(e){return{componentIndex:0,vertexIndex:e.index,coordinates:n.coordinateHelper.vectorToArray(e.pos)}})),i=t.map((function(e){return e.coordinates}));switch(e.type){case"vertex-add":n.emit(e.type,(0,r.Z)((0,r.Z)({},e),{},{added:i,vertices:t}));break;case"vertex-update":n.emit(e.type,(0,r.Z)((0,r.Z)({},e),{},{updated:i,vertices:t}));break;case"vertex-remove":n.emit(e.type,(0,r.Z)((0,r.Z)({},e),{},{removed:i,vertices:t}))}}))),this._manipulator=new x({grabbableForEvent:function(e){return"click"!==n.drawingMode||"touch"===e.pointerType&&n._snappingEnabled&&1===n._pointerDownStates.size}}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==this.geometryType,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",(function(e){return n._onImmediateClick(e)})),this._manipulator.events.on("immediate-double-click",(function(e){return n._onImmediateDoubleClick(e)}))])}},{key:"destroy",value:function(){this._editGeometryOperations=(0,v.SC)(this._editGeometryOperations),this._frameTask=(0,v.hw)(this._frameTask)}},{key:"_snappingEnabled",get:function(){return(0,v.pC)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}},{key:"canRedo",get:function(){return this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return this._editGeometryOperations.canUndo}},{key:"committedVertices",get:function(){var e=this;return this._activeComponent.vertices.map((function(t){return e.coordinateHelper.vectorToArray(t.pos)}))}},{key:"drawingMode",set:function(e){this._set("drawingMode",null!=e?e:k)}},{key:"hasStagedVertex",get:function(){return(0,v.pC)(this._stagedVertex)}},{key:"interactive",get:function(){return this._manipulator.interactive},set:function(e){this._manipulator.interactive=e}},{key:"isCompleted",get:function(){return this._createOperationCompleted}},{key:"numCommittedVertices",get:function(){return this._activeComponent.vertices.length}},{key:"numVertices",get:function(){return(0,v.pC)(this._stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}},{key:"spatialReference",get:function(){return this.view.spatialReference}},{key:"stagedVertex",get:function(){return this._stagedVertex},set:function(e){if((0,v.Wi)(e))this.discardStagedVertex();else if(!(0,v.pC)(this._stagedVertex)||!(0,_.k)(this._stagedVertex,e)){if((0,v.Wi)(this._stagedVertex))this._stagedVertex=(0,d.d9)(e);else{if((0,_.k)(this._stagedVertex,e))return;this._stagedVertex.x=e.x,this._stagedVertex.y=e.y,this._stagedVertex.z=e.z,this._stagedVertex.m=e.m,this._stagedVertex.hasZ=e.hasZ,this._stagedVertex.hasM=e.hasM,this._stagedVertex.spatialReference=e.spatialReference}this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(e)}],operation:"apply",type:"vertex-update"})}}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"vertices",get:function(){var e=this.committedVertices;return(0,v.pC)(this._stagedVertex)&&e.push(this.coordinateHelper.pointToArray(this._stagedVertex)),e}},{key:"cancel",value:function(){this.complete({aborted:!0})}},{key:"commitStagedVertex",value:function(){if(this._snappingTask=(0,v.IM)(this._snappingTask),(0,v.pC)(this._stagedVertex)){var e=this._stagedVertex;this._stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}}},{key:"complete",value:function(e){var t=e&&e.aborted||!1;(0,v.IM)(this._snappingTask),(0,v.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.discardStagedVertex();var n="multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3;this._createOperationCompleted=!n,(this.isCompleted||t)&&this.emit("complete",{vertices:this.vertices.map((function(e,t){return{componentIndex:0,vertexIndex:t,coordinates:e}})),aborted:t,type:"complete"})}},{key:"discardStagedVertex",value:function(){this._stagedVertex=null}},{key:"onInputEvent",value:function(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}},{key:"redo",value:function(){this._editGeometryOperations.redo()}},{key:"undo",value:function(){(0,v.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}},{key:"_closeOnClickVertexIndex",value:function(e){var t=this._activeComponent;if("polygon"===this.geometryType&&t.vertices.length>2){if(this._vertexWithinPointerDistance(t.vertices[0].pos,e))return 0;if(this._vertexWithinPointerDistance(t.vertices[t.vertices.length-1].pos,e))return t.vertices.length-1}return null}},{key:"_createManipulatorDragPipeline",value:function(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}},{key:"_createManipulatorDragPipelineClick",value:function(e){var t=this;return(0,C.Xd)(e,(function(e,n,i,r){var a="touch"===r&&t._snappingEnabled;!t.isCompleted&&a&&(n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&(t.stagedVertex=e.mapStart,("segment"===t.geometryType||a&&0===t.numVertices)&&t.commitStagedVertex()),e})).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return a},cancel:i,snappingManager:t.snappingManager,snappingContext:new T.N({editGeometryOperations:t._editGeometryOperations,elevationInfo:t.elevationInfo,pointer:r,visualizer:t.snappingVisualizer}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next((function(e){return a&&(t.stagedVertex=e.mapEnd,"end"===e.action&&t.commitStagedVertex()),e})).next((function(e){return"end"===e.action&&("segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()),e})),i.next((function(){a&&(0,v.pC)(t.snappingManager)&&t.snappingManager.doneSnapping()})))}))}},{key:"_createManipulatorDragPipelineFreehand",value:function(e){var t=this;return(0,C.Xd)(e,(function(e,n){t.isCompleted||n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&((0,v.Wi)(t.stagedVertex)&&(t.stagedVertex=e.mapStart),"segment"===t.geometryType&&t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":t.complete()}return e}))}))}},{key:"_createManipulatorDragPipelineHybrid",value:function(e){var t=this;return(0,C.Xd)(e,(function(e,n){t.isCompleted||n.next(t._screenToMapDragEventStep()).next((function(e){return"start"===e.action&&((0,v.Wi)(t.stagedVertex)&&(t.stagedVertex=e.mapStart),t.commitStagedVertex()),e})).next((function(e){switch(e.action){case"start":case"update":t.stagedVertex=e.mapEnd,"polygon"!==t.geometryType&&"polyline"!==t.geometryType||t.commitStagedVertex();break;case"end":"segment"!==t.geometryType&&"point"!==t.geometryType||t.complete()}return e}))}))}},{key:"_getDrawSurface",value:function(){if((0,v.Wi)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ)return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;var e=this.defaultZ,t=!1;(0,v.pC)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(t=!0),(0,v.pC)(this.snapToSceneEnabled)&&(t=this.snapToSceneEnabled),(0,v.pC)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(t=!1);var n=this._activeComponent.vertices.length;return("segment"===this.geometryType||"polygon"===this.geometryType)&&n>0&&(e=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),t=!1),t?this.drawSurface:(this.elevationDrawSurface.defaultZ=e,this.elevationDrawSurface)}},{key:"_mapToScreen",value:function(e){return this._getDrawSurface().mapToScreen(e)}},{key:"_onHold",value:function(e){(0,v.IM)(this._snappingTask),"click"===this.drawingMode&&"touch"===e.pointerType&&this._snappingEnabled&&(this.stagedVertex=e.mapPoint),e.stopPropagation()}},{key:"_onImmediateClick",value:function(e){if(!("mouse"===e.pointerType&&2===e.button||this._manipulator.dragging)){var t=this._activeComponent,n=this._closeOnClickVertexIndex(e.screenPoint);if((0,v.pC)(n))return e.stopPropagation(),this.discardStagedVertex(),void this.complete();var i=this._screenToMap(e.screenPoint);if((0,v.pC)(i))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&(this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),this.complete());break;case"click":case"hybrid":this._snappingTask=(0,v.IM)(this._snappingTask),this.hasStagedVertex?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(i)),("point"===this.geometryType||"segment"===this.geometryType&&2===t.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===t.vertices.length)&&this.complete()}e.stopPropagation()}}},{key:"_onImmediateDoubleClick",value:function(e){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),e.stopPropagation())}},{key:"_onPointerMove",value:function(e){var t=this;if((0,v.IM)(this._snappingTask),!(this._manipulator.dragging||this._pointerDownStates.has(e.pointerId)||this._manipulator.grabbing)&&this._manipulator.interactive){var n=(0,y.vW)(e.x,e.y),r=this._closeOnClickVertexIndex(n);if((0,v.pC)(r)){this.discardStagedVertex();var a={componentIndex:0,vertexIndex:r,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[r].pos)};this.emit("cursor-update",{updated:null,vertices:[a],operation:"apply",type:"vertex-update"})}else{var o=this._screenToMap(n);if(this._manipulator.cursor=(0,v.pC)(o)?"crosshair":null,(0,v.pC)(o))if((0,v.pC)(this.snappingManager)){var s=this.snappingManager,l=new T.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e.pointerType,visualizer:this.snappingVisualizer});this.stagedVertex=s.update(o,l),this._snappingTask=(0,f.vr)(function(){var e=(0,i.Z)(u.mark((function e(n){var i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._frameTask.schedule((function(){return s.snap(o,l,n)}),n);case 2:if(i=e.sent,e.t0=i.valid,!e.t0){e.next=7;break}return e.next=7,t._frameTask.schedule((function(){t.stagedVertex=i.apply()}),n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.updatingHandles.addPromise(this._snappingTask.promise)}else this.stagedVertex=o}e.stopPropagation()}}},{key:"_screenToMap",value:function(e){return this._getDrawSurface().screenToMap(e)}},{key:"_screenToMapDragEventStep",value:function(){var e=this,t=null;return function(n){if("start"===n.action&&(t=e._screenToMap(n.screenStart)),(0,v.Wi)(t))return null;var i=e._screenToMap(n.screenEnd);return(0,v.pC)(i)?(0,r.Z)((0,r.Z)({},n),{},{mapStart:t,mapEnd:i}):null}}},{key:"_vertexWithinPointerDistance",value:function(e,t){var n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return!!(0,v.pC)(n)&&function(e,t,n){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r<=n}(n,t,25)}}]),n}(p.Z.EventedMixin(h.r));(0,c._)([(0,m.Cb)()],Z.prototype,"defaultZ",void 0),(0,c._)([(0,m.Cb)({value:k})],Z.prototype,"drawingMode",null),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"elevationDrawSurface",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"elevationInfo",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"geometryType",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"hasM",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"hasZ",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"manipulators",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"drawSurface",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"snappingManager",void 0),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"snappingVisualizer",void 0),(0,c._)([(0,m.Cb)()],Z.prototype,"snapToSceneEnabled",void 0),(0,c._)([(0,m.Cb)({readOnly:!0})],Z.prototype,"updating",null),(0,c._)([(0,m.Cb)({constructOnly:!0})],Z.prototype,"view",void 0),Z=(0,c._)([(0,g.j)("esri.views.draw.DrawOperation")],Z)},54016:function(e,t,n){n.d(t,{aL:function(){return u},hP:function(){return p},iW:function(){return c}});var i=n(15671),r=n(43144),a=n(92026),o=n(17842),s=n(65618),l=n(74509),u=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,i.Z)(this,e),this.elevationInfo=t,this.defaultZ=n,this.view=r,this.excludeGraphics=a}return(0,r.Z)(e,[{key:"screenToMap",value:function(e){if((0,a.pC)(this.defaultZ))return this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,o.s1)(e.x,e.y),this.elevationInfo,this.defaultZ,this.excludeGraphics);var t=this.view.sceneIntersectionHelper.intersectElevationFromScreen((0,o.s1)(e.x,e.y),this.elevationInfo,0,this.excludeGraphics);return(0,a.pC)(t)&&(t.z=void 0),t}},{key:"mapToScreen",value:function(e){var t=(0,s.Tx)(e.x,e.y,(0,l.vQ)(this.view,e,this.elevationInfo),e.spatialReference);return this.view.toScreen(t)}}]),e}(),c=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];(0,i.Z)(this,e),this.view=t,this.elevationInfo=n,this.exclude=r}return(0,r.Z)(e,[{key:"screenToMap",value:function(e){var t=this.view.toMap(e,{exclude:this.exclude});return(0,a.pC)(t)&&(t.z=(0,l.Ou)(t,this.view,this.elevationInfo)),t}},{key:"mapToScreen",value:function(e){var t=e;return(0,a.pC)(this.elevationInfo)&&(t=(0,s.Tx)(e.x,e.y,(0,l.vQ)(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}}]),e}(),p=(0,r.Z)((function e(t){(0,i.Z)(this,e),this.view=t,this.screenToMap=function(e){return t.toMap(e)},this.mapToScreen=function(e){return t.toScreen(e)}}))},29919:function(e,t,n){n.d(t,{m:function(){return _}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(27366),l=n(85015),u=n(32718),c=n(92026),p=n(66978),h=n(49861),d=(n(63780),n(93169),n(25243),n(69912)),v=n(24043),f=n(37762),y=n(40110),m=function(){function e(){(0,i.Z)(this,e),this._isToolEditable=!0,this._manipulators=new y.Z,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}return(0,r.Z)(e,[{key:"isToolEditable",set:function(e){this._isToolEditable=e}},{key:"length",get:function(){return this._manipulators.length}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.addMany([e],t)[0]}},{key:"addMany",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.map((function(e){var i=t._nextManipulatorId++,r={id:i,manipulator:e,visibilityPredicate:n,attached:!1};return t._manipulators.add(r),t._attached&&t._updateManipulatorAttachment(r),i}))}},{key:"remove",value:function(e){if("number"==typeof e){for(var t=e,n=0;n<this._manipulators.length;n++)if(this._manipulators.getItemAt(n).id===t){var i=this._manipulators.splice(n,1)[0];return this._detachManipulator(i),i.id}return null}for(var r=e,a=0;a<this._manipulators.length;a++)if(this._manipulators.getItemAt(a).manipulator===r){var o=this._manipulators.splice(a,1)[0];return this._detachManipulator(o),o.id}return null}},{key:"removeAll",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._manipulators.removeAll()}},{key:"attach",value:function(){var e=this;this._manipulators.forEach((function(t){e._updateManipulatorAttachment(t)})),this._attached=!0}},{key:"detach",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._attached=!1}},{key:"destroy",value:function(){this._manipulators.forEach((function(e){var t=e.manipulator;t.destroy&&t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}},{key:"on",value:function(e,t){return this._manipulators.on(e,(function(e){t(e)}))}},{key:"forEach",value:function(e){var t,n=(0,f.Z)(this._manipulators.items);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(i){n.e(i)}finally{n.f()}}},{key:"some",value:function(e){return this._manipulators.items.some(e)}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){return e.push(t.manipulator)})),e}},{key:"intersect",value:function(e,t){var n=null,i=Number.MAX_VALUE;return this._manipulators.forEach((function(r){var a=r.id,o=r.manipulator;if(r.attached&&o.interactive){var s=o.intersectionDistance(e,t);(0,c.pC)(s)&&s<i&&(i=s,n={id:a,manipulator:o})}})),n}},{key:"findById",value:function(e){if((0,c.Wi)(e))return null;var t,n=(0,f.Z)(this._manipulators.items);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(e===i.id)return i.manipulator}}catch(r){n.e(r)}finally{n.f()}return null}},{key:"_updateManipulatorAttachment",value:function(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}},{key:"_attachManipulator",value:function(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}},{key:"_detachManipulator",value:function(e){if(e.attached){var t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}}},{key:"_isManipulatorItemVisible",value:function(e){return 2===e.visibilityPredicate||(this._isToolEditable?0===e.visibilityPredicate:1===e.visibilityPredicate)}}]),e}(),g=u.Z.getLogger("esri.views.interactive.InteractiveToolBase"),_=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).toolState="pending",r.completed=!1,r.manipulators=new m,r.updating=!1,r.automaticManipulatorSelection=!0,r._editableFlags=new Map([[1,!0],[0,!0]]),r._creationStartedResolver=(0,p.hh)(),r._creationFinishedResolver=(0,p.hh)(),r}return(0,r.Z)(n,[{key:"active",get:function(){return null!=this.view&&this.view.activeTool===this}},{key:"visible",set:function(e){this._set("visible",e),e||this.active&&(this.view.activeTool=null),this.attached&&(e?this._show():this._hide())}},{key:"editable",get:function(){return this.getEditableFlag(0)},set:function(e){this.setEditableFlag(0,e)}},{key:"attached",get:function(){return this._get("attached")}},{key:"created",get:function(){return"created"===this.toolState}},{key:"cursor",get:function(){return null}},{key:"attach",value:function(){this.attached?g.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}},{key:"detach",value:function(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):g.error("Tool isn't currently attached. Ignoring detach request.")}},{key:"activate",value:function(){(0,c.Wi)(this.view)?g.error("Can't activate tool if view is not defined."):this.active?g.warn("Tool is already active, ignoring activation request."):((0,v.t)(this.view)&&this.view.focus(),this.onActivate())}},{key:"deactivate",value:function(){this.active?this.onDeactivate():g.warn("Tool is not active, ignoring deactivation request.")}},{key:"handleInputEvent",value:function(e){this.attached?this.onInputEvent(e):g.warn("handleInputEvent() called on detached tool")}},{key:"handleInputEventAfter",value:function(e){this.attached?this.onInputEventAfter(e):g.warn("handleInputEventAfter() called on detached tool")}},{key:"destroy",value:function(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)}},{key:"setEditableFlag",value:function(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),0===e&&this.notifyChange("editable"),this.onEditableChange()}},{key:"getEditableFlag",value:function(e){return this._editableFlags.get(e)}},{key:"whenCreationStarted",value:function(){return this._creationStartedResolver.promise}},{key:"whenCreated",value:function(){return this._creationFinishedResolver.promise}},{key:"rejectCreation",value:function(e){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(e)}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onAttach",value:function(){}},{key:"onDetach",value:function(){}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onEditableChange",value:function(){}},{key:"onInputEvent",value:function(e){}},{key:"onInputEventAfter",value:function(e){}},{key:"internallyEditable",get:function(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}},{key:"startToolCreation",value:function(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error("Unexpected tool state ".concat(this.toolState))}},{key:"finishToolCreation",value:function(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error("Unexpected tool state ".concat(this.toolState))}}},{key:"complete",value:function(){this.finishToolCreation(),this._set("completed",!0)}},{key:"_show",value:function(){this._updateManipulatorAttachment(),this.onShow()}},{key:"_hide",value:function(){this._updateManipulatorAttachment(),this.onHide()}},{key:"_updateManipulatorAttachment",value:function(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}}]),n}(l.Z);(0,s._)([(0,h.Cb)()],_.prototype,"toolState",void 0),(0,s._)([(0,h.Cb)({constructOnly:!0})],_.prototype,"view",void 0),(0,s._)([(0,h.Cb)({readOnly:!0})],_.prototype,"active",null),(0,s._)([(0,h.Cb)({value:!0})],_.prototype,"visible",null),(0,s._)([(0,h.Cb)({value:!0})],_.prototype,"editable",null),(0,s._)([(0,h.Cb)({value:!1,readOnly:!0})],_.prototype,"attached",null),(0,s._)([(0,h.Cb)({readOnly:!0})],_.prototype,"created",null),(0,s._)([(0,h.Cb)({readOnly:!0})],_.prototype,"completed",void 0),(0,s._)([(0,h.Cb)({readOnly:!0})],_.prototype,"manipulators",void 0),(0,s._)([(0,h.Cb)({readOnly:!0})],_.prototype,"updating",void 0),(0,s._)([(0,h.Cb)()],_.prototype,"cursor",null),(0,s._)([(0,h.Cb)()],_.prototype,"automaticManipulatorSelection",void 0),_=(0,s._)([(0,d.j)("esri.views.interactive.InteractiveToolBase")],_)},74229:function(e,t,n){n.d(t,{hM:function(){return S},AN:function(){return w},zh:function(){return C},M2:function(){return f},Xd:function(){return v},kY:function(){return b},a9:function(){return y},oq:function(){return g},bD:function(){return x},QY:function(){return k}});var i=n(15671),r=n(43144),a=n(1413),o=n(37762),s=n(84652),l=n(16889),u=n(92026),c=n(17842),p=n(71353),h=n(60176),d=n(20008);function v(e,t){return e.events.on("drag",function(e,t){var n=null,i=null;return function(r){if("cancel"!==r.action){var a={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&(0,u.Wi)(n)&&(n=new S,i=new S,t(e,n,i,r.pointerType,a)),(0,u.pC)(n)&&n.execute(a),"end"===r.action&&(0,u.pC)(n)&&(n=null,i=null)}else(0,u.pC)(i)&&(i.execute({action:"cancel"}),n=null,i=null)}}(e,t))}function f(e,t){var n=[e.x,e.y,e.z],i=t,r=[Math.cos(i),Math.sin(i)],a=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(0===a)return null;r[0]/=a,r[1]/=a;var o=function(e){var t=(e.x-n[0])*r[0]+(e.y-n[1])*r[1];e.x=n[0]+t*r[0],e.y=n[1]+t*r[1]};return function(e){return o(e.mapStart),o(e.mapEnd),e}}function y(e,t){var n=null;return function(i){if("start"===i.action&&(n=function(e,t,n){var i=e.geometry;if((0,u.Wi)(i))return null;if("mesh"===i.type)return function(e,t,n,i){if((0,u.pC)(t.transform))return function(e,t,n,i){var r=m(n.getOriginPoint(t.spatialReference),i),a=t.spatialReference;return(0,u.Wi)(r)?null:{move:function(t,i,o){var s=(0,d.pB)(r.clone(),t,i,o);if(s.spatialReference.equals(a))n.origin=(0,p.f)(s.x,s.y,s.z);else{var l=(0,h.iV)(s,a);(0,u.pC)(l)&&(n.origin=(0,p.f)(l.x,l.y,l.z))}e.notifyGeometryChanged()}}}(e,t,t.transform,n);if(!t.spatialReference.equals(n))return null;var r=0,a=0,o=0;return{move:function(n,s,l){var u=n-r,c=s-a,p=l-o;if(u||c||p){var h=t.origin.clone().offset(u,c,p);t.centerAt(h,{geographic:1===i}),e.notifyGeometryChanged(),r=n,a=s,o=l}}}}(e,i,t,n);var r=m(i,t),a=i.spatialReference;return(0,u.Wi)(r)?null:{move:function(t,n,i){var o=(0,d.pB)(r.clone(),t,n,i);o.spatialReference.equals(a)?e.geometry=o:e.geometry=(0,h.iV)(o,a)}}}(e,i.mapStart.spatialReference,t)),(0,u.Wi)(n))return null;var r=i.mapEnd.x-i.mapStart.x,o=i.mapEnd.y-i.mapStart.y,s=i.mapEnd.z-i.mapStart.z;return n.move(r,o,s),(0,a.Z)((0,a.Z)({},i),{},{translationX:r,translationY:o,translationZ:s})}}function m(e,t){return(0,u.Wi)(e)?null:e.spatialReference.equals(t)?e.clone():(0,h.iV)(e,t)}function g(e,t){var n=e.map((function(e){return(0,u.Wg)(y(e,t))})).filter((function(e){return(0,u.pC)(e)}));return function(e){var t=e.mapEnd.x-e.mapStart.x,i=e.mapEnd.y-e.mapStart.y,r=e.mapEnd.z-e.mapStart.z;return n.forEach((function(t){return t(e)})),(0,a.Z)((0,a.Z)({},e),{},{translationX:t,translationY:i,translationZ:r})}}function _(e,t){var n,i=new Map,r=(0,o.Z)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.set(a,(0,s.d9)(e[a]))}}catch(l){r.e(l)}finally{r.f()}return function(t){return i.forEach((function(t,n){e[n]=t})),t}}function x(e){return(0,u.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e,t){var n=(0,u.pC)(t.transform)?t.transform.clone():null,i=t.vertexAttributes.clonePositional();return function(r){return t.transform=n,t.vertexAttributes=i,e.notifyGeometryChanged(),r}}(e,e.geometry):_(e,["geometry"])}function k(e){var t=e.map((function(e){return(0,u.Wg)(x(e))})).filter((function(e){return(0,u.pC)(e)}));return function(e){return t.forEach((function(t){return t(e)})),e}}function w(){var e=0,t=0,n=0;return function(i){"start"===i.action&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);var r=i.mapEnd.x-e,o=i.mapEnd.y-t,s=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,(0,a.Z)((0,a.Z)({},i),{},{mapDeltaX:r,mapDeltaY:o,mapDeltaZ:s,mapDeltaSpatialReference:i.mapStart.spatialReference})}}function C(){var e=0,t=0;return function(n){"start"===n.action&&(e=n.screenStart.x,t=n.screenStart.y);var i=n.screenEnd.x-e,r=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,(0,a.Z)((0,a.Z)({},n),{},{screenDeltaX:i,screenDeltaY:r})}}function b(e,t){var n=null,i=0,r=0;return function(a){if("start"===a.action&&((n=e.toScreen(t)).x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=a.screenStart.x-n.x,r=a.screenStart.y-n.y)),null==n)return null;var o=(0,l.uZ)(a.screenEnd.x-i,0,e.width),s=(0,l.uZ)(a.screenEnd.y-r,0,e.height),u=(0,c.vW)(o,s);return a.screenStart=n,a.screenEnd=u,a}}var S=function(){function e(){(0,i.Z)(this,e),this.execute=function(){}}return(0,r.Z)(e,[{key:"next",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return(0,u.pC)(t)&&(this.execute=function(e){var i=t(e);(0,u.pC)(i)&&n.execute(i)}),n}}]),e}()},80151:function(e,t,n){n.d(t,{n:function(){return v}});var i=n(15861),r=n(1413),a=n(15671),o=n(43144),s=n(87757),l=n(92026),u=n(66978),c=n(70178),p=n(74229),h=n(34019),d=n(99912),v=function(){function e(){(0,a.Z)(this,e),this.next=new p.hM}return(0,o.Z)(e,[{key:"createSnapDragEventPipelineStep",value:function(e){var t=this,n=e.predicate,a=void 0===n?function(){return!0}:n,o=e.cancel,v=e.snappingManager,f=e.snappingContext,y=e.updatingHandles;if((0,l.Wi)(v))return function(e){return e};var m=null,g=null,_=function(){m=(0,l.IM)(m),v.doneSnapping(),(0,l.pC)(g)&&g.frameTask.remove(),g=null};return o.next((function(e){return _(),e})),this.next=new p.hM,function(e){if(!a(e))return e;if(m=(0,l.IM)(m),"start"===e.action){var n="3d"===v.view.type?v.view.resourceController.scheduler.registerTask(d.T8.SNAPPING):d.sq;g={context:new h.N({editGeometryOperations:f.editGeometryOperations,elevationInfo:f.elevationInfo,pointer:f.pointer,vertexHandle:(0,l.pC)(e.info)?e.info.handle:null,excludeFeature:f.excludeFeature,visualizer:f.visualizer}),originalPos:(0,l.pC)(e.snapOrigin)?f.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,frameTask:n}}if((0,l.pC)(g)){var o=g.context.coordinateHelper.vectorToDehydratedPoint(g.context.coordinateHelper.arrayToVector([g.originalPos.x,g.originalPos.y,g.originalPos.z]));o.x+=e.mapEnd.x-e.mapStart.x,o.y+=e.mapEnd.y-e.mapStart.y;var p=e.mapStart.x-g.originalPos.x,x=e.mapStart.y-g.originalPos.y,k=(0,r.Z)((0,r.Z)({},e),{},{action:"udpate"}),w=g.context,C=v.update(o,g.context);if(e.mapEnd.x=C.x+p,e.mapEnd.y=C.y+x,"end"!==e.action){var b=g.frameTask;m=(0,u.vr)(function(){var e=(0,i.Z)(s.mark((function e(n){var i,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.schedule((function(){return v.snap(o,w,n)}),n);case 2:if(!(i=e.sent).valid){e.next=8;break}return e.next=6,b.schedule((function(){return i.apply()}),n);case 6:r=e.sent,(0,c.k)(r,C)||(k.mapEnd.x=r.x+p,k.mapEnd.y=r.y+x,t.next.execute(k));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),y.addPromise(m.promise)}}return"end"===e.action&&_(),e}}}]),e}()}}]);
//# sourceMappingURL=2490.99978f31.chunk.js.map