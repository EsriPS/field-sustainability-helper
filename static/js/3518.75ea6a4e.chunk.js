"use strict";(globalThis.webpackChunkfield_sustainability_helper=globalThis.webpackChunkfield_sustainability_helper||[]).push([[3518],{47991:(e,t,n)=>{n.d(t,{U:()=>d});var i=n(65156),s=n(376),r=n(66504),a=n(77981),o=n(76335),c=n(92975);function d(e){if(!e)return null;let t=null;const n=e.spatialReference,i=(0,c.C5)(n);if(!i)return"toJSON"in e?e.toJSON():e;const d=(0,c.sS)(n)?102100:4326,u=o.UZ[d].maxX,h=o.UZ[d].minX,m=o.UZ[d].plus180Line,f=o.UZ[d].minus180Line;let g;const _="toJSON"in e?e.toJSON():e;if((0,a.wp)(_))g=p(_,u,h);else if((0,a.aW)(_))_.points=_.points.map((e=>p(e,u,h))),g=_;else if((0,a.YX)(_))g=l(_,i);else if((0,a.oU)(_)||(0,a.l9)(_)){const e=x;(0,s.$P)(e,_);const n={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=(0,o.XZ)(n.xmin,h)*(2*u),a=0===i?_:function(e,t){const n=(0,o.x3)(e);for(const i of n)for(const e of i)e[0]+=t;return e}(_,i);n.xmin+=i,n.xmax+=i,(0,r.jQ)(n,m)&&n.xmax!==u||(0,r.jQ)(n,f)&&n.xmin!==h?t=a:g=a}else g=_;return null!==t?(new y).cut(t,u):g}function l(e,t){if(!t)return e;const n=function(e,t){const n=[],{ymin:i,ymax:s}=e,r=e.xmax-e.xmin,a=e.xmin,o=e.xmax;let c;const[d,l]=t.valid;c=u(e.xmin,t);const p=c.x,m=c.frameId;c=u(e.xmax,t);const y=c.x,x=c.frameId,f=p===y&&r>0;if(r>2*l){const e={xmin:a<o?p:y,ymin:i,xmax:l,ymax:s},t={xmin:d,ymin:i,xmax:a<o?y:p,ymax:s},r={xmin:0,ymin:i,xmax:l,ymax:s},c={xmin:d,ymin:i,xmax:0,ymax:s},u=[],f=[];h(e,r)&&u.push(m),h(e,c)&&f.push(m),h(t,r)&&u.push(x),h(t,c)&&f.push(x);for(let n=m+1;n<x;n++)u.push(n),f.push(n);n.push({extent:e,frameIds:[m]},{extent:t,frameIds:[x]},{extent:r,frameIds:u},{extent:c,frameIds:f})}else p>y||f?n.push({extent:{xmin:p,ymin:i,xmax:l,ymax:s},frameIds:[m]},{extent:{xmin:d,ymin:i,xmax:y,ymax:s},frameIds:[x]}):n.push({extent:{xmin:p,ymin:i,xmax:y,ymax:s},frameIds:[m]});return n}(e,t).map((e=>e.extent));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]))}}function p(e,t,n){if(Array.isArray(e)){const i=e[0];if(i>t){const n=(0,o.XZ)(i,t);e[0]=i+n*(-2*t)}else if(i<n){const t=(0,o.XZ)(i,n);e[0]=i+t*(-2*n)}}else{const i=e.x;if(i>t){const n=(0,o.XZ)(i,t);e.x+=n*(-2*t)}else if(i<n){const t=(0,o.XZ)(i,n);e.x+=t*(-2*n)}}return e}function u(e,t){const[n,i]=t.valid,s=2*i;let r,a=0;return e>i?(r=Math.ceil(Math.abs(e-i)/s),e-=r*s,a=r):e<n&&(r=Math.ceil(Math.abs(e-n)/s),e+=r*s,a=-r),{x:e,frameId:a}}function h(e,t){const{xmin:n,ymin:i,xmax:s,ymax:r}=t;return m(e,n,i)&&m(e,n,r)&&m(e,s,r)&&m(e,s,i)}function m(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}class y{cut(e,t){let n;if(e.rings)this.closed=!0,n=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,n=e.paths,this.minPts=2}const i=n.length,s=-2*t;for(let r=0;r<i;r++){const e=n[r];if(e&&e.length>=this.minPts){const t=[];for(const n of e)t.push([n[0]+s,n[1]]);n.push(t)}}return this.closed?e.rings=n:e.paths=n,e}}const x=(0,i.Ue)()},33518:(e,t,n)=>{n.r(t),n.d(t,{GraphicsSnappingSource:()=>v});var i=n(27366),s=n(85015),r=n(63780),a=n(41691),o=n(92026),c=n(66978),d=n(49861),l=(n(93169),n(25243),n(69912)),p=n(80885),u=n(79803),h=n(47991),m=n(27823),y=n(83406),x=n(3182),f=n(68928),g=n(14e3),_=n(64674),S=n(69117);let v=class extends((0,a.p)(s.Z)){constructor(e){super(e),this.availability=1,this.sources={multipoint:null,point:null,polygon:null,polyline:null},this.loadedWkids=new Set,this.loadedWkts=new Set,this.pendingAdds=[]}get updating(){return this.updatingHandles.updating}get layer(){return this.layerSource.layer}destroy(){const e=this.pendingAdds;this.pendingAdds.length=0;for(const t of e)t.task.abort();this._mapSources((e=>this._destroySource(e)))}initialize(){this.handles.add([this.layer.on("graphic-update",(e=>this._onGraphicUpdate(e))),this.updatingHandles.addOnCollectionChange((()=>this.layer.graphics),(e=>this._onGraphicsChanged(e)))]),this._addMany(this.layer.graphics.toArray())}async fetchCandidates(e,t){const n=(await(0,c.WW)(this._mapSources((n=>n.queryEngine.executeQueryForSnapping({point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),distance:e.distance,types:e.types,query:(0,o.pC)(e.filter)?e.filter.createQuery().toJSON():{where:"1=1"}},t).then((e=>{let{candidates:t}=e;return t})))))).flat().map((t=>(0,S.X)(t,e.coordinateHelper)));return(0,_.lQ)(e.point,n),n}refresh(){}_onGraphicUpdate(e){switch(e.property){case"geometry":case"visible":this._remove(e.graphic),this._addMany([e.graphic])}}_onGraphicsChanged(e){for(const t of e.removed)this._remove(t);this._addMany(e.added)}_addMany(e){const t=[],n=new Map;for(const i of e)(0,o.Wi)(i.geometry)||(this._needsInitializeProjection(i.geometry.spatialReference)?(t.push(i.geometry.spatialReference),n.set(i.uid,i)):this._add(i));this._createPendingAdd(t,n)}_createPendingAdd(e,t){if(!e.length)return;const n=(0,c.vr)((async n=>{await(0,u.iQ)(e.map((e=>({source:e,dest:this.spatialReference}))),{signal:n}),this._markLoadedSpatialReferences(e);for(const[,e]of t)this._add(e)}));this.updatingHandles.addPromise(n.promise);const i={task:n,graphics:t},s=()=>(0,r.e$)(this.pendingAdds,i);n.promise.then(s,s),this.pendingAdds.push(i)}_markLoadedSpatialReferences(e){for(const t of e)null!=t.wkid&&this.loadedWkids.add(t.wkid),null!=t.wkt&&this.loadedWkts.add(t.wkt)}_add(e){if((0,o.Wi)(e.geometry)||!e.visible)return;let t=e.geometry;if("mesh"===t.type)return;"extent"===t.type&&(t=p.Z.fromExtent(t));const n=this._ensureSource(t.type);if((0,o.Wi)(n))return;const i=this._createOptimizedFeature(e.uid,t);(0,o.pC)(i)&&n.featureStore.add(i)}_needsInitializeProjection(e){return(null==e.wkid||!this.loadedWkids.has(e.wkid))&&(null==e.wkt||!this.loadedWkts.has(e.wkt))&&!(0,u.Up)(e,this.spatialReference)}_createOptimizedFeature(e,t){const n=(0,u.iV)((0,h.U)(t),this.spatialReference);return n?new x.u_((0,y.GH)(n,!1,!1),{[w]:e},null,e):null}_ensureSource(e){const t=this.sources[e];if((0,o.pC)(t))return t;const n=this._createSource(e);return this.sources[e]=n,n}_createSource(e){const t=m.Mk.toJSON(e),n=new f.Z({geometryType:t,hasZ:!1,hasM:!1});return{featureStore:n,queryEngine:new g.Z({featureStore:n,fields:[{name:w,type:"esriFieldTypeOID",alias:w}],geometryType:t,hasM:!1,hasZ:!1,objectIdField:w,spatialReference:this.spatialReference,scheduler:(0,o.pC)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:e}}_remove(e){this._mapSources((t=>this._removeFromSource(t,e)));for(const t of this.pendingAdds)t.graphics.delete(e.uid),0===t.graphics.size&&t.task.abort()}_removeFromSource(e,t){const n=t.uid;e.featureStore.has(n)&&e.featureStore.removeById(t.uid)}_destroySource(e){e.queryEngine.destroy(),this.sources[e.type]=null}_mapSources(e){const{point:t,polygon:n,polyline:i,multipoint:s}=this.sources,r=[];return(0,o.pC)(t)&&r.push(e(t)),(0,o.pC)(n)&&r.push(e(n)),(0,o.pC)(i)&&r.push(e(i)),(0,o.pC)(s)&&r.push(e(s)),r}};(0,i._)([(0,d.Cb)({constructOnly:!0})],v.prototype,"spatialReference",void 0),(0,i._)([(0,d.Cb)({constructOnly:!0})],v.prototype,"layerSource",void 0),(0,i._)([(0,d.Cb)({constructOnly:!0})],v.prototype,"view",void 0),(0,i._)([(0,d.Cb)({readOnly:!0})],v.prototype,"updating",null),(0,i._)([(0,d.Cb)({readOnly:!0})],v.prototype,"availability",void 0),v=(0,i._)([(0,l.j)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],v);const w="OBJECTID"},69117:(e,t,n)=>{n.d(t,{X:()=>c});var i=n(95905),s=n(95122),r=n(75691),a=n(61309);class o extends r.a{constructor(e){super({...e,constraint:new s.Hk(e.coordinateHelper,e.targetPoint)})}get hints(){return[new a.n(this.targetPoint)]}}function c(e,t){switch(e.type){case"edge":return new i.L({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId});case"vertex":return new o({coordinateHelper:t,targetPoint:t.pointToVector(e.target),objectId:e.objectId})}}},61309:(e,t,n)=>{n.d(t,{n:()=>r});var i=n(64674),s=n(55054);class r extends s.r{constructor(e){super(),this.point=e}equals(e){return e instanceof r&&(0,i.Xv)(this.point,e.point)}}}}]);
//# sourceMappingURL=3518.75ea6a4e.chunk.js.map