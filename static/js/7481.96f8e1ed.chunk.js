"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[7481],{77095:function(e,t,r){r.d(t,{hN:function(){return E},P0:function(){return T},cW:function(){return Z}});var i=r(74165),n=r(37762),s=r(15861),a=r(10064),o=r(34066),u=r(66504);var l=r(77981),c=r(92975);function h(e,t){return e?t?4:3:t?3:2}function f(e,t,r,i,n,s){var a=h(n,s),o=i.coords,u=i.lengths;if(!u)return!1;for(var l=0,c=0;l<u.length;l++,c+=a)if(!p(e,t,r,o[c],o[c+1]))return!1;return!0}function p(e,t,r,i,s){if(!e)return!1;var a,o=h(t,r),u=e.coords,l=e.lengths,c=!1,f=0,p=(0,n.Z)(l);try{for(p.s();!(a=p.n()).done;){var d=a.value;c=y(c,u,o,f,d,i,s),f+=d*o}}catch(v){p.e(v)}finally{p.f()}return c}function y(e,t,r,i,n,s,a){for(var o=e,u=i,l=i,c=i+n*r;l<c;l+=r){(u=l+r)===c&&(u=i);var h=t[l],f=t[l+1],p=t[u],y=t[u+1];(f<a&&y>=a||y<a&&f>=a)&&h+(a-f)/(y-f)*(p-h)<s&&(o=!o)}return o}var d=r(83406),v=r(80457),m=r(19995),_=r(31904),w="feature-store:unsupported-query",b={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},R={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},I={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},S={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function k(e){return!0===R[e]}function g(e){return!0===I[(0,l.Ji)(e)]}function x(e){return!0===S[e]}function Z(e,t,i,n,s){if((0,l.oU)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var a=(0,d.Uy)(new v.Z,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,i){return p(e,t,r,i.coords[0],i.coords[1])}(a,!1,!1,e)}))}if((0,l.oU)(t)&&"esriGeometryMultipoint"===i){var c=(0,d.Uy)(new v.Z,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return f(c,!1,!1,e,n,s)}))}if((0,l.YX)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return(0,o.aV)(t,(0,_.Op)(i,n,s,e))}));if((0,l.YX)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return(0,o.lQ)(t,(0,_.Op)(i,n,s,e))}));if((0,l.YX)(t)&&"esriSpatialRelIntersects"===e){var h=function(e){return"mesh"===e?u.h_:(0,u.IY)(e)}(i);return Promise.resolve((function(e){return h(t,(0,_.Op)(i,n,s,e))}))}return r.e(309).then(r.bind(r,50309)).then((function(r){var a=r[b[e]].bind(null,t.spatialReference,t);return function(e){return a((0,_.Op)(i,n,s,e))}}))}function T(e,t,r){return G.apply(this,arguments)}function G(){return G=(0,s.Z)((0,i.Z)().mark((function e(t,r,n){var s,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.spatialRel,!(o=t.geometry)){e.next=11;break}if(k(s)){e.next=4;break}throw new a.Z(w,"Unsupported query spatial relationship",{query:t});case 4:if(!(0,c.JY)(o.spatialReference)||!(0,c.JY)(n)){e.next=11;break}if(g(o)){e.next=7;break}throw new a.Z(w,"Unsupported query geometry type",{query:t});case 7:if(x(r)){e.next=9;break}throw new a.Z(w,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",(0,m._W)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)}))),G.apply(this,arguments)}function E(e){if((0,l.YX)(e))return!0;if((0,l.oU)(e)){var t,r=(0,n.Z)(e.rings);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(5!==i.length)return!1;if(i[0][0]!==i[1][0]||i[0][0]!==i[4][0]||i[2][0]!==i[3][0]||i[0][1]!==i[3][1]||i[0][1]!==i[4][1]||i[1][1]!==i[2][1])return!1}}catch(s){r.e(s)}finally{r.f()}return!0}return!1}},37481:function(e,t,r){r.r(t),r.d(t,{default:function(){return S}});var i=r(74165),n=r(15861),s=r(37762),a=r(15671),o=r(43144),u=r(10064),l=r(32718),c=r(92026),h=r(65156),f=r(376),p=r(77095),y=r(20311),d=r(31904),v=r(21149),m=r(36876),_=l.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),w={getAttribute:function(e,t){return e.field(t)}};function b(e,t){return R.apply(this,arguments)}function R(){return R=(0,n.Z)((0,i.Z)().mark((function e(t,n){var s,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,48562));case 2:return s=e.sent,e.prev=3,(a=s.WhereClause.create(t,n)).isStandardized||(o=new u.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",a),_.error(o)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return a.testFeature(t,w)}));case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",(_.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 12:case"end":return e.stop()}}),e,null,[[3,9]])}))),R.apply(this,arguments)}var I=l.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),S=function(){function e(t){(0,a.Z)(this,e),this._geometryBounds=(0,h.Ue)(),this._idToVisibility=new Map,this._serviceInfo=t}return(0,o.Z)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,r){e._idToVisibility.set(r,0)}))}},{key:"setKnownIds",value:function(e){var t,r=(0,s.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._idToVisibility.set(i,1)}}catch(n){r.e(n)}finally{r.f()}}},{key:"setTrue",value:function(e){var t=this,r=[],i=[],n=new Set(e);return this._idToVisibility.forEach((function(e,s){var a=!!(1&t._idToVisibility.get(s)),o=n.has(s);!a&&o?r.push(s):a&&!o&&i.push(s),t._idToVisibility.set(s,o?3:0)})),{show:r,hide:i}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,r=this.where,i=this.timeExtent,n=this.objectIds;return v.Z.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:n})}},{key:"update",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,(0,d.j6)(t,null,r);case 3:return n=e.sent,e.next=6,Promise.all([this._setGeometryFilter(n),this._setIdFilter(n),this._setAttributeFilter(n),this._setTimeFilter(n)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,b(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return r=t.geometry,n=t.spatialRel||"esriSpatialRelIntersects",e.next=6,(0,p.cW)(n,r,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:s=e.sent,(0,f.$P)(this._geometryBounds,r),this._spatialQueryOperator=s,this.geometry=r,this.spatialRel=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,y.y)(this._serviceInfo.timeInfo,e.timeExtent,m.k);else{var t=new u.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);I.error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return!(0,c.pC)(this._timeOperator)||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(r,i){1&r||(e._idToVisibility.set(i,1),t.push(i))})),t}}]),e}()}}]);
//# sourceMappingURL=7481.96f8e1ed.chunk.js.map