"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[4e3],{14e3:function(e,t,r){r.d(t,{Z:function(){return P}});var n=r(1413),i=r(37762),s=r(74165),u=r(15861),a=r(43144),c=r(15671),o=r(10064),l=r(84652),p=r(92026),h=r(18759),f=r(68860),d=r(41414),x=r(65156),y=r(376),m=r(77981),v=r(50689),g=r(92975),_=r(33392),k=r(19995),S=r(60480),b=r(92536),Z=r(77095),R=r(20311),w=r(31904),Q=r(52410),F=r(819),I=r(99912);var C="feature-store:unsupported-query",E=new Set,G=new h.WJ(2e6),O=0,P=function(){function e(t){var r=this;(0,c.Z)(this,e),this.capabilities={query:S.g},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new h.Xq(O+++"$$",G)),this.fieldsIndex=new Q.Z(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return(0,a.Z)(e,[{key:"destroy",value:function(){this._frameTask=(0,p.hw)(this._frameTask),this.clearCache(),(0,p.SC)(this._geometryQueryCache),this._changeHandle=(0,p.hw)(this._changeHandle),(0,p.SC)(this.fieldsIndex)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return e?{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:(0,w.S2)(this.spatialReference)}:null}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,R.R)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){this._geometryQueryCache&&this._geometryQueryCache.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u=this,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,i=(0,l.d9)(t),e.prev=3,e.next=6,this._schedule((function(){return(0,w.Up)(i,u.definitionExpression,u.spatialReference)}),r);case 6:return i=e.sent,e.next=9,this._reschedule((function(){return u._checkQuerySupport(i)}),r);case 9:return i=e.sent,e.next=12,this._reschedule((function(){return u._executeGeometryQuery(i,r)}),r);case 12:return n=e.sent,e.next=15,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 15:return n=e.sent,e.next=18,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 18:return n=e.sent,e.next=21,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 21:return n=e.sent,e.next=24,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 24:n=e.sent,e.next=32;break;case 27:if(e.prev=27,e.t0=e.catch(3),e.t0===w.vF){e.next=31;break}throw e.t0;case 31:n=new b.Z([],null,this);case 32:return e.abrupt("return",n.createQueryResponse(i));case 33:case"end":return e.stop()}}),e,this,[[3,27]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u=this,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,(n=(0,l.d9)(t)).returnGeometry=!1,n.returnCentroid=!1,n.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return(0,w.Up)(n,u.definitionExpression,u.spatialReference)}),r);case 7:return n=e.sent,e.next=10,this._reschedule((function(){return u._checkQuerySupport(n)}),r);case 10:return n=e.sent,e.next=13,this._reschedule((function(){return u._executeGeometryQuery(n,r)}),r);case 13:return i=e.sent,e.next=16,this._reschedule((function(){return i.executeAggregateIdsQuery(n)}),r);case 16:return i=e.sent,e.next=19,this._reschedule((function(){return i.executeObjectIdsQuery(n)}),r);case 19:return i=e.sent,e.next=22,this._reschedule((function(){return i.executeTimeQuery(n)}),r);case 22:return i=e.sent,e.next=25,this._reschedule((function(){return i.executeAttributesQuery(n)}),r);case 25:return i=e.sent,e.abrupt("return",i.createQueryResponseForCount(n));case 29:if(e.prev=29,e.t0=e.catch(4),e.t0===w.vF){e.next=33;break}throw e.t0;case 33:return e.abrupt("return",0);case 34:case"end":return e.stop()}}),e,this,[[4,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u,a,c,o,p,h,x,y=this,m=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m.length>0&&void 0!==m[0]?m[0]:{},r=m.length>1?m[1]:void 0,i=(0,l.d9)(t),u=i.outSR,e.prev=4,e.next=7,this._schedule((function(){return(0,w.Up)(i,y.definitionExpression,y.spatialReference)}),r);case 7:return i=e.sent,e.next=10,this._reschedule((function(){return y._checkQuerySupport(i)}),r);case 10:return(i=e.sent).returnGeometry=!0,i.returnCentroid=!1,i.outSR=null,e.next=16,this._reschedule((function(){return y._executeGeometryQuery(i,r)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 25:return n=e.sent,e.next=28,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 28:if(n=e.sent,a=n.size){e.next=32;break}return e.abrupt("return",{count:a,extent:null});case 32:return(0,d.t8)(T,d.Gv),this.featureStore.forEachBounds(n.items,(function(e){return(0,d.TC)(T,e)}),A),c={xmin:T[0],ymin:T[1],xmax:T[3],ymax:T[4],spatialReference:(0,w.S2)(this.spatialReference)},this.hasZ&&isFinite(T[2])&&isFinite(T[5])&&(c.zmin=T[2],c.zmax=T[5]),(o=(0,k.iV)(c,n.spatialReference,u)).spatialReference=(0,w.S2)(u||this.spatialReference),o.xmax-o.xmin==0&&(p=(0,f.c9)(o.spatialReference),o.xmin-=p,o.xmax+=p),o.ymax-o.ymin==0&&(h=(0,f.c9)(o.spatialReference),o.ymin-=h,o.ymax+=h),this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0&&(x=(0,f.c9)(o.spatialReference),o.zmin-=x,o.zmax+=x),e.abrupt("return",{count:a,extent:o});case 42:if(e.prev=42,e.t0=e.catch(4),e.t0!==w.vF){e.next=46;break}return e.abrupt("return",{count:0,extent:null});case 46:throw e.t0;case 47:case"end":return e.stop()}}),e,this,[[4,42]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,u,a,c,o=this,p=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},r=p.length>1?p[1]:void 0,(u=(0,l.d9)(t)).returnGeometry=!1,u.returnCentroid=!1,u.outSR=null,e.prev=4,e.next=7,this._schedule((function(){return(0,w.Up)(u,o.definitionExpression,o.spatialReference)}),r);case 7:return u=e.sent,e.next=10,this._reschedule((function(){return o._checkQuerySupport(u)}),r);case 10:return u=e.sent,e.next=13,this._reschedule((function(){return o._executeGeometryQuery(u,r)}),r);case 13:return n=e.sent,e.next=16,this._reschedule((function(){return n.executeAggregateIdsQuery(u)}),r);case 16:return n=e.sent,e.next=19,this._reschedule((function(){return n.executeObjectIdsQuery(u)}),r);case 19:return n=e.sent,e.next=22,this._reschedule((function(){return n.executeTimeQuery(u)}),r);case 22:return n=e.sent,e.next=25,this._reschedule((function(){return n.executeAttributesQuery(u)}),r);case 25:return n=e.sent,a=n.items,c=new Set,e.next=29,this._reschedule((function(){var e,t=(0,i.Z)(a);try{for(t.s();!(e=t.n()).done;){var r=e.value;c.add(n.featureAdapter.getObjectId(r))}}catch(s){t.e(s)}finally{t.f()}}),r);case 29:return e.abrupt("return",c);case 32:if(e.prev=32,e.t0=e.catch(4),e.t0!==w.vF){e.next=36;break}return e.abrupt("return",new Set);case 36:throw e.t0;case 37:case"end":return e.stop()}}),e,this,[[4,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var i,u,a,c,o,l,h,f,d,x,y,_,S,Z,R=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.point,u=t.distance,t.types!==b.r.NONE){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return R._checkQuerySupport(t.query)}),r);case 5:if(a=e.sent,c=!(0,g.fS)(i.spatialReference,this.spatialReference),e.t0=c,!e.t0){e.next=11;break}return e.next=11,(0,k._W)(i.spatialReference,this.spatialReference);case 11:if(o="number"==typeof u?u:u.x,l="number"==typeof u?u:u.y,h={xmin:i.x-o,xmax:i.x+o,ymin:i.y-l,ymax:i.y+l,spatialReference:i.spatialReference},f=c?(0,k.iV)(h,this.spatialReference):h){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,(0,v.aX)((0,m.im)(i),null,{signal:r});case 16:return d=e.sent[0],e.next=19,(0,v.aX)((0,m.im)(f),null,{signal:r});case 19:if(x=e.sent[0],!(0,p.Wi)(d)&&!(0,p.Wi)(x)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return y=new b.Z(this._searchFeatures(this._getQueryBBoxes(x.toJSON())),null,this),e.next=25,this._reschedule((function(){return y.executeObjectIdsQuery(a)}),r);case 25:return y=e.sent,e.next=28,this._reschedule((function(){return y.executeTimeQuery(a)}),r);case 28:return y=e.sent,e.next=31,this._reschedule((function(){return y.executeAttributesQuery(a)}),r);case 31:return y=e.sent,_=d.toJSON(),S=c?(0,k.iV)(_,this.spatialReference):_,Z=c?Math.max(f.xmax-f.xmin,f.ymax-f.ymin)/2:u,e.abrupt("return",y.createSnappingResponse((0,n.Z)((0,n.Z)({},t),{},{point:S,distance:Z}),i.spatialReference));case 34:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u=this,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,this.timeInfo&&this.timeInfo.trackIdField){e.next=4;break}throw new o.Z(C,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 4:return i=(0,l.d9)(t),e.prev=5,e.next=8,this._schedule((function(){return(0,w.Up)(i,u.definitionExpression,u.spatialReference)}),r);case 8:return i=e.sent,e.next=11,this._reschedule((function(){return u._checkQuerySupport(i)}),r);case 11:return i=e.sent,e.next=14,this._reschedule((function(){return u._executeGeometryQuery(i,r)}),r);case 14:return n=e.sent,e.next=17,this._reschedule((function(){return n.executeAggregateIdsQuery(i)}),r);case 17:return n=e.sent,e.next=20,this._reschedule((function(){return n.executeObjectIdsQuery(i)}),r);case 20:return n=e.sent,e.next=23,this._reschedule((function(){return n.executeTimeQuery(i)}),r);case 23:return n=e.sent,e.next=26,this._reschedule((function(){return n.executeAttributesQuery(i)}),r);case 26:return n=e.sent,e.next=29,this._reschedule((function(){return n.filterLatest()}),r);case 29:n=e.sent,e.next=37;break;case 32:if(e.prev=32,e.t0=e.catch(5),e.t0===w.vF){e.next=36;break}throw e.t0;case 36:n=new b.Z([],null,this);case 37:return e.abrupt("return",n.createQueryResponse(i));case 38:case"end":return e.stop()}}),e,this,[[5,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u,a,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=c.length>1?c[1]:void 0,n=c.length>2?c[2]:void 0,i=r.field,u=r.normalizationField,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:u,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForUniqueValues",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,n=a.length>2?a[2]:void 0,i=r.field,u=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForClassBreaks",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u,a,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=c.length>1?c[1]:void 0,n=c.length>2?c[2]:void 0,i=r.field,u=r.normalizationField,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:u,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForHistogram",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u,a,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=c.length>1?c[1]:void 0,n=c.length>2?c[2]:void 0,i=r.field,u=r.normalizationField,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:u,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_schedule",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.pC)(this._frameTask)?this._frameTask.schedule(t,r):t(I.G5));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.pC)(this._frameTask)?this._frameTask.reschedule(t,r):t(I.G5));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAll",value:function(){if(!this._allItems){var e=[];this.featureStore.forEach((function(t){return e.push(t)})),this._allItems=new b.Z(e,null,this)}return this._allItems}},{key:"_executeGeometryQuery",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,a,c,o,l,h,f,d,x,y,m,v,_,S,R,w,Q,F,I,C,E,G,O,P,A,T=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.geometry,a=t.outSR,c=t.spatialRel,o=t.returnGeometry,l=t.returnCentroid,h=this.featureStore.featureSpatialReference,f=n&&h&&h!==n.spatialReference?(0,k.iV)(n,h):n,d=o||l,x=(0,g.JY)(a)&&!(0,g.fS)(this.spatialReference,a),!(y=this._geometryQueryCache?x&&d?JSON.stringify({originalFilterGeometry:n,spatialRelationship:c,outSpatialReference:a}):JSON.stringify({originalFilterGeometry:n,spatialRelationship:c}):null)){e.next=5;break}if(m=this._geometryQueryCache.get(y),(0,p.o8)(m)){e.next=5;break}return e.abrupt("return",m);case 5:if(v=function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x||!d){e.next=5;break}return e.next=3,t.project(a);case 3:return r=e.sent,e.abrupt("return",(y&&T._geometryQueryCache.put(y,r,r.size||1),r));case 5:return e.abrupt("return",(y&&T._geometryQueryCache.put(y,t,t.size||1),t));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f){e.next=8;break}return e.abrupt("return",v(this._getAll()));case 8:if(_=this.featureAdapter,"esriSpatialRelDisjoint"!==c){e.next=22;break}if((S=this._searchFeatures(this._getQueryBBoxes(n))).length){e.next=13;break}return e.abrupt("return",v(this._getAll()));case 13:Q=new Set,F=(0,i.Z)(S);try{for(F.s();!(I=F.n()).done;)C=I.value,Q.add(_.getObjectId(C))}catch(z){F.e(z)}finally{F.f()}return e.next=18,this._reschedule((function(){var e=0;R=new Array(Q.size),T.featureStore.forEach((function(t){return R[e++]=t})),w=Q}),r);case 18:return e.next=20,this._reschedule((0,u.Z)((0,s.Z)().mark((function e(){var t,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Z.cW)(c,f,T.geometryType,T.hasZ,T.hasM);case 2:return t=e.sent,i=function(e){return!w.has(_.getObjectId(e))||t(_.getGeometry(e))},e.t0=b.Z,e.next=7,T._runSpatialFilter(R,i,r);case 7:return e.t1=e.sent,e.t2=n,e.t3=T,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 11:case"end":return e.stop()}}),e)}))),r);case 20:return E=e.sent,e.abrupt("return",v(E));case 22:if((G=this._searchFeatures(this._getQueryBBoxes(n))).length){e.next=26;break}return O=new b.Z([],n,this),e.abrupt("return",(y&&this._geometryQueryCache.put(y,O,O.size||1),O));case 26:if(!this._canExecuteSoloPass(f,t)){e.next=28;break}return e.abrupt("return",v(new b.Z(G,n,this)));case 28:return e.next=30,(0,Z.cW)(c,f,this.geometryType,this.hasZ,this.hasM);case 30:return P=e.sent,e.next=33,this._runSpatialFilter(G,(function(e){return P(_.getGeometry(e))}),r);case 33:return A=e.sent,e.abrupt("return",v(new b.Z(A,n,this)));case 35:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_runSpatialFilter",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,a,c,o=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(!(0,p.Wi)(this._frameTask)){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,a=new Array,c=function(){var e=(0,u.Z)((0,s.Z)().mark((function e(u){var l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=9;break}if(l=t[i++],r(l)&&(a.push(l),u.madeProgress()),e.t0=u.done,!e.t0){e.next=7;break}return e.next=7,o._reschedule((function(e){return c(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return c(e)}),n).then((function(){return a})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_canExecuteSoloPass",value:function(e,t){var r=this.geometryType,n=t.spatialRel;return(0,Z.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===n||"esriGeometryPoint"===r&&("esriSpatialRelIntersects"===n||"esriSpatialRelContains"===n||"esriSpatialRelWithin"===n))}},{key:"_getQueryBBoxes",value:function(e){if((0,Z.hN)(e)){if((0,m.YX)(e))return[(0,x.al)(e.xmin,e.ymin,e.xmax,e.ymax)];if((0,m.oU)(e))return e.rings.map((function(e){return(0,x.al)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[(0,y.$P)((0,x.Ue)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){E.add(e)}))}}catch(a){r.e(a)}finally{r.f()}var s=new Array(E.size),u=0;return E.forEach((function(e){return s[u++]=e})),E.clear(),s}},{key:"_checkStatisticsSupport",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new o.Z(C,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkStatisticsParamsSupport(r),(0,Z.P0)(t,this.geometryType,this.spatialReference),(0,k._W)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkStatisticsParamsSupport",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!t.valueExpression){e.next=7;break}return e.next=4,(0,F.LC)();case 4:n=e.sent,i=n.arcadeUtils,r=i.extractFieldNames(t.valueExpression);case 7:if(t.field&&r.push(t.field),t.normalizationField&&r.push(t.normalizationField),r.length){e.next=9;break}throw new o.Z(C,"params should have at least a field or valueExpression",{params:t});case 9:(0,_.Of)(this.fieldsIndex,r,"params contains missing fields");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkQuerySupport",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new o.Z(C,"Unsupported query options",{query:t});case 2:return e.abrupt("return",Promise.all([this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),(0,Z.P0)(t,this.geometryType,this.spatialReference),(0,k._W)(this.spatialReference,t.outSR)]).then((function(){return t})));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,i=e.outStatistics,s=i?i.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})).filter(Boolean):[];if(r&&r.length>0){var u=" asc",a=" desc",c=r.map((function(e){var t=e.toLowerCase();return t.indexOf(u)>-1?t.split(u)[0]:t.indexOf(a)>-1?t.split(a)[0]:e})).filter((function(e){return-1===s.indexOf(e)}));(0,_.Of)(this.fieldsIndex,c,"orderByFields contains missing fields")}if(t&&t.length>0)(0,_.Of)(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new o.Z(C,"outFields should be specified for returnDistinctValues",{query:e});(0,_.hO)(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,u,a,c,l,p,h,f,d,x;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.outStatistics,n=t.groupByFieldsForStatistics,u=t.having,a=n&&n.length,c=r&&r.length,!u){e.next=5;break}if(a&&c){e.next=4;break}throw new o.Z(C,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:t});case 4:(0,_.z4)(this.fieldsIndex,u,r);case 5:if(!c){e.next=34;break}if(r.every((function(e){return"exceedslimit"!==e.statisticType}))){e.next=8;break}return e.abrupt("return");case 8:l=r.map((function(e){return e.onStatisticField})).filter(Boolean),(0,_.Of)(this.fieldsIndex,l,"onStatisticFields contains missing fields"),a&&(0,_.Of)(this.fieldsIndex,n,"groupByFieldsForStatistics contains missing fields"),p=(0,i.Z)(r),e.prev=11,p.s();case 13:if((h=p.n()).done){e.next=26;break}if(f=h.value,d=f.onStatisticField,"percentile_disc"!==(x=f.statisticType)&&"percentile_cont"!==x||!("statisticParameters"in f)){e.next=22;break}if(f.statisticParameters){e.next=20;break}throw new o.Z(C,"statisticParamters should be set for percentile type",{definition:f,query:t});case 20:e.next=24;break;case 22:if("count"===x||!d||!(0,_.G3)(d,this.fieldsIndex)){e.next=24;break}throw new o.Z(C,"outStatistics contains non-numeric fields",{definition:f,query:t});case 24:e.next=13;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(11),p.e(e.t0);case 31:return e.prev=31,p.f(),e.finish(31);case 34:case"end":return e.stop()}}),e,this,[[11,28,31,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_getQueryEngineResultForStats",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,u=this,a=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,n=a.length>2?a[2]:void 0,t=(0,l.d9)(t),e.prev=4,e.next=7,this._schedule((function(){return(0,w.Up)(t,u.definitionExpression,u.spatialReference)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return u._checkStatisticsSupport(t,r)}),n);case 10:return t=e.sent,e.next=13,this._reschedule((function(){return u._executeGeometryQuery(t,n)}),n);case 13:return i=e.sent,e.next=16,this._reschedule((function(){return i.executeAggregateIdsQuery(t)}),n);case 16:return i=e.sent,e.next=19,this._reschedule((function(){return i.executeObjectIdsQuery(t)}),n);case 19:return i=e.sent,e.next=22,this._reschedule((function(){return i.executeTimeQuery(t)}),n);case 22:return i=e.sent,e.next=25,this._reschedule((function(){return i.executeAttributesQuery(t)}),n);case 25:i=e.sent,e.next=33;break;case 28:if(e.prev=28,e.t0=e.catch(4),e.t0===w.vF){e.next=32;break}throw e.t0;case 32:i=new b.Z([],null,this);case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this,[[4,28]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),A=(0,d.Ue)(),T=(0,d.Ue)()},60480:function(e,t,r){r.d(t,{g:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},77095:function(e,t,r){r.d(t,{hN:function(){return C},P0:function(){return F},cW:function(){return Q}});var n=r(74165),i=r(37762),s=r(15861),u=r(10064),a=r(34066),c=r(66504);var o=r(77981),l=r(92975);function p(e,t){return e?t?4:3:t?3:2}function h(e,t,r,n,i,s){var u=p(i,s),a=n.coords,c=n.lengths;if(!c)return!1;for(var o=0,l=0;o<c.length;o++,l+=u)if(!f(e,t,r,a[l],a[l+1]))return!1;return!0}function f(e,t,r,n,s){if(!e)return!1;var u,a=p(t,r),c=e.coords,o=e.lengths,l=!1,h=0,f=(0,i.Z)(o);try{for(f.s();!(u=f.n()).done;){var x=u.value;l=d(l,c,a,h,x,n,s),h+=x*a}}catch(y){f.e(y)}finally{f.f()}return l}function d(e,t,r,n,i,s,u){for(var a=e,c=n,o=n,l=n+i*r;o<l;o+=r){(c=o+r)===l&&(c=n);var p=t[o],h=t[o+1],f=t[c],d=t[c+1];(h<u&&d>=u||d<u&&h>=u)&&p+(u-h)/(d-h)*(f-p)<s&&(a=!a)}return a}var x=r(83406),y=r(80457),m=r(19995),v=r(31904),g="feature-store:unsupported-query",_={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},k={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},S={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function Z(e){return!0===k[e]}function R(e){return!0===S[(0,o.Ji)(e)]}function w(e){return!0===b[e]}function Q(e,t,n,i,s){if((0,o.oU)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var u=(0,x.Uy)(new y.Z,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return f(e,t,r,n.coords[0],n.coords[1])}(u,!1,!1,e)}))}if((0,o.oU)(t)&&"esriGeometryMultipoint"===n){var l=(0,x.Uy)(new y.Z,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return h(l,!1,!1,e,i,s)}))}if((0,o.YX)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return(0,a.aV)(t,(0,v.Op)(n,i,s,e))}));if((0,o.YX)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return(0,a.lQ)(t,(0,v.Op)(n,i,s,e))}));if((0,o.YX)(t)&&"esriSpatialRelIntersects"===e){var p=function(e){return"mesh"===e?c.h_:(0,c.IY)(e)}(n);return Promise.resolve((function(e){return p(t,(0,v.Op)(n,i,s,e))}))}return r.e(309).then(r.bind(r,50309)).then((function(r){var u=r[_[e]].bind(null,t.spatialReference,t);return function(e){return u((0,v.Op)(n,i,s,e))}}))}function F(e,t,r){return I.apply(this,arguments)}function I(){return I=(0,s.Z)((0,n.Z)().mark((function e(t,r,i){var s,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.spatialRel,!(a=t.geometry)){e.next=11;break}if(Z(s)){e.next=4;break}throw new u.Z(g,"Unsupported query spatial relationship",{query:t});case 4:if(!(0,l.JY)(a.spatialReference)||!(0,l.JY)(i)){e.next=11;break}if(R(a)){e.next=7;break}throw new u.Z(g,"Unsupported query geometry type",{query:t});case 7:if(w(r)){e.next=9;break}throw new u.Z(g,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",(0,m._W)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function C(e){if((0,o.YX)(e))return!0;if((0,o.oU)(e)){var t,r=(0,i.Z)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(s){r.e(s)}finally{r.f()}return!0}return!1}}}]);
//# sourceMappingURL=4000.5aff8a4a.chunk.js.map