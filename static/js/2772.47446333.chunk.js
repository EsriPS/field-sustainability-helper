"use strict";(self.webpackChunkfield_sustainability_helper=self.webpackChunkfield_sustainability_helper||[]).push([[2772],{52772:function(e,t,i){i.r(t),i.d(t,{default:function(){return Le}});var r=i(37762),n=i(15671),o=i(43144),a=i(11752),s=i(61120),l=i(60136),u=i(29388),d=i(27366),p=i(40110),c=i(100),y=i(32718),h=i(92026),v=i(97642),_=i(66978),b=i(94172),f=i(49861),g=(i(63780),i(93169),i(25243)),m=i(38511),w=i(69912),x=i(11186),S=i(71353),C=i(74184),Z=i(76200),V=i(65905);function k(e){return(0,V.V)("esri/libs/vxl/".concat(e))}var j=y.Z.getLogger("esri.layers.VoxelWasmPerScene"),T=function(){function e(t){(0,n.Z)(this,e),this._halfIntTexturesAvailable=!1,this._havePreparedWithAllLayers=!1,this._renderPluginContext=null,this._vxl=null,this._pluginIsActive=!1,this._moreToLoad=!1,this._viewportWidth=-1,this._viewportHeight=-1,this._newLayers=[],this._layers=new Map,this._renderPass=0,this._renderSlot=22,this._rctx=null,this._renderTargetToRestore=null,this._lastFrameWasStationary=!1,this._wasmMemBlockSizes=[512,1024,2048,4096,8192,16384,32768,65536],this._wasmMemBlocks=new Map,this._dbgFlags=new Set,this._view=t,this.initialize()}return(0,o.Z)(e,[{key:"canRender",get:function(){return!!this._vxl&&"local"===this._view.viewingMode}},{key:"dbg",value:function(e,t){this._dbgFlags.has(e)&&(4===e?j.error(t):j.warn(t))}},{key:"removeRenderPlugin",value:function(){this._pluginIsActive&&this._view._stage&&(this.dbg(1,"--removeRenderPlugin--"),this._view._stage.removeRenderPlugin(this)),this._pluginIsActive=!1}},{key:"initialize",value:function(){var e=this;this.dbg(1,"--initialize--");var t,i=(0,r.Z)(this._wasmMemBlockSizes);try{for(i.s();!(t=i.n()).done;){var n=t.value;this._wasmMemBlocks.set(n,0)}}catch(o){i.e(o)}finally{i.f()}this._readyWatchHandle=(0,b.Ym)((function(){return e._view.ready}),(function(t){t&&"local"===e._view.viewingMode?(e.dbg(1,"view ready status changed to ready on a local view, calling addRenderPlugin"),e._view._stage.addRenderPlugin([e._renderSlot],e),e._pluginIsActive=!0):(e.dbg(1,"view ready status changed, not ready or not a local view!"),e.removeRenderPlugin())}),{initial:!0}),this._qualityWatchHandle=(0,b.Ym)((function(){var t;return null==(t=e._view)?void 0:t.qualityProfile}),(function(t){e.dbg(3,"qualityProfile changed to "+t),e._vxl&&e._vxl.set_quality(e.toWasmQuality(t))}),{initial:!0}),this._timeExtentWatchHandle=(0,b.Ym)((function(){var t;return null==(t=e._view)?void 0:t.timeExtent}),(function(){if(e._vxl){var t,i=e._getTimeArgs(null==(t=e._view)?void 0:t.timeExtent);e.dbg(3,"sceneView timeExtent changed to useTime="+i.useTime+" st="+i.startTime+" et="+i.endTime),e._vxl.set_scene_time_extent(i.startTime,i.endTime,i.useTime),e._renderPluginContext.requestRender()}}),{initial:!0}),this._stationaryWatchHandle=(0,b.Ym)((function(){var t;return null==(t=e._view)?void 0:t.stationary}),(function(t){e._vxl&&t&&!e._lastFrameWasStationary&&e._renderPluginContext.requestRender()}))}},{key:"initializeRenderContext",value:function(e){this.dbg(1,"--initializeRenderContext--");var t=e.renderContext.rctx;"webgl2"===t.webglVersion?(this._renderPluginContext=e,this._rctx=e.renderContext.rctx,this._halfIntTexturesAvailable=!!this._rctx.capabilities.textureNorm16,this.initializeWasm(t.gl)):this.dbg(4,"WebGL 1 context only!")}},{key:"uninitializeRenderContext",value:function(){this._renderPluginContext=null,this._rctx=null,this.dbg(1,"--uninitializeRenderContext--")}},{key:"restoreFramebuffer",value:function(){if(this._renderTargetToRestore){var e=this._renderTargetToRestore.fbo;if(this._rctx){this._rctx.bindFramebuffer(e,!0);var t=this._renderTargetToRestore.viewport;this._rctx.setViewport(t.x,t.y,t.width,t.height)}else this.dbg(4,"no context in restoreFramebuffer!")}}},{key:"bindPreviousDepthToSlot",value:function(e,t){var i=!!this._rctx,r=!!this._renderTargetToRestore;if(!i||!r)return 0;var n=this._renderTargetToRestore.fbo.depthStencilTexture;return n?(0===t?this._rctx.bindTexture(null,e,!0):this._rctx.bindTexture(n,e,!0),1):(this.dbg(4,"no depth/stencil texture exists!"),0)}},{key:"setBlendState",value:function(e,t,i,r){this._rctx?(this._rctx.setBlendingEnabled(1===e),this._rctx.setBlendFunction(t,i),this._rctx.setBlendEquation(r)):this.dbg(4,"setBlendState callback has no rendering context!")}},{key:"setFrontFace",value:function(e){this._rctx?this._rctx.setFrontFace(e):this.dbg(4,"setFrontFace callback has no rendering context!")}},{key:"setDepthStencilStateFunction",value:function(e,t,i){this._rctx?(this._rctx.setDepthFunction(i),this._rctx.setDepthTestEnabled(1===e),this._rctx.setDepthWriteEnabled(1===t),this._rctx.setStencilTestEnabled(!1),this._rctx.setStencilFunction(519,0,255),this._rctx.setStencilOpSeparate(1028,7680,7682,7680),this._rctx.setStencilOpSeparate(1029,7680,7683,7680)):this.dbg(4,"setDepthStencilStateFunction callback has no rendering context!")}},{key:"setRasterizerState",value:function(e){if(this._rctx)switch(e){case 1:this._rctx.setFaceCullingEnabled(!1);break;case 3:this._rctx.setCullFace(1029),this._rctx.setFaceCullingEnabled(!0);break;case 2:this._rctx.setCullFace(1028),this._rctx.setFaceCullingEnabled(!0)}else this.dbg(4,"setRasterizerState callback has no rendering context!")}},{key:"setViewport",value:function(e,t,i,r){this._rctx?this._rctx.setViewport(e,t,i,r):this.dbg(4,"setViewport callback has no rendering context!")}},{key:"_syncRequestsResponses",value:function(){var e=this;this._layers.forEach((function(t,i){var r=[];t.responses.forEach((function(t,n){r.push(n),e.dbg(2,"responding for requestID:"+n+" size:"+t.size),e._vxl.respond(i,n,t)}));for(var n=t.responses,o=0,a=r;o<a.length;o++){var s=a[o];n.delete(s)}var l=e._vxl.get_new_requests(i),u=t.abortController.signal,d=function(i){t.outstandingRequestCount+=1,1===t.outstandingRequestCount&&t.layerView.updatingFlagChanged();var r=l[i],o={responseType:"array-buffer",signal:u};e.dbg(2,"making requestID:"+i+" url:"+r.url),(0,Z.default)(r.url,o).then((function(o){t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),e.dbg(2,"have response for requestID:"+i);var a=0;if(o.data.byteLength>0){a=e._vxl._malloc(o.data.byteLength);for(var s=new Uint8Array(e._vxl.HEAPU8.buffer,a,o.data.byteLength),l=new Uint8Array(o.data),u=0;u<o.data.byteLength;++u)s[u]=l[u]}n.set(+i,{type:r.type,ptr:a,size:o.data.byteLength,success:!0})})).catch((function(o){t.outstandingRequestCount-=1,0===t.outstandingRequestCount&&t.layerView.updatingFlagChanged(),(0,_.D_)(o)||(e.dbg(4,"requestID:".concat(i," failed, error=").concat(o.toString())),n.set(+i,{type:r.type,ptr:0,size:0,success:!1}))}))};for(var p in l)d(p)}))}},{key:"updateWasmCamera",value:function(e){this._vxl.set_projection_matrix.apply(this._vxl,e.projectionMatrix),this._vxl.set_view_matrix.apply(this._vxl,e.viewMatrix),this._vxl.set_near_far(e.near,e.far)}},{key:"isUpdating",value:function(e){return!(this._vxl||!this._vxlPromise)||!!this._layers.has(e)&&this._layers.get(e).outstandingRequestCount>0}},{key:"setEnabled",value:function(e,t){var i=this;this._layers.forEach((function(r,n){r.layerView===e&&(i._vxl.set_enabled(n,t),i._renderPluginContext.requestRender())}))}},{key:"setSlices",value:function(e,t){var i={mask:2,slices:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,i,!0)}},{key:"setDynamicSections",value:function(e,t){var i={mask:4,dynamicSections:{planes:t,currentEditPlane:-1}};return this._doMaskedUIUpdate(e,i,!0)}},{key:"setStaticSections",value:function(e,t){var i={mask:1,staticSections:t};return this._doMaskedUIUpdate(e,i,!0)}},{key:"setCurrentVariable",value:function(e,t){var i={mask:1024,currentVariable:t};return this._doMaskedUIUpdate(e,i,!0)}},{key:"setRenderMode",value:function(e,t){var i={mask:8192,renderMode:t};return this._doMaskedUIUpdate(e,i,!0)}},{key:"_doMaskedUIUpdate",value:function(e,t,i){var r=this;if(!this._vxl)return!1;var n=!1;return this._layers.forEach((function(i,o){if(i.layerView===e){var a={str:JSON.stringify(t),byteCount:0,ptr:0,isReusable:!1};r._AllocateBlock(a)&&(n=1===r._vxl.handle_masked_ui_update(o,a.ptr,a.byteCount),a.isReusable||r._vxl._free(a.ptr))}})),n&&i&&this._renderPluginContext.requestRender(),n}},{key:"addVoxelLayer",value:function(e){if(!this._vxl){var t={layerView:e,resolveCallback:null,rejectCallback:null},i=new Promise((function(e,i){t.resolveCallback=e,t.rejectCallback=i}));return this._newLayers.push(t),i}var r=this._addVoxelLayer(e);return r<0?Promise.reject(-1):Promise.resolve(r)}},{key:"removeVoxelLayer",value:function(e){var t=this;if(!this._vxl){var i=this._newLayers.findIndex((function(t){return e===t.layerView}));i>=0&&(this._newLayers[i].resolveCallback(-1),this._newLayers.splice(i,1));var r=this._newLayers.length;return 0===r&&(this.dbg(1," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),r}var n=-1;this._layers.forEach((function(i,r){i.layerView===e&&(n=r,i.abortController.abort(),t._vxl.remove_layer(n))})),n>=0&&this._layers.delete(n);var o=this._layers.size;return 0===o&&(this.dbg(1," no voxel layers left after removing a layer, removing RenderPlugin and destroying"),this.destroy()),o}},{key:"_getBlockSize",value:function(e){var t,i=(0,r.Z)(this._wasmMemBlockSizes);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(e<n)return n}}catch(o){i.e(o)}finally{i.f()}return-1}},{key:"_AllocateBlock",value:function(e){e.byteCount=this._vxl.lengthBytesUTF8(e.str)+1;var t=this._getBlockSize(e.byteCount);return t<0?(e.isReusable=!1,e.ptr=this._vxl._malloc(e.byteCount)):(e.isReusable=!0,e.ptr=this._wasmMemBlocks.get(t),0===e.ptr&&(e.ptr=this._vxl._malloc(t),this._wasmMemBlocks.set(t,e.ptr))),0!==e.ptr&&(this._vxl.stringToUTF8(e.str,e.ptr,e.byteCount),!0)}},{key:"_getTimeArgs",value:function(e){var t=-Number.MAX_VALUE,i=Number.MAX_VALUE,r=!1;return(0,h.pC)(e)&&(e.isAllTime?r=!0:((0,h.pC)(e.start)&&(r=!0,t=e.start.getTime()/1e3),(0,h.pC)(e.end)&&(r=!0,i=e.end.getTime()/1e3))),{startTime:t,endTime:i,useTime:r}}},{key:"_addVoxelLayer",value:function(e){var t,i,n=e.layer,o=n.getConfiguration();if(o.length<1)return-1;var a={str:o,byteCount:0,ptr:0,isReusable:!1};if(!this._AllocateBlock(a))return-1;var s=this._getTimeArgs(null==(t=this._view)?void 0:t.timeExtent),l=this._view.spatialReference.isWGS84&&n.spatialReference.isWGS84?111319.49079327357:1;if(i=this._vxl.add_layer(n.serviceRoot,a.ptr,a.byteCount,l,l,s.startTime,s.endTime,s.useTime,this.toWasmQuality(this._view.qualityProfile)),a.isReusable||this._vxl._free(a.ptr),i>=0){var u=new AbortController;if(this._layers.set(i,{layerView:e,responses:new Map,outstandingRequestCount:0,abortController:u}),!this._halfIntTexturesAvailable){var d,p=[],c="",y=(0,r.Z)(e.layer.variables);try{for(y.s();!(d=y.n()).done;){var h=d.value;"Int16"!==h.renderingFormat.type&&"UInt16"!==h.renderingFormat.type||(p.push(h.name),h.id===e.layer.style.currentVariableId&&(c=h.name))}}catch(v){y.e(v)}finally{y.f()}""!==c&&j.error("#addVoxelLayer_error()",e.layer,"The voxel layer '".concat(e.layer.title,"' cannot render the current variable '").concat(c,"' in this browser")),p.length>0&&j.warn("#addVoxelLayer_warning()",e.layer,"The voxel layer '".concat(e.layer.title,"' cannot render the variables '").concat(p.toString(),"' in this browser"))}return i}return-1}},{key:"prepareRender",value:function(e){if(this._vxl){var t=e.viewForward,i=e.eye;this._vxl.update_camera_pos_and_direction(i[0],i[1],i[2],t[0],t[1],t[2]);var r=this._vxl.cull();this.dbg(2,"missingResourceCount="+r),this._moreToLoad=r>0,this._havePreparedWithAllLayers=0===this._newLayers.length}}},{key:"render",value:function(e){if(!this._vxl||e.pass!==this._renderPass||e.slot!==this._renderSlot)return!1;var t,i=(0,r.Z)(this._newLayers);try{for(i.s();!(t=i.n()).done;){var n=t.value,o=this._addVoxelLayer(n.layerView);-1===o?n.rejectCallback(-1):n.resolveCallback(o)}}catch(s){i.e(s)}finally{i.f()}if(this._newLayers=[],0===this._layers.size)return this.dbg(4,"No voxel layers but RenderPlugin instance is being asked to render!"),!1;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()},this._syncRequestsResponses(),this._lastFrameWasStationary=this._view.stationary,this._vxl.begin_color_frame(!this._view.stationary||this._moreToLoad,e.scenelightingData.lightingMainDirection[0],e.scenelightingData.lightingMainDirection[1],e.scenelightingData.lightingMainDirection[2]);var a=this._renderTargetToRestore.viewport;return a.width===this._viewportWidth&&a.height===this._viewportHeight||(this._viewportWidth=a.width,this._viewportHeight=a.height,this._vxl.set_viewport(a.width,a.height)),0===a.x&&0===a.y||this.dbg(4,"Unsupported viewport parameters detected!"),this.updateWasmCamera(e.camera),this._vxl.draw(),this._renderTargetToRestore.fbo=null,e.rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),e.rctx.externalVertexArrayObjectUpdate(),e.rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),(this._moreToLoad||!this._havePreparedWithAllLayers&&this._layers.size>0)&&this._renderPluginContext.requestRender(),!0}},{key:"destroy",value:function(){var e=this;this.dbg(1,"--destroy--"),this.removeRenderPlugin(),this._readyWatchHandle=(0,h.hw)(this._readyWatchHandle),this._qualityWatchHandle=(0,h.hw)(this._qualityWatchHandle),this._timeExtentWatchHandle=(0,h.hw)(this._timeExtentWatchHandle),this._stationaryWatchHandle=(0,h.hw)(this._stationaryWatchHandle),this._vxl&&(this._layers.forEach((function(e){e.abortController.abort()})),this._wasmMemBlocks.forEach((function(t){0!==t&&e._vxl._free(t)})),this._vxl.uninitialize_voxel_wasm(),this._vxl=null)}},{key:"initializeWasm",value:function(e){var t=this;return this._vxl?Promise.resolve():(this._vxlPromise||(this._vxlPromise=function(e){return new Promise((function(t){return i.e(4808).then(i.bind(i,4808)).then((function(e){return e.v})).then((function(i){var r=(0,i.default)({locateFile:k,preinitializedWebGLContext:e,onRuntimeInitialized:function(){return t(r)}})}))})).catch((function(e){return Promise.reject(e)}))}(e).then((function(e){var i;if(t._vxl=e,t._vxlPromise=null,t._newLayers.length<=0)return t.dbg(1," no voxel layers left after WASM downloaded, removing RenderPlugin and destroying"),void t.destroy();var r=t._getTimeArgs(null==(i=t._view)?void 0:i.timeExtent),n=t._vxl.addFunction(t.restoreFramebuffer.bind(t),"v"),o=t._vxl.addFunction(t.setBlendState.bind(t),"viiii"),a=t._vxl.addFunction(t.setFrontFace.bind(t),"vi"),s=t._vxl.addFunction(t.setRasterizerState.bind(t),"vi"),l=t._vxl.addFunction(t.setDepthStencilStateFunction.bind(t),"viii"),u=t._vxl.addFunction(t.setViewport.bind(t),"viiii"),d=t._vxl.addFunction(t.bindPreviousDepthToSlot.bind(t),"iii");t._vxl.initialize_voxel_wasm(n,o,a,s,l,u,d,r.startTime,r.endTime,r.useTime),t._renderPluginContext&&t._renderPluginContext.requestRender()})).catch((function(){var e,i=(0,r.Z)(t._newLayers);try{for(i.s();!(e=i.n()).done;){e.value.rejectCallback(-2)}}catch(n){i.e(n)}finally{i.f()}t.dbg(4," WASM failed to download, removing RenderPlugin and destroying"),t.destroy()}))),this._vxlPromise)}},{key:"pickDepth",value:function(e,t,i){if(!this._vxl||!this._rctx||0===this._layers.size)return null;var r=i.viewport[3]-t;if(e<0||e>i.viewport[2]||t<0||t>i.viewport[3])return this.dbg(4,"pickDepth: outOfRange, screenXY=[".concat(e,", ").concat(r,"], vp=[").concat(i.viewport.toString(),"]")),null;this._renderTargetToRestore={fbo:this._rctx.getBoundFramebufferObject(),viewport:this._rctx.getViewport()};var n=i.viewForward,o=i.eye;this._vxl.update_camera_pos_and_direction(o[0],o[1],o[2],n[0],n[1],n[2]),this.updateWasmCamera(i),this._vxl.begin_frame();var a=this._vxl.pick_depth(e,r);return this._renderTargetToRestore.fbo=null,this._rctx.externalTextureUnitUpdate(this._vxl.get_texture_units_bound_in_frame(),this._vxl.get_active_texture_unit()),this._rctx.externalVertexArrayObjectUpdate(),this._rctx.externalVertexBufferUpdate(),this._rctx.externalProgramUpdate(),a.success?a.distanceToCamera:null}},{key:"toWasmQuality",value:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2}}}]),e}(),R=function(){function e(){(0,n.Z)(this,e),this.view2WASM=new Map}return(0,o.Z)(e,[{key:"getVoxelWasmPerSceneView",value:function(e){return this.view2WASM.has(e)?this.view2WASM.get(e):null}},{key:"isUpdating",value:function(e,t){return!!this.view2WASM.has(e)&&this.view2WASM.get(e).isUpdating(t)}},{key:"addLayer",value:function(e,t){return this.view2WASM.has(e)||this.view2WASM.set(e,new T(e)),this.view2WASM.get(e).addVoxelLayer(t)}},{key:"removeLayer",value:function(e,t){this.view2WASM.has(e)&&this.view2WASM.get(e).removeVoxelLayer(t)<1&&this.view2WASM.delete(e)}},{key:"setLayerEnabled",value:function(e,t,i){this.view2WASM.has(e)&&this.view2WASM.get(e).setEnabled(t,i)}},{key:"setLayerSlices",value:function(e,t){var i=!1;return this.view2WASM.forEach((function(r,n){n.allLayerViews.filter((function(e){return"voxel-3d"===e.type})).forEach((function(n){n.layer===e&&(i=r.setSlices(n,t))}))})),i}},{key:"setLayerDynamicSections",value:function(e,t){var i=!1;return this.view2WASM.forEach((function(r,n){n.allLayerViews.filter((function(e){return"voxel-3d"===e.type})).forEach((function(n){n.layer===e&&(i=r.setDynamicSections(n,t))}))})),i}},{key:"setLayerCurrentVariable",value:function(e,t){var i=!1;return this.view2WASM.forEach((function(r,n){n.allLayerViews.filter((function(e){return"voxel-3d"===e.type})).forEach((function(n){n.layer===e&&(i=r.setCurrentVariable(n,t))}))})),i}},{key:"setLayerRenderMode",value:function(e,t){var i=!1;return this.view2WASM.forEach((function(r,n){n.allLayerViews.filter((function(e){return"voxel-3d"===e.type})).forEach((function(n){n.layer===e&&(i=r.setRenderMode(n,t))}))})),i}},{key:"setLayerStaticSections",value:function(e,t){var i=!1;return this.view2WASM.forEach((function(r,n){n.allLayerViews.filter((function(e){return"voxel-3d"===e.type})).forEach((function(n){n.layer===e&&(i=r.setStaticSections(n,t))}))})),i}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),q=i(27961),L=i(11936),W=i(6061),I=i(29598),P=i(56811),M=i(95731),z=i(25899),F=i(45948),A=i(67123),N=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).enabled=!0,e.label="",e.normal=null,e.point=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Boolean,json:{default:!0,write:!0}})],N.prototype,"enabled",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],N.prototype,"label",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:!0}})],N.prototype,"normal",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:!0}})],N.prototype,"point",void 0);var D=N=(0,d._)([(0,w.j)("esri.layers.support.VoxelDynamicSection")],N),E=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).enabled=!0,e.label="",e.normal=null,e.point=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],E.prototype,"enabled",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],E.prototype,"label",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:!0}})],E.prototype,"normal",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:!0}})],E.prototype,"point",void 0);var B=E=(0,d._)([(0,w.j)("esri.layers.support.VoxelSlice")],E),U=i(53283),H=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).enabled=!0,e.href=null,e.id=null,e.label="",e.normal=null,e.point=null,e.sizeInPixel=null,e.slices=null,e.timeId=0,e.variableId=null,e}return(0,o.Z)(i,[{key:"readHref",value:function(e,t,i){return(0,U.f)(e,i)}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:Boolean,json:{default:!0,write:!0}})],H.prototype,"enabled",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],H.prototype,"href",void 0),(0,d._)([(0,m.r)(["service","web-scene"],"href")],H.prototype,"readHref",null),(0,d._)([(0,f.Cb)({type:g.z8,json:{write:{enabled:!0,isRequired:!0}}})],H.prototype,"id",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],H.prototype,"label",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],H.prototype,"normal",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],H.prototype,"point",void 0),(0,d._)([(0,f.Cb)({type:[g.z8],json:{write:{enabled:!0,isRequired:!0}}})],H.prototype,"sizeInPixel",void 0),(0,d._)([(0,f.Cb)({type:[B],json:{write:!0}})],H.prototype,"slices",void 0),(0,d._)([(0,f.Cb)({type:g.z8,json:{default:0,write:!0}})],H.prototype,"timeId",void 0),(0,d._)([(0,f.Cb)({type:g.z8,json:{write:{enabled:!0,isRequired:!0}}})],H.prototype,"variableId",void 0);var O=H=(0,d._)([(0,w.j)("esri.layers.support.VoxelSection")],H),Y=i(60354),J=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).diffuseFactor=.5,e.specularFactor=.5,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Number,range:{min:0,max:1},json:{default:.5,write:!0}})],J.prototype,"diffuseFactor",void 0),(0,d._)([(0,f.Cb)({type:Number,range:{min:0,max:1},json:{default:.5,write:!0}})],J.prototype,"specularFactor",void 0);var G=J=(0,d._)([(0,w.j)("esri.layers.support.VoxelSimpleShading")],J),Q=i(51995),X=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).color=null,e.value=null,e.enabled=!0,e.label=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Q.Z,json:{type:[g.z8],write:{enabled:!0,isRequired:!0}}})],X.prototype,"color",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],X.prototype,"value",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{default:!0,write:!0}})],X.prototype,"enabled",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],X.prototype,"label",void 0);var K=X=(0,d._)([(0,w.j)("esri.layers.support.VoxelIsosurface")],X),$=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).alpha=0,e.position=0,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],$.prototype,"alpha",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],$.prototype,"position",void 0);var ee=$=(0,d._)([(0,w.j)("esri.layers.support.VoxelAlphaStop")],$),te=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).color=null,e.position=0,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Q.Z,json:{type:[g.z8],write:{enabled:!0,isRequired:!0}}})],te.prototype,"color",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],te.prototype,"position",void 0);var ie=te=(0,d._)([(0,w.j)("esri.layers.support.VoxelColorStop")],te),re=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).enabled=!1,e.range=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Boolean,json:{default:!1,write:!0}})],re.prototype,"enabled",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:!0}})],re.prototype,"range",void 0);var ne=re=(0,d._)([(0,w.j)("esri.layers.support.VoxelRangeFilter")],re),oe=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).interpolation=null,r.stretchRange=null,r.rangeFilter=null,r.colorStops=new p.Z,r.alphaStops=new p.Z,r}return(0,o.Z)(i,[{key:"colorStops",set:function(e){this._set("colorStops",(0,Y.Z)(e,this._get("colorStops"),p.Z.ofType(ie)))}},{key:"alphaStops",set:function(e){this._set("alphaStops",(0,Y.Z)(e,this._get("alphaStops"),p.Z.ofType(ee)))}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:["linear","nearest"],json:{write:!0}})],oe.prototype,"interpolation",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],oe.prototype,"stretchRange",void 0),(0,d._)([(0,f.Cb)({type:p.Z.ofType(ie),json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!!this.colorStops&&this.colorStops.length>0}}}}})],oe.prototype,"colorStops",null),(0,d._)([(0,f.Cb)({type:p.Z.ofType(ee),json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!!this.alphaStops&&this.alphaStops.length>0}}}}})],oe.prototype,"alphaStops",null),(0,d._)([(0,f.Cb)({type:ne,json:{write:!0}})],oe.prototype,"rangeFilter",void 0);var ae=oe=(0,d._)([(0,w.j)("esri.layers.support.VoxelTransferFunctionStyle")],oe),se=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).color=null,e.value=0,e.enabled=!0,e.label=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Q.Z,json:{type:[g.z8],write:{enabled:!0,isRequired:!0}}})],se.prototype,"color",void 0),(0,d._)([(0,f.Cb)({type:g.z8,json:{write:{enabled:!0,isRequired:!0}}})],se.prototype,"value",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{default:!0,write:!0}})],se.prototype,"enabled",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],se.prototype,"label",void 0);var le=se=(0,d._)([(0,w.j)("esri.layers.support.VoxelUniqueValue")],se),ue=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).variableId=0,r.label=null,r.transferFunction=null,r.uniqueValues=new p.Z,r.isosurfaces=new p.Z,r}return(0,o.Z)(i,[{key:"uniqueValues",set:function(e){this._set("uniqueValues",(0,Y.Z)(e,this._get("uniqueValues"),p.Z.ofType(le)))}},{key:"isosurfaces",set:function(e){this._set("isosurfaces",(0,Y.Z)(e,this._get("isosurfaces"),p.Z.ofType(K)))}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:g.z8,json:{write:{enabled:!0,isRequired:!0}}})],ue.prototype,"variableId",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],ue.prototype,"label",void 0),(0,d._)([(0,f.Cb)({type:ae,json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!this.uniqueValues||this.uniqueValues.length<1}}}}})],ue.prototype,"transferFunction",void 0),(0,d._)([(0,f.Cb)({type:p.Z.ofType(le),json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!!this.uniqueValues&&this.uniqueValues.length>0}}}}})],ue.prototype,"uniqueValues",null),(0,d._)([(0,f.Cb)({type:p.Z.ofType(K),json:{write:{enabled:!0,overridePolicy:function(){var e=!this.uniqueValues||this.uniqueValues.length<1,t=!!this.isosurfaces&&this.isosurfaces.length>0;return{enabled:e&&t}}}}})],ue.prototype,"isosurfaces",null);var de=ue=(0,d._)([(0,w.j)("esri.layers.support.VoxelVariableStyle")],ue),pe=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).volumeId=0,r.verticalExaggeration=1,r.exaggerationMode="scale-height",r.verticalOffset=0,r.slices=new p.Z,r.dynamicSections=new p.Z,r}return(0,o.Z)(i,[{key:"slices",set:function(e){this._set("slices",(0,Y.Z)(e,this._get("slices"),p.Z.ofType(B)))}},{key:"dynamicSections",set:function(e){this._set("dynamicSections",(0,Y.Z)(e,this._get("dynamicSections"),p.Z.ofType(D)))}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:g.z8,json:{write:{enabled:!0,isRequired:!0}}})],pe.prototype,"volumeId",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{default:1,write:!0}})],pe.prototype,"verticalExaggeration",void 0),(0,d._)([(0,f.Cb)({type:["scale-position","scale-height"],json:{default:"scale-height",write:!0}})],pe.prototype,"exaggerationMode",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{default:0,write:!0}})],pe.prototype,"verticalOffset",void 0),(0,d._)([(0,f.Cb)({type:p.Z.ofType(B),json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!!this.slices&&this.slices.length>0}}}}})],pe.prototype,"slices",null),(0,d._)([(0,f.Cb)({type:p.Z.ofType(D),json:{write:{enabled:!0,overridePolicy:function(){return{enabled:!!this.dynamicSections&&this.dynamicSections.length>0}}}}})],pe.prototype,"dynamicSections",null);var ce=pe=(0,d._)([(0,w.j)("esri.layers.support.VoxelVolumeStyle")],pe),ye=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).currentVariableId=0,r.renderMode="volume",r.enableSlices=!0,r.enableSections=!0,r.enableDynamicSections=!0,r.enableIsosurfaces=!0,r.shading=new G,r.volumeStyles=new p.Z,r.variableStyles=new p.Z,r}return(0,o.Z)(i,[{key:"volumeStyles",set:function(e){this._set("volumeStyles",(0,Y.Z)(e,this._get("volumeStyles"),p.Z.ofType(ce)))}},{key:"variableStyles",set:function(e){this._set("variableStyles",(0,Y.Z)(e,this._get("variableStyles"),p.Z.ofType(de)))}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:p.Z.ofType(ce),json:{write:!0}})],ye.prototype,"volumeStyles",null),(0,d._)([(0,f.Cb)({type:g.z8,json:{write:{enabled:!0,isRequired:!0}}})],ye.prototype,"currentVariableId",void 0),(0,d._)([(0,f.Cb)({type:["volume","surfaces"],json:{write:!0}})],ye.prototype,"renderMode",void 0),(0,d._)([(0,f.Cb)({type:p.Z.ofType(de),json:{write:!0}})],ye.prototype,"variableStyles",null),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],ye.prototype,"enableSlices",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],ye.prototype,"enableSections",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],ye.prototype,"enableDynamicSections",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],ye.prototype,"enableIsosurfaces",void 0),(0,d._)([(0,f.Cb)({type:G,json:{write:!0}})],ye.prototype,"shading",void 0);var he=ye=(0,d._)([(0,w.j)("esri.layers.support.VoxelStyle")],ye),ve=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).continuity=null,e.hasNoData=!1,e.noData=0,e.offset=0,e.scale=1,e.type=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:["discrete","continuous"],json:{write:!0}})],ve.prototype,"continuity",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],ve.prototype,"hasNoData",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],ve.prototype,"noData",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],ve.prototype,"offset",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],ve.prototype,"scale",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],ve.prototype,"type",void 0);var _e=ve=(0,d._)([(0,w.j)("esri.layers.support.VoxelFormat")],ve),be=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).id=null,e.description="",e.name=null,e.originalFormat=null,e.renderingFormat=null,e.unit="",e.volumeId=0,e.type=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],be.prototype,"id",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],be.prototype,"description",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:{enabled:!0,isRequired:!0}}})],be.prototype,"name",void 0),(0,d._)([(0,f.Cb)({type:_e,json:{write:!0}})],be.prototype,"originalFormat",void 0),(0,d._)([(0,f.Cb)({type:_e,json:{write:{enabled:!0,isRequired:!0}}})],be.prototype,"renderingFormat",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],be.prototype,"unit",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],be.prototype,"volumeId",void 0),(0,d._)([(0,f.Cb)({type:["stc-hot-spot-results","stc-cluster-outlier-results","stc-estimated-bin","generic-nearest-interpolated"],json:{write:!0}})],be.prototype,"type",void 0);var fe=be=(0,d._)([(0,w.j)("esri.layers.support.VoxelVariable")],be),ge=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).values=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:[Number],json:{write:!0}})],ge.prototype,"values",void 0);var me=ge=(0,d._)([(0,w.j)("esri.layers.support.VoxelIrregularSpacing")],ge),we=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).scale=1,e.offset=0,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],we.prototype,"scale",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],we.prototype,"offset",void 0);var xe=we=(0,d._)([(0,w.j)("esri.layers.support.VoxelRegularSpacing")],we),Se=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).irregularSpacing=null,e.isPositiveUp=null,e.isWrappedDateLine=null,e.label=null,e.name=null,e.quantity=null,e.regularSpacing=null,e.size=0,e.unit=null,e}return(0,o.Z)(i)}(A.wq);(0,d._)([(0,f.Cb)({type:me,json:{write:!0}})],Se.prototype,"irregularSpacing",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],Se.prototype,"isPositiveUp",void 0),(0,d._)([(0,f.Cb)({type:Boolean,json:{write:!0}})],Se.prototype,"isWrappedDateLine",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],Se.prototype,"label",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],Se.prototype,"name",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],Se.prototype,"quantity",void 0),(0,d._)([(0,f.Cb)({type:xe,json:{write:!0}})],Se.prototype,"regularSpacing",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:!0}})],Se.prototype,"size",void 0),(0,d._)([(0,f.Cb)({type:String,json:{write:!0}})],Se.prototype,"unit",void 0);var Ce=Se=(0,d._)([(0,w.j)("esri.layers.support.VoxelDimension")],Se),Ze=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).id=0,e.dimensions=null,e}return(0,o.Z)(i,[{key:"getZDimension",value:function(){if(!this.dimensions)return-1;if(!Array.isArray(this.dimensions))return-1;if(4!==this.dimensions.length)return-1;for(var e=2;e<4;++e)if(this.dimensions[e].size>0)return e;return-1}},{key:"isVolumeValid",value:function(){return!!this.dimensions&&!!Array.isArray(this.dimensions)&&4===this.dimensions.length&&!(this.dimensions[0].size<1||this.dimensions[1].size<1)&&-1!==this.getZDimension()}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],Ze.prototype,"id",void 0),(0,d._)([(0,f.Cb)({type:[Ce],json:{write:{enabled:!0,isRequired:!0}}})],Ze.prototype,"dimensions",void 0);var Ve,ke=Ze=(0,d._)([(0,w.j)("esri.layers.support.VoxelVolume")],Ze),je=Ve=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).apronWidth=1,e.brickSize=[32,32,32],e.maxLodLevel=0,e.nodeSize=[4,4,4],e}return(0,o.Z)(i,[{key:"isValid",value:function(){var e=new Ve;return e.apronWidth===this.apronWidth&&e.maxLodLevel===this.maxLodLevel&&!!this.brickSize&&!!this.nodeSize&&!(!Array.isArray(this.brickSize)||!Array.isArray(this.nodeSize))&&3===this.brickSize.length&&3===this.nodeSize.length&&32===this.brickSize[0]&&32===this.brickSize[1]&&32===this.brickSize[2]&&4===this.nodeSize[0]&&4===this.nodeSize[1]&&4===this.nodeSize[2]}}]),i}(A.wq);(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],je.prototype,"apronWidth",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],je.prototype,"brickSize",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}}})],je.prototype,"maxLodLevel",void 0),(0,d._)([(0,f.Cb)({type:[Number],json:{write:{enabled:!0,isRequired:!0}}})],je.prototype,"nodeSize",void 0);var Te=je=Ve=(0,d._)([(0,w.j)("esri.layers.support.VoxelVolumeIndex")],je),Re=y.Z.getLogger(" esri.layers.VoxelLayer"),qe=function(e){(0,l.Z)(i,e);var t=(0,u.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e)).serviceRoot="",r.popupEnabled=!0,r.operationalLayerType="Voxel",r.legendEnabled=!0,r.title=null,r.sections=new p.Z,r.style=null,r.opacity=1,r.variables=new p.Z,r.volumes=new p.Z,r.index=null,r.minScale=0,r.maxScale=0,r.type="voxel",r._dbgFlags=new Set,r._handles=new c.Z,r.version={major:Number.NaN,minor:Number.NaN,versionString:""},r}return(0,o.Z)(i,[{key:"url",set:function(e){this._set("url",(0,z.Nm)(e,Re))}},{key:"destroy",value:function(){this._handles=(0,h.SC)(this._handles)}},{key:"dbg",value:function(e,t){this._dbgFlags.has(e)&&(3===e?Re.error(t):Re.warn(t))}},{key:"load",value:function(e){var t=this,i=(0,h.pC)(e)?e.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},e).catch(_.r9).then((function(){return t._fetchService(i)})).then((function(){return t.serviceRoot=t.url}));return this.addResolvingPromise(r),Promise.resolve(this)}},{key:"getConfiguration",value:function(){var e=this;this._handles.add([(0,b.Ym)((function(){return e._getRenderMode()}),(function(t){return e._pushRenderModeToWasm(t)})),(0,b.Ym)((function(){return e._getCurrentVariableId()}),(function(t){return e._pushCurrentVariableIdToWasm(t)})),(0,b.Ym)((function(){return e._getDynamicSections()}),(function(t){return e._pushDynamicSectionsToWasm(t)})),(0,b.Ym)((function(){return e._getSlices()}),(function(t){return e._pushSlicesToWasm(t)})),(0,b.Ym)((function(){return e._getSections()}),(function(t){return e._pushSectionsToWasm(t)}))]);var t={layerType:this.operationalLayerType,version:this.version.versionString,name:this.title,spatialReference:this.spatialReference,fullExtent:this.fullExtent,volumes:this.volumes.toJSON(),variables:this.variables.toJSON(),index:this.index.toJSON(),sections:this.sections.toJSON(),style:this.style};return t.index&&this.index.isValid()?JSON.stringify(t):""}},{key:"readVersion",value:function(e,t){return(0,a.Z)((0,s.Z)(i.prototype),"parseVersionString",this).call(this,e)}},{key:"_getSections",value:function(){var e,t=[],i=(0,r.Z)(this.sections);try{for(i.s();!(e=i.n()).done;){var n=e.value;t.push(new O({enabled:n.enabled,href:n.href,id:n.id,label:n.label,normal:n.normal,point:n.point,sizeInPixel:n.sizeInPixel,slices:n.slices,timeId:n.timeId,variableId:n.variableId}))}}catch(o){i.e(o)}finally{i.f()}return t}},{key:"_pushSectionsToWasm",value:function(e){this.dbg(2,"VoxelLayer._pushSectionsToWasm() called"),R.getInstance().setLayerStaticSections(this,e)||this.dbg(3,"VoxelLayer._pushSectionsToWasm() failed!")}},{key:"_isPlaneValid",value:function(e,t,i){if(!e.point)return!1;if(!Array.isArray(e.point)||3!==e.point.length)return!1;if(!e.normal)return!1;if(!Array.isArray(e.normal)||3!==e.normal.length)return!1;for(var r=0;r<3;++r){var n=e.point[r];if(n<0||n>=i[t[r]].size)return!1}var o=(0,S.f)(e.normal[0],e.normal[1],e.normal[2]);(0,x.n)(o,o);return!(Math.abs(o[0])+Math.abs(o[1])+Math.abs(o[2])<1e-6)&&(e.normal[0]=o[0],e.normal[1]=o[1],e.normal[2]=o[2],!0)}},{key:"getVariableStyle",value:function(e){var t;if(t=(0,h.pC)(e)?e:this._getCurrentVariableId(),!(null==this?void 0:this.style.variableStyles)||-1===t)return null;var i=this.style.variableStyles.findIndex((function(e){return e.variableId===t}));return i<0?null:this.style.variableStyles.getItemAt(i)}},{key:"getVariable",value:function(e){var t;if(t=(0,h.pC)(e)?e:this._getCurrentVariableId(),!this.variables||-1===t)return null;var i=this.variables.findIndex((function(e){return e.id===t}));return i<0?null:this.variables.getItemAt(i)}},{key:"_getVolume",value:function(e){var t=this.getVariable(e);return(0,h.pC)(t)?this.volumes.find((function(e){return e.id===t.volumeId})):null}},{key:"_getVolumeStyle",value:function(e){var t=this.getVariable(e);return(0,h.pC)(t)?this.style.volumeStyles.find((function(e){return e.volumeId===t.volumeId})):null}},{key:"_getSlices",value:function(){var e=[],t=this._getVolume(null);if(!(0,h.pC)(t)||!t.isVolumeValid())return e;var i=this._getVolumeStyle(null);if(!(0,h.pC)(i))return e;var n,o=(0,r.Z)(i.slices);try{for(o.s();!(n=o.n()).done;){var a=n.value;this._isPlaneValid(a,[0,1,t.getZDimension()],t.dimensions)?e.push(new B({enabled:a.enabled,label:a.label,point:a.point,normal:a.normal})):e.push(new B({enabled:!1,label:"invalid",point:a.point,normal:a.normal}))}}catch(s){o.e(s)}finally{o.f()}return e}},{key:"_pushSlicesToWasm",value:function(e){this.dbg(2,"VoxelLayer._pushSlicesToWasm() called!"),R.getInstance().setLayerSlices(this,e)||this.dbg(3,"VoxelLayer._pushSlicesToWasm() failed!")}},{key:"_getDynamicSections",value:function(){var e=[],t=this._getVolume(null);if(!(0,h.pC)(t)||!t.isVolumeValid())return e;var i=this._getVolumeStyle(null);if(!(0,h.pC)(i))return e;var n,o=(0,r.Z)(i.dynamicSections);try{for(o.s();!(n=o.n()).done;){var a=n.value;this._isPlaneValid(a,[0,1,t.getZDimension()],t.dimensions)?e.push(new D({enabled:a.enabled,label:a.label,point:a.point,normal:a.normal})):e.push(new D({enabled:!1,label:"invalid",point:a.point,normal:a.normal}))}}catch(s){o.e(s)}finally{o.f()}return e}},{key:"_pushDynamicSectionsToWasm",value:function(e){this.dbg(2,"VoxelLayer._pushDynamicSectionsToWasm() called!"),R.getInstance().setLayerDynamicSections(this,e)||this.dbg(3,"VoxelLayer._updateDynamicSections() failed!")}},{key:"_getCurrentVariableId",value:function(){return this.style?this.style.currentVariableId:-1}},{key:"_pushCurrentVariableIdToWasm",value:function(e){this.dbg(2,"VoxelLayer._pushCurrentVariableIdToWasm() called!"),R.getInstance().setLayerCurrentVariable(this,e)||this.dbg(3,"VoxelLayer._pushCurrentVariableIdToWasm() failed!")}},{key:"_getRenderMode",value:function(){return this.style?this.style.renderMode:"volume"}},{key:"_pushRenderModeToWasm",value:function(e){this.dbg(2,"VoxelLayer._pushRenderModeToWasm() called!"),R.getInstance().setLayerRenderMode(this,e)||this.dbg(3,"VoxelLayer.setLayerRenderMode() failed!")}}]),i}((0,M.V)((0,L.Y)((0,W.q)((0,I.I)((0,P.M)((0,v.R)((0,q.V)(C.Z))))))));(0,d._)([(0,f.Cb)(F.C_)],qe.prototype,"popupEnabled",void 0),(0,d._)([(0,f.Cb)({type:["Voxel"]})],qe.prototype,"operationalLayerType",void 0),(0,d._)([(0,f.Cb)(F.rn)],qe.prototype,"legendEnabled",void 0),(0,d._)([(0,f.Cb)({json:{write:!0}})],qe.prototype,"title",void 0),(0,d._)([(0,f.Cb)(F.HQ)],qe.prototype,"url",null),(0,d._)([(0,f.Cb)({type:p.Z.ofType(O),json:{write:!0,origins:{"web-scene":{name:"layerDefinition.sections",write:!0},service:{write:!1}}}})],qe.prototype,"sections",void 0),(0,d._)([(0,f.Cb)({type:he,json:{write:!0,origins:{"web-scene":{name:"layerDefinition.style",write:!0},service:{write:!1}}}})],qe.prototype,"style",void 0),(0,d._)([(0,f.Cb)({type:["show","hide"]})],qe.prototype,"listMode",void 0),(0,d._)([(0,f.Cb)({type:Number,range:{min:0,max:1},nonNullable:!0,json:{read:!1,write:!1,origins:{"web-scene":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],qe.prototype,"opacity",void 0),(0,d._)([(0,f.Cb)({type:p.Z.ofType(fe)})],qe.prototype,"variables",void 0),(0,d._)([(0,f.Cb)({type:p.Z.ofType(ke)})],qe.prototype,"volumes",void 0),(0,d._)([(0,f.Cb)({type:Te})],qe.prototype,"index",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{name:"layerDefinition.minScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],qe.prototype,"minScale",void 0),(0,d._)([(0,f.Cb)({type:Number,json:{name:"layerDefinition.maxScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],qe.prototype,"maxScale",void 0),(0,d._)([(0,f.Cb)({json:{read:!1},readOnly:!0})],qe.prototype,"type",void 0),(0,d._)([(0,f.Cb)({readOnly:!0,json:{name:"serviceVersion"}})],qe.prototype,"version",void 0),(0,d._)([(0,m.r)("service","version")],qe.prototype,"readVersion",null);var Le=qe=(0,d._)([(0,w.j)("esri.layers.VoxelLayer")],qe)}}]);
//# sourceMappingURL=2772.47446333.chunk.js.map